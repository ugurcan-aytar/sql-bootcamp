<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style_bootstrap.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/code.css">
    <link href="https://cdn.prod.website-files.com/5efdb54f07a6812bcd95cc65/6773d0fc3013e060f08d7145_favicon.jpg"
        rel="shortcut icon" type="image/x-icon">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>Day 2: Hands-on Workshop</title>
    <style>
        code {
            white-space: pre-wrap;
        }

        span.smallcaps {
            font-variant: small-caps;
        }

        span.underline {
            text-decoration: underline;
        }

        div.column {
            display: inline-block;
            vertical-align: top;
            width: 50%;
        }

        div.hanging-indent {
            margin-left: 1.5em;
            text-indent: -1.5em;
        }

        ul.task-list {
            list-style: none;
        }

        .language-switcher {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .language-switcher a {
            text-decoration: none;
            padding: 5px 10px;
            margin: 0 2px;
            border-radius: 3px;
            color: #333;
        }

        .language-switcher a.active {
            background: #0d6efd;
            color: #fff;
        }

        .language-switcher a:hover:not(.active) {
            background: #e9ecef;
        }

        .exercise-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .exercise-box h4 {
            color: #495057;
            margin-bottom: 15px;
        }

        .solution-box {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .solution-box.show {
            display: block;
        }

        .toggle-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .toggle-btn:hover {
            background-color: #0056b3;
        }

        .hint-box {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .hint-box::before {
            content: "Hint: ";
            font-weight: bold;
        }

        .concept-box {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .concept-box::before {
            content: "Concept: ";
            font-weight: bold;
        }

        .dataset-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        .dataset-table th,
        .dataset-table td {
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            text-align: left;
        }

        .dataset-table th {
            background-color: #343a40;
            color: white;
        }

        .dataset-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
    </style>
</head>

<body>
    <a href="../index_en.html" class="back-button">&larr; Back to Index</a>
    <div class="language-switcher">
        <a href="04_hands_on_workshop.html" class="active">EN</a>
        <a href="04_hands_on_workshop_tr.html">TR</a>
    </div>
    <div class="copy-notification" id="copyNotification">Copied!</div>
    <div id="europeanunion-turkey">
        <img src="../static/eu.png" alt="">
    </div>
    <div id="sanayiteknolojibakan">
        <img src="../static/sanayitek.png" alt="">
    </div>
    <div id="rekabet">
        <img src="../static/rekabet.png" alt="">
    </div>
    <div id="tisk">
        <img src="../static/tisk.png" alt="">
    </div>
    <div id="undp">
        <img src="../static/undp.png" alt="">
    </div>
    <div class="content-container">
        <div class="container">
            <section>
                <h1 id="day-2-hands-on-workshop">Day 2: Hands-on Workshop</h1>
                <h2 id="exploring-the-database">Exploring the bootcamp_db Database</h2>

                <p>In this hands-on workshop, we'll explore the structure and content of the <code>bootcamp_db</code> database, applying the SQL concepts we've learned. This PostgreSQL database contains tables for a typical e-commerce scenario.</p>

                <div class="concept-box">
                    The <code>bootcamp_db</code> database includes: <code>customers</code>, <code>products</code> (with JSONB attributes), <code>orders</code> (with JSONB metadata), <code>order_lines</code>, <code>categories</code>, <code>suppliers</code>, <code>employees</code>, <code>stock_movements</code>, and <code>countries</code>.
                </div>

                <h3 id="navigating-schemas-and-tables">Navigating Schemas and Tables</h3>
                <p>Let's start by exploring the available schemas and tables:</p>

                <div class="row">
                    <div class="col-md-4">
                        <pre><code class="language-sql">-- List all schemas in the database
SELECT schema_name
FROM information_schema.schemata
ORDER BY schema_name;</code></pre>
                    </div>
                    <div class="col-md-4">
                        <pre><code class="language-sql">-- List tables in the public schema
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
ORDER BY table_name;</code></pre>
                    </div>
                    <div class="col-md-4">
                        <pre><code class="language-sql">-- Count tables in each schema
SELECT table_schema, COUNT(*) as table_count
FROM information_schema.tables
WHERE table_type = 'BASE TABLE'
GROUP BY table_schema
ORDER BY table_count DESC;</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <h3 id="exploring-table-structure">Exploring Table Structure</h3>
                <p>Let's examine the structure of some key tables in the database:</p>

                <div class="row">
                    <div class="col-md-6">
                        <pre><code class="language-sql">-- Describe the customers table
SELECT
    column_name,
    data_type,
    character_maximum_length,
    is_nullable
FROM
    information_schema.columns
WHERE
    table_name = 'customers'
ORDER BY
    ordinal_position;</code></pre>
                    </div>
                    <div class="col-md-6">
                        <pre><code class="language-sql">-- Examine constraints on the orders table
SELECT
    tc.constraint_name,
    tc.constraint_type,
    kcu.column_name,
    ccu.table_name AS foreign_table,
    ccu.column_name AS foreign_column
FROM
    information_schema.table_constraints tc
JOIN
    information_schema.key_column_usage kcu
    ON tc.constraint_name = kcu.constraint_name
LEFT JOIN
    information_schema.constraint_column_usage ccu
    ON ccu.constraint_name = tc.constraint_name
WHERE
    tc.table_name = 'orders'
ORDER BY
    tc.constraint_type,
    kcu.column_name;</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <h3 id="finding-relationships">Finding Relationships Between Tables</h3>
                <p>Understanding table relationships is crucial for effective querying:</p>
                <pre><code class="language-sql">-- Find all tables that reference customers
SELECT
    tc.table_name,
    kcu.column_name
FROM
    information_schema.table_constraints tc
JOIN
    information_schema.key_column_usage kcu
    ON tc.constraint_name = kcu.constraint_name
JOIN
    information_schema.constraint_column_usage ccu
    ON ccu.constraint_name = tc.constraint_name
WHERE
    tc.constraint_type = 'FOREIGN KEY' AND
    ccu.table_name = 'customers' AND
    ccu.column_name = 'id'
ORDER BY
    tc.table_name;</code></pre>
            </section>

            <section>
                <h3 id="understanding-data-model">Understanding the Data Model</h3>
                <p>The <code>bootcamp_db</code> data model is designed for e-commerce scenarios. Let's explore some of the core business entities:</p>

                <div class="row">
                    <div class="col-md-6">
                        <ol>
                            <li><strong>Customers</strong>:
                                <ul>
                                    <li>Customer information with types: individual, business, vip</li>
                                    <li>Links to orders and countries</li>
                                </ul>
                            </li>
                            <li><strong>Products</strong>:
                                <ul>
                                    <li>Product catalog with categories and suppliers</li>
                                    <li><code>attributes</code> JSONB column for flexible specifications</li>
                                </ul>
                            </li>
                            <li><strong>Orders & Order Lines</strong>:
                                <ul>
                                    <li><code>orders</code>: Order header with status, totals, and metadata JSONB</li>
                                    <li><code>order_lines</code>: Individual items within orders</li>
                                </ul>
                            </li>
                        </ol>
                    </div>
                    <div class="col-md-6">
                        <ol start="4">
                            <li><strong>Categories</strong>:
                                <ul>
                                    <li>Hierarchical product categories with parent_id</li>
                                    <li>Supports recursive queries</li>
                                </ul>
                            </li>
                            <li><strong>Employees</strong>:
                                <ul>
                                    <li>Employee hierarchy with manager_id</li>
                                    <li>Includes department and salary information</li>
                                </ul>
                            </li>
                            <li><strong>Stock Movements</strong>:
                                <ul>
                                    <li>Tracks inventory changes: purchase, sale, return, adjustment</li>
                                </ul>
                            </li>
                        </ol>
                    </div>
                </div>
            </section>

            <section>
                <p>Let's explore these entities with some queries:</p>
                <div class="row">
                    <div class="col-md-6">
                        <pre><code class="language-sql">-- Overview of customers by type
SELECT
    customer_type,
    COUNT(*) as count
FROM
    customers
WHERE
    status = 'active'
GROUP BY
    customer_type
ORDER BY
    count DESC;</code></pre>
                    </div>
                    <div class="col-md-6">
                        <pre><code class="language-sql">-- Product categories hierarchy
WITH RECURSIVE category_tree AS (
    SELECT
        id,
        name,
        parent_id,
        0 AS level,
        name::TEXT AS path
    FROM categories
    WHERE parent_id IS NULL
    UNION ALL
    SELECT
        c.id,
        c.name,
        c.parent_id,
        ct.level + 1,
        ct.path || ' > ' || c.name
    FROM categories c
    JOIN category_tree ct ON c.parent_id = ct.id
)
SELECT
    level,
    path,
    (SELECT COUNT(*) FROM products p WHERE p.category_id = category_tree.id) AS product_count
FROM category_tree
ORDER BY path;</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <h3 id="writing-basic-queries">Writing Basic Queries Against the Database</h3>
                <p>Now let's practice writing queries that extract useful business information. Study each example carefully before looking at the SQL code.</p>

                <div class="exercise-box">
                    <h4>Example 1: Customer Analysis</h4>
                    <p><strong>Goal:</strong> Identify the top 10 most valuable customers based on their total purchase amount.</p>
                    <p><strong>Business Question:</strong> Who are our best customers and how much have they spent?</p>
                    <p><strong>Concepts Used:</strong></p>
                    <ul>
                        <li><code>JOIN</code> to connect customers with their orders</li>
                        <li><code>GROUP BY</code> to aggregate data per customer</li>
                        <li><code>SUM()</code> and <code>COUNT()</code> aggregate functions</li>
                        <li><code>ORDER BY ... DESC</code> with <code>LIMIT</code> to get top results</li>
                    </ul>
                    <p><strong>Tables:</strong> <code>customers</code>, <code>orders</code></p>
                </div>
                <pre><code class="language-sql">-- Top 10 customers by total order value
SELECT
    c.name AS customer,
    c.email,
    c.customer_type,
    COUNT(o.id) AS order_count,
    SUM(o.total_amount) AS total_spent
FROM
    customers c
JOIN
    orders o ON c.id = o.customer_id
WHERE
    o.status IN ('delivered', 'shipped', 'confirmed')
GROUP BY
    c.id, c.name, c.email, c.customer_type
ORDER BY
    total_spent DESC
LIMIT 10;</code></pre>
            </section>

            <section>
                <div class="exercise-box">
                    <p><strong>Goal:</strong> Create a summary showing ALL customers with their order activity, including those with no orders.</p>
                    <p><strong>Business Question:</strong> Which customers are inactive or have low engagement?</p>
                    <p><strong>Key Concept:</strong> <code>LEFT JOIN</code> keeps all customers even if they have no matching orders. <code>COALESCE()</code> handles NULL values from the join.</p>
                </div>
                <pre><code class="language-sql">-- Customer order summary (shows all customers with order counts)
SELECT
    c.name,
    c.email,
    c.customer_type,
    COUNT(o.id) AS order_count,
    COALESCE(SUM(o.total_amount), 0) AS total_spent
FROM
    customers c
LEFT JOIN
    orders o ON c.id = o.customer_id AND o.status NOT IN ('cancelled', 'draft')
GROUP BY
    c.id, c.name, c.email, c.customer_type
ORDER BY
    order_count ASC, c.name
LIMIT 20;</code></pre>
            </section>

            <section>
                <div class="exercise-box">
                    <h4>Example 2: Product Performance</h4>
                    <p><strong>Goal:</strong> Find the best-selling products ranked by total revenue generated.</p>
                    <p><strong>Business Question:</strong> Which products generate the most revenue for our business?</p>
                    <p><strong>Concepts Used:</strong></p>
                    <ul>
                        <li>Multiple <code>JOIN</code>s to connect order_lines → orders → products → categories</li>
                        <li><code>SUM()</code> to calculate total quantity and revenue</li>
                        <li>Filtering completed orders with <code>WHERE status IN (...)</code></li>
                    </ul>
                    <p><strong>Tables:</strong> <code>order_lines</code>, <code>orders</code>, <code>products</code>, <code>categories</code></p>
                </div>
                <pre><code class="language-sql">-- Best-selling products with revenue
SELECT
    p.name AS product,
    cat.name AS category,
    SUM(ol.quantity) AS quantity_sold,
    SUM(ol.line_total) AS revenue
FROM
    order_lines ol
JOIN
    orders o ON ol.order_id = o.id
JOIN
    products p ON ol.product_id = p.id
LEFT JOIN
    categories cat ON p.category_id = cat.id
WHERE
    o.status IN ('delivered', 'shipped', 'confirmed')
GROUP BY
    p.id, p.name, cat.name
ORDER BY
    revenue DESC
LIMIT 15;</code></pre>
            </section>

            <section>
                <div class="exercise-box">
                    <p><strong>Goal:</strong> Identify products that need to be reordered because stock is below the minimum threshold.</p>
                    <p><strong>Business Question:</strong> Which products are running low and need restocking?</p>
                    <p><strong>Key Concept:</strong> <code>CASE WHEN</code> creates a conditional status column. Comparing <code>stock_quantity</code> against <code>reorder_level</code> identifies items needing attention.</p>
                </div>
                <pre><code class="language-sql">-- Products with low stock (below reorder level)
SELECT
    p.name AS product,
    p.sku,
    p.price,
    p.stock_quantity AS current_stock,
    p.reorder_level,
    CASE
        WHEN p.stock_quantity < p.reorder_level THEN 'Reorder Needed'
        ELSE 'OK'
    END AS stock_status
FROM
    products p
WHERE
    p.active = true
    AND p.stock_quantity < p.reorder_level
ORDER BY
    p.stock_quantity ASC;</code></pre>
            </section>

            <section>
                <div class="exercise-box">
                    <h4>Example 3: Sales Analysis</h4>
                    <p><strong>Goal:</strong> Analyze sales trends by grouping orders into monthly periods.</p>
                    <p><strong>Business Question:</strong> How do our sales vary month by month? Are there seasonal patterns?</p>
                    <p><strong>Concepts Used:</strong></p>
                    <ul>
                        <li><code>DATE_TRUNC('month', ...)</code> to group dates into monthly buckets</li>
                        <li><code>COUNT(DISTINCT ...)</code> to count unique orders</li>
                        <li>Time-series analysis pattern</li>
                    </ul>
                    <p><strong>Tables:</strong> <code>orders</code></p>
                </div>
                <pre><code class="language-sql">-- Monthly sales trend (all time)
SELECT
    DATE_TRUNC('month', o.order_date) AS month,
    COUNT(DISTINCT o.id) AS order_count,
    SUM(o.total_amount) AS total_sales
FROM
    orders o
WHERE
    o.status IN ('delivered', 'shipped', 'confirmed')
GROUP BY
    DATE_TRUNC('month', o.order_date)
ORDER BY
    month;</code></pre>
            </section>

            <section>
                <div class="exercise-box">
                    <p><strong>Goal:</strong> Break down sales performance by geographic region (country).</p>
                    <p><strong>Business Question:</strong> Which countries generate the most revenue? Where should we focus marketing?</p>
                    <p><strong>Key Concept:</strong> Chain multiple <code>JOIN</code>s: orders → customers → countries to connect sales data with geographic information.</p>
                </div>
                <pre><code class="language-sql">-- Sales by country
SELECT
    co.name AS country,
    COUNT(DISTINCT o.id) AS order_count,
    SUM(o.total_amount) AS total_sales
FROM
    orders o
JOIN
    customers c ON o.customer_id = c.id
JOIN
    countries co ON c.country_id = co.id
WHERE
    o.status IN ('delivered', 'shipped', 'confirmed')
GROUP BY
    co.name
ORDER BY
    total_sales DESC;</code></pre>
            </section>

            <section>
                <h3 id="practical-exercises">Practical Exercises</h3>
                <p>Now it's time for you to practice with some guided exercises. For each exercise, try to write the query yourself before looking at the solution.</p>

                <div class="exercise-box">
                    <h4>Exercise 1: Find Orders With High Discounts</h4>
                    <p><strong>Goal:</strong> Find all orders where the discount amount is greater than 10% of the subtotal. Include order number, customer name, subtotal, discount amount, and the discount percentage.</p>

                    <div class="hint-box">
                        Use the <code>orders</code> table joined with <code>customers</code>. Calculate discount percentage as <code>(discount_amount / subtotal) * 100</code>.
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('solution1')">Show Solution</button>
                    <div id="solution1" class="solution-box">
                        <pre><code class="language-sql">SELECT
    o.order_number,
    c.name AS customer,
    o.subtotal,
    o.discount_amount,
    ROUND((o.discount_amount / NULLIF(o.subtotal, 0)) * 100, 2) AS discount_percentage
FROM
    orders o
JOIN
    customers c ON o.customer_id = c.id
WHERE
    o.subtotal > 0
    AND (o.discount_amount / o.subtotal) > 0.10
ORDER BY
    discount_percentage DESC;</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <div class="exercise-box">
                    <h4>Exercise 2: Product Profitability Analysis</h4>
                    <p><strong>Goal:</strong> Calculate the profit margin for each product sold. Include product name, category, total quantity sold, total revenue, total cost, profit, and profit margin percentage.</p>

                    <div class="hint-box">
                        Use <code>order_lines</code>, <code>orders</code>, <code>products</code>, and <code>categories</code>. Profit = Revenue - (Quantity * Cost). Profit margin = (Profit / Revenue) * 100.
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('solution2')">Show Solution</button>
                    <div id="solution2" class="solution-box">
                        <pre><code class="language-sql">SELECT
    p.name AS product,
    cat.name AS category,
    SUM(ol.quantity) AS quantity_sold,
    SUM(ol.line_total) AS revenue,
    SUM(ol.quantity * p.cost) AS total_cost,
    SUM(ol.line_total) - SUM(ol.quantity * p.cost) AS profit,
    CASE
        WHEN SUM(ol.line_total) = 0 THEN 0
        ELSE ROUND(
            (SUM(ol.line_total) - SUM(ol.quantity * p.cost)) / SUM(ol.line_total) * 100,
            2
        )
    END AS profit_margin_percentage
FROM
    order_lines ol
JOIN
    orders o ON ol.order_id = o.id
JOIN
    products p ON ol.product_id = p.id
LEFT JOIN
    categories cat ON p.category_id = cat.id
WHERE
    o.status IN ('delivered', 'shipped', 'confirmed')
    AND p.cost IS NOT NULL
GROUP BY
    p.id, p.name, cat.name
HAVING
    SUM(ol.line_total) > 0
ORDER BY
    profit_margin_percentage DESC;</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <div class="exercise-box">
                    <h4>Exercise 3: Customer Segmentation</h4>
                    <p><strong>Goal:</strong> Segment customers based on their total purchase amount into these categories:</p>
                    <ul>
                        <li><strong>VIP:</strong> More than $10,000 in purchases</li>
                        <li><strong>Regular:</strong> $1,000 to $10,000 in purchases</li>
                        <li><strong>Occasional:</strong> Less than $1,000 in purchases (but > 0)</li>
                        <li><strong>Inactive:</strong> No purchases</li>
                    </ul>
                    <p>Show the count of customers in each segment.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution3')">Show Solution</button>
                    <div id="solution3" class="solution-box">
                        <pre><code class="language-sql">SELECT
    customer_segment,
    COUNT(*) AS customer_count
FROM (
    SELECT
        CASE
            WHEN total_spent > 10000 THEN 'VIP'
            WHEN total_spent BETWEEN 1000 AND 10000 THEN 'Regular'
            WHEN total_spent < 1000 AND total_spent > 0 THEN 'Occasional'
            ELSE 'Inactive'
        END AS customer_segment
    FROM (
        SELECT
            c.id,
            COALESCE(SUM(o.total_amount), 0) AS total_spent
        FROM
            customers c
        LEFT JOIN
            orders o ON c.id = o.customer_id
            AND o.status IN ('delivered', 'shipped', 'confirmed')
        GROUP BY
            c.id
    ) AS spending_data
) AS segmented_data
GROUP BY
    customer_segment
ORDER BY
    MIN(CASE customer_segment
        WHEN 'VIP' THEN 1
        WHEN 'Regular' THEN 2
        WHEN 'Occasional' THEN 3
        ELSE 4
    END);</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <div class="exercise-box">
                    <h4>Exercise 4: Employee Hierarchy</h4>
                    <p><strong>Goal:</strong> Display the complete employee hierarchy showing each employee's name, their manager's name, and their level in the organization (CEO = level 0).</p>

                    <div class="hint-box">
                        Use a recursive CTE starting from employees where <code>manager_id IS NULL</code> (top level).
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('solution4')">Show Solution</button>
                    <div id="solution4" class="solution-box">
                        <pre><code class="language-sql">WITH RECURSIVE employee_hierarchy AS (
    -- Base case: top-level employees (no manager)
    SELECT
        id,
        (first_name || ' ' || last_name)::TEXT AS employee_name,
        department,
        job_title,
        manager_id,
        0 AS level,
        (first_name || ' ' || last_name)::TEXT AS path
    FROM employees
    WHERE manager_id IS NULL

    UNION ALL

    -- Recursive case: employees with managers
    SELECT
        e.id,
        e.first_name || ' ' || e.last_name,
        e.department,
        e.job_title,
        e.manager_id,
        eh.level + 1,
        eh.path || ' > ' || e.first_name || ' ' || e.last_name
    FROM employees e
    JOIN employee_hierarchy eh ON e.manager_id = eh.id
)
SELECT
    eh.employee_name,
    eh.department,
    eh.job_title,
    COALESCE(m.first_name || ' ' || m.last_name, 'No Manager') AS manager_name,
    eh.level
FROM employee_hierarchy eh
LEFT JOIN employees m ON eh.manager_id = m.id
ORDER BY eh.level, eh.employee_name;</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <div class="exercise-box">
                    <h4>Exercise 5: JSON Analysis - Order Sources</h4>
                    <p><strong>Goal:</strong> Analyze the <code>metadata</code> JSONB column in the orders table. Count orders by their source channel (stored in <code>metadata->>'source'</code>) and calculate total revenue for each source.</p>

                    <div class="hint-box">
                        Use <code>metadata->>'source'</code> to extract the source as text. Filter out NULL metadata values.
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('solution5')">Show Solution</button>
                    <div id="solution5" class="solution-box">
                        <pre><code class="language-sql">SELECT
    metadata->>'source' AS order_source,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_revenue,
    ROUND(AVG(total_amount), 2) AS avg_order_value
FROM
    orders
WHERE
    metadata IS NOT NULL
    AND metadata->>'source' IS NOT NULL
    AND status IN ('delivered', 'shipped', 'confirmed')
GROUP BY
    metadata->>'source'
ORDER BY
    total_revenue DESC;</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <div class="exercise-box">
                    <h4>Exercise 6: JSON Analysis - Product Attributes</h4>
                    <p><strong>Goal:</strong> Find all products that have '5g' capability (stored in <code>attributes</code> JSONB column as <code>{"5g": true}</code>). Display the product name, brand, and price.</p>

                    <div class="hint-box">
                        Use the containment operator <code>@></code> to check if attributes contain <code>{"5g": true}</code>. Extract brand with <code>attributes->>'brand'</code>.
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('solution6')">Show Solution</button>
                    <div id="solution6" class="solution-box">
                        <pre><code class="language-sql">-- Using containment operator
SELECT
    name,
    attributes->>'brand' AS brand,
    price,
    attributes->>'storage' AS storage
FROM
    products
WHERE
    attributes @> '{"5g": true}'::jsonb
ORDER BY
    price DESC;

-- Alternative: checking boolean value
SELECT
    name,
    attributes->>'brand' AS brand,
    price
FROM
    products
WHERE
    (attributes->>'5g')::BOOLEAN = true;</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <div class="exercise-box">
                    <h4>Exercise 7: Stock Movement Analysis</h4>
                    <p><strong>Goal:</strong> Analyze stock movements to show the net change in inventory for each product. Include products that have had at least one sale movement. Show product name, total purchased, total sold, and net change.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution7')">Show Solution</button>
                    <div id="solution7" class="solution-box">
                        <pre><code class="language-sql">SELECT
    p.name AS product,
    p.sku,
    COALESCE(SUM(CASE WHEN sm.movement_type = 'purchase' THEN sm.quantity ELSE 0 END), 0) AS total_purchased,
    COALESCE(SUM(CASE WHEN sm.movement_type = 'sale' THEN ABS(sm.quantity) ELSE 0 END), 0) AS total_sold,
    COALESCE(SUM(CASE WHEN sm.movement_type = 'return' THEN sm.quantity ELSE 0 END), 0) AS total_returned,
    SUM(sm.quantity) AS net_change,
    p.stock_quantity AS current_stock
FROM
    products p
LEFT JOIN
    stock_movements sm ON p.id = sm.product_id
GROUP BY
    p.id, p.name, p.sku, p.stock_quantity
HAVING
    SUM(CASE WHEN sm.movement_type = 'sale' THEN 1 ELSE 0 END) > 0
ORDER BY
    total_sold DESC;</code></pre>
                    </div>
                </div>
            </section>

            <section>
                <h3 id="conclusion">Conclusion and Next Steps</h3>
                <p>In this hands-on workshop, you've explored the <code>bootcamp_db</code> database structure and practiced writing SQL queries to extract valuable business insights. These skills will enable you to:</p>
                <ol>
                    <li>Understand the data model underlying your database</li>
                    <li>Extract specific information needed for decision-making</li>
                    <li>Validate system behavior by examining the actual data</li>
                    <li>Create custom reports that answer specific business questions</li>
                    <li>Work with JSON data using PostgreSQL's powerful JSONB features</li>
                </ol>
                <p>Continue practicing by modifying these queries to answer different business questions, or by combining multiple concepts into more complex analyses.</p>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="../static/script.js"></script>

    <script>
        function toggleSolution(id) {
            var element = document.getElementById(id);
            if (element.classList.contains('show')) {
                element.classList.remove('show');
                event.target.textContent = 'Show Solution';
            } else {
                element.classList.add('show');
                event.target.textContent = 'Hide Solution';
            }
        }
    </script>
</body>

</html>
