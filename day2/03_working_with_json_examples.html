<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style_bootstrap.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/code.css">
    <link href="https://cdn.prod.website-files.com/5efdb54f07a6812bcd95cc65/6773d0fc3013e060f08d7145_favicon.jpg"
        rel="shortcut icon" type="image/x-icon">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>Day 2: Working with JSON Data - Practical Examples</title>
    <style>
        code {
            white-space: pre-wrap;
        }

        span.smallcaps {
            font-variant: small-caps;
        }

        span.underline {
            text-decoration: underline;
        }

        div.column {
            display: inline-block;
            vertical-align: top;
            width: 50%;
        }

        div.hanging-indent {
            margin-left: 1.5em;
            text-indent: -1.5em;
        }

        ul.task-list {
            list-style: none;
        }

        .language-switcher {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .language-switcher a {
            text-decoration: none;
            padding: 5px 10px;
            margin: 0 2px;
            border-radius: 3px;
            color: #333;
        }

        .language-switcher a.active {
            background: #0d6efd;
            color: #fff;
        }

        .language-switcher a:hover:not(.active) {
            background: #e9ecef;
        }

        .exercise-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .exercise-box h4 {
            color: #495057;
            margin-bottom: 15px;
        }

        .solution-box {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .solution-box.show {
            display: block;
        }

        .toggle-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .toggle-btn:hover {
            background-color: #0056b3;
        }

        .hint-box {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .hint-box::before {
            content: "Hint: ";
            font-weight: bold;
        }

        .warning-box {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .warning-box::before {
            content: "Warning: ";
            font-weight: bold;
        }

        .concept-box {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .concept-box::before {
            content: "Concept: ";
            font-weight: bold;
        }

        .syntax-box {
            background-color: #e2d5f1;
            border: 1px solid #c5b3d9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .syntax-box::before {
            content: "Syntax Reference: ";
            font-weight: bold;
        }

        .challenge-box {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .challenge-box h4 {
            color: #155724;
        }

        .challenge-box::before {
            content: "";
        }

        .dataset-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        .dataset-table th,
        .dataset-table td {
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            text-align: left;
        }

        .dataset-table th {
            background-color: #343a40;
            color: white;
        }

        .dataset-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background-color: #007bff;
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .json-display {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre;
        }

        .json-key {
            color: #f92672;
        }

        .json-string {
            color: #a6e22e;
        }

        .json-number {
            color: #ae81ff;
        }

        .json-boolean {
            color: #66d9ef;
        }

        .result-box {
            background-color: #f1f1f1;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
        }

        .db-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin: 2px;
        }

        .db-postgresql {
            background-color: #336791;
            color: white;
        }

        .db-mysql {
            background-color: #4479A1;
            color: white;
        }

        .db-sqlserver {
            background-color: #CC2927;
            color: white;
        }

        .db-oracle {
            background-color: #F80000;
            color: white;
        }

        .operator-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 13px;
        }

        .operator-table th,
        .operator-table td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }

        .operator-table th {
            background-color: #6c5ce7;
            color: white;
        }

        .operator-table code {
            background-color: #f1f1f1;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>

<body>
    <a href="../index_en.html" class="back-button">‚Üê Back to Index</a>
    <div class="language-switcher">
        <a href="03_working_with_json_examples.html" class="active">EN</a>
        <a href="03_working_with_json_examples_tr.html">TR</a>
    </div>
    <div class="copy-notification" id="copyNotification">Copied!</div>

    <div id="europeanunion-turkey">
        <img src="../static/eu.png" alt="">
    </div>
    <div id="sanayiteknolojibakan">
        <img src="../static/sanayitek.png" alt="">
    </div>
    <div id="rekabet">
        <img src="../static/rekabet.png" alt="">
    </div>
    <div id="tisk">
        <img src="../static/tisk.png" alt="">
    </div>
    <div id="undp">
        <img src="../static/undp.png" alt="">
    </div>
    <div class="content-container">
        <div class="container">
            <section>
                <h1 id="json-practical-examples">Working with JSON Data - Practical Examples</h1>
                <p><a href="03_working_with_json.html">&larr; Back to Working with JSON Data Lesson</a></p>
                <p>This page provides hands-on exercises to master JSON operations in SQL. Practice extracting values,
                    searching within JSON, modifying documents, and converting between JSON and relational formats.</p>

                <div class="syntax-box">
                    <strong>PostgreSQL operators:</strong> <code>-></code> (get as JSON), <code>->></code> (get as text), <code>?</code> (key exists), <code>@></code> (contains)<br>
                    <strong>MySQL:</strong> <code>-></code> or <code>JSON_EXTRACT()</code>, <code>->></code> (unquoted), <code>JSON_CONTAINS()</code><br>
                    <strong>SQL Server:</strong> <code>JSON_VALUE()</code>, <code>JSON_QUERY()</code>, <code>OPENJSON()</code>
                </div>
            </section>

            <!-- Sample Datasets Section -->
            <section>
                <h2 id="sample-datasets">Sample Datasets</h2>
                <p>The following tables demonstrate JSON data structures. Use these as reference for the exercises.</p>

                <h4>users Table</h4>
                <p>User profiles with JSON preferences and address data:</p>
                <table class="dataset-table">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>username</th>
                            <th>data (JSONB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>john_doe</td>
                            <td>
                                <div class="json-display">{
  "email": "john@example.com",
  "age": 32,
  "address": {
    "city": "New York",
    "country": "USA",
    "zip": "10001"
  },
  "tags": ["admin", "developer"],
  "preferences": {
    "theme": "dark",
    "notifications": true
  }
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>jane_smith</td>
                            <td>
                                <div class="json-display">{
  "email": "jane@example.com",
  "age": 28,
  "address": {
    "city": "London",
    "country": "UK",
    "zip": "SW1A 1AA"
  },
  "tags": ["editor", "reviewer"],
  "preferences": {
    "theme": "light",
    "notifications": false
  }
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>bob_wilson</td>
                            <td>
                                <div class="json-display">{
  "email": "bob@example.com",
  "age": 45,
  "address": {
    "city": "Istanbul",
    "country": "Turkey",
    "zip": "34000"
  },
  "tags": ["admin", "manager"],
  "preferences": {
    "theme": "dark",
    "notifications": true,
    "language": "tr"
  }
}</div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h4>products Table</h4>
                <p>Products with JSON specifications:</p>
                <table class="dataset-table">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>name</th>
                            <th>specs (JSONB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Laptop Pro</td>
                            <td>
                                <div class="json-display">{
  "brand": "TechCorp",
  "price": 1299.99,
  "in_stock": true,
  "features": ["16GB RAM", "512GB SSD", "15.6 inch"],
  "dimensions": {"width": 35.5, "height": 1.8, "depth": 24.0},
  "ratings": [4.5, 4.8, 4.2, 5.0]
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Wireless Mouse</td>
                            <td>
                                <div class="json-display">{
  "brand": "PeripheralCo",
  "price": 49.99,
  "in_stock": true,
  "features": ["Bluetooth", "Ergonomic", "Rechargeable"],
  "colors": ["black", "white", "gray"],
  "ratings": [4.0, 4.3, 3.9]
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Monitor 4K</td>
                            <td>
                                <div class="json-display">{
  "brand": "DisplayTech",
  "price": 599.00,
  "in_stock": false,
  "features": ["4K UHD", "HDR", "USB-C"],
  "dimensions": {"width": 61.0, "height": 36.5, "depth": 5.2},
  "ratings": [4.7, 4.9, 4.6, 4.8, 5.0]
}</div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h4>logs Table</h4>
                <p>Application logs with JSON event data:</p>
                <table class="dataset-table">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>timestamp</th>
                            <th>event_data (JSONB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>2024-03-15 09:30:00</td>
                            <td>
                                <div class="json-display">{
  "event": "login",
  "user": {"id": 1, "name": "john_doe"},
  "metadata": {"ip": "192.168.1.100", "browser": "Chrome"}
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>2024-03-15 10:15:00</td>
                            <td>
                                <div class="json-display">{
  "event": "purchase",
  "user": {"id": 1, "name": "john_doe"},
  "items": [{"product_id": 1, "qty": 1}, {"product_id": 2, "qty": 2}],
  "total": 1399.97
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>2024-03-15 11:00:00</td>
                            <td>
                                <div class="json-display">{
  "event": "error",
  "error_code": 500,
  "message": "Database connection failed",
  "metadata": {"service": "api", "endpoint": "/users"}
}</div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h4>orders Table</h4>
                <p>Orders with nested JSON items:</p>
                <table class="dataset-table">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>customer_id</th>
                            <th>order_data (JSONB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>1</td>
                            <td>
                                <div class="json-display">{
  "status": "completed",
  "items": [
    {"name": "Laptop Pro", "price": 1299.99, "qty": 1},
    {"name": "Wireless Mouse", "price": 49.99, "qty": 2}
  ],
  "shipping": {"method": "express", "cost": 25.00},
  "payment": {"method": "credit_card", "last_four": "4242"}
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>2</td>
                            <td>
                                <div class="json-display">{
  "status": "pending",
  "items": [
    {"name": "Monitor 4K", "price": 599.00, "qty": 1}
  ],
  "shipping": {"method": "standard", "cost": 10.00},
  "payment": {"method": "paypal", "email": "jane@example.com"}
}</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- JSON Operators Quick Reference -->
            <section>
                <h2 id="operator-reference">JSON Operators Quick Reference</h2>
                <table class="operator-table">
                    <thead>
                        <tr>
                            <th>Operation</th>
                            <th><span class="db-badge db-postgresql">PostgreSQL</span></th>
                            <th><span class="db-badge db-mysql">MySQL</span></th>
                            <th><span class="db-badge db-sqlserver">SQL Server</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Get field as JSON</td>
                            <td><code>data->'field'</code></td>
                            <td><code>data->'$.field'</code></td>
                            <td><code>JSON_QUERY(data, '$.field')</code></td>
                        </tr>
                        <tr>
                            <td>Get field as text</td>
                            <td><code>data->>'field'</code></td>
                            <td><code>data->>'$.field'</code></td>
                            <td><code>JSON_VALUE(data, '$.field')</code></td>
                        </tr>
                        <tr>
                            <td>Get nested path</td>
                            <td><code>data#>>'{a,b,c}'</code></td>
                            <td><code>data->>'$.a.b.c'</code></td>
                            <td><code>JSON_VALUE(data, '$.a.b.c')</code></td>
                        </tr>
                        <tr>
                            <td>Get array element</td>
                            <td><code>data->'arr'->0</code></td>
                            <td><code>data->'$.arr[0]'</code></td>
                            <td><code>JSON_VALUE(data, '$.arr[0]')</code></td>
                        </tr>
                        <tr>
                            <td>Key exists</td>
                            <td><code>data ? 'key'</code></td>
                            <td><code>JSON_CONTAINS_PATH(data, 'one', '$.key')</code></td>
                            <td><code>JSON_VALUE(data, '$.key') IS NOT NULL</code></td>
                        </tr>
                        <tr>
                            <td>Contains value</td>
                            <td><code>data @> '{"k":"v"}'</code></td>
                            <td><code>JSON_CONTAINS(data, '"v"', '$.k')</code></td>
                            <td>Extract and compare</td>
                        </tr>
                        <tr>
                            <td>Set/update value</td>
                            <td><code>jsonb_set(data, '{k}', '"v"')</code></td>
                            <td><code>JSON_SET(data, '$.k', 'v')</code></td>
                            <td><code>JSON_MODIFY(data, '$.k', 'v')</code></td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Exercise 1: Basic JSON Extraction -->
            <section>
                <h2 id="exercise-1">Exercise 1: Basic JSON Path Navigation</h2>
                <p>Learn to extract values from JSON columns using path navigation operators.</p>

                <div class="concept-box">
                    Use <code>-></code> to get JSON/JSONB output, use <code>->></code> to get text output.
                    The difference matters when comparing values or using in WHERE clauses.
                </div>

                <div class="exercise-box">
                    <h4>Exercise 1.1: Extract Simple Fields</h4>
                    <p>Using the <code>users</code> table, write queries to:</p>
                    <ol>
                        <li>Get the email of all users</li>
                        <li>Get the username and age of all users</li>
                        <li>Get users who are older than 30</li>
                    </ol>

                    <div class="hint-box">
                        Remember to cast the age to integer when comparing: <code>(data->>'age')::INTEGER</code>
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_1')">Show Solution</button>
                    <div id="solution1_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Get email of all users
SELECT username, data->>'email' AS email
FROM users;

-- 2. Get username and age
SELECT username, data->>'age' AS age
FROM users;

-- 3. Users older than 30
SELECT username, data->>'age' AS age
FROM users
WHERE (data->>'age')::INTEGER > 30;

-- MySQL
-- 1. Get email
SELECT username, data->>'$.email' AS email
FROM users;

-- 2. Get username and age
SELECT username, data->>'$.age' AS age
FROM users;

-- 3. Users older than 30
SELECT username, data->>'$.age' AS age
FROM users
WHERE CAST(data->>'$.age' AS UNSIGNED) > 30;

-- SQL Server
-- 1. Get email
SELECT username, JSON_VALUE(data, '$.email') AS email
FROM users;

-- 2. Get username and age
SELECT username, JSON_VALUE(data, '$.age') AS age
FROM users;

-- 3. Users older than 30
SELECT username, JSON_VALUE(data, '$.age') AS age
FROM users
WHERE CAST(JSON_VALUE(data, '$.age') AS INT) > 30;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Exercise 1.2: Extract Nested Fields</h4>
                    <p>Using the <code>users</code> table, write queries to:</p>
                    <ol>
                        <li>Get the city from the address object for each user</li>
                        <li>Get the theme preference for each user</li>
                        <li>Find users from the USA</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_2')">Show Solution</button>
                    <div id="solution1_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Get city from nested address
SELECT username, data->'address'->>'city' AS city
FROM users;

-- Alternative using path notation
SELECT username, data#>>'{address,city}' AS city
FROM users;

-- 2. Get theme preference
SELECT username, data->'preferences'->>'theme' AS theme
FROM users;

-- 3. Find users from USA
SELECT username, data->'address'->>'country' AS country
FROM users
WHERE data->'address'->>'country' = 'USA';

-- MySQL
-- 1. Get city
SELECT username, data->>'$.address.city' AS city
FROM users;

-- 2. Get theme preference
SELECT username, data->>'$.preferences.theme' AS theme
FROM users;

-- 3. Find users from USA
SELECT username, data->>'$.address.country' AS country
FROM users
WHERE data->>'$.address.country' = 'USA';

-- SQL Server
-- 1. Get city
SELECT username, JSON_VALUE(data, '$.address.city') AS city
FROM users;

-- 2. Get theme preference
SELECT username, JSON_VALUE(data, '$.preferences.theme') AS theme
FROM users;

-- 3. Find users from USA
SELECT username, JSON_VALUE(data, '$.address.country') AS country
FROM users
WHERE JSON_VALUE(data, '$.address.country') = 'USA';</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Exercise 1.3: Access Array Elements</h4>
                    <p>Using the <code>users</code> table, write queries to:</p>
                    <ol>
                        <li>Get the first tag for each user</li>
                        <li>Get all tags as a JSON array</li>
                        <li>Count how many tags each user has</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_3')">Show Solution</button>
                    <div id="solution1_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Get first tag
SELECT username, data->'tags'->>0 AS first_tag
FROM users;

-- 2. Get all tags as JSON array
SELECT username, data->'tags' AS tags
FROM users;

-- 3. Count tags
SELECT username, jsonb_array_length(data->'tags') AS tag_count
FROM users;

-- MySQL
-- 1. Get first tag
SELECT username, data->>'$.tags[0]' AS first_tag
FROM users;

-- 2. Get all tags as JSON array
SELECT username, data->'$.tags' AS tags
FROM users;

-- 3. Count tags
SELECT username, JSON_LENGTH(data->'$.tags') AS tag_count
FROM users;

-- SQL Server
-- 1. Get first tag
SELECT username, JSON_VALUE(data, '$.tags[0]') AS first_tag
FROM users;

-- 2. Get all tags as JSON array
SELECT username, JSON_QUERY(data, '$.tags') AS tags
FROM users;

-- 3. Count tags (requires OPENJSON)
SELECT username,
       (SELECT COUNT(*) FROM OPENJSON(data, '$.tags')) AS tag_count
FROM users;</code></pre>
                    </div>
                </div>
            </section>

            <!-- Exercise 2: Existence and Containment Checks -->
            <section>
                <h2 id="exercise-2">Exercise 2: Existence and Containment Checks</h2>
                <p>Learn to check for key existence and value containment in JSON data.</p>

                <div class="concept-box">
                    PostgreSQL's <code>?</code> checks key existence. <code>@></code> checks if left JSON contains
                    right JSON. These operators are efficient with GIN indexes.
                </div>

                <div class="exercise-box">
                    <h4>Exercise 2.1: Check Key Existence</h4>
                    <p>Using the <code>users</code> table, write queries to:</p>
                    <ol>
                        <li>Find users who have a "language" preference set</li>
                        <li>Find users whose preferences contain a "notifications" key</li>
                        <li>Find products that have a "colors" field in their specs</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_1')">Show Solution</button>
                    <div id="solution2_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Users with language preference
SELECT username, data->'preferences'->>'language' AS language
FROM users
WHERE data->'preferences' ? 'language';

-- 2. Users with notifications key
SELECT username
FROM users
WHERE data->'preferences' ? 'notifications';

-- 3. Products with colors field
SELECT name
FROM products
WHERE specs ? 'colors';

-- MySQL
-- 1. Users with language preference
SELECT username, data->>'$.preferences.language' AS language
FROM users
WHERE JSON_CONTAINS_PATH(data, 'one', '$.preferences.language');

-- 2. Users with notifications key
SELECT username
FROM users
WHERE JSON_CONTAINS_PATH(data, 'one', '$.preferences.notifications');

-- 3. Products with colors field
SELECT name
FROM products
WHERE JSON_CONTAINS_PATH(specs, 'one', '$.colors');

-- SQL Server
-- 1. Users with language preference
SELECT username, JSON_VALUE(data, '$.preferences.language') AS language
FROM users
WHERE JSON_VALUE(data, '$.preferences.language') IS NOT NULL;

-- 2. Users with notifications key
SELECT username
FROM users
WHERE JSON_VALUE(data, '$.preferences.notifications') IS NOT NULL;</code></pre>
                        <p><strong>Result for query 1:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>username</th>
                                <th>language</th>
                            </tr>
                            <tr>
                                <td>bob_wilson</td>
                                <td>tr</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Exercise 2.2: Containment Queries</h4>
                    <p>Using the <code>users</code> table, write queries to:</p>
                    <ol>
                        <li>Find users who have "admin" in their tags</li>
                        <li>Find users with dark theme preference</li>
                        <li>Find users from Turkey with notifications enabled</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_2')">Show Solution</button>
                    <div id="solution2_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Users with "admin" tag
SELECT username, data->'tags' AS tags
FROM users
WHERE data->'tags' @> '"admin"'::jsonb;

-- Alternative: check if array contains value
SELECT username
FROM users
WHERE data @> '{"tags": ["admin"]}'::jsonb;

-- 2. Users with dark theme
SELECT username
FROM users
WHERE data->'preferences' @> '{"theme": "dark"}'::jsonb;

-- 3. Users from Turkey with notifications enabled
SELECT username
FROM users
WHERE data @> '{"address": {"country": "Turkey"}, "preferences": {"notifications": true}}'::jsonb;

-- MySQL
-- 1. Users with "admin" tag
SELECT username, data->'$.tags' AS tags
FROM users
WHERE JSON_CONTAINS(data->'$.tags', '"admin"');

-- 2. Users with dark theme
SELECT username
FROM users
WHERE JSON_CONTAINS(data, '{"theme": "dark"}', '$.preferences');

-- 3. Users from Turkey with notifications enabled
SELECT username
FROM users
WHERE data->>'$.address.country' = 'Turkey'
  AND JSON_EXTRACT(data, '$.preferences.notifications') = true;</code></pre>
                        <p><strong>Result for query 1:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>username</th>
                                <th>tags</th>
                            </tr>
                            <tr>
                                <td>john_doe</td>
                                <td>["admin", "developer"]</td>
                            </tr>
                            <tr>
                                <td>bob_wilson</td>
                                <td>["admin", "manager"]</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Exercise 2.3: Multiple Key Existence</h4>
                    <p>Using the <code>products</code> table, write queries to:</p>
                    <ol>
                        <li>Find products that have BOTH "dimensions" and "colors" fields</li>
                        <li>Find products that have EITHER "dimensions" OR "colors" fields</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_3')">Show Solution</button>
                    <div id="solution2_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Products with BOTH dimensions AND colors
SELECT name
FROM products
WHERE specs ?& ARRAY['dimensions', 'colors'];

-- Alternative using AND
SELECT name
FROM products
WHERE specs ? 'dimensions' AND specs ? 'colors';

-- 2. Products with EITHER dimensions OR colors
SELECT name
FROM products
WHERE specs ?| ARRAY['dimensions', 'colors'];

-- Alternative using OR
SELECT name
FROM products
WHERE specs ? 'dimensions' OR specs ? 'colors';

-- MySQL
-- 1. Products with BOTH
SELECT name
FROM products
WHERE JSON_CONTAINS_PATH(specs, 'all', '$.dimensions', '$.colors');

-- 2. Products with EITHER
SELECT name
FROM products
WHERE JSON_CONTAINS_PATH(specs, 'one', '$.dimensions', '$.colors');</code></pre>
                    </div>
                </div>
            </section>

            <!-- Exercise 3: Modifying JSON Data -->
            <section>
                <h2 id="exercise-3">Exercise 3: Modifying JSON Data</h2>
                <p>Learn to update, add, and remove fields from JSON documents.</p>

                <div class="warning-box">
                    Modifying JSON updates the entire document. For frequently updated fields,
                    consider storing them in separate relational columns.
                </div>

                <div class="exercise-box">
                    <h4>Exercise 3.1: Update JSON Fields</h4>
                    <p>Write queries to:</p>
                    <ol>
                        <li>Update john_doe's theme preference to "system"</li>
                        <li>Add a new "phone" field to bob_wilson's data</li>
                        <li>Update the price of "Laptop Pro" in the products table</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_1')">Show Solution</button>
                    <div id="solution3_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Update theme preference
UPDATE users
SET data = jsonb_set(data, '{preferences,theme}', '"system"')
WHERE username = 'john_doe';

-- 2. Add phone field
UPDATE users
SET data = jsonb_set(data, '{phone}', '"555-1234"')
WHERE username = 'bob_wilson';

-- Alternative: merge new data
UPDATE users
SET data = data || '{"phone": "555-1234"}'::jsonb
WHERE username = 'bob_wilson';

-- 3. Update product price
UPDATE products
SET specs = jsonb_set(specs, '{price}', '1199.99')
WHERE name = 'Laptop Pro';

-- MySQL
-- 1. Update theme preference
UPDATE users
SET data = JSON_SET(data, '$.preferences.theme', 'system')
WHERE username = 'john_doe';

-- 2. Add phone field
UPDATE users
SET data = JSON_SET(data, '$.phone', '555-1234')
WHERE username = 'bob_wilson';

-- 3. Update product price
UPDATE products
SET specs = JSON_SET(specs, '$.price', 1199.99)
WHERE name = 'Laptop Pro';

-- SQL Server
-- 1. Update theme preference
UPDATE users
SET data = JSON_MODIFY(data, '$.preferences.theme', 'system')
WHERE username = 'john_doe';

-- 2. Add phone field
UPDATE users
SET data = JSON_MODIFY(data, '$.phone', '555-1234')
WHERE username = 'bob_wilson';

-- 3. Update product price
UPDATE products
SET specs = JSON_MODIFY(specs, '$.price', 1199.99)
WHERE name = 'Laptop Pro';</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Exercise 3.2: Remove JSON Fields</h4>
                    <p>Write queries to:</p>
                    <ol>
                        <li>Remove the "language" preference from bob_wilson</li>
                        <li>Remove the "colors" array from the Wireless Mouse product</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_2')">Show Solution</button>
                    <div id="solution3_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Remove language preference
UPDATE users
SET data = data #- '{preferences,language}'
WHERE username = 'bob_wilson';

-- Alternative: remove key from nested object
UPDATE users
SET data = jsonb_set(data, '{preferences}',
           (data->'preferences') - 'language')
WHERE username = 'bob_wilson';

-- 2. Remove colors from product
UPDATE products
SET specs = specs - 'colors'
WHERE name = 'Wireless Mouse';

-- MySQL
-- 1. Remove language preference
UPDATE users
SET data = JSON_REMOVE(data, '$.preferences.language')
WHERE username = 'bob_wilson';

-- 2. Remove colors from product
UPDATE products
SET specs = JSON_REMOVE(specs, '$.colors')
WHERE name = 'Wireless Mouse';

-- SQL Server
-- 1. Remove language preference (set to null)
UPDATE users
SET data = JSON_MODIFY(data, '$.preferences.language', NULL)
WHERE username = 'bob_wilson';</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Exercise 3.3: Array Modifications</h4>
                    <p>Write queries to:</p>
                    <ol>
                        <li>Add a new tag "supervisor" to bob_wilson's tags</li>
                        <li>Add a new feature "Touch Screen" to the Monitor 4K product</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_3')">Show Solution</button>
                    <div id="solution3_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Add new tag to user
UPDATE users
SET data = jsonb_set(data, '{tags}',
           (data->'tags') || '"supervisor"'::jsonb)
WHERE username = 'bob_wilson';

-- Alternative: concatenate arrays
UPDATE users
SET data = jsonb_set(data, '{tags}',
           data->'tags' || '["supervisor"]'::jsonb)
WHERE username = 'bob_wilson';

-- 2. Add feature to product
UPDATE products
SET specs = jsonb_set(specs, '{features}',
            specs->'features' || '["Touch Screen"]'::jsonb)
WHERE name = 'Monitor 4K';

-- MySQL
-- 1. Add new tag (MySQL 8.0+)
UPDATE users
SET data = JSON_ARRAY_APPEND(data, '$.tags', 'supervisor')
WHERE username = 'bob_wilson';

-- 2. Add feature to product
UPDATE products
SET specs = JSON_ARRAY_APPEND(specs, '$.features', 'Touch Screen')
WHERE name = 'Monitor 4K';

-- SQL Server (requires rebuilding array)
-- 1. Add new tag
UPDATE users
SET data = JSON_MODIFY(data, '$.tags',
           JSON_QUERY(
               CONCAT(
                   LEFT(JSON_QUERY(data, '$.tags'),
                        LEN(JSON_QUERY(data, '$.tags')) - 1),
                   ',"supervisor"]'
               )
           ))
WHERE username = 'bob_wilson';</code></pre>
                    </div>
                </div>
            </section>

            <!-- Exercise 4: JSON to Relational Conversion -->
            <section>
                <h2 id="exercise-4">Exercise 4: Converting JSON to Relational Format</h2>
                <p>Learn to expand JSON arrays and objects into rows and columns.</p>

                <div class="concept-box">
                    <code>jsonb_array_elements</code> (PostgreSQL), <code>JSON_TABLE</code> (MySQL/Oracle),
                    and <code>OPENJSON</code> (SQL Server) convert JSON into relational rows.
                </div>

                <div class="exercise-box">
                    <h4>Exercise 4.1: Expand JSON Arrays</h4>
                    <p>Using the <code>users</code> table, write a query that shows each user with their tags
                        expanded into separate rows (one row per tag per user).</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_1')">Show Solution</button>
                    <div id="solution4_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    username,
    jsonb_array_elements_text(data->'tags') AS tag
FROM users;

-- With index position
SELECT
    username,
    ordinality AS tag_position,
    tag
FROM users,
     jsonb_array_elements_text(data->'tags')
     WITH ORDINALITY AS t(tag, ordinality);

-- MySQL
SELECT
    username,
    jt.tag
FROM users,
     JSON_TABLE(data, '$.tags[*]' COLUMNS(
         tag VARCHAR(50) PATH '$'
     )) AS jt;

-- SQL Server
SELECT
    username,
    tag.value AS tag
FROM users
CROSS APPLY OPENJSON(data, '$.tags') AS tag;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Exercise 4.2: Expand Nested Objects</h4>
                    <p>Using the <code>orders</code> table, write a query that expands the items array,
                        showing order_id, item name, price, and quantity for each item.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_2')">Show Solution</button>
                    <div id="solution4_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    o.id AS order_id,
    item->>'name' AS item_name,
    (item->>'price')::DECIMAL AS price,
    (item->>'qty')::INTEGER AS quantity
FROM orders o,
     jsonb_array_elements(o.order_data->'items') AS item;

-- With calculated line total
SELECT
    o.id AS order_id,
    item->>'name' AS item_name,
    (item->>'price')::DECIMAL AS price,
    (item->>'qty')::INTEGER AS quantity,
    (item->>'price')::DECIMAL * (item->>'qty')::INTEGER AS line_total
FROM orders o,
     jsonb_array_elements(o.order_data->'items') AS item;

-- MySQL
SELECT
    o.id AS order_id,
    jt.item_name,
    jt.price,
    jt.quantity,
    jt.price * jt.quantity AS line_total
FROM orders o,
     JSON_TABLE(o.order_data, '$.items[*]' COLUMNS(
         item_name VARCHAR(100) PATH '$.name',
         price DECIMAL(10,2) PATH '$.price',
         quantity INT PATH '$.qty'
     )) AS jt;

-- SQL Server
SELECT
    o.id AS order_id,
    JSON_VALUE(item.value, '$.name') AS item_name,
    CAST(JSON_VALUE(item.value, '$.price') AS DECIMAL(10,2)) AS price,
    CAST(JSON_VALUE(item.value, '$.qty') AS INT) AS quantity
FROM orders o
CROSS APPLY OPENJSON(o.order_data, '$.items') AS item;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Exercise 4.3: JSON Object to Key-Value Pairs</h4>
                    <p>Using the <code>users</code> table, write a query that expands the preferences
                        object into key-value pairs for each user.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_3')">Show Solution</button>
                    <div id="solution4_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    username,
    pref.key AS preference_name,
    pref.value AS preference_value
FROM users,
     jsonb_each(data->'preferences') AS pref(key, value);

-- MySQL (using JSON_KEYS and a recursive approach or specific keys)
SELECT
    username,
    'theme' AS preference_name,
    data->>'$.preferences.theme' AS preference_value
FROM users
UNION ALL
SELECT
    username,
    'notifications' AS preference_name,
    CAST(data->'$.preferences.notifications' AS CHAR) AS preference_value
FROM users
UNION ALL
SELECT
    username,
    'language' AS preference_name,
    data->>'$.preferences.language' AS preference_value
FROM users
WHERE JSON_CONTAINS_PATH(data, 'one', '$.preferences.language');

-- SQL Server
SELECT
    username,
    pref.[key] AS preference_name,
    pref.[value] AS preference_value
FROM users
CROSS APPLY OPENJSON(data, '$.preferences') AS pref;</code></pre>
                    </div>
                </div>
            </section>

            <!-- Exercise 5: Building JSON from Relational Data -->
            <section>
                <h2 id="exercise-5">Exercise 5: Building JSON from Relational Data</h2>
                <p>Learn to construct JSON objects and arrays from relational query results.</p>

                <div class="exercise-box">
                    <h4>Exercise 5.1: Build JSON Objects</h4>
                    <p>Create a query that builds a JSON object containing product information
                        (name, brand, price) for each product.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution5_1')">Show Solution</button>
                    <div id="solution5_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    jsonb_build_object(
        'product_name', name,
        'brand', specs->>'brand',
        'price', (specs->>'price')::DECIMAL,
        'in_stock', (specs->>'in_stock')::BOOLEAN
    ) AS product_json
FROM products;

-- With pretty formatting
SELECT
    jsonb_pretty(
        jsonb_build_object(
            'product_name', name,
            'brand', specs->>'brand',
            'price', (specs->>'price')::DECIMAL
        )
    ) AS product_json
FROM products;

-- MySQL
SELECT
    JSON_OBJECT(
        'product_name', name,
        'brand', specs->>'$.brand',
        'price', CAST(specs->>'$.price' AS DECIMAL(10,2)),
        'in_stock', CAST(specs->'$.in_stock' AS JSON)
    ) AS product_json
FROM products;

-- SQL Server
SELECT
    name AS product_name,
    JSON_VALUE(specs, '$.brand') AS brand,
    JSON_VALUE(specs, '$.price') AS price
FROM products
FOR JSON PATH;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Exercise 5.2: Aggregate into JSON Arrays</h4>
                    <p>Create a query that returns all usernames as a JSON array, and another that
                        returns user data grouped by country.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution5_2')">Show Solution</button>
                    <div id="solution5_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. All usernames as JSON array
SELECT jsonb_agg(username) AS all_usernames
FROM users;

-- 2. Users grouped by country
SELECT
    data->'address'->>'country' AS country,
    jsonb_agg(
        jsonb_build_object(
            'username', username,
            'email', data->>'email',
            'city', data->'address'->>'city'
        )
    ) AS users_in_country
FROM users
GROUP BY data->'address'->>'country';

-- 3. Products with their ratings as summary
SELECT
    name,
    jsonb_build_object(
        'count', jsonb_array_length(specs->'ratings'),
        'ratings', specs->'ratings',
        'average', (
            SELECT AVG(r::DECIMAL)
            FROM jsonb_array_elements_text(specs->'ratings') r
        )
    ) AS rating_summary
FROM products;

-- MySQL
-- 1. All usernames as JSON array
SELECT JSON_ARRAYAGG(username) AS all_usernames
FROM users;

-- 2. Users grouped by country
SELECT
    data->>'$.address.country' AS country,
    JSON_ARRAYAGG(
        JSON_OBJECT(
            'username', username,
            'email', data->>'$.email',
            'city', data->>'$.address.city'
        )
    ) AS users_in_country
FROM users
GROUP BY data->>'$.address.country';

-- SQL Server
-- 1. All usernames as JSON array
SELECT username
FROM users
FOR JSON PATH;</code></pre>
                        <p><strong>Result for grouped by country:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>country</th>
                                <th>users_in_country</th>
                            </tr>
                            <tr>
                                <td>USA</td>
                                <td>[{"username": "john_doe", "email": "john@example.com", "city": "New York"}]</td>
                            </tr>
                            <tr>
                                <td>UK</td>
                                <td>[{"username": "jane_smith", "email": "jane@example.com", "city": "London"}]</td>
                            </tr>
                            <tr>
                                <td>Turkey</td>
                                <td>[{"username": "bob_wilson", "email": "bob@example.com", "city": "Istanbul"}]</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Challenge Exercises -->
            <section>
                <h2 id="challenge-exercises">Challenge Exercises</h2>
                <p>Test your comprehensive understanding of JSON operations with these advanced challenges.</p>

                <div class="challenge-box">
                    <h4>Challenge 1: Log Analysis</h4>
                    <p>Using the <code>logs</code> table, write queries to:</p>
                    <ol>
                        <li>Count events by event type</li>
                        <li>Find all error events and extract the error code and message</li>
                        <li>Get a list of all unique users who have logged in</li>
                        <li>Calculate the total value of all purchases</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge1')">Show Solution</button>
                    <div id="challenge1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Count events by type
SELECT
    event_data->>'event' AS event_type,
    COUNT(*) AS event_count
FROM logs
GROUP BY event_data->>'event';

-- 2. Find error events with details
SELECT
    timestamp,
    (event_data->>'error_code')::INTEGER AS error_code,
    event_data->>'message' AS error_message,
    event_data->'metadata'->>'service' AS service,
    event_data->'metadata'->>'endpoint' AS endpoint
FROM logs
WHERE event_data->>'event' = 'error';

-- 3. Unique users who logged in
SELECT DISTINCT
    event_data->'user'->>'id' AS user_id,
    event_data->'user'->>'name' AS username
FROM logs
WHERE event_data->>'event' = 'login';

-- 4. Total purchase value
SELECT
    SUM((event_data->>'total')::DECIMAL) AS total_revenue
FROM logs
WHERE event_data->>'event' = 'purchase';

-- Bonus: Detailed purchase breakdown
SELECT
    event_data->'user'->>'name' AS customer,
    (event_data->>'total')::DECIMAL AS order_total,
    jsonb_array_length(event_data->'items') AS item_count
FROM logs
WHERE event_data->>'event' = 'purchase';</code></pre>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Challenge 2: Product Analytics</h4>
                    <p>Using the <code>products</code> table, write queries to:</p>
                    <ol>
                        <li>Find the average rating for each product</li>
                        <li>Find products with average rating above 4.5</li>
                        <li>List all unique features across all products</li>
                        <li>Find products that have more than 3 features</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge2')">Show Solution</button>
                    <div id="challenge2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Average rating for each product
SELECT
    name,
    ROUND(
        (SELECT AVG(r::DECIMAL)
         FROM jsonb_array_elements_text(specs->'ratings') r),
        2
    ) AS avg_rating
FROM products;

-- 2. Products with avg rating above 4.5
SELECT
    name,
    avg_rating
FROM (
    SELECT
        name,
        (SELECT AVG(r::DECIMAL)
         FROM jsonb_array_elements_text(specs->'ratings') r) AS avg_rating
    FROM products
) subq
WHERE avg_rating > 4.5;

-- 3. All unique features
SELECT DISTINCT feature
FROM products,
     jsonb_array_elements_text(specs->'features') AS feature
ORDER BY feature;

-- 4. Products with more than 3 features
SELECT
    name,
    jsonb_array_length(specs->'features') AS feature_count
FROM products
WHERE jsonb_array_length(specs->'features') > 3;</code></pre>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Challenge 3: Order Report Generation</h4>
                    <p>Using the <code>orders</code> table, create a comprehensive order report that shows:</p>
                    <ol>
                        <li>Order ID, status, and customer ID</li>
                        <li>Number of items in each order</li>
                        <li>Subtotal (sum of price * qty for all items)</li>
                        <li>Shipping cost and method</li>
                        <li>Grand total (subtotal + shipping)</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge3')">Show Solution</button>
                    <div id="challenge3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    id AS order_id,
    customer_id,
    order_data->>'status' AS status,
    jsonb_array_length(order_data->'items') AS item_count,
    (
        SELECT SUM(
            (item->>'price')::DECIMAL * (item->>'qty')::INTEGER
        )
        FROM jsonb_array_elements(order_data->'items') AS item
    ) AS subtotal,
    order_data->'shipping'->>'method' AS shipping_method,
    (order_data->'shipping'->>'cost')::DECIMAL AS shipping_cost,
    (
        SELECT SUM(
            (item->>'price')::DECIMAL * (item->>'qty')::INTEGER
        )
        FROM jsonb_array_elements(order_data->'items') AS item
    ) + (order_data->'shipping'->>'cost')::DECIMAL AS grand_total
FROM orders;

-- Alternative with CTE for cleaner code
WITH order_items AS (
    SELECT
        o.id,
        SUM((item->>'price')::DECIMAL * (item->>'qty')::INTEGER) AS subtotal
    FROM orders o,
         jsonb_array_elements(o.order_data->'items') AS item
    GROUP BY o.id
)
SELECT
    o.id AS order_id,
    o.customer_id,
    o.order_data->>'status' AS status,
    jsonb_array_length(o.order_data->'items') AS item_count,
    oi.subtotal,
    o.order_data->'shipping'->>'method' AS shipping_method,
    (o.order_data->'shipping'->>'cost')::DECIMAL AS shipping_cost,
    oi.subtotal + (o.order_data->'shipping'->>'cost')::DECIMAL AS grand_total
FROM orders o
JOIN order_items oi ON o.id = oi.id;</code></pre>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Challenge 4: Create Indexing Strategy</h4>
                    <p>Design and write SQL statements to create appropriate indexes for the following query patterns:</p>
                    <ol>
                        <li>Frequently query users by email</li>
                        <li>Frequently search for products containing specific tags</li>
                        <li>Search for orders by status</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge4')">Show Solution</button>
                    <div id="challenge4" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL

-- 1. Index for email queries (B-tree on extracted value)
CREATE INDEX idx_users_email ON users ((data->>'email'));

-- 2. GIN index for tag containment queries
CREATE INDEX idx_users_tags ON users USING GIN ((data->'tags'));
-- This supports queries like: WHERE data->'tags' @> '"admin"'

-- 3. Index for order status
CREATE INDEX idx_orders_status ON orders ((order_data->>'status'));

-- Full JSONB GIN index for flexible querying
CREATE INDEX idx_users_data_gin ON users USING GIN (data);
-- This supports ?, ?|, ?&, @>, <@ operators

-- GIN with jsonb_path_ops for containment-only queries (smaller index)
CREATE INDEX idx_users_data_path ON users USING GIN (data jsonb_path_ops);

-- MySQL

-- 1. Generated column with index for email
ALTER TABLE users
ADD COLUMN email_idx VARCHAR(255)
GENERATED ALWAYS AS (data->>'$.email') STORED;
CREATE INDEX idx_users_email ON users(email_idx);

-- 2. Multi-valued index for tags (MySQL 8.0.17+)
CREATE INDEX idx_users_tags ON users((CAST(data->'$.tags' AS CHAR(100) ARRAY)));

-- 3. Generated column for status
ALTER TABLE orders
ADD COLUMN status_idx VARCHAR(50)
GENERATED ALWAYS AS (order_data->>'$.status') STORED;
CREATE INDEX idx_orders_status ON orders(status_idx);

-- SQL Server

-- 1. Computed column with index for email
ALTER TABLE users
ADD email_computed AS JSON_VALUE(data, '$.email');
CREATE INDEX idx_users_email ON users(email_computed);

-- 3. Computed column for status
ALTER TABLE orders
ADD status_computed AS JSON_VALUE(order_data, '$.status');
CREATE INDEX idx_orders_status ON orders(status_computed);</code></pre>
                    </div>
                </div>
            </section>

            <!-- Key Takeaways -->
            <section>
                <h2 id="key-takeaways">Key Takeaways</h2>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Concept</th>
                            <th>Best Practice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>JSON Type Selection</td>
                            <td>Use <code>JSONB</code> (PostgreSQL) or native <code>JSON</code> (MySQL) for better performance and indexing</td>
                        </tr>
                        <tr>
                            <td>Extracting Values</td>
                            <td>Use <code>->></code> for text output when comparing or displaying, <code>-></code> for nested navigation</td>
                        </tr>
                        <tr>
                            <td>Type Casting</td>
                            <td>Always cast extracted values to appropriate types for comparisons: <code>(data->>'age')::INTEGER</code></td>
                        </tr>
                        <tr>
                            <td>Containment Queries</td>
                            <td>Use <code>@></code> for efficient containment checks, especially with GIN indexes</td>
                        </tr>
                        <tr>
                            <td>Array Expansion</td>
                            <td>Use <code>jsonb_array_elements</code>, <code>JSON_TABLE</code>, or <code>OPENJSON</code> to convert arrays to rows</td>
                        </tr>
                        <tr>
                            <td>Indexing Strategy</td>
                            <td>Create expression indexes on frequently queried paths; use GIN indexes for flexible containment queries</td>
                        </tr>
                        <tr>
                            <td>Schema Design</td>
                            <td>Don't overuse JSON; extract frequently queried fields to regular columns when appropriate</td>
                        </tr>
                        <tr>
                            <td>Cross-Database Portability</td>
                            <td>Be aware of syntax differences; prefer standard <code>JSON_VALUE</code>/<code>JSON_QUERY</code> when possible</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Navigation -->
            <section>
                <p><a href="03_working_with_json.html">&larr; Back to Working with JSON Data Lesson</a></p>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="../static/script.js"></script>

    <script>
        function toggleSolution(id) {
            var element = document.getElementById(id);
            if (element.classList.contains('show')) {
                element.classList.remove('show');
                event.target.textContent = 'Show Solution';
            } else {
                element.classList.add('show');
                event.target.textContent = 'Hide Solution';
            }
        }
    </script>
</body>

</html>
