<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 2 Cheatsheet - Data Manipulation & JSON</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .cheatsheet-card {
            background: #ffffff; border: 1px solid #dee2e6; border-radius: 8px;
            margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .cheatsheet-card h5 {
            color: #0b132b; border-bottom: 2px solid #4dd0e1;
            padding-bottom: 0.5rem; margin-bottom: 1rem;
        }
        .section-title {
            color: #0b132b; font-size: 1.5rem; margin: 2rem 0 1rem;
            border-left: 4px solid #4dd0e1; padding-left: 1rem;
        }
        .keyword { color: #ff7b72; }
        .function { color: #d2a8ff; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; }
        .tip {
            background: #e8f5e9; border-left: 4px solid #4caf50; padding: 0.75rem 1rem;
            margin: 0.5rem 0; border-radius: 0 5px 5px 0;
        }
        .warning {
            background: #fff3e0; border-left: 4px solid #ff9800; padding: 0.75rem 1rem;
            margin: 0.5rem 0; border-radius: 0 5px 5px 0;
        }
        .quick-ref { background: #e3f2fd; border: 1px solid #1e88e5; border-radius: 8px; padding: 1rem; }
        .quick-ref h5 { color: #1e88e5; border-bottom: none; }
    </style>
</head>
<body>
    <a href="../index_en.html" class="back-button">‚Üê Back to Index</a>
    <div class="language-switcher">
        <a href="cheatsheet.html" class="active">EN</a>
        <a href="cheatsheet_tr.html">TR</a>
    </div>
    <div id="europeanunion-turkey">
        <img src="../static/eu.png" alt="">
    </div>
    <div id="sanayiteknolojibakan">
        <img src="../static/sanayitek.png" alt="">
    </div>
    <div id="rekabet">
        <img src="../static/rekabet.png" alt="">
    </div>
    <div id="tisk">
        <img src="../static/tisk.png" alt="">
    </div>
    <div id="undp">
        <img src="../static/undp.png" alt="">
    </div>

    <div class="content-container">
        <div class="container">
            <section>
                <h1>Day 2: Data Manipulation & JSON</h1>
                <p class="text-muted">INSERT, UPDATE, DELETE, Data Types & JSON Operations</p>

        <!-- Quick Reference -->
        <div class="quick-ref mb-4">
            <h5 class="text-center mb-3">DML Quick Reference</h5>
            <div class="row text-center">
                <div class="col-md-3"><code>INSERT</code> - Add new rows</div>
                <div class="col-md-3"><code>UPDATE</code> - Modify existing rows</div>
                <div class="col-md-3"><code>DELETE</code> - Remove rows</div>
                <div class="col-md-3"><code>UPSERT</code> - Insert or update</div>
            </div>
        </div>

        <!-- INSERT -->
        <h3 class="section-title">INSERT Statement</h3>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Single Row Insert</h5>
                    <pre><code><span class="comment">-- Specify columns (recommended)</span>
<span class="keyword">INSERT INTO</span> employees
    (first_name, last_name, email, salary)
<span class="keyword">VALUES</span>
    (<span class="string">'John'</span>, <span class="string">'Doe'</span>, <span class="string">'john@email.com'</span>, 50000);

<span class="comment">-- All columns (order matters)</span>
<span class="keyword">INSERT INTO</span> employees
<span class="keyword">VALUES</span> (1, <span class="string">'John'</span>, <span class="string">'Doe'</span>, <span class="string">'john@email.com'</span>, 50000);</code></pre>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Multiple Rows Insert</h5>
                    <pre><code><span class="keyword">INSERT INTO</span> employees
    (first_name, last_name, salary)
<span class="keyword">VALUES</span>
    (<span class="string">'John'</span>, <span class="string">'Doe'</span>, 50000),
    (<span class="string">'Jane'</span>, <span class="string">'Smith'</span>, 55000),
    (<span class="string">'Bob'</span>, <span class="string">'Johnson'</span>, 48000);

<span class="comment">-- Returns inserted rows (PostgreSQL)</span>
<span class="keyword">INSERT INTO</span> employees (name, salary)
<span class="keyword">VALUES</span> (<span class="string">'Alice'</span>, 60000)
<span class="keyword">RETURNING</span> id, name;</code></pre>
                </div>
            </div>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Insert from SELECT</h5>
            <pre><code><span class="comment">-- Copy data from another table</span>
<span class="keyword">INSERT INTO</span> employees_archive (id, name, salary, archived_at)
<span class="keyword">SELECT</span> id, name, salary, <span class="function">NOW</span>()
<span class="keyword">FROM</span> employees
<span class="keyword">WHERE</span> termination_date <span class="keyword">IS NOT NULL</span>;</code></pre>
        </div>

        <!-- UPDATE -->
        <h3 class="section-title">UPDATE Statement</h3>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Basic UPDATE</h5>
                    <pre><code><span class="comment">-- Update single column</span>
<span class="keyword">UPDATE</span> employees
<span class="keyword">SET</span> salary = 55000
<span class="keyword">WHERE</span> id = 1;

<span class="comment">-- Update multiple columns</span>
<span class="keyword">UPDATE</span> employees
<span class="keyword">SET</span> salary = 60000,
    department_id = 5,
    updated_at = <span class="function">NOW</span>()
<span class="keyword">WHERE</span> id = 1;</code></pre>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Conditional UPDATE</h5>
                    <pre><code><span class="comment">-- Update with calculation</span>
<span class="keyword">UPDATE</span> employees
<span class="keyword">SET</span> salary = salary * 1.10  <span class="comment">-- 10% raise</span>
<span class="keyword">WHERE</span> department_id = 5;

<span class="comment">-- Update with CASE</span>
<span class="keyword">UPDATE</span> employees
<span class="keyword">SET</span> bonus = <span class="keyword">CASE</span>
    <span class="keyword">WHEN</span> rating >= 5 <span class="keyword">THEN</span> salary * 0.20
    <span class="keyword">WHEN</span> rating >= 3 <span class="keyword">THEN</span> salary * 0.10
    <span class="keyword">ELSE</span> salary * 0.05
<span class="keyword">END</span>;</code></pre>
                </div>
            </div>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>UPDATE with JOIN (PostgreSQL)</h5>
            <pre><code><span class="keyword">UPDATE</span> employees e
<span class="keyword">SET</span> department_name = d.name
<span class="keyword">FROM</span> departments d
<span class="keyword">WHERE</span> e.department_id = d.id;</code></pre>
            <div class="warning">Always use WHERE clause with UPDATE! Without it, ALL rows will be modified.</div>
        </div>

        <!-- DELETE -->
        <h3 class="section-title">DELETE Statement</h3>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Basic DELETE</h5>
                    <pre><code><span class="comment">-- Delete specific rows</span>
<span class="keyword">DELETE FROM</span> employees
<span class="keyword">WHERE</span> id = 1;

<span class="comment">-- Delete with condition</span>
<span class="keyword">DELETE FROM</span> employees
<span class="keyword">WHERE</span> termination_date < <span class="string">'2023-01-01'</span>;

<span class="comment">-- Delete all rows (careful!)</span>
<span class="keyword">DELETE FROM</span> temp_table;</code></pre>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>DELETE with Subquery</h5>
                    <pre><code><span class="comment">-- Delete using subquery</span>
<span class="keyword">DELETE FROM</span> employees
<span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (
    <span class="keyword">SELECT</span> id <span class="keyword">FROM</span> departments
    <span class="keyword">WHERE</span> status = <span class="string">'closed'</span>
);

<span class="comment">-- TRUNCATE (faster, no WHERE)</span>
<span class="keyword">TRUNCATE TABLE</span> temp_logs;
<span class="comment">-- Cannot rollback, resets sequences</span></code></pre>
                </div>
            </div>
        </div>

        <!-- UPSERT -->
        <h3 class="section-title">UPSERT (Insert or Update)</h3>

        <div class="cheatsheet-card p-3">
            <h5>ON CONFLICT (PostgreSQL)</h5>
            <pre><code><span class="comment">-- Insert or update on conflict</span>
<span class="keyword">INSERT INTO</span> products (sku, name, price, stock)
<span class="keyword">VALUES</span> (<span class="string">'SKU001'</span>, <span class="string">'Widget'</span>, 29.99, 100)
<span class="keyword">ON CONFLICT</span> (sku)
<span class="keyword">DO UPDATE SET</span>
    price = EXCLUDED.price,
    stock = products.stock + EXCLUDED.stock,
    updated_at = <span class="function">NOW</span>();

<span class="comment">-- Insert or ignore on conflict</span>
<span class="keyword">INSERT INTO</span> products (sku, name)
<span class="keyword">VALUES</span> (<span class="string">'SKU001'</span>, <span class="string">'Widget'</span>)
<span class="keyword">ON CONFLICT DO NOTHING</span>;</code></pre>
        </div>

        <!-- Data Types -->
        <h3 class="section-title">Common SQL Data Types</h3>

        <div class="cheatsheet-card p-3">
            <h5>Numeric Types</h5>
            <table>
                <thead><tr><th>Type</th><th>Range/Size</th><th>Use Case</th></tr></thead>
                <tbody>
                    <tr><td><code>SMALLINT</code></td><td>-32,768 to 32,767</td><td>Small numbers, flags</td></tr>
                    <tr><td><code>INTEGER / INT</code></td><td>-2.1B to 2.1B</td><td>Most common integer type</td></tr>
                    <tr><td><code>BIGINT</code></td><td>-9.2 quintillion to 9.2 quintillion</td><td>Large IDs, timestamps</td></tr>
                    <tr><td><code>DECIMAL(p,s) / NUMERIC</code></td><td>Exact precision</td><td>Money, financial data</td></tr>
                    <tr><td><code>REAL / FLOAT4</code></td><td>6 decimal digits</td><td>Scientific data</td></tr>
                    <tr><td><code>DOUBLE PRECISION</code></td><td>15 decimal digits</td><td>Scientific calculations</td></tr>
                    <tr><td><code>SERIAL / BIGSERIAL</code></td><td>Auto-increment</td><td>Primary keys</td></tr>
                </tbody>
            </table>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Character Types</h5>
            <table>
                <thead><tr><th>Type</th><th>Description</th><th>Use Case</th></tr></thead>
                <tbody>
                    <tr><td><code>CHAR(n)</code></td><td>Fixed length, padded</td><td>Fixed codes (country codes)</td></tr>
                    <tr><td><code>VARCHAR(n)</code></td><td>Variable length, max n</td><td>Most string data</td></tr>
                    <tr><td><code>TEXT</code></td><td>Unlimited length</td><td>Long text, descriptions</td></tr>
                </tbody>
            </table>
            <div class="tip">In PostgreSQL, VARCHAR and TEXT have similar performance. Use VARCHAR(n) when you need length validation.</div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Date/Time Types</h5>
                    <table>
                        <tbody>
                            <tr><td><code>DATE</code></td><td>Date only (YYYY-MM-DD)</td></tr>
                            <tr><td><code>TIME</code></td><td>Time only (HH:MM:SS)</td></tr>
                            <tr><td><code>TIMESTAMP</code></td><td>Date + Time</td></tr>
                            <tr><td><code>TIMESTAMPTZ</code></td><td>With timezone (recommended)</td></tr>
                            <tr><td><code>INTERVAL</code></td><td>Time duration</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Other Types</h5>
                    <table>
                        <tbody>
                            <tr><td><code>BOOLEAN</code></td><td>TRUE, FALSE, NULL</td></tr>
                            <tr><td><code>UUID</code></td><td>Universally unique ID</td></tr>
                            <tr><td><code>JSON / JSONB</code></td><td>JSON data (JSONB faster)</td></tr>
                            <tr><td><code>BYTEA</code></td><td>Binary data</td></tr>
                            <tr><td><code>ARRAY</code></td><td>Array of any type</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- JSON -->
        <h3 class="section-title">Working with JSON</h3>

        <div class="cheatsheet-card p-3">
            <h5>JSON vs JSONB (PostgreSQL)</h5>
            <table>
                <thead><tr><th>Feature</th><th>JSON</th><th>JSONB</th></tr></thead>
                <tbody>
                    <tr><td>Storage</td><td>Text (preserves whitespace)</td><td>Binary (compact)</td></tr>
                    <tr><td>Write speed</td><td>Faster</td><td>Slightly slower</td></tr>
                    <tr><td>Read speed</td><td>Slower (reparsed)</td><td>Faster</td></tr>
                    <tr><td>Indexing</td><td>No</td><td>Yes (GIN index)</td></tr>
                    <tr><td>Key order</td><td>Preserved</td><td>Not guaranteed</td></tr>
                </tbody>
            </table>
            <div class="tip">Use JSONB unless you need to preserve key order or exact formatting.</div>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>JSON Operators (PostgreSQL)</h5>
            <pre><code><span class="comment">-- Sample data</span>
<span class="keyword">CREATE TABLE</span> users (
    id SERIAL PRIMARY KEY,
    data JSONB
);

<span class="keyword">INSERT INTO</span> users (data) <span class="keyword">VALUES</span>
(<span class="string">'{"name": "John", "age": 30, "address": {"city": "NYC", "zip": "10001"}, "tags": ["admin", "active"]}'</span>);

<span class="comment">-- Access JSON field (returns JSON)</span>
<span class="keyword">SELECT</span> data-><span class="string">'name'</span> <span class="keyword">FROM</span> users;              <span class="comment">-- "John" (JSON)</span>

<span class="comment">-- Access JSON field as text</span>
<span class="keyword">SELECT</span> data->><span class="string">'name'</span> <span class="keyword">FROM</span> users;             <span class="comment">-- John (text)</span>

<span class="comment">-- Access nested field</span>
<span class="keyword">SELECT</span> data-><span class="string">'address'</span>-><span class="string">'city'</span> <span class="keyword">FROM</span> users;   <span class="comment">-- "NYC"</span>
<span class="keyword">SELECT</span> data-><span class="string">'address'</span>->><span class="string">'city'</span> <span class="keyword">FROM</span> users;  <span class="comment">-- NYC</span>

<span class="comment">-- Access array element</span>
<span class="keyword">SELECT</span> data-><span class="string">'tags'</span>->0 <span class="keyword">FROM</span> users;          <span class="comment">-- "admin"</span>

<span class="comment">-- Path access</span>
<span class="keyword">SELECT</span> data#><span class="string">'{address,city}'</span> <span class="keyword">FROM</span> users;   <span class="comment">-- "NYC"</span>
<span class="keyword">SELECT</span> data#>><span class="string">'{address,city}'</span> <span class="keyword">FROM</span> users;  <span class="comment">-- NYC</span></code></pre>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>JSON Query Operators</h5>
                    <pre><code><span class="comment">-- Contains (JSONB only)</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> users
<span class="keyword">WHERE</span> data @> <span class="string">'{"age": 30}'</span>;

<span class="comment">-- Is contained by</span>
<span class="keyword">WHERE</span> <span class="string">'{"name": "John"}'</span> <@ data;

<span class="comment">-- Key exists</span>
<span class="keyword">WHERE</span> data ? <span class="string">'name'</span>;

<span class="comment">-- Any key exists</span>
<span class="keyword">WHERE</span> data ?| array[<span class="string">'name'</span>, <span class="string">'email'</span>];

<span class="comment">-- All keys exist</span>
<span class="keyword">WHERE</span> data ?& array[<span class="string">'name'</span>, <span class="string">'age'</span>];</code></pre>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>JSON Functions</h5>
                    <pre><code><span class="comment">-- Get all keys</span>
<span class="keyword">SELECT</span> <span class="function">jsonb_object_keys</span>(data) <span class="keyword">FROM</span> users;

<span class="comment">-- Get array length</span>
<span class="keyword">SELECT</span> <span class="function">jsonb_array_length</span>(data-><span class="string">'tags'</span>);

<span class="comment">-- Expand array to rows</span>
<span class="keyword">SELECT</span> <span class="function">jsonb_array_elements</span>(data-><span class="string">'tags'</span>);

<span class="comment">-- Pretty print</span>
<span class="keyword">SELECT</span> <span class="function">jsonb_pretty</span>(data) <span class="keyword">FROM</span> users;

<span class="comment">-- Build JSON object</span>
<span class="keyword">SELECT</span> <span class="function">jsonb_build_object</span>(
    <span class="string">'name'</span>, first_name,
    <span class="string">'salary'</span>, salary
) <span class="keyword">FROM</span> employees;</code></pre>
                </div>
            </div>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Modifying JSON (JSONB)</h5>
            <pre><code><span class="comment">-- Set/update a key</span>
<span class="keyword">UPDATE</span> users
<span class="keyword">SET</span> data = <span class="function">jsonb_set</span>(data, <span class="string">'{age}'</span>, <span class="string">'31'</span>)
<span class="keyword">WHERE</span> id = 1;

<span class="comment">-- Set nested key</span>
<span class="keyword">UPDATE</span> users
<span class="keyword">SET</span> data = <span class="function">jsonb_set</span>(data, <span class="string">'{address,zip}'</span>, <span class="string">'"10002"'</span>);

<span class="comment">-- Remove a key</span>
<span class="keyword">UPDATE</span> users
<span class="keyword">SET</span> data = data - <span class="string">'age'</span>;

<span class="comment">-- Remove nested key</span>
<span class="keyword">UPDATE</span> users
<span class="keyword">SET</span> data = data #- <span class="string">'{address,zip}'</span>;

<span class="comment">-- Concatenate/merge JSON</span>
<span class="keyword">UPDATE</span> users
<span class="keyword">SET</span> data = data || <span class="string">'{"email": "john@email.com"}'</span>;</code></pre>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Indexing JSON (JSONB)</h5>
            <pre><code><span class="comment">-- GIN index for @>, ?, ?|, ?& operators</span>
<span class="keyword">CREATE INDEX</span> idx_users_data <span class="keyword">ON</span> users <span class="keyword">USING GIN</span> (data);

<span class="comment">-- Index specific path</span>
<span class="keyword">CREATE INDEX</span> idx_users_city <span class="keyword">ON</span> users <span class="keyword">USING GIN</span> ((data-><span class="string">'address'</span>));

<span class="comment">-- Expression index for specific key</span>
<span class="keyword">CREATE INDEX</span> idx_users_name <span class="keyword">ON</span> users ((data->><span class="string">'name'</span>));</code></pre>
        </div>

        <!-- Transactions -->
        <h3 class="section-title">Transactions</h3>

        <div class="cheatsheet-card p-3">
            <h5>Transaction Control</h5>
            <pre><code><span class="comment">-- Start transaction</span>
<span class="keyword">BEGIN</span>;  <span class="comment">-- or START TRANSACTION</span>

<span class="comment">-- Your DML statements</span>
<span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance = balance - 100 <span class="keyword">WHERE</span> id = 1;
<span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance = balance + 100 <span class="keyword">WHERE</span> id = 2;

<span class="comment">-- Save changes</span>
<span class="keyword">COMMIT</span>;

<span class="comment">-- Or undo changes</span>
<span class="keyword">ROLLBACK</span>;

<span class="comment">-- Savepoints for partial rollback</span>
<span class="keyword">BEGIN</span>;
<span class="keyword">INSERT INTO</span> orders (...) <span class="keyword">VALUES</span> (...);
<span class="keyword">SAVEPOINT</span> before_items;
<span class="keyword">INSERT INTO</span> order_items (...) <span class="keyword">VALUES</span> (...);
<span class="keyword">ROLLBACK TO</span> before_items;  <span class="comment">-- Undo items only</span>
<span class="keyword">COMMIT</span>;  <span class="comment">-- Order is saved</span></code></pre>
        </div>

        <!-- Best Practices -->
        <h3 class="section-title">Best Practices</h3>

        <div class="row">
            <div class="col-md-6">
                <div class="tip">
                    <strong>Always use WHERE with UPDATE/DELETE</strong> - Prevent accidental mass changes
                </div>
                <div class="tip">
                    <strong>Use transactions</strong> - Group related changes together
                </div>
                <div class="tip">
                    <strong>Use DECIMAL for money</strong> - Never use FLOAT for financial data
                </div>
            </div>
            <div class="col-md-6">
                <div class="tip">
                    <strong>Use TIMESTAMPTZ</strong> - Always store timestamps with timezone
                </div>
                <div class="warning">
                    <strong>JSONB over JSON</strong> - Better performance and indexing
                </div>
                <div class="warning">
                    <strong>Test DML in transaction</strong> - BEGIN, run statement, verify, then COMMIT or ROLLBACK
                </div>
            </div>
        </div>

            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>
