<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="tr" xml:lang="tr">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style_bootstrap.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/code.css">
    <link href="https://cdn.prod.website-files.com/5efdb54f07a6812bcd95cc65/6773d0fc3013e060f08d7145_favicon.jpg"
        rel="shortcut icon" type="image/x-icon">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>Gun 2: JSON Verileriyle Calisma - Pratik Ornekler</title>
    <style>
        code {
            white-space: pre-wrap;
        }

        span.smallcaps {
            font-variant: small-caps;
        }

        span.underline {
            text-decoration: underline;
        }

        div.column {
            display: inline-block;
            vertical-align: top;
            width: 50%;
        }

        div.hanging-indent {
            margin-left: 1.5em;
            text-indent: -1.5em;
        }

        ul.task-list {
            list-style: none;
        }

        .exercise-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .exercise-box h4 {
            color: #495057;
            margin-bottom: 15px;
        }

        .solution-box {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .solution-box.show {
            display: block;
        }

        .toggle-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .toggle-btn:hover {
            background-color: #0056b3;
        }

        .hint-box {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .hint-box::before {
            content: "Ipucu: ";
            font-weight: bold;
        }

        .warning-box {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .warning-box::before {
            content: "Uyari: ";
            font-weight: bold;
        }

        .concept-box {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .concept-box::before {
            content: "Kavram: ";
            font-weight: bold;
        }

        .syntax-box {
            background-color: #e2d5f1;
            border: 1px solid #c5b3d9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .syntax-box::before {
            content: "Sozdizimi Referansi: ";
            font-weight: bold;
        }

        .challenge-box {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .challenge-box h4 {
            color: #155724;
        }

        .challenge-box::before {
            content: "";
        }

        .dataset-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        .dataset-table th,
        .dataset-table td {
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            text-align: left;
        }

        .dataset-table th {
            background-color: #343a40;
            color: white;
        }

        .dataset-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background-color: #007bff;
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .json-display {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre;
        }

        .json-key {
            color: #f92672;
        }

        .json-string {
            color: #a6e22e;
        }

        .json-number {
            color: #ae81ff;
        }

        .json-boolean {
            color: #66d9ef;
        }

        .result-box {
            background-color: #f1f1f1;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
        }

        .db-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin: 2px;
        }

        .db-postgresql {
            background-color: #336791;
            color: white;
        }

        .db-mysql {
            background-color: #4479A1;
            color: white;
        }

        .db-sqlserver {
            background-color: #CC2927;
            color: white;
        }

        .db-oracle {
            background-color: #F80000;
            color: white;
        }

        .operator-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 13px;
        }

        .operator-table th,
        .operator-table td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }

        .operator-table th {
            background-color: #6c5ce7;
            color: white;
        }

        .operator-table code {
            background-color: #f1f1f1;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .language-switcher {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .language-switcher span {
            font-weight: bold;
            color: #495057;
        }

        .language-switcher a {
            padding: 5px 12px;
            border-radius: 4px;
            text-decoration: none;
            color: #007bff;
            border: 1px solid #007bff;
            transition: all 0.3s ease;
        }

        .language-switcher a:hover {
            background-color: #007bff;
            color: white;
        }

        .language-switcher a.active {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>

<body>
    <a href="../index.html" class="back-button">← Anasayfaya Don</a>
    <div class="copy-notification" id="copyNotification">Kopyalandi!</div>

    <div id="europeanunion-turkey">
        <img src="../static/eu.png" alt="">
    </div>
    <div id="sanayiteknolojibakan">
        <img src="../static/sanayitek.png" alt="">
    </div>
    <div id="rekabet">
        <img src="../static/rekabet.png" alt="">
    </div>
    <div id="tisk">
        <img src="../static/tisk.png" alt="">
    </div>
    <div id="undp">
        <img src="../static/undp.png" alt="">
    </div>
    <div class="content-container">
        <div class="container">
            <div class="language-switcher">
                <span>Dil:</span>
                <a href="03_working_with_json_examples.html">English</a>
                <a href="03_working_with_json_examples_tr.html" class="active">Turkce</a>
            </div>

            <section>
                <h1 id="json-practical-examples">JSON Verileriyle Calisma - Pratik Ornekler</h1>
                <p><a href="03_working_with_json.html">&larr; JSON Verileriyle Calisma Dersine Don</a></p>
                <p>Bu sayfa, SQL'de JSON islemlerini ustaca kullanmaniz icin uygulamali alistirmalar sunmaktadir. Deger cikarma,
                    JSON icerisinde arama yapma, belgeleri degistirme ve JSON ile iliskisel formatlar arasinda donusum yapma konularinda pratik yapin.</p>

                <div class="syntax-box">
                    <strong>PostgreSQL operatorleri:</strong> <code>-></code> (JSON olarak al), <code>->></code> (metin olarak al), <code>?</code> (anahtar var mi), <code>@></code> (icerir)<br>
                    <strong>MySQL:</strong> <code>-></code> veya <code>JSON_EXTRACT()</code>, <code>->></code> (tirnak isaretsiz), <code>JSON_CONTAINS()</code><br>
                    <strong>SQL Server:</strong> <code>JSON_VALUE()</code>, <code>JSON_QUERY()</code>, <code>OPENJSON()</code>
                </div>
            </section>

            <!-- Ornek Veri Setleri Bolumu -->
            <section>
                <h2 id="sample-datasets">Ornek Veri Setleri</h2>
                <p><code>bootcamp_db</code> veritabanindaki asagidaki tablolar JSONB sutunlari icermektedir. Alisturmalara baslamadan once veri yapisini anlamak icin bu ornekleri inceleyin.</p>

                <h4>products Tablosu (attributes JSONB sutunu)</h4>
                <p><code>attributes</code> sutunu urun ozelliklerini JSON olarak saklar. Farkli urun turleri farkli ozelliklere sahiptir (laptoplar islemci/ram, telefonlar ekran/kamera vb.):</p>
                <table class="dataset-table">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>name</th>
                            <th>attributes (JSONB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>ProBook Laptop 15"</td>
                            <td>
                                <div class="json-display">{
  "brand": "TechPro",
  "processor": "Intel i7-12700H",
  "ram": "16GB DDR5",
  "storage": "512GB NVMe SSD",
  "display": "15.6 inch FHD",
  "battery": "72Wh",
  "warranty_months": 24
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>SmartPhone Pro Max</td>
                            <td>
                                <div class="json-display">{
  "brand": "TechMobile",
  "screen": "6.7 inch OLED",
  "storage": "256GB",
  "ram": "12GB",
  "camera": "108MP + 12MP + 10MP",
  "battery": "5000mAh",
  "5g": true,
  "colors": ["Black", "Silver", "Blue"]
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>SmartPhone Lite</td>
                            <td>
                                <div class="json-display">{
  "brand": "TechMobile",
  "screen": "6.1 inch LCD",
  "storage": "64GB",
  "ram": "4GB",
  "camera": "48MP + 2MP",
  "battery": "4000mAh",
  "5g": false
}</div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h4>orders Tablosu (metadata JSONB sutunu)</h4>
                <p><code>metadata</code> sutunu siparis baglam bilgilerini saklar. Not: Tum siparislerin metadatasi yoktur ve farkli siparisler farkli anahtarlara sahip olabilir (source, campaign, b2b, rep_id, returning_customer):</p>
                <table class="dataset-table">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>order_number</th>
                            <th>metadata (JSONB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>ORD-2023-0001</td>
                            <td>
                                <div class="json-display">{
  "source": "website",
  "campaign": "new_year"
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>ORD-2023-0002</td>
                            <td>
                                <div class="json-display">{
  "source": "mobile_app"
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>ORD-2023-0003</td>
                            <td>
                                <div class="json-display">{
  "source": "website",
  "b2b": true
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>ORD-2023-0004</td>
                            <td>
                                <div class="json-display">{
  "source": "sales_rep",
  "rep_id": 10
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>8</td>
                            <td>ORD-2023-0008</td>
                            <td>
                                <div class="json-display">{
  "source": "website",
  "returning_customer": true
}</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- JSON Operatorleri Hizli Referans -->
            <section>
                <h2 id="operator-reference">JSON Operatorleri Hizli Referans</h2>
                <table class="operator-table">
                    <thead>
                        <tr>
                            <th>Islem</th>
                            <th><span class="db-badge db-postgresql">PostgreSQL</span></th>
                            <th><span class="db-badge db-mysql">MySQL</span></th>
                            <th><span class="db-badge db-sqlserver">SQL Server</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Alani JSON olarak al</td>
                            <td><code>data->'field'</code></td>
                            <td><code>data->'$.field'</code></td>
                            <td><code>JSON_QUERY(data, '$.field')</code></td>
                        </tr>
                        <tr>
                            <td>Alani metin olarak al</td>
                            <td><code>data->>'field'</code></td>
                            <td><code>data->>'$.field'</code></td>
                            <td><code>JSON_VALUE(data, '$.field')</code></td>
                        </tr>
                        <tr>
                            <td>Ic ice yolu al</td>
                            <td><code>data#>>'{a,b,c}'</code></td>
                            <td><code>data->>'$.a.b.c'</code></td>
                            <td><code>JSON_VALUE(data, '$.a.b.c')</code></td>
                        </tr>
                        <tr>
                            <td>Dizi elemanini al</td>
                            <td><code>data->'arr'->0</code></td>
                            <td><code>data->'$.arr[0]'</code></td>
                            <td><code>JSON_VALUE(data, '$.arr[0]')</code></td>
                        </tr>
                        <tr>
                            <td>Anahtar var mi</td>
                            <td><code>data ? 'key'</code></td>
                            <td><code>JSON_CONTAINS_PATH(data, 'one', '$.key')</code></td>
                            <td><code>JSON_VALUE(data, '$.key') IS NOT NULL</code></td>
                        </tr>
                        <tr>
                            <td>Deger icerir</td>
                            <td><code>data @> '{"k":"v"}'</code></td>
                            <td><code>JSON_CONTAINS(data, '"v"', '$.k')</code></td>
                            <td>Cikar ve karsilastir</td>
                        </tr>
                        <tr>
                            <td>Deger ata/guncelle</td>
                            <td><code>jsonb_set(data, '{k}', '"v"')</code></td>
                            <td><code>JSON_SET(data, '$.k', 'v')</code></td>
                            <td><code>JSON_MODIFY(data, '$.k', 'v')</code></td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Alistirma 1: Temel JSON Cikarma -->
            <section>
                <h2 id="exercise-1">Alistirma 1: Temel JSON Yol Gezintisi</h2>
                <p>Yol gezintisi operatorlerini kullanarak JSON sutunlarindan deger cikarmayi ogrenin. Bunlar neredeyse her JSON sorgusunda kullanacaginiz temel islemlerdir.</p>

                <div class="concept-box">
                    JSON/JSONB ciktisi almak icin <code>-></code>, metin ciktisi almak icin <code>->></code> kullanin.
                    Fark, degerleri karsilastirirken veya WHERE ifadelerinde kullanirken onemlidir. Metin ciktisi karsilastirma ve gosterim icin gereklidir.
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 1.1: Basit Alanlari Cikarma</h4>
                    <p><code>products</code> tablosundaki <code>attributes</code> JSONB sutununu kullanarak JSON'dan skaler degerler cikarin:</p>
                    <ol>
                        <li><strong>Marka cikarma:</strong> Tum urun adlarini markalariyla birlikte listeleyin (attributes icindeki <code>brand</code> anahtarindan). Sadece attributes'u olan urunleri dahil edin.</li>
                        <li><strong>RAM ozelligi:</strong> Urun adlarini <code>ram</code> anahtarindan RAM ozellikleriyle birlikte gosterin.</li>
                        <li><strong>Garanti filtreleme:</strong> Garantisi 12 aydan uzun olan urunleri bulun. <code>warranty_months</code> anahtari tamsayi deger saklar.</li>
                    </ol>

                    <div class="hint-box">
                        JSON degerleri varsayilan olarak metin olarak cikarilir. Sayisal degerleri karsilastirmak icin donusum yapin: <code>(attributes->>'warranty_months')::INTEGER > 12</code>
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_1')">Cozumu Goster</button>
                    <div id="solution1_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Tum urunlerin markasini al
SELECT name, attributes->>'brand' AS brand
FROM products
WHERE attributes IS NOT NULL;

-- 2. Urun adi ve RAM'i al
SELECT name, attributes->>'ram' AS ram
FROM products
WHERE attributes IS NOT NULL;

-- 3. Garantisi 12 aydan fazla olan urunler
SELECT name, attributes->>'warranty_months' AS warranty
FROM products
WHERE attributes IS NOT NULL
  AND (attributes->>'warranty_months')::INTEGER > 12;

-- MySQL
-- 1. Markayi al
SELECT name, attributes->>'$.brand' AS brand
FROM products
WHERE attributes IS NOT NULL;

-- 2. Urun adi ve RAM'i al
SELECT name, attributes->>'$.ram' AS ram
FROM products
WHERE attributes IS NOT NULL;

-- 3. Garantisi 12 aydan fazla olan urunler
SELECT name, attributes->>'$.warranty_months' AS warranty
FROM products
WHERE attributes IS NOT NULL
  AND CAST(attributes->>'$.warranty_months' AS UNSIGNED) > 12;

-- SQL Server
-- 1. Markayi al
SELECT name, JSON_VALUE(attributes, '$.brand') AS brand
FROM products
WHERE attributes IS NOT NULL;

-- 2. Urun adi ve RAM'i al
SELECT name, JSON_VALUE(attributes, '$.ram') AS ram
FROM products
WHERE attributes IS NOT NULL;

-- 3. Garantisi 12 aydan fazla olan urunler
SELECT name, JSON_VALUE(attributes, '$.warranty_months') AS warranty
FROM products
WHERE attributes IS NOT NULL
  AND CAST(JSON_VALUE(attributes, '$.warranty_months') AS INT) > 12;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 1.2: Siparis Metadata'sindan Cikarma</h4>
                    <p><code>orders</code> tablosundaki <code>metadata</code> JSONB sutununu kullanarak deger cikarma ve JSON icerigine gore filtreleme pratiği yapin:</p>
                    <ol>
                        <li><strong>Kaynak cikarma:</strong> Tum siparis numaralarini kaynak kanallariyla birlikte listeleyin (<code>source</code> anahtarindan). Not: Bazi siparislerin metadata'si NULL olabilir.</li>
                        <li><strong>Kampanyali siparisler:</strong> Metadata'larinda <code>campaign</code> alani olan siparisleri bulun ve kampanya adini gosterin.</li>
                        <li><strong>Website siparisleri:</strong> Sadece kaynak 'website' olan siparisleri gostermek icin filtreleyin.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_2')">Cozumu Goster</button>
                    <div id="solution1_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Siparis kaynagini al
SELECT order_number, metadata->>'source' AS source
FROM orders
WHERE metadata IS NOT NULL;

-- 2. Campaign alani olan siparisler
SELECT order_number, metadata->>'campaign' AS campaign
FROM orders
WHERE metadata ? 'campaign';

-- 3. Website'den gelen siparisler
SELECT order_number, metadata->>'source' AS source
FROM orders
WHERE metadata->>'source' = 'website';

-- MySQL
-- 1. Siparis kaynagini al
SELECT order_number, metadata->>'$.source' AS source
FROM orders
WHERE metadata IS NOT NULL;

-- 2. Campaign alani olan siparisler
SELECT order_number, metadata->>'$.campaign' AS campaign
FROM orders
WHERE JSON_CONTAINS_PATH(metadata, 'one', '$.campaign');

-- 3. Website'den gelen siparisler
SELECT order_number, metadata->>'$.source' AS source
FROM orders
WHERE metadata->>'$.source' = 'website';

-- SQL Server
-- 1. Siparis kaynagini al
SELECT order_number, JSON_VALUE(metadata, '$.source') AS source
FROM orders
WHERE metadata IS NOT NULL;

-- 2. Campaign alani olan siparisler
SELECT order_number, JSON_VALUE(metadata, '$.campaign') AS campaign
FROM orders
WHERE JSON_VALUE(metadata, '$.campaign') IS NOT NULL;

-- 3. Website'den gelen siparisler
SELECT order_number, JSON_VALUE(metadata, '$.source') AS source
FROM orders
WHERE JSON_VALUE(metadata, '$.source') = 'website';</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 1.3: Dizi Elemanlarina Erisim</h4>
                    <p>Bazi urunler (akilli telefonlar gibi) attributes'larinda <code>colors</code> dizisine sahiptir. JSON dizileriyle calismayi pratiğe dokun:</p>
                    <ol>
                        <li><strong>Ilk eleman:</strong> Colors dizisi olan urunlerden ilk rengi (index 0) cikarin. Dizi indeksleri 0'dan baslar.</li>
                        <li><strong>Tam dizi:</strong> Her urun icin tum colors dizisini JSON olarak dondurün.</li>
                        <li><strong>Dizi uzunlugu:</strong> <code>jsonb_array_length()</code> kullanarak her urunun kac renk secenegine sahip oldugunu sayin.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_3')">Cozumu Goster</button>
                    <div id="solution1_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Ilk rengi al
SELECT name, attributes->'colors'->>0 AS first_color
FROM products
WHERE attributes ? 'colors';

-- 2. Tum renkleri JSON dizisi olarak al
SELECT name, attributes->'colors' AS colors
FROM products
WHERE attributes ? 'colors';

-- 3. Renkleri say
SELECT name, jsonb_array_length(attributes->'colors') AS color_count
FROM products
WHERE attributes ? 'colors';

-- MySQL
-- 1. Ilk rengi al
SELECT name, attributes->>'$.colors[0]' AS first_color
FROM products
WHERE JSON_CONTAINS_PATH(attributes, 'one', '$.colors');

-- 2. Tum renkleri JSON dizisi olarak al
SELECT name, attributes->'$.colors' AS colors
FROM products
WHERE JSON_CONTAINS_PATH(attributes, 'one', '$.colors');

-- 3. Renkleri say
SELECT name, JSON_LENGTH(attributes->'$.colors') AS color_count
FROM products
WHERE JSON_CONTAINS_PATH(attributes, 'one', '$.colors');

-- SQL Server
-- 1. Ilk rengi al
SELECT name, JSON_VALUE(attributes, '$.colors[0]') AS first_color
FROM products
WHERE JSON_QUERY(attributes, '$.colors') IS NOT NULL;

-- 2. Tum renkleri JSON dizisi olarak al
SELECT name, JSON_QUERY(attributes, '$.colors') AS colors
FROM products
WHERE JSON_QUERY(attributes, '$.colors') IS NOT NULL;

-- 3. Renkleri say (OPENJSON gerektirir)
SELECT name,
       (SELECT COUNT(*) FROM OPENJSON(attributes, '$.colors')) AS color_count
FROM products
WHERE JSON_QUERY(attributes, '$.colors') IS NOT NULL;</code></pre>
                    </div>
                </div>
            </section>

            <!-- Alistirma 2: Varlik ve Icerik Kontrolleri -->
            <section>
                <h2 id="exercise-2">Alistirma 2: Varlik ve Icerik Kontrolleri</h2>
                <p>JSON verilerinde anahtar varligi ve deger icerme kontrollerini ogrenin. Bu islemler, tum kayitlarin ayni alanlara sahip olmadigi yari-yapilandirilmis verileri sorgulamak icin onemlidir.</p>

                <div class="concept-box">
                    PostgreSQL'in <code>?</code> operatoru bir anahtarin var olup olmadigini kontrol eder. <code>@></code> sol JSON'un sag JSON'u icerip icermedigini kontrol eder (belirli degerleri eslemek icin kullanisli).
                    Her iki operator de GIN indeksleri ile birlestirildiginde verimlidir.
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 2.1: Anahtar Varligini Kontrol Etme</h4>
                    <p>Tum urunler ayni ozelliklere sahip degildir (laptoplarda 5g yok, telefonlarda warranty_months yok). Belirli anahtarlara sahip kayitlari bulmak icin <code>?</code> operatorunu kullanin:</p>
                    <ol>
                        <li><strong>5G yetenegi:</strong> Ozelliklerinde "5g" alani tanimlanmis tum urunleri bulun (degerinden bagimsiz olarak).</li>
                        <li><strong>Garanti bilgisi:</strong> Garanti bilgisi olan urunleri bulun ("warranty_months" anahtari mevcut).</li>
                        <li><strong>Kampanya takibi:</strong> Metadata'sinda "campaign" alani kaydedilmis siparisleri bulun.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_1')">Cozumu Goster</button>
                    <div id="solution2_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. 5g alani olan urunler
SELECT name, attributes->>'5g' AS has_5g
FROM products
WHERE attributes ? '5g';

-- 2. warranty_months alani olan urunler
SELECT name, attributes->>'warranty_months' AS warranty
FROM products
WHERE attributes ? 'warranty_months';

-- 3. Campaign alani olan siparisler
SELECT order_number, metadata->>'campaign' AS campaign
FROM orders
WHERE metadata ? 'campaign';

-- MySQL
-- 1. 5g alani olan urunler
SELECT name, attributes->>'$.5g' AS has_5g
FROM products
WHERE JSON_CONTAINS_PATH(attributes, 'one', '$.5g');

-- 2. warranty_months alani olan urunler
SELECT name, attributes->>'$.warranty_months' AS warranty
FROM products
WHERE JSON_CONTAINS_PATH(attributes, 'one', '$.warranty_months');

-- 3. Campaign alani olan siparisler
SELECT order_number, metadata->>'$.campaign' AS campaign
FROM orders
WHERE JSON_CONTAINS_PATH(metadata, 'one', '$.campaign');

-- SQL Server
-- 1. 5g alani olan urunler
SELECT name, JSON_VALUE(attributes, '$.5g') AS has_5g
FROM products
WHERE JSON_VALUE(attributes, '$.5g') IS NOT NULL;

-- 2. warranty_months alani olan urunler
SELECT name, JSON_VALUE(attributes, '$.warranty_months') AS warranty
FROM products
WHERE JSON_VALUE(attributes, '$.warranty_months') IS NOT NULL;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 2.2: Icerik Sorgulari</h4>
                    <p>Belirli JSON degerlerini eslesen kayitlari bulmak icin <code>@></code> icerik operatorunu kullanin. Bu, cikarip karsilastirmaktan daha verimlidir:</p>
                    <ol>
                        <li><strong>5G telefonlar:</strong> 5g'nin true oldugu urunleri bulun (sadece anahtarin var oldugu degil, degerin true oldugu).</li>
                        <li><strong>Marka filtresi:</strong> Icerik kullanarak "TechMobile" markasindaki tum urunleri bulun.</li>
                        <li><strong>B2B siparisler:</strong> Metadata'si <code>{"b2b": true}</code> iceren isletmeler arasi siparisleri bulun.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_2')">Cozumu Goster</button>
                    <div id="solution2_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. 5G destegi olan urunler
SELECT name, attributes
FROM products
WHERE attributes @> '{"5g": true}'::jsonb;

-- Metin cikarma ve donusum ile alternatif
SELECT name
FROM products
WHERE (attributes->>'5g')::BOOLEAN = TRUE;

-- 2. TechMobile markasindaki urunler
SELECT name, attributes->>'brand' AS brand
FROM products
WHERE attributes @> '{"brand": "TechMobile"}'::jsonb;

-- 3. B2B siparisler
SELECT order_number, metadata
FROM orders
WHERE metadata @> '{"b2b": true}'::jsonb;

-- MySQL
-- 1. 5G destegi olan urunler
SELECT name, attributes
FROM products
WHERE JSON_EXTRACT(attributes, '$.5g') = true;

-- 2. TechMobile markasindaki urunler
SELECT name, attributes->>'$.brand' AS brand
FROM products
WHERE JSON_CONTAINS(attributes, '"TechMobile"', '$.brand');

-- 3. B2B siparisler
SELECT order_number, metadata
FROM orders
WHERE JSON_EXTRACT(metadata, '$.b2b') = true;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 2.3: Coklu Anahtar Varligi</h4>
                    <p>PostgreSQL birden fazla anahtari ayni anda kontrol etmek icin <code>?&</code> (tum anahtarlar mevcut) ve <code>?|</code> (herhangi bir anahtar mevcut) saglar:</p>
                    <ol>
                        <li><strong>VE mantigi:</strong> HEM "5g" HEM DE "colors" alanina sahip urunleri bulun (renk secenekli akilli telefonlar).</li>
                        <li><strong>VEYA mantigi:</strong> "warranty_months" VEYA "colors" alanina sahip urunleri bulun (genisletilmis bilgiye sahip urunler).</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_3')">Cozumu Goster</button>
                    <div id="solution2_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. HEM 5g HEM DE colors olan urunler
SELECT name
FROM products
WHERE attributes ?& ARRAY['5g', 'colors'];

-- AND kullanan alternatif
SELECT name
FROM products
WHERE attributes ? '5g' AND attributes ? 'colors';

-- 2. warranty_months VEYA colors olan urunler
SELECT name
FROM products
WHERE attributes ?| ARRAY['warranty_months', 'colors'];

-- OR kullanan alternatif
SELECT name
FROM products
WHERE attributes ? 'warranty_months' OR attributes ? 'colors';

-- MySQL
-- 1. HER IKISI de olan urunler
SELECT name
FROM products
WHERE JSON_CONTAINS_PATH(attributes, 'all', '$.5g', '$.colors');

-- 2. HERHANGI BIRI olan urunler
SELECT name
FROM products
WHERE JSON_CONTAINS_PATH(attributes, 'one', '$.warranty_months', '$.colors');</code></pre>
                    </div>
                </div>
            </section>

            <!-- Alistirma 3: JSON Verisini Degistirme -->
            <section>
                <h2 id="exercise-3">Alistirma 3: JSON Verisini Degistirme</h2>
                <p>JSON belgelerinde alanlari guncelleme, ekleme ve kaldirmayi ogrenin. Bu UPDATE sorgulari bir JSON sutununun belirli bolumlerini nasil degistireceginizi gosterir.</p>

                <div class="warning-box">
                    JSON'u degistirmek dahili olarak tum belgeyi gunceller. Sik guncellenen alanlar icin
                    daha iyi performans icin bunlari ayri iliskisel sutunlarda saklamayi dusunun.
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 3.1: JSON Alanlarini Guncelleme</h4>
                    <p>JSON degerlerini degistirmek icin <code>jsonb_set()</code> ve <code>||</code> birlestirme operatorunu kullanin:</p>
                    <ol>
                        <li><strong>Mevcut degeri guncelle:</strong> 'ProBook Laptop 15"' icin warranty_months'i <code>jsonb_set()</code> kullanarak 24'ten 36'ya degistirin.</li>
                        <li><strong>Yeni alan ekle:</strong> <code>||</code> birlestirme operatorunu kullanarak bir urunun attributes'una true degeriyle "eco_friendly" alani ekleyin.</li>
                        <li><strong>Metadata'yi genislet:</strong> Siparis id=1'in metadata'sina "high" degeriyle "priority" alani ekleyin.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_1')">Cozumu Goster</button>
                    <div id="solution3_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. warranty_months'i guncelle
UPDATE products
SET attributes = jsonb_set(attributes, '{warranty_months}', '36')
WHERE name = 'ProBook Laptop 15"';

-- 2. eco_friendly alani ekle
UPDATE products
SET attributes = attributes || '{"eco_friendly": true}'::jsonb
WHERE name = 'ProBook Laptop 15"';

-- jsonb_set ile alternatif
UPDATE products
SET attributes = jsonb_set(attributes, '{eco_friendly}', 'true')
WHERE name = 'ProBook Laptop 15"';

-- 3. Siparis metadata'sina priority ekle
UPDATE orders
SET metadata = metadata || '{"priority": "high"}'::jsonb
WHERE id = 1;

-- MySQL
-- 1. warranty_months'i guncelle
UPDATE products
SET attributes = JSON_SET(attributes, '$.warranty_months', 36)
WHERE name = 'ProBook Laptop 15"';

-- 2. eco_friendly alani ekle
UPDATE products
SET attributes = JSON_SET(attributes, '$.eco_friendly', true)
WHERE name = 'ProBook Laptop 15"';

-- 3. Siparis metadata'sina priority ekle
UPDATE orders
SET metadata = JSON_SET(metadata, '$.priority', 'high')
WHERE id = 1;

-- SQL Server
-- 1. warranty_months'i guncelle
UPDATE products
SET attributes = JSON_MODIFY(attributes, '$.warranty_months', 36)
WHERE name = 'ProBook Laptop 15"';

-- 2. eco_friendly alani ekle
UPDATE products
SET attributes = JSON_MODIFY(attributes, '$.eco_friendly', CAST('true' AS BIT))
WHERE name = 'ProBook Laptop 15"';

-- 3. Siparis metadata'sina priority ekle
UPDATE orders
SET metadata = JSON_MODIFY(metadata, '$.priority', 'high')
WHERE id = 1;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 3.2: JSON Alanlarini Kaldirma</h4>
                    <p>JSONB'den anahtarlari kaldirmak icin <code>-</code> operatorunu kullanin (ic ice yollar icin <code>#-</code>):</p>
                    <ol>
                        <li><strong>Urun alanini kaldir:</strong> 'SmartPhone Lite' attributes'undan "battery" alanini kaldirin.</li>
                        <li><strong>Metadata alanini kaldir:</strong> Siparis id=1'in metadata'sindan "campaign" alanini kaldirin.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_2')">Cozumu Goster</button>
                    <div id="solution3_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Urunden battery alanini kaldir
UPDATE products
SET attributes = attributes - 'battery'
WHERE name = 'SmartPhone Lite';

-- 2. Siparis metadata'sindan campaign'i kaldir
UPDATE orders
SET metadata = metadata - 'campaign'
WHERE id = 1;

-- Ic ice yollar icin #- kullanan alternatif
UPDATE orders
SET metadata = metadata #- '{campaign}'
WHERE id = 1;

-- MySQL
-- 1. battery alanini kaldir
UPDATE products
SET attributes = JSON_REMOVE(attributes, '$.battery')
WHERE name = 'SmartPhone Lite';

-- 2. Siparis metadata'sindan campaign'i kaldir
UPDATE orders
SET metadata = JSON_REMOVE(metadata, '$.campaign')
WHERE id = 1;

-- SQL Server
-- 1. battery alanini kaldir (null'a ayarla)
UPDATE products
SET attributes = JSON_MODIFY(attributes, '$.battery', NULL)
WHERE name = 'SmartPhone Lite';

-- 2. Siparis metadata'sindan campaign'i kaldir
UPDATE orders
SET metadata = JSON_MODIFY(metadata, '$.campaign', NULL)
WHERE id = 1;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 3.3: Dizi Degisiklikleri</h4>
                    <p>JSON dizilerini degistirmek ozel teknikler gerektirir. <code>jsonb_set()</code>'i dizi birlestirme ile birlikte kullanin:</p>
                    <ol>
                        <li><strong>Diziye eleman ekle:</strong> 'SmartPhone Pro Max' colors dizisinin sonuna "Gold" ekleyin (su anda ["Black", "Silver", "Blue"] iceriyor).</li>
                        <li><strong>Diziyi degistir:</strong> Bir urun icin tum colors dizisini ["Red", "Green", "Blue"] ile degistirin.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_3')">Cozumu Goster</button>
                    <div id="solution3_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Diziye yeni renk ekle
UPDATE products
SET attributes = jsonb_set(
    attributes,
    '{colors}',
    (attributes->'colors') || '"Gold"'::jsonb
)
WHERE name = 'SmartPhone Pro Max';

-- Alternatif: dizileri birlestir
UPDATE products
SET attributes = jsonb_set(
    attributes,
    '{colors}',
    attributes->'colors' || '["Gold"]'::jsonb
)
WHERE name = 'SmartPhone Pro Max';

-- 2. Tum colors dizisini degistir
UPDATE products
SET attributes = jsonb_set(
    attributes,
    '{colors}',
    '["Red", "Green", "Blue"]'::jsonb
)
WHERE name = 'SmartPhone Pro Max';

-- MySQL
-- 1. Yeni renk ekle (MySQL 8.0+)
UPDATE products
SET attributes = JSON_ARRAY_APPEND(attributes, '$.colors', 'Gold')
WHERE name = 'SmartPhone Pro Max';

-- 2. Tum colors dizisini degistir
UPDATE products
SET attributes = JSON_SET(
    attributes,
    '$.colors',
    JSON_ARRAY('Red', 'Green', 'Blue')
)
WHERE name = 'SmartPhone Pro Max';

-- SQL Server (diziyi yeniden olusturmayi gerektirir)
-- 1. Diziye yeni renk ekle
UPDATE products
SET attributes = JSON_MODIFY(
    attributes,
    '$.colors',
    JSON_QUERY(
        CONCAT(
            LEFT(JSON_QUERY(attributes, '$.colors'),
                 LEN(JSON_QUERY(attributes, '$.colors')) - 1),
            ',"Gold"]'
        )
    )
)
WHERE name = 'SmartPhone Pro Max';</code></pre>
                    </div>
                </div>
            </section>

            <!-- Alistirma 4: JSON'dan Iliskisel Formata Donusum -->
            <section>
                <h2 id="exercise-4">Alistirma 4: JSON'u Iliskisel Formata Donusturme</h2>
                <p>JSON dizilerini ve nesnelerini satirlara ve sutunlara genisletmeyi ogrenin. Bu, JSON verisini iliskisel tablolarla birlestirmek veya raporlama icin kullanislidir.</p>

                <div class="concept-box">
                    <code>jsonb_array_elements()</code> bir JSON dizisini satirlara genisletir (eleman basina bir satir).
                    <code>jsonb_each()</code> bir JSON nesnesini anahtar-deger ciftlerine genisletir.
                    MySQL <code>JSON_TABLE</code>, SQL Server <code>OPENJSON</code> kullanir.
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 4.1: JSON Dizilerini Genisletme</h4>
                    <p>Akilli telefonlarin colors dizisi var. Bunu her renk kendi satiri olacak sekilde genisletin:</p>
                    <p><strong>Hedef:</strong> Bir urunun colors'i ["Black", "Silver", "Blue"] ise, urun adiyla birlikte 3 satir uretin - her renk icin bir tane.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_1')">Cozumu Goster</button>
                    <div id="solution4_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    name,
    jsonb_array_elements_text(attributes->'colors') AS color
FROM products
WHERE attributes ? 'colors';

-- Indeks konumu ile
SELECT
    name,
    ordinality AS color_position,
    color
FROM products,
     jsonb_array_elements_text(attributes->'colors')
     WITH ORDINALITY AS t(color, ordinality)
WHERE attributes ? 'colors';

-- MySQL
SELECT
    name,
    jt.color
FROM products,
     JSON_TABLE(attributes, '$.colors[*]' COLUMNS(
         color VARCHAR(50) PATH '$'
     )) AS jt
WHERE JSON_CONTAINS_PATH(attributes, 'one', '$.colors');

-- SQL Server
SELECT
    name,
    color.value AS color
FROM products
CROSS APPLY OPENJSON(attributes, '$.colors') AS color
WHERE JSON_QUERY(attributes, '$.colors') IS NOT NULL;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 4.2: JSON Nesnesini Anahtar-Deger Ciftlerine Donusturme</h4>
                    <p>Tum attributes nesnesini her satirin bir anahtar-deger cifti gosterdigi satirlara genisletin:</p>
                    <p><strong>Hedef:</strong> {"brand": "TechPro", "ram": "16GB"} olan bir urun icin 2 satir uretin: (product_name, "brand", "TechPro") ve (product_name, "ram", "16GB").</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_2')">Cozumu Goster</button>
                    <div id="solution4_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    name AS product_name,
    attr.key AS attribute_name,
    attr.value AS attribute_value
FROM products,
     jsonb_each(attributes) AS attr(key, value)
WHERE attributes IS NOT NULL
LIMIT 20;

-- Sadece skaler degerleri filtrele (dizileri haric tut)
SELECT
    name AS product_name,
    attr.key AS attribute_name,
    attr.value AS attribute_value
FROM products,
     jsonb_each(attributes) AS attr(key, value)
WHERE attributes IS NOT NULL
  AND jsonb_typeof(attr.value) != 'array';

-- MySQL (belirli anahtarlar kullanarak)
SELECT
    name AS product_name,
    'brand' AS attribute_name,
    attributes->>'$.brand' AS attribute_value
FROM products
WHERE attributes IS NOT NULL
UNION ALL
SELECT
    name,
    'processor',
    attributes->>'$.processor'
FROM products
WHERE JSON_CONTAINS_PATH(attributes, 'one', '$.processor')
UNION ALL
SELECT
    name,
    'ram',
    attributes->>'$.ram'
FROM products
WHERE JSON_CONTAINS_PATH(attributes, 'one', '$.ram');

-- SQL Server
SELECT
    name AS product_name,
    attr.[key] AS attribute_name,
    attr.[value] AS attribute_value
FROM products
CROSS APPLY OPENJSON(attributes) AS attr
WHERE attributes IS NOT NULL;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 4.3: Siparis Metadata'sini Genisletme</h4>
                    <p>Analiz icin siparis metadata'sini anahtar-deger ciftlerine genisletin:</p>
                    <p><strong>Hedef:</strong> {"source": "website", "campaign": "new_year"} olan bir siparis icin, order_number ile birlikte her metadata anahtarini ve degerini gosteren satirlar uretin.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_3')">Cozumu Goster</button>
                    <div id="solution4_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    order_number,
    meta.key AS metadata_key,
    meta.value AS metadata_value
FROM orders,
     jsonb_each(metadata) AS meta(key, value)
WHERE metadata IS NOT NULL;

-- JSON yerine metin degerleri al
SELECT
    order_number,
    meta.key AS metadata_key,
    meta.value::TEXT AS metadata_value
FROM orders,
     jsonb_each_text(metadata) AS meta(key, value)
WHERE metadata IS NOT NULL;

-- SQL Server
SELECT
    order_number,
    meta.[key] AS metadata_key,
    meta.[value] AS metadata_value
FROM orders
CROSS APPLY OPENJSON(metadata) AS meta
WHERE metadata IS NOT NULL;</code></pre>
                    </div>
                </div>
            </section>

            <!-- Alistirma 5: Iliskisel Veriden JSON Olusturma -->
            <section>
                <h2 id="exercise-5">Alistirma 5: Iliskisel Veriden JSON Olusturma</h2>
                <p>Iliskisel sorgu sonuclarindan JSON nesneleri ve dizileri olusturmayi ogrenin. API'ler ve veri aktarimi icin kullanislidir.</p>

                <div class="exercise-box">
                    <h4>Alistirma 5.1: JSON Nesneleri Olusturma</h4>
                    <p>Sorgu sonuclarindan ozel JSON yapilari olusturmak icin <code>jsonb_build_object()</code> kullanin:</p>
                    <p><strong>Hedef:</strong> Her urun icin su bilgileri iceren bir JSON nesnesi olusturun: product_name, sku, brand (attributes'tan) ve price.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution5_1')">Cozumu Goster</button>
                    <div id="solution5_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    jsonb_build_object(
        'product_name', name,
        'sku', sku,
        'brand', attributes->>'brand',
        'price', price,
        'has_5g', COALESCE((attributes->>'5g')::BOOLEAN, false)
    ) AS product_json
FROM products
WHERE attributes IS NOT NULL;

-- Guzel formatlama ile
SELECT
    jsonb_pretty(
        jsonb_build_object(
            'product_name', name,
            'brand', attributes->>'brand',
            'price', price
        )
    ) AS product_json
FROM products
WHERE attributes IS NOT NULL;

-- MySQL
SELECT
    JSON_OBJECT(
        'product_name', name,
        'sku', sku,
        'brand', attributes->>'$.brand',
        'price', price
    ) AS product_json
FROM products
WHERE attributes IS NOT NULL;

-- SQL Server
SELECT
    name AS product_name,
    sku,
    JSON_VALUE(attributes, '$.brand') AS brand,
    price
FROM products
WHERE attributes IS NOT NULL
FOR JSON PATH;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 5.2: JSON Dizilerine Toplama</h4>
                    <p>Birden fazla satiri JSON dizisine toplamak icin <code>jsonb_agg()</code> ve anahtar-deger toplamalari olusturmak icin <code>jsonb_object_agg()</code> kullanin:</p>
                    <ol>
                        <li><strong>Basit dizi:</strong> Tum urun adlarini iceren tek bir JSON dizisi olusturun.</li>
                        <li><strong>Gruplu toplama:</strong> Urunleri markaya gore gruplayin ve her marka icin urun nesnelerinin JSON dizisini olusturun.</li>
                        <li><strong>Anahtar-deger toplama:</strong> Siparis kaynaklarini anahtar, sayilarini deger olarak gosteren bir JSON nesnesi olusturun.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution5_2')">Cozumu Goster</button>
                    <div id="solution5_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Tum urun adlari JSON dizisi olarak
SELECT jsonb_agg(name) AS all_products
FROM products
WHERE attributes IS NOT NULL;

-- 2. Markaya gore gruplu urunler
SELECT
    attributes->>'brand' AS brand,
    jsonb_agg(
        jsonb_build_object(
            'name', name,
            'price', price,
            'sku', sku
        )
    ) AS products_by_brand
FROM products
WHERE attributes IS NOT NULL
  AND attributes->>'brand' IS NOT NULL
GROUP BY attributes->>'brand';

-- 3. Siparis kaynaklari ve sayilari JSON olarak
SELECT
    jsonb_object_agg(
        source,
        order_count
    ) AS source_summary
FROM (
    SELECT
        metadata->>'source' AS source,
        COUNT(*) AS order_count
    FROM orders
    WHERE metadata IS NOT NULL
      AND metadata->>'source' IS NOT NULL
    GROUP BY metadata->>'source'
) AS source_counts;

-- MySQL
-- 1. Tum urun adlari JSON dizisi olarak
SELECT JSON_ARRAYAGG(name) AS all_products
FROM products
WHERE attributes IS NOT NULL;

-- 2. Markaya gore gruplu urunler
SELECT
    attributes->>'$.brand' AS brand,
    JSON_ARRAYAGG(
        JSON_OBJECT(
            'name', name,
            'price', price,
            'sku', sku
        )
    ) AS products_by_brand
FROM products
WHERE attributes IS NOT NULL
GROUP BY attributes->>'$.brand';

-- SQL Server
-- 1. Tum urun adlari JSON dizisi olarak
SELECT name
FROM products
WHERE attributes IS NOT NULL
FOR JSON PATH;</code></pre>
                    </div>
                </div>
            </section>

            <!-- Zorluk Alistirmalari -->
            <section>
                <h2 id="challenge-exercises">Zorluk Alistirmalari</h2>
                <p>Bu gercek dunya analitik senaryolarinda ogrendiklerinizin tumunu uygulayin. Bu zorluklar birden fazla JSON islemini birlestirir.</p>

                <div class="challenge-box">
                    <h4>Zorluk 1: Siparis Kaynagi Analizi</h4>
                    <p><code>metadata</code> JSONB sutununu kullanarak siparis verilerini analiz edin. Metadata kaynak kanal bilgisi (website, mobile_app, sales_rep), kampanya adlari ve B2B bayraklari icerir:</p>
                    <ol>
                        <li><strong>Kanal dagilimi:</strong> Her kaynak kanaldan kac siparis geldigini sayin.</li>
                        <li><strong>B2B siparisleri:</strong> Tum isletmeler arasi siparisleri (b2b = true) bulun ve toplam tutarlarini gosterin.</li>
                        <li><strong>Pazarlama kampanyalari:</strong> Campaign alani olan tum siparisleri listeleyin ve kampanya adini gosterin.</li>
                        <li><strong>Kanala gore gelir:</strong> Her kaynak icin toplam gelir, siparis sayisi ve ortalama siparis degerini hesaplayin.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge1')">Cozumu Goster</button>
                    <div id="challenge1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Siparisleri kaynaga gore say
SELECT
    metadata->>'source' AS source,
    COUNT(*) AS order_count
FROM orders
WHERE metadata IS NOT NULL
GROUP BY metadata->>'source'
ORDER BY order_count DESC;

-- 2. Toplamlarla B2B siparisleri
SELECT
    order_number,
    customer_id,
    total_amount,
    metadata
FROM orders
WHERE metadata @> '{"b2b": true}'::jsonb;

-- 3. Kampanyali siparisler
SELECT
    order_number,
    metadata->>'campaign' AS campaign_name,
    order_date,
    total_amount
FROM orders
WHERE metadata ? 'campaign';

-- 4. Kaynaga gore toplam gelir
SELECT
    metadata->>'source' AS source,
    SUM(total_amount) AS total_revenue,
    COUNT(*) AS order_count,
    ROUND(AVG(total_amount), 2) AS avg_order_value
FROM orders
WHERE metadata IS NOT NULL
GROUP BY metadata->>'source'
ORDER BY total_revenue DESC;</code></pre>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Zorluk 2: Urun Analitikleri</h4>
                    <p><code>attributes</code> JSONB sutununu kullanarak urun katalogunuzu analiz edin. Urunler marka, 5g destegi, warranty_months, colors gibi degisken ozelliklere sahiptir:</p>
                    <ol>
                        <li><strong>Marka envanteri:</strong> Her markanin katalogda kac urunu oldugunu sayin.</li>
                        <li><strong>5G urunleri:</strong> Tum 5G destekli urunleri adlari, fiyatlari ve depolama ozellikleriyle listeleyin.</li>
                        <li><strong>Marka listesi:</strong> Urun katalogunuzdaki tum benzersiz markalarin listesini alin.</li>
                        <li><strong>Uzatilmis garanti:</strong> Garantisi 12 aydan uzun olan urunleri bulun ve garanti suresini gosterin.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge2')">Cozumu Goster</button>
                    <div id="challenge2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Urunleri markaya gore say
SELECT
    attributes->>'brand' AS brand,
    COUNT(*) AS product_count
FROM products
WHERE attributes IS NOT NULL
  AND attributes->>'brand' IS NOT NULL
GROUP BY attributes->>'brand'
ORDER BY product_count DESC;

-- 2. 5G'li urunler ve fiyatlari
SELECT
    name,
    price,
    attributes->>'brand' AS brand,
    attributes->>'storage' AS storage
FROM products
WHERE attributes @> '{"5g": true}'::jsonb
ORDER BY price DESC;

-- 3. Tum benzersiz markalar
SELECT DISTINCT attributes->>'brand' AS brand
FROM products
WHERE attributes IS NOT NULL
  AND attributes->>'brand' IS NOT NULL
ORDER BY brand;

-- 4. Garantisi 12 aydan uzun olan urunler
SELECT
    name,
    attributes->>'brand' AS brand,
    (attributes->>'warranty_months')::INTEGER AS warranty_months,
    price
FROM products
WHERE attributes ? 'warranty_months'
  AND (attributes->>'warranty_months')::INTEGER > 12
ORDER BY warranty_months DESC;</code></pre>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Zorluk 3: Birlesik Analitik Raporu</h4>
                    <p>Toplama ile JSON islemlerini birlestiren kapsamli analitik raporlar olusturun:</p>
                    <ol>
                        <li><strong>Marka analitigi:</strong> Her markayi urun sayisi, ortalama fiyat, minimum fiyat ve maksimum fiyat ile gosterin.</li>
                        <li><strong>Kanal analitigi:</strong> Her siparis kaynagini siparis sayisi, toplam gelir ve ortalama siparis degeri ile gosterin.</li>
                        <li><strong>Ozet JSON:</strong> Temel is metriklerini (toplam urun, 5G urun sayisi, marka listesi, toplam siparis, toplam gelir, kaynak listesi) iceren tek bir JSON nesnesi olusturun.</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge3')">Cozumu Goster</button>
                    <div id="challenge3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Marka analitigi
SELECT
    attributes->>'brand' AS brand,
    COUNT(*) AS product_count,
    ROUND(AVG(price), 2) AS avg_price,
    MIN(price) AS min_price,
    MAX(price) AS max_price
FROM products
WHERE attributes IS NOT NULL
  AND attributes->>'brand' IS NOT NULL
GROUP BY attributes->>'brand'
ORDER BY product_count DESC;

-- 2. Siparis kaynagi analitigi
SELECT
    metadata->>'source' AS source,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_revenue,
    ROUND(AVG(total_amount), 2) AS avg_order_value
FROM orders
WHERE metadata IS NOT NULL
GROUP BY metadata->>'source'
ORDER BY total_revenue DESC;

-- 3. Ozet JSON nesnesi
SELECT jsonb_build_object(
    'product_stats', (
        SELECT jsonb_build_object(
            'total_products', COUNT(*),
            'products_with_5g', SUM(CASE WHEN attributes @> '{"5g": true}'::jsonb THEN 1 ELSE 0 END),
            'brands', (SELECT jsonb_agg(DISTINCT attributes->>'brand')
                      FROM products WHERE attributes->>'brand' IS NOT NULL)
        )
        FROM products
        WHERE attributes IS NOT NULL
    ),
    'order_stats', (
        SELECT jsonb_build_object(
            'total_orders', COUNT(*),
            'total_revenue', SUM(total_amount),
            'sources', (SELECT jsonb_agg(DISTINCT metadata->>'source')
                       FROM orders WHERE metadata IS NOT NULL)
        )
        FROM orders
    )
) AS analytics_summary;</code></pre>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Zorluk 4: Indeksleme Stratejisi Olusturma</h4>
                    <p>JSON sorgularini optimize etmek icin indeksler tasarlayin. Ifade indeksleri (cikarilan degerler uzerinde B-tree) ve GIN indeksleri (tam JSON indeksleme) arasinda secim yapin:</p>
                    <ol>
                        <li><strong>Marka sorgulari:</strong> Markaya gore filtreleme sorgularini hizlandirmak icin bir indeks olusturun (ornegin, WHERE attributes->>'brand' = 'TechPro').</li>
                        <li><strong>5G icerik:</strong> Icerik sorgularini desteklemek icin bir GIN indeksi olusturun (ornegin, WHERE attributes @> '{"5g": true}').</li>
                        <li><strong>Siparis kaynagi:</strong> Siparisleri kaynak kanala gore filtrelemeyi optimize etmek icin bir indeks olusturun.</li>
                    </ol>

                    <div class="hint-box">
                        Ifade indeksleri, B-tree islemleri (=, <, >) ile belirli yollar icin iyi calisir. GIN indeksleri icerik (@>), varlik (?) destekler ve esnektir ancak daha buyuktur.
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('challenge4')">Cozumu Goster</button>
                    <div id="challenge4" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL

-- 1. Marka sorgulari icin indeks (cikarilan deger uzerinde B-tree)
CREATE INDEX idx_products_brand ON products ((attributes->>'brand'));

-- 2. 5G icerik sorgulari icin GIN indeksi
CREATE INDEX idx_products_5g ON products USING GIN (attributes);
-- Bu sorguyu destekler: WHERE attributes @> '{"5g": true}'

-- Alternatif: belirli boolean kontrolu icin ifade indeksi
CREATE INDEX idx_products_5g_true ON products ((attributes->>'5g'))
WHERE attributes->>'5g' = 'true';

-- 3. Siparis kaynagi icin indeks
CREATE INDEX idx_orders_source ON orders ((metadata->>'source'));

-- Urunlerde esnek sorgulama icin tam JSONB GIN indeksi
CREATE INDEX idx_products_attrs_gin ON products USING GIN (attributes);
-- Bu ?, ?|, ?&, @>, <@ operatorlerini destekler

-- Siparisler metadata icin tam JSONB GIN indeksi
CREATE INDEX idx_orders_meta_gin ON orders USING GIN (metadata);

-- Sadece icerik sorgulari icin jsonb_path_ops ile GIN (daha kucuk indeks)
CREATE INDEX idx_products_attrs_path ON products USING GIN (attributes jsonb_path_ops);

-- MySQL

-- 1. Marka icin indeksli olusturulmus sutun
ALTER TABLE products
ADD COLUMN brand_idx VARCHAR(100)
GENERATED ALWAYS AS (attributes->>'$.brand') STORED;
CREATE INDEX idx_products_brand ON products(brand_idx);

-- 2. 5g bayragi icin olusturulmus sutun
ALTER TABLE products
ADD COLUMN has_5g_idx BOOLEAN
GENERATED ALWAYS AS (CAST(attributes->>'$.5g' AS UNSIGNED) = 1) STORED;
CREATE INDEX idx_products_5g ON products(has_5g_idx);

-- 3. Kaynak icin olusturulmus sutun
ALTER TABLE orders
ADD COLUMN source_idx VARCHAR(50)
GENERATED ALWAYS AS (metadata->>'$.source') STORED;
CREATE INDEX idx_orders_source ON orders(source_idx);

-- SQL Server

-- 1. Marka icin indeksli hesaplanmis sutun
ALTER TABLE products
ADD brand_computed AS JSON_VALUE(attributes, '$.brand');
CREATE INDEX idx_products_brand ON products(brand_computed);

-- 3. Kaynak icin hesaplanmis sutun
ALTER TABLE orders
ADD source_computed AS JSON_VALUE(metadata, '$.source');
CREATE INDEX idx_orders_source ON orders(source_computed);</code></pre>
                    </div>
                </div>
            </section>

            <!-- Onemli Noktalar -->
            <section>
                <h2 id="key-takeaways">Onemli Noktalar</h2>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Kavram</th>
                            <th>En Iyi Uygulama</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>JSON Tur Secimi</td>
                            <td>Daha iyi performans ve indeksleme icin <code>JSONB</code> (PostgreSQL) veya yerel <code>JSON</code> (MySQL) kullanin</td>
                        </tr>
                        <tr>
                            <td>Deger Cikarma</td>
                            <td>Karsilastirma veya gosterim icin <code>->></code> metin ciktisi kullanin, ic ice gezinme icin <code>-></code> kullanin</td>
                        </tr>
                        <tr>
                            <td>Tur Donusumu</td>
                            <td>Karsilastirmalar icin cikarilan degerleri her zaman uygun turlere donusturun: <code>(data->>'age')::INTEGER</code></td>
                        </tr>
                        <tr>
                            <td>Icerik Sorgulari</td>
                            <td>Verimli icerik kontrolleri icin, ozellikle GIN indeksleri ile <code>@></code> kullanin</td>
                        </tr>
                        <tr>
                            <td>Dizi Genisletme</td>
                            <td>Dizileri satirlara donusturmek icin <code>jsonb_array_elements</code>, <code>JSON_TABLE</code> veya <code>OPENJSON</code> kullanin</td>
                        </tr>
                        <tr>
                            <td>Indeksleme Stratejisi</td>
                            <td>Sik sorgulanan yollarda ifade indeksleri olusturun; esnek icerik sorgulari icin GIN indeksleri kullanin</td>
                        </tr>
                        <tr>
                            <td>Sema Tasarimi</td>
                            <td>JSON'u asiri kullanmayin; uygun oldugunda sik sorgulanan alanlari normal sutunlara cikarin</td>
                        </tr>
                        <tr>
                            <td>Veritabanlari Arasi Tasinabilirlik</td>
                            <td>Sozdizimi farkliliklarina dikkat edin; mumkun oldugunda standart <code>JSON_VALUE</code>/<code>JSON_QUERY</code> tercih edin</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Gezinme -->
            <section>
                <p><a href="03_working_with_json.html">&larr; JSON Verileriyle Calisma Dersine Don</a></p>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="../static/script.js"></script>

    <script>
        function toggleSolution(id) {
            var element = document.getElementById(id);
            if (element.classList.contains('show')) {
                element.classList.remove('show');
                event.target.textContent = 'Cozumu Goster';
            } else {
                element.classList.add('show');
                event.target.textContent = 'Cozumu Gizle';
            }
        }
    </script>
</body>

</html>
