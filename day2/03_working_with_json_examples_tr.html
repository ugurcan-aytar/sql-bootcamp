<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="tr" xml:lang="tr">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style_bootstrap.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/code.css">
    <link href="https://cdn.prod.website-files.com/5efdb54f07a6812bcd95cc65/6773d0fc3013e060f08d7145_favicon.jpg"
        rel="shortcut icon" type="image/x-icon">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>Gun 2: JSON Verileriyle Calisma - Pratik Ornekler</title>
    <style>
        code {
            white-space: pre-wrap;
        }

        span.smallcaps {
            font-variant: small-caps;
        }

        span.underline {
            text-decoration: underline;
        }

        div.column {
            display: inline-block;
            vertical-align: top;
            width: 50%;
        }

        div.hanging-indent {
            margin-left: 1.5em;
            text-indent: -1.5em;
        }

        ul.task-list {
            list-style: none;
        }

        .exercise-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .exercise-box h4 {
            color: #495057;
            margin-bottom: 15px;
        }

        .solution-box {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .solution-box.show {
            display: block;
        }

        .toggle-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .toggle-btn:hover {
            background-color: #0056b3;
        }

        .hint-box {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .hint-box::before {
            content: "Ipucu: ";
            font-weight: bold;
        }

        .warning-box {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .warning-box::before {
            content: "Uyari: ";
            font-weight: bold;
        }

        .concept-box {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .concept-box::before {
            content: "Kavram: ";
            font-weight: bold;
        }

        .syntax-box {
            background-color: #e2d5f1;
            border: 1px solid #c5b3d9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .syntax-box::before {
            content: "Sozdizimi Referansi: ";
            font-weight: bold;
        }

        .challenge-box {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .challenge-box h4 {
            color: #155724;
        }

        .challenge-box::before {
            content: "";
        }

        .dataset-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        .dataset-table th,
        .dataset-table td {
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            text-align: left;
        }

        .dataset-table th {
            background-color: #343a40;
            color: white;
        }

        .dataset-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background-color: #007bff;
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .json-display {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre;
        }

        .json-key {
            color: #f92672;
        }

        .json-string {
            color: #a6e22e;
        }

        .json-number {
            color: #ae81ff;
        }

        .json-boolean {
            color: #66d9ef;
        }

        .result-box {
            background-color: #f1f1f1;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
        }

        .db-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin: 2px;
        }

        .db-postgresql {
            background-color: #336791;
            color: white;
        }

        .db-mysql {
            background-color: #4479A1;
            color: white;
        }

        .db-sqlserver {
            background-color: #CC2927;
            color: white;
        }

        .db-oracle {
            background-color: #F80000;
            color: white;
        }

        .operator-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 13px;
        }

        .operator-table th,
        .operator-table td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }

        .operator-table th {
            background-color: #6c5ce7;
            color: white;
        }

        .operator-table code {
            background-color: #f1f1f1;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .language-switcher {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .language-switcher span {
            font-weight: bold;
            color: #495057;
        }

        .language-switcher a {
            padding: 5px 12px;
            border-radius: 4px;
            text-decoration: none;
            color: #007bff;
            border: 1px solid #007bff;
            transition: all 0.3s ease;
        }

        .language-switcher a:hover {
            background-color: #007bff;
            color: white;
        }

        .language-switcher a.active {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>

<body>
    <a href="../index_tr.html" class="back-button">← Anasayfaya Don</a>
    <div class="copy-notification" id="copyNotification">Kopyalandi!</div>

    <div id="europeanunion-turkey">
        <img src="../static/eu.png" alt="">
    </div>
    <div id="sanayiteknolojibakan">
        <img src="../static/sanayitek.png" alt="">
    </div>
    <div id="rekabet">
        <img src="../static/rekabet.png" alt="">
    </div>
    <div id="tisk">
        <img src="../static/tisk.png" alt="">
    </div>
    <div id="undp">
        <img src="../static/undp.png" alt="">
    </div>
    <div class="content-container">
        <div class="container">
            <div class="language-switcher">
                <span>Dil:</span>
                <a href="03_working_with_json_examples.html">English</a>
                <a href="03_working_with_json_examples_tr.html" class="active">Turkce</a>
            </div>

            <section>
                <h1 id="json-practical-examples">JSON Verileriyle Calisma - Pratik Ornekler</h1>
                <p><a href="03_working_with_json.html">&larr; JSON Verileriyle Calisma Dersine Don</a></p>
                <p>Bu sayfa, SQL'de JSON islemlerini ustaca kullanmaniz icin uygulamali alistirmalar sunmaktadir. Deger cikarma,
                    JSON icerisinde arama yapma, belgeleri degistirme ve JSON ile iliskisel formatlar arasinda donusum yapma konularinda pratik yapin.</p>

                <div class="syntax-box">
                    <strong>PostgreSQL operatorleri:</strong> <code>-></code> (JSON olarak al), <code>->></code> (metin olarak al), <code>?</code> (anahtar var mi), <code>@></code> (icerir)<br>
                    <strong>MySQL:</strong> <code>-></code> veya <code>JSON_EXTRACT()</code>, <code>->></code> (tirnak isaretsiz), <code>JSON_CONTAINS()</code><br>
                    <strong>SQL Server:</strong> <code>JSON_VALUE()</code>, <code>JSON_QUERY()</code>, <code>OPENJSON()</code>
                </div>
            </section>

            <!-- Ornek Veri Setleri Bolumu -->
            <section>
                <h2 id="sample-datasets">Ornek Veri Setleri</h2>
                <p>Asagidaki tablolar JSON veri yapilarini gostermektedir. Alistirmalar icin referans olarak kullanin.</p>

                <h4>users Tablosu</h4>
                <p>JSON tercihleri ve adres verileri iceren kullanici profilleri:</p>
                <table class="dataset-table">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>username</th>
                            <th>data (JSONB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>john_doe</td>
                            <td>
                                <div class="json-display">{
  "email": "john@example.com",
  "age": 32,
  "address": {
    "city": "New York",
    "country": "USA",
    "zip": "10001"
  },
  "tags": ["admin", "developer"],
  "preferences": {
    "theme": "dark",
    "notifications": true
  }
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>jane_smith</td>
                            <td>
                                <div class="json-display">{
  "email": "jane@example.com",
  "age": 28,
  "address": {
    "city": "London",
    "country": "UK",
    "zip": "SW1A 1AA"
  },
  "tags": ["editor", "reviewer"],
  "preferences": {
    "theme": "light",
    "notifications": false
  }
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>bob_wilson</td>
                            <td>
                                <div class="json-display">{
  "email": "bob@example.com",
  "age": 45,
  "address": {
    "city": "Istanbul",
    "country": "Turkey",
    "zip": "34000"
  },
  "tags": ["admin", "manager"],
  "preferences": {
    "theme": "dark",
    "notifications": true,
    "language": "tr"
  }
}</div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h4>products Tablosu</h4>
                <p>JSON ozellikleri iceren urunler:</p>
                <table class="dataset-table">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>name</th>
                            <th>specs (JSONB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Laptop Pro</td>
                            <td>
                                <div class="json-display">{
  "brand": "TechCorp",
  "price": 1299.99,
  "in_stock": true,
  "features": ["16GB RAM", "512GB SSD", "15.6 inch"],
  "dimensions": {"width": 35.5, "height": 1.8, "depth": 24.0},
  "ratings": [4.5, 4.8, 4.2, 5.0]
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Wireless Mouse</td>
                            <td>
                                <div class="json-display">{
  "brand": "PeripheralCo",
  "price": 49.99,
  "in_stock": true,
  "features": ["Bluetooth", "Ergonomic", "Rechargeable"],
  "colors": ["black", "white", "gray"],
  "ratings": [4.0, 4.3, 3.9]
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Monitor 4K</td>
                            <td>
                                <div class="json-display">{
  "brand": "DisplayTech",
  "price": 599.00,
  "in_stock": false,
  "features": ["4K UHD", "HDR", "USB-C"],
  "dimensions": {"width": 61.0, "height": 36.5, "depth": 5.2},
  "ratings": [4.7, 4.9, 4.6, 4.8, 5.0]
}</div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h4>logs Tablosu</h4>
                <p>JSON olay verileri iceren uygulama loglari:</p>
                <table class="dataset-table">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>timestamp</th>
                            <th>event_data (JSONB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>2024-03-15 09:30:00</td>
                            <td>
                                <div class="json-display">{
  "event": "login",
  "user": {"id": 1, "name": "john_doe"},
  "metadata": {"ip": "192.168.1.100", "browser": "Chrome"}
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>2024-03-15 10:15:00</td>
                            <td>
                                <div class="json-display">{
  "event": "purchase",
  "user": {"id": 1, "name": "john_doe"},
  "items": [{"product_id": 1, "qty": 1}, {"product_id": 2, "qty": 2}],
  "total": 1399.97
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>2024-03-15 11:00:00</td>
                            <td>
                                <div class="json-display">{
  "event": "error",
  "error_code": 500,
  "message": "Database connection failed",
  "metadata": {"service": "api", "endpoint": "/users"}
}</div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h4>orders Tablosu</h4>
                <p>Ic ice JSON ogeleri iceren siparisler:</p>
                <table class="dataset-table">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>customer_id</th>
                            <th>order_data (JSONB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>1</td>
                            <td>
                                <div class="json-display">{
  "status": "completed",
  "items": [
    {"name": "Laptop Pro", "price": 1299.99, "qty": 1},
    {"name": "Wireless Mouse", "price": 49.99, "qty": 2}
  ],
  "shipping": {"method": "express", "cost": 25.00},
  "payment": {"method": "credit_card", "last_four": "4242"}
}</div>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>2</td>
                            <td>
                                <div class="json-display">{
  "status": "pending",
  "items": [
    {"name": "Monitor 4K", "price": 599.00, "qty": 1}
  ],
  "shipping": {"method": "standard", "cost": 10.00},
  "payment": {"method": "paypal", "email": "jane@example.com"}
}</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- JSON Operatorleri Hizli Referans -->
            <section>
                <h2 id="operator-reference">JSON Operatorleri Hizli Referans</h2>
                <table class="operator-table">
                    <thead>
                        <tr>
                            <th>Islem</th>
                            <th><span class="db-badge db-postgresql">PostgreSQL</span></th>
                            <th><span class="db-badge db-mysql">MySQL</span></th>
                            <th><span class="db-badge db-sqlserver">SQL Server</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Alani JSON olarak al</td>
                            <td><code>data->'field'</code></td>
                            <td><code>data->'$.field'</code></td>
                            <td><code>JSON_QUERY(data, '$.field')</code></td>
                        </tr>
                        <tr>
                            <td>Alani metin olarak al</td>
                            <td><code>data->>'field'</code></td>
                            <td><code>data->>'$.field'</code></td>
                            <td><code>JSON_VALUE(data, '$.field')</code></td>
                        </tr>
                        <tr>
                            <td>Ic ice yolu al</td>
                            <td><code>data#>>'{a,b,c}'</code></td>
                            <td><code>data->>'$.a.b.c'</code></td>
                            <td><code>JSON_VALUE(data, '$.a.b.c')</code></td>
                        </tr>
                        <tr>
                            <td>Dizi elemanini al</td>
                            <td><code>data->'arr'->0</code></td>
                            <td><code>data->'$.arr[0]'</code></td>
                            <td><code>JSON_VALUE(data, '$.arr[0]')</code></td>
                        </tr>
                        <tr>
                            <td>Anahtar var mi</td>
                            <td><code>data ? 'key'</code></td>
                            <td><code>JSON_CONTAINS_PATH(data, 'one', '$.key')</code></td>
                            <td><code>JSON_VALUE(data, '$.key') IS NOT NULL</code></td>
                        </tr>
                        <tr>
                            <td>Deger icerir</td>
                            <td><code>data @> '{"k":"v"}'</code></td>
                            <td><code>JSON_CONTAINS(data, '"v"', '$.k')</code></td>
                            <td>Cikar ve karsilastir</td>
                        </tr>
                        <tr>
                            <td>Deger ata/guncelle</td>
                            <td><code>jsonb_set(data, '{k}', '"v"')</code></td>
                            <td><code>JSON_SET(data, '$.k', 'v')</code></td>
                            <td><code>JSON_MODIFY(data, '$.k', 'v')</code></td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Alistirma 1: Temel JSON Cikarma -->
            <section>
                <h2 id="exercise-1">Alistirma 1: Temel JSON Yol Gezintisi</h2>
                <p>Yol gezintisi operatorlerini kullanarak JSON sutunlarindan deger cikarmayi ogrenin.</p>

                <div class="concept-box">
                    JSON/JSONB ciktisi almak icin <code>-></code>, metin ciktisi almak icin <code>->></code> kullanin.
                    Fark, degerleri karsilastirirken veya WHERE ifadelerinde kullanirken onemlidir.
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 1.1: Basit Alanlari Cikarma</h4>
                    <p><code>users</code> tablosunu kullanarak asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>Tum kullanicilarin e-postasini alin</li>
                        <li>Tum kullanicilarin kullanici adi ve yasini alin</li>
                        <li>30 yasindan buyuk kullanicilari alin</li>
                    </ol>

                    <div class="hint-box">
                        Karsilastirma yaparken yasi tamsayiya donusturmeyi unutmayin: <code>(data->>'age')::INTEGER</code>
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_1')">Cozumu Goster</button>
                    <div id="solution1_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Tum kullanicilarin e-postasini al
SELECT username, data->>'email' AS email
FROM users;

-- 2. Kullanici adi ve yasini al
SELECT username, data->>'age' AS age
FROM users;

-- 3. 30 yasindan buyuk kullanicilar
SELECT username, data->>'age' AS age
FROM users
WHERE (data->>'age')::INTEGER > 30;

-- MySQL
-- 1. E-postayi al
SELECT username, data->>'$.email' AS email
FROM users;

-- 2. Kullanici adi ve yasini al
SELECT username, data->>'$.age' AS age
FROM users;

-- 3. 30 yasindan buyuk kullanicilar
SELECT username, data->>'$.age' AS age
FROM users
WHERE CAST(data->>'$.age' AS UNSIGNED) > 30;

-- SQL Server
-- 1. E-postayi al
SELECT username, JSON_VALUE(data, '$.email') AS email
FROM users;

-- 2. Kullanici adi ve yasini al
SELECT username, JSON_VALUE(data, '$.age') AS age
FROM users;

-- 3. 30 yasindan buyuk kullanicilar
SELECT username, JSON_VALUE(data, '$.age') AS age
FROM users
WHERE CAST(JSON_VALUE(data, '$.age') AS INT) > 30;</code></pre>
                        <p><strong>Sorgu 3 icin Beklenen Sonuc:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>username</th>
                                <th>age</th>
                            </tr>
                            <tr>
                                <td>john_doe</td>
                                <td>32</td>
                            </tr>
                            <tr>
                                <td>bob_wilson</td>
                                <td>45</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 1.2: Ic Ice Alanlari Cikarma</h4>
                    <p><code>users</code> tablosunu kullanarak asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>Her kullanici icin adres nesnesinden sehri alin</li>
                        <li>Her kullanici icin tema tercihini alin</li>
                        <li>ABD'den kullanicilari bulun</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_2')">Cozumu Goster</button>
                    <div id="solution1_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Ic ice adresten sehri al
SELECT username, data->'address'->>'city' AS city
FROM users;

-- Yol notasyonu ile alternatif
SELECT username, data#>>'{address,city}' AS city
FROM users;

-- 2. Tema tercihini al
SELECT username, data->'preferences'->>'theme' AS theme
FROM users;

-- 3. ABD'den kullanicilari bul
SELECT username, data->'address'->>'country' AS country
FROM users
WHERE data->'address'->>'country' = 'USA';

-- MySQL
-- 1. Sehri al
SELECT username, data->>'$.address.city' AS city
FROM users;

-- 2. Tema tercihini al
SELECT username, data->>'$.preferences.theme' AS theme
FROM users;

-- 3. ABD'den kullanicilari bul
SELECT username, data->>'$.address.country' AS country
FROM users
WHERE data->>'$.address.country' = 'USA';

-- SQL Server
-- 1. Sehri al
SELECT username, JSON_VALUE(data, '$.address.city') AS city
FROM users;

-- 2. Tema tercihini al
SELECT username, JSON_VALUE(data, '$.preferences.theme') AS theme
FROM users;

-- 3. ABD'den kullanicilari bul
SELECT username, JSON_VALUE(data, '$.address.country') AS country
FROM users
WHERE JSON_VALUE(data, '$.address.country') = 'USA';</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 1.3: Dizi Elemanlarina Erisim</h4>
                    <p><code>users</code> tablosunu kullanarak asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>Her kullanici icin ilk etiketi alin</li>
                        <li>Tum etiketleri JSON dizisi olarak alin</li>
                        <li>Her kullanicinin kac etiketi oldugunu sayın</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_3')">Cozumu Goster</button>
                    <div id="solution1_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Ilk etiketi al
SELECT username, data->'tags'->>0 AS first_tag
FROM users;

-- 2. Tum etiketleri JSON dizisi olarak al
SELECT username, data->'tags' AS tags
FROM users;

-- 3. Etiketleri say
SELECT username, jsonb_array_length(data->'tags') AS tag_count
FROM users;

-- MySQL
-- 1. Ilk etiketi al
SELECT username, data->>'$.tags[0]' AS first_tag
FROM users;

-- 2. Tum etiketleri JSON dizisi olarak al
SELECT username, data->'$.tags' AS tags
FROM users;

-- 3. Etiketleri say
SELECT username, JSON_LENGTH(data->'$.tags') AS tag_count
FROM users;

-- SQL Server
-- 1. Ilk etiketi al
SELECT username, JSON_VALUE(data, '$.tags[0]') AS first_tag
FROM users;

-- 2. Tum etiketleri JSON dizisi olarak al
SELECT username, JSON_QUERY(data, '$.tags') AS tags
FROM users;

-- 3. Etiketleri say (OPENJSON gerektirir)
SELECT username,
       (SELECT COUNT(*) FROM OPENJSON(data, '$.tags')) AS tag_count
FROM users;</code></pre>
                    </div>
                </div>
            </section>

            <!-- Alistirma 2: Varlik ve Icerik Kontrolleri -->
            <section>
                <h2 id="exercise-2">Alistirma 2: Varlik ve Icerik Kontrolleri</h2>
                <p>JSON verilerinde anahtar varligi ve deger icerme kontrollerini ogrenin.</p>

                <div class="concept-box">
                    PostgreSQL'in <code>?</code> operatoru anahtar varligini kontrol eder. <code>@></code> sol JSON'un
                    sag JSON'u icerip icermedigini kontrol eder. Bu operatorler GIN indeksleri ile verimlidir.
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 2.1: Anahtar Varligini Kontrol Etme</h4>
                    <p><code>users</code> tablosunu kullanarak asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>"language" tercihi ayarlanmis kullanicilari bulun</li>
                        <li>Tercihleri "notifications" anahtari iceren kullanicilari bulun</li>
                        <li>Ozelliklerinde "colors" alani olan urunleri bulun</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_1')">Cozumu Goster</button>
                    <div id="solution2_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Dil tercihi olan kullanicilar
SELECT username, data->'preferences'->>'language' AS language
FROM users
WHERE data->'preferences' ? 'language';

-- 2. Notifications anahtari olan kullanicilar
SELECT username
FROM users
WHERE data->'preferences' ? 'notifications';

-- 3. Colors alani olan urunler
SELECT name
FROM products
WHERE specs ? 'colors';

-- MySQL
-- 1. Dil tercihi olan kullanicilar
SELECT username, data->>'$.preferences.language' AS language
FROM users
WHERE JSON_CONTAINS_PATH(data, 'one', '$.preferences.language');

-- 2. Notifications anahtari olan kullanicilar
SELECT username
FROM users
WHERE JSON_CONTAINS_PATH(data, 'one', '$.preferences.notifications');

-- 3. Colors alani olan urunler
SELECT name
FROM products
WHERE JSON_CONTAINS_PATH(specs, 'one', '$.colors');

-- SQL Server
-- 1. Dil tercihi olan kullanicilar
SELECT username, JSON_VALUE(data, '$.preferences.language') AS language
FROM users
WHERE JSON_VALUE(data, '$.preferences.language') IS NOT NULL;

-- 2. Notifications anahtari olan kullanicilar
SELECT username
FROM users
WHERE JSON_VALUE(data, '$.preferences.notifications') IS NOT NULL;</code></pre>
                        <p><strong>Sorgu 1 icin Sonuc:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>username</th>
                                <th>language</th>
                            </tr>
                            <tr>
                                <td>bob_wilson</td>
                                <td>tr</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 2.2: Icerik Sorgulari</h4>
                    <p><code>users</code> tablosunu kullanarak asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>Etiketlerinde "admin" olan kullanicilari bulun</li>
                        <li>Koyu tema tercihine sahip kullanicilari bulun</li>
                        <li>Turkiye'den ve bildirimleri acik olan kullanicilari bulun</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_2')">Cozumu Goster</button>
                    <div id="solution2_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. "admin" etiketi olan kullanicilar
SELECT username, data->'tags' AS tags
FROM users
WHERE data->'tags' @> '"admin"'::jsonb;

-- Alternatif: dizinin deger icerip icermedigini kontrol et
SELECT username
FROM users
WHERE data @> '{"tags": ["admin"]}'::jsonb;

-- 2. Koyu tema olan kullanicilar
SELECT username
FROM users
WHERE data->'preferences' @> '{"theme": "dark"}'::jsonb;

-- 3. Turkiye'den ve bildirimleri acik olan kullanicilar
SELECT username
FROM users
WHERE data @> '{"address": {"country": "Turkey"}, "preferences": {"notifications": true}}'::jsonb;

-- MySQL
-- 1. "admin" etiketi olan kullanicilar
SELECT username, data->'$.tags' AS tags
FROM users
WHERE JSON_CONTAINS(data->'$.tags', '"admin"');

-- 2. Koyu tema olan kullanicilar
SELECT username
FROM users
WHERE JSON_CONTAINS(data, '{"theme": "dark"}', '$.preferences');

-- 3. Turkiye'den ve bildirimleri acik olan kullanicilar
SELECT username
FROM users
WHERE data->>'$.address.country' = 'Turkey'
  AND JSON_EXTRACT(data, '$.preferences.notifications') = true;</code></pre>
                        <p><strong>Sorgu 1 icin Sonuc:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>username</th>
                                <th>tags</th>
                            </tr>
                            <tr>
                                <td>john_doe</td>
                                <td>["admin", "developer"]</td>
                            </tr>
                            <tr>
                                <td>bob_wilson</td>
                                <td>["admin", "manager"]</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 2.3: Coklu Anahtar Varligi</h4>
                    <p><code>products</code> tablosunu kullanarak asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>HEM "dimensions" HEM DE "colors" alanina sahip urunleri bulun</li>
                        <li>"dimensions" VEYA "colors" alanina sahip urunleri bulun</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_3')">Cozumu Goster</button>
                    <div id="solution2_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. HEM dimensions HEM DE colors olan urunler
SELECT name
FROM products
WHERE specs ?& ARRAY['dimensions', 'colors'];

-- AND kullanan alternatif
SELECT name
FROM products
WHERE specs ? 'dimensions' AND specs ? 'colors';

-- 2. dimensions VEYA colors olan urunler
SELECT name
FROM products
WHERE specs ?| ARRAY['dimensions', 'colors'];

-- OR kullanan alternatif
SELECT name
FROM products
WHERE specs ? 'dimensions' OR specs ? 'colors';

-- MySQL
-- 1. HER IKISI de olan urunler
SELECT name
FROM products
WHERE JSON_CONTAINS_PATH(specs, 'all', '$.dimensions', '$.colors');

-- 2. HERHANGI BIRI olan urunler
SELECT name
FROM products
WHERE JSON_CONTAINS_PATH(specs, 'one', '$.dimensions', '$.colors');</code></pre>
                    </div>
                </div>
            </section>

            <!-- Alistirma 3: JSON Verisini Degistirme -->
            <section>
                <h2 id="exercise-3">Alistirma 3: JSON Verisini Degistirme</h2>
                <p>JSON belgelerinde alanlari guncelleme, ekleme ve kaldirmayi ogrenin.</p>

                <div class="warning-box">
                    JSON'u degistirmek tum belgeyi gunceller. Sik guncellenen alanlar icin
                    bunlari ayri iliskisel sutunlarda saklamayi dusunun.
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 3.1: JSON Alanlarini Guncelleme</h4>
                    <p>Asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>john_doe'nun tema tercihini "system" olarak guncelleyin</li>
                        <li>bob_wilson'in verisine yeni bir "phone" alani ekleyin</li>
                        <li>Products tablosunda "Laptop Pro"nun fiyatini guncelleyin</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_1')">Cozumu Goster</button>
                    <div id="solution3_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Tema tercihini guncelle
UPDATE users
SET data = jsonb_set(data, '{preferences,theme}', '"system"')
WHERE username = 'john_doe';

-- 2. Phone alani ekle
UPDATE users
SET data = jsonb_set(data, '{phone}', '"555-1234"')
WHERE username = 'bob_wilson';

-- Alternatif: yeni veri birlestir
UPDATE users
SET data = data || '{"phone": "555-1234"}'::jsonb
WHERE username = 'bob_wilson';

-- 3. Urun fiyatini guncelle
UPDATE products
SET specs = jsonb_set(specs, '{price}', '1199.99')
WHERE name = 'Laptop Pro';

-- MySQL
-- 1. Tema tercihini guncelle
UPDATE users
SET data = JSON_SET(data, '$.preferences.theme', 'system')
WHERE username = 'john_doe';

-- 2. Phone alani ekle
UPDATE users
SET data = JSON_SET(data, '$.phone', '555-1234')
WHERE username = 'bob_wilson';

-- 3. Urun fiyatini guncelle
UPDATE products
SET specs = JSON_SET(specs, '$.price', 1199.99)
WHERE name = 'Laptop Pro';

-- SQL Server
-- 1. Tema tercihini guncelle
UPDATE users
SET data = JSON_MODIFY(data, '$.preferences.theme', 'system')
WHERE username = 'john_doe';

-- 2. Phone alani ekle
UPDATE users
SET data = JSON_MODIFY(data, '$.phone', '555-1234')
WHERE username = 'bob_wilson';

-- 3. Urun fiyatini guncelle
UPDATE products
SET specs = JSON_MODIFY(specs, '$.price', 1199.99)
WHERE name = 'Laptop Pro';</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 3.2: JSON Alanlarini Kaldirma</h4>
                    <p>Asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>bob_wilson'dan "language" tercihini kaldirin</li>
                        <li>Wireless Mouse urununden "colors" dizisini kaldirin</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_2')">Cozumu Goster</button>
                    <div id="solution3_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Language tercihini kaldir
UPDATE users
SET data = data #- '{preferences,language}'
WHERE username = 'bob_wilson';

-- Alternatif: ic ice nesneden anahtari kaldir
UPDATE users
SET data = jsonb_set(data, '{preferences}',
           (data->'preferences') - 'language')
WHERE username = 'bob_wilson';

-- 2. Urunden colors'i kaldir
UPDATE products
SET specs = specs - 'colors'
WHERE name = 'Wireless Mouse';

-- MySQL
-- 1. Language tercihini kaldir
UPDATE users
SET data = JSON_REMOVE(data, '$.preferences.language')
WHERE username = 'bob_wilson';

-- 2. Urunden colors'i kaldir
UPDATE products
SET specs = JSON_REMOVE(specs, '$.colors')
WHERE name = 'Wireless Mouse';

-- SQL Server
-- 1. Language tercihini kaldir (null'a ayarla)
UPDATE users
SET data = JSON_MODIFY(data, '$.preferences.language', NULL)
WHERE username = 'bob_wilson';</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 3.3: Dizi Degisiklikleri</h4>
                    <p>Asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>bob_wilson'in etiketlerine "supervisor" etiketi ekleyin</li>
                        <li>Monitor 4K urunune "Touch Screen" ozelligi ekleyin</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_3')">Cozumu Goster</button>
                    <div id="solution3_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Kullaniciya yeni etiket ekle
UPDATE users
SET data = jsonb_set(data, '{tags}',
           (data->'tags') || '"supervisor"'::jsonb)
WHERE username = 'bob_wilson';

-- Alternatif: dizileri birlestir
UPDATE users
SET data = jsonb_set(data, '{tags}',
           data->'tags' || '["supervisor"]'::jsonb)
WHERE username = 'bob_wilson';

-- 2. Urune ozellik ekle
UPDATE products
SET specs = jsonb_set(specs, '{features}',
            specs->'features' || '["Touch Screen"]'::jsonb)
WHERE name = 'Monitor 4K';

-- MySQL
-- 1. Yeni etiket ekle (MySQL 8.0+)
UPDATE users
SET data = JSON_ARRAY_APPEND(data, '$.tags', 'supervisor')
WHERE username = 'bob_wilson';

-- 2. Urune ozellik ekle
UPDATE products
SET specs = JSON_ARRAY_APPEND(specs, '$.features', 'Touch Screen')
WHERE name = 'Monitor 4K';

-- SQL Server (diziyi yeniden olusturmayi gerektirir)
-- 1. Yeni etiket ekle
UPDATE users
SET data = JSON_MODIFY(data, '$.tags',
           JSON_QUERY(
               CONCAT(
                   LEFT(JSON_QUERY(data, '$.tags'),
                        LEN(JSON_QUERY(data, '$.tags')) - 1),
                   ',"supervisor"]'
               )
           ))
WHERE username = 'bob_wilson';</code></pre>
                    </div>
                </div>
            </section>

            <!-- Alistirma 4: JSON'dan Iliskisel Formata Donusum -->
            <section>
                <h2 id="exercise-4">Alistirma 4: JSON'u Iliskisel Formata Donusturme</h2>
                <p>JSON dizilerini ve nesnelerini satirlara ve sutunlara genisletmeyi ogrenin.</p>

                <div class="concept-box">
                    <code>jsonb_array_elements</code> (PostgreSQL), <code>JSON_TABLE</code> (MySQL/Oracle),
                    ve <code>OPENJSON</code> (SQL Server) JSON'u iliskisel satirlara donusturur.
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 4.1: JSON Dizilerini Genisletme</h4>
                    <p><code>users</code> tablosunu kullanarak, her kullaniciyi etiketleri ayri satirlara
                        genisletilmis olarak gosteren bir sorgu yazin (kullanici basina etiket basina bir satir).</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_1')">Cozumu Goster</button>
                    <div id="solution4_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    username,
    jsonb_array_elements_text(data->'tags') AS tag
FROM users;

-- Indeks konumu ile
SELECT
    username,
    ordinality AS tag_position,
    tag
FROM users,
     jsonb_array_elements_text(data->'tags')
     WITH ORDINALITY AS t(tag, ordinality);

-- MySQL
SELECT
    username,
    jt.tag
FROM users,
     JSON_TABLE(data, '$.tags[*]' COLUMNS(
         tag VARCHAR(50) PATH '$'
     )) AS jt;

-- SQL Server
SELECT
    username,
    tag.value AS tag
FROM users
CROSS APPLY OPENJSON(data, '$.tags') AS tag;</code></pre>
                        <p><strong>Beklenen Sonuc:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>username</th>
                                <th>tag</th>
                            </tr>
                            <tr>
                                <td>john_doe</td>
                                <td>admin</td>
                            </tr>
                            <tr>
                                <td>john_doe</td>
                                <td>developer</td>
                            </tr>
                            <tr>
                                <td>jane_smith</td>
                                <td>editor</td>
                            </tr>
                            <tr>
                                <td>jane_smith</td>
                                <td>reviewer</td>
                            </tr>
                            <tr>
                                <td>bob_wilson</td>
                                <td>admin</td>
                            </tr>
                            <tr>
                                <td>bob_wilson</td>
                                <td>manager</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 4.2: Ic Ice Nesneleri Genisletme</h4>
                    <p><code>orders</code> tablosunu kullanarak, items dizisini genisleten ve her oge icin
                        order_id, oge adi, fiyat ve miktari gosteren bir sorgu yazin.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_2')">Cozumu Goster</button>
                    <div id="solution4_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    o.id AS order_id,
    item->>'name' AS item_name,
    (item->>'price')::DECIMAL AS price,
    (item->>'qty')::INTEGER AS quantity
FROM orders o,
     jsonb_array_elements(o.order_data->'items') AS item;

-- Hesaplanmis satir toplami ile
SELECT
    o.id AS order_id,
    item->>'name' AS item_name,
    (item->>'price')::DECIMAL AS price,
    (item->>'qty')::INTEGER AS quantity,
    (item->>'price')::DECIMAL * (item->>'qty')::INTEGER AS line_total
FROM orders o,
     jsonb_array_elements(o.order_data->'items') AS item;

-- MySQL
SELECT
    o.id AS order_id,
    jt.item_name,
    jt.price,
    jt.quantity,
    jt.price * jt.quantity AS line_total
FROM orders o,
     JSON_TABLE(o.order_data, '$.items[*]' COLUMNS(
         item_name VARCHAR(100) PATH '$.name',
         price DECIMAL(10,2) PATH '$.price',
         quantity INT PATH '$.qty'
     )) AS jt;

-- SQL Server
SELECT
    o.id AS order_id,
    JSON_VALUE(item.value, '$.name') AS item_name,
    CAST(JSON_VALUE(item.value, '$.price') AS DECIMAL(10,2)) AS price,
    CAST(JSON_VALUE(item.value, '$.qty') AS INT) AS quantity
FROM orders o
CROSS APPLY OPENJSON(o.order_data, '$.items') AS item;</code></pre>
                        <p><strong>Beklenen Sonuc:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>order_id</th>
                                <th>item_name</th>
                                <th>price</th>
                                <th>quantity</th>
                                <th>line_total</th>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>Laptop Pro</td>
                                <td>1299.99</td>
                                <td>1</td>
                                <td>1299.99</td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>Wireless Mouse</td>
                                <td>49.99</td>
                                <td>2</td>
                                <td>99.98</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>Monitor 4K</td>
                                <td>599.00</td>
                                <td>1</td>
                                <td>599.00</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 4.3: JSON Nesnesini Anahtar-Deger Ciftlerine Donusturme</h4>
                    <p><code>users</code> tablosunu kullanarak, her kullanici icin preferences
                        nesnesini anahtar-deger ciftlerine genisleten bir sorgu yazin.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_3')">Cozumu Goster</button>
                    <div id="solution4_3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    username,
    pref.key AS preference_name,
    pref.value AS preference_value
FROM users,
     jsonb_each(data->'preferences') AS pref(key, value);

-- MySQL (JSON_KEYS ve ozyinelemeli yaklasim veya belirli anahtarlar kullanarak)
SELECT
    username,
    'theme' AS preference_name,
    data->>'$.preferences.theme' AS preference_value
FROM users
UNION ALL
SELECT
    username,
    'notifications' AS preference_name,
    CAST(data->'$.preferences.notifications' AS CHAR) AS preference_value
FROM users
UNION ALL
SELECT
    username,
    'language' AS preference_name,
    data->>'$.preferences.language' AS preference_value
FROM users
WHERE JSON_CONTAINS_PATH(data, 'one', '$.preferences.language');

-- SQL Server
SELECT
    username,
    pref.[key] AS preference_name,
    pref.[value] AS preference_value
FROM users
CROSS APPLY OPENJSON(data, '$.preferences') AS pref;</code></pre>
                        <p><strong>Beklenen Sonuc (PostgreSQL):</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>username</th>
                                <th>preference_name</th>
                                <th>preference_value</th>
                            </tr>
                            <tr>
                                <td>john_doe</td>
                                <td>theme</td>
                                <td>"dark"</td>
                            </tr>
                            <tr>
                                <td>john_doe</td>
                                <td>notifications</td>
                                <td>true</td>
                            </tr>
                            <tr>
                                <td>jane_smith</td>
                                <td>theme</td>
                                <td>"light"</td>
                            </tr>
                            <tr>
                                <td>jane_smith</td>
                                <td>notifications</td>
                                <td>false</td>
                            </tr>
                            <tr>
                                <td>bob_wilson</td>
                                <td>theme</td>
                                <td>"dark"</td>
                            </tr>
                            <tr>
                                <td>bob_wilson</td>
                                <td>notifications</td>
                                <td>true</td>
                            </tr>
                            <tr>
                                <td>bob_wilson</td>
                                <td>language</td>
                                <td>"tr"</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Alistirma 5: Iliskisel Veriden JSON Olusturma -->
            <section>
                <h2 id="exercise-5">Alistirma 5: Iliskisel Veriden JSON Olusturma</h2>
                <p>Iliskisel sorgu sonuclarindan JSON nesneleri ve dizileri olusturmayi ogrenin.</p>

                <div class="exercise-box">
                    <h4>Alistirma 5.1: JSON Nesneleri Olusturma</h4>
                    <p>Her urun icin urun bilgilerini (isim, marka, fiyat) iceren bir JSON nesnesi
                        olusturan bir sorgu yazin.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution5_1')">Cozumu Goster</button>
                    <div id="solution5_1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    jsonb_build_object(
        'product_name', name,
        'brand', specs->>'brand',
        'price', (specs->>'price')::DECIMAL,
        'in_stock', (specs->>'in_stock')::BOOLEAN
    ) AS product_json
FROM products;

-- Guzel formatlama ile
SELECT
    jsonb_pretty(
        jsonb_build_object(
            'product_name', name,
            'brand', specs->>'brand',
            'price', (specs->>'price')::DECIMAL
        )
    ) AS product_json
FROM products;

-- MySQL
SELECT
    JSON_OBJECT(
        'product_name', name,
        'brand', specs->>'$.brand',
        'price', CAST(specs->>'$.price' AS DECIMAL(10,2)),
        'in_stock', CAST(specs->'$.in_stock' AS JSON)
    ) AS product_json
FROM products;

-- SQL Server
SELECT
    name AS product_name,
    JSON_VALUE(specs, '$.brand') AS brand,
    JSON_VALUE(specs, '$.price') AS price
FROM products
FOR JSON PATH;</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 5.2: JSON Dizilerine Toplama</h4>
                    <p>Tum kullanici adlarini JSON dizisi olarak donduren ve kullanici verilerini
                        ulkeye gore gruplayan bir sorgu olusturun.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution5_2')">Cozumu Goster</button>
                    <div id="solution5_2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Tum kullanici adlari JSON dizisi olarak
SELECT jsonb_agg(username) AS all_usernames
FROM users;

-- 2. Ulkeye gore gruplu kullanicilar
SELECT
    data->'address'->>'country' AS country,
    jsonb_agg(
        jsonb_build_object(
            'username', username,
            'email', data->>'email',
            'city', data->'address'->>'city'
        )
    ) AS users_in_country
FROM users
GROUP BY data->'address'->>'country';

-- 3. Urunler ve degerlendirme ozetleri
SELECT
    name,
    jsonb_build_object(
        'count', jsonb_array_length(specs->'ratings'),
        'ratings', specs->'ratings',
        'average', (
            SELECT AVG(r::DECIMAL)
            FROM jsonb_array_elements_text(specs->'ratings') r
        )
    ) AS rating_summary
FROM products;

-- MySQL
-- 1. Tum kullanici adlari JSON dizisi olarak
SELECT JSON_ARRAYAGG(username) AS all_usernames
FROM users;

-- 2. Ulkeye gore gruplu kullanicilar
SELECT
    data->>'$.address.country' AS country,
    JSON_ARRAYAGG(
        JSON_OBJECT(
            'username', username,
            'email', data->>'$.email',
            'city', data->>'$.address.city'
        )
    ) AS users_in_country
FROM users
GROUP BY data->>'$.address.country';

-- SQL Server
-- 1. Tum kullanici adlari JSON dizisi olarak
SELECT username
FROM users
FOR JSON PATH;</code></pre>
                        <p><strong>Ulkeye gore gruplu sonuc:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>country</th>
                                <th>users_in_country</th>
                            </tr>
                            <tr>
                                <td>USA</td>
                                <td>[{"username": "john_doe", "email": "john@example.com", "city": "New York"}]</td>
                            </tr>
                            <tr>
                                <td>UK</td>
                                <td>[{"username": "jane_smith", "email": "jane@example.com", "city": "London"}]</td>
                            </tr>
                            <tr>
                                <td>Turkey</td>
                                <td>[{"username": "bob_wilson", "email": "bob@example.com", "city": "Istanbul"}]</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Zorluk Alistirmalari -->
            <section>
                <h2 id="challenge-exercises">Zorluk Alistirmalari</h2>
                <p>Bu ileri duzey zorluklarla JSON islemlerinin kapsamli anlayisinizi test edin.</p>

                <div class="challenge-box">
                    <h4>Zorluk 1: Log Analizi</h4>
                    <p><code>logs</code> tablosunu kullanarak asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>Olaylari tur bazinda sayin</li>
                        <li>Tum hata olaylarini bulun ve hata kodu ile mesajini cikarin</li>
                        <li>Giris yapmis tum benzersiz kullanicilarin listesini alin</li>
                        <li>Tum satislarin toplam degerini hesaplayin</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge1')">Cozumu Goster</button>
                    <div id="challenge1" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Ture gore olaylari say
SELECT
    event_data->>'event' AS event_type,
    COUNT(*) AS event_count
FROM logs
GROUP BY event_data->>'event';

-- 2. Hata olaylarini detaylari ile bul
SELECT
    timestamp,
    (event_data->>'error_code')::INTEGER AS error_code,
    event_data->>'message' AS error_message,
    event_data->'metadata'->>'service' AS service,
    event_data->'metadata'->>'endpoint' AS endpoint
FROM logs
WHERE event_data->>'event' = 'error';

-- 3. Giris yapmis benzersiz kullanicilar
SELECT DISTINCT
    event_data->'user'->>'id' AS user_id,
    event_data->'user'->>'name' AS username
FROM logs
WHERE event_data->>'event' = 'login';

-- 4. Toplam satis degeri
SELECT
    SUM((event_data->>'total')::DECIMAL) AS total_revenue
FROM logs
WHERE event_data->>'event' = 'purchase';

-- Bonus: Detayli satis dokumu
SELECT
    event_data->'user'->>'name' AS customer,
    (event_data->>'total')::DECIMAL AS order_total,
    jsonb_array_length(event_data->'items') AS item_count
FROM logs
WHERE event_data->>'event' = 'purchase';</code></pre>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Zorluk 2: Urun Analitikleri</h4>
                    <p><code>products</code> tablosunu kullanarak asagidaki sorgulari yazin:</p>
                    <ol>
                        <li>Her urun icin ortalama derecelendirmeyi bulun</li>
                        <li>Ortalama derecelendirmesi 4.5'in uzerinde olan urunleri bulun</li>
                        <li>Tum urunlerdeki benzersiz ozellikleri listeleyin</li>
                        <li>3'ten fazla ozelligi olan urunleri bulun</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge2')">Cozumu Goster</button>
                    <div id="challenge2" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
-- 1. Her urun icin ortalama derecelendirme
SELECT
    name,
    ROUND(
        (SELECT AVG(r::DECIMAL)
         FROM jsonb_array_elements_text(specs->'ratings') r),
        2
    ) AS avg_rating
FROM products;

-- 2. Ortalama derecelendirmesi 4.5 uzerinde olan urunler
SELECT
    name,
    avg_rating
FROM (
    SELECT
        name,
        (SELECT AVG(r::DECIMAL)
         FROM jsonb_array_elements_text(specs->'ratings') r) AS avg_rating
    FROM products
) subq
WHERE avg_rating > 4.5;

-- 3. Tum benzersiz ozellikler
SELECT DISTINCT feature
FROM products,
     jsonb_array_elements_text(specs->'features') AS feature
ORDER BY feature;

-- 4. 3'ten fazla ozelligi olan urunler
SELECT
    name,
    jsonb_array_length(specs->'features') AS feature_count
FROM products
WHERE jsonb_array_length(specs->'features') > 3;</code></pre>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Zorluk 3: Siparis Raporu Olusturma</h4>
                    <p><code>orders</code> tablosunu kullanarak asagidakileri gosteren kapsamli bir siparis raporu olusturun:</p>
                    <ol>
                        <li>Siparis ID, durum ve musteri ID</li>
                        <li>Her siparisteki oge sayisi</li>
                        <li>Ara toplam (tum ogeler icin fiyat * miktar toplami)</li>
                        <li>Kargo maliyeti ve yontemi</li>
                        <li>Genel toplam (ara toplam + kargo)</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge3')">Cozumu Goster</button>
                    <div id="challenge3" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL
SELECT
    id AS order_id,
    customer_id,
    order_data->>'status' AS status,
    jsonb_array_length(order_data->'items') AS item_count,
    (
        SELECT SUM(
            (item->>'price')::DECIMAL * (item->>'qty')::INTEGER
        )
        FROM jsonb_array_elements(order_data->'items') AS item
    ) AS subtotal,
    order_data->'shipping'->>'method' AS shipping_method,
    (order_data->'shipping'->>'cost')::DECIMAL AS shipping_cost,
    (
        SELECT SUM(
            (item->>'price')::DECIMAL * (item->>'qty')::INTEGER
        )
        FROM jsonb_array_elements(order_data->'items') AS item
    ) + (order_data->'shipping'->>'cost')::DECIMAL AS grand_total
FROM orders;

-- Daha temiz kod icin CTE ile alternatif
WITH order_items AS (
    SELECT
        o.id,
        SUM((item->>'price')::DECIMAL * (item->>'qty')::INTEGER) AS subtotal
    FROM orders o,
         jsonb_array_elements(o.order_data->'items') AS item
    GROUP BY o.id
)
SELECT
    o.id AS order_id,
    o.customer_id,
    o.order_data->>'status' AS status,
    jsonb_array_length(o.order_data->'items') AS item_count,
    oi.subtotal,
    o.order_data->'shipping'->>'method' AS shipping_method,
    (o.order_data->'shipping'->>'cost')::DECIMAL AS shipping_cost,
    oi.subtotal + (o.order_data->'shipping'->>'cost')::DECIMAL AS grand_total
FROM orders o
JOIN order_items oi ON o.id = oi.id;</code></pre>
                        <p><strong>Beklenen Sonuc:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th>order_id</th>
                                <th>status</th>
                                <th>item_count</th>
                                <th>subtotal</th>
                                <th>shipping_method</th>
                                <th>shipping_cost</th>
                                <th>grand_total</th>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>completed</td>
                                <td>2</td>
                                <td>1399.97</td>
                                <td>express</td>
                                <td>25.00</td>
                                <td>1424.97</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>pending</td>
                                <td>1</td>
                                <td>599.00</td>
                                <td>standard</td>
                                <td>10.00</td>
                                <td>609.00</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Zorluk 4: Indeksleme Stratejisi Olusturma</h4>
                    <p>Asagidaki sorgu kaliplari icin uygun indeksler olusturmak uzere SQL ifadeleri tasarlayin ve yazin:</p>
                    <ol>
                        <li>Kullanicilari e-postaya gore sik sorgulama</li>
                        <li>Belirli etiketler iceren urunleri sik arama</li>
                        <li>Siparisleri duruma gore arama</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge4')">Cozumu Goster</button>
                    <div id="challenge4" class="solution-box">
                        <pre><code class="language-sql">-- PostgreSQL

-- 1. E-posta sorgulari icin indeks (cikarilan degerde B-tree)
CREATE INDEX idx_users_email ON users ((data->>'email'));

-- 2. Etiket icerik sorgulari icin GIN indeksi
CREATE INDEX idx_users_tags ON users USING GIN ((data->'tags'));
-- Bu su sorgulari destekler: WHERE data->'tags' @> '"admin"'

-- 3. Siparis durumu icin indeks
CREATE INDEX idx_orders_status ON orders ((order_data->>'status'));

-- Esnek sorgulama icin tam JSONB GIN indeksi
CREATE INDEX idx_users_data_gin ON users USING GIN (data);
-- Bu ?, ?|, ?&, @>, <@ operatorlerini destekler

-- Yalnizca icerik sorgulari icin jsonb_path_ops ile GIN (daha kucuk indeks)
CREATE INDEX idx_users_data_path ON users USING GIN (data jsonb_path_ops);

-- MySQL

-- 1. E-posta icin indeksli olusturulan sutun
ALTER TABLE users
ADD COLUMN email_idx VARCHAR(255)
GENERATED ALWAYS AS (data->>'$.email') STORED;
CREATE INDEX idx_users_email ON users(email_idx);

-- 2. Etiketler icin coklu degerli indeks (MySQL 8.0.17+)
CREATE INDEX idx_users_tags ON users((CAST(data->'$.tags' AS CHAR(100) ARRAY)));

-- 3. Durum icin olusturulan sutun
ALTER TABLE orders
ADD COLUMN status_idx VARCHAR(50)
GENERATED ALWAYS AS (order_data->>'$.status') STORED;
CREATE INDEX idx_orders_status ON orders(status_idx);

-- SQL Server

-- 1. E-posta icin indeksli hesaplanan sutun
ALTER TABLE users
ADD email_computed AS JSON_VALUE(data, '$.email');
CREATE INDEX idx_users_email ON users(email_computed);

-- 3. Durum icin hesaplanan sutun
ALTER TABLE orders
ADD status_computed AS JSON_VALUE(order_data, '$.status');
CREATE INDEX idx_orders_status ON orders(status_computed);</code></pre>
                    </div>
                </div>
            </section>

            <!-- Onemli Noktalar -->
            <section>
                <h2 id="key-takeaways">Onemli Noktalar</h2>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Kavram</th>
                            <th>En Iyi Uygulama</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>JSON Tur Secimi</td>
                            <td>Daha iyi performans ve indeksleme icin <code>JSONB</code> (PostgreSQL) veya yerel <code>JSON</code> (MySQL) kullanin</td>
                        </tr>
                        <tr>
                            <td>Deger Cikarma</td>
                            <td>Karsilastirma veya gosterim icin <code>->></code> metin ciktisi kullanin, ic ice gezinme icin <code>-></code> kullanin</td>
                        </tr>
                        <tr>
                            <td>Tur Donusumu</td>
                            <td>Karsilastirmalar icin cikarilan degerleri her zaman uygun turlere donusturun: <code>(data->>'age')::INTEGER</code></td>
                        </tr>
                        <tr>
                            <td>Icerik Sorgulari</td>
                            <td>Verimli icerik kontrolleri icin, ozellikle GIN indeksleri ile <code>@></code> kullanin</td>
                        </tr>
                        <tr>
                            <td>Dizi Genisletme</td>
                            <td>Dizileri satirlara donusturmek icin <code>jsonb_array_elements</code>, <code>JSON_TABLE</code> veya <code>OPENJSON</code> kullanin</td>
                        </tr>
                        <tr>
                            <td>Indeksleme Stratejisi</td>
                            <td>Sik sorgulanan yollarda ifade indeksleri olusturun; esnek icerik sorgulari icin GIN indeksleri kullanin</td>
                        </tr>
                        <tr>
                            <td>Sema Tasarimi</td>
                            <td>JSON'u asiri kullanmayin; uygun oldugunda sik sorgulanan alanlari normal sutunlara cikarin</td>
                        </tr>
                        <tr>
                            <td>Veritabanlari Arasi Tasinabilirlik</td>
                            <td>Sozdizimi farkliliklarina dikkat edin; mumkun oldugunda standart <code>JSON_VALUE</code>/<code>JSON_QUERY</code> tercih edin</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Gezinme -->
            <section>
                <p><a href="03_working_with_json.html">&larr; JSON Verileriyle Calisma Dersine Don</a></p>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="../static/script.js"></script>

    <script>
        function toggleSolution(id) {
            var element = document.getElementById(id);
            if (element.classList.contains('show')) {
                element.classList.remove('show');
                event.target.textContent = 'Cozumu Goster';
            } else {
                element.classList.add('show');
                event.target.textContent = 'Cozumu Gizle';
            }
        }
    </script>
</body>

</html>
