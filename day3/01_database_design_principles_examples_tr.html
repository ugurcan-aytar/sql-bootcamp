<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="tr" xml:lang="tr">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style_bootstrap.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/code.css">
    <link href="https://cdn.prod.website-files.com/5efdb54f07a6812bcd95cc65/6773d0fc3013e060f08d7145_favicon.jpg"
        rel="shortcut icon" type="image/x-icon">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>Gun 3: Veritabani Tasarim Ilkeleri - Pratik Ornekler</title>
    <style>
        code {
            white-space: pre-wrap;
        }

        span.smallcaps {
            font-variant: small-caps;
        }

        span.underline {
            text-decoration: underline;
        }

        div.column {
            display: inline-block;
            vertical-align: top;
            width: 50%;
        }

        div.hanging-indent {
            margin-left: 1.5em;
            text-indent: -1.5em;
        }

        ul.task-list {
            list-style: none;
        }

        .exercise-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .exercise-box h4 {
            color: #495057;
            margin-bottom: 15px;
        }

        .solution-box {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .solution-box.show {
            display: block;
        }

        .toggle-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .toggle-btn:hover {
            background-color: #0056b3;
        }

        .hint-box {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .hint-box::before {
            content: "Ipucu: ";
            font-weight: bold;
        }

        .warning-box {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .warning-box::before {
            content: "Uyari: ";
            font-weight: bold;
        }

        .concept-box {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .concept-box::before {
            content: "Kavram: ";
            font-weight: bold;
        }

        .challenge-box {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .challenge-box h4 {
            color: #155724;
        }

        .challenge-box::before {
            content: "";
        }

        .dataset-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        .dataset-table th,
        .dataset-table td {
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            text-align: left;
        }

        .dataset-table th {
            background-color: #343a40;
            color: white;
        }

        .dataset-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background-color: #007bff;
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .result-box {
            background-color: #f1f1f1;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
        }

        .bad-design {
            background-color: #f8d7da;
            border: 2px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .bad-design::before {
            content: "Kotu Tasarim: ";
            font-weight: bold;
            color: #721c24;
        }

        .good-design {
            background-color: #d4edda;
            border: 2px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .good-design::before {
            content: "Iyi Tasarim: ";
            font-weight: bold;
            color: #155724;
        }

        .nf-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }

        .nf-1nf {
            background-color: #ffc107;
            color: #212529;
        }

        .nf-2nf {
            background-color: #17a2b8;
            color: white;
        }

        .nf-3nf {
            background-color: #28a745;
            color: white;
        }

        .er-diagram {
            background-color: #f8f9fa;
            border: 2px solid #6c757d;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
        }

        .cardinality-box {
            background-color: #e2d5f1;
            border: 1px solid #c5b3d9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .key-type {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin: 2px;
        }

        .key-pk {
            background-color: #ffc107;
            color: #212529;
        }

        .key-fk {
            background-color: #17a2b8;
            color: white;
        }

        .key-uk {
            background-color: #6c757d;
            color: white;
        }

        .anomaly-box {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .language-switcher {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: #fff;
            padding: 5px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .language-switcher a {
            text-decoration: none;
            padding: 5px 10px;
            margin: 0 2px;
            border-radius: 3px;
            color: #333;
        }

        .language-switcher a.active {
            background: #0d6efd;
            color: #fff;
        }

        .language-switcher a:hover:not(.active) {
            background: #e9ecef;
        }
    </style>
</head>

<body>
    <a href="../index_tr.html" class="back-button">← Anasayfaya Don</a>
    <div class="language-switcher">
        <a href="01_database_design_principles_examples.html">EN</a>
        <a href="01_database_design_principles_examples_tr.html" class="active">TR</a>
    </div>

    <div class="copy-notification" id="copyNotification">Kopyalandi!</div>

    <div id="europeanunion-turkey">
        <img src="../static/eu.png" alt="">
    </div>
    <div id="sanayiteknolojibakan">
        <img src="../static/sanayitek.png" alt="">
    </div>
    <div id="rekabet">
        <img src="../static/rekabet.png" alt="">
    </div>
    <div id="tisk">
        <img src="../static/tisk.png" alt="">
    </div>
    <div id="undp">
        <img src="../static/undp.png" alt="">
    </div>
    <div class="content-container">
        <div class="container">
            <section>
                <h1 id="design-principles-practical-examples">Veritabani Tasarim Ilkeleri - Pratik Ornekler</h1>
                <p><a href="01_database_design_principles_tr.html">&larr; Veritabani Tasarim Ilkeleri Dersine Don</a></p>
                <p>Bu sayfa veritabani tasariminda ustalasmak icin uygulamali alistirmalar sunmaktadir. Normalizasyon
                    sorunlarini tespit etme, varlik iliskilerini tasarlama, anahtarlari uygulama ve kisitlamalar yazma pratiği yapin.</p>
            </section>

            <!-- Normal Formlar Hizli Referans -->
            <section>
                <h2 id="normal-forms-reference">Normal Formlar Hizli Referans</h2>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Normal Form</th>
                            <th>Kural</th>
                            <th>Ihlal Ornegi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="nf-badge nf-1nf">1NF</span></td>
                            <td>Her hucre atomik (tekil) degerler icerir. Tekrarlayan gruplar yok.</td>
                            <td>Phone sutunu: "555-1234, 555-5678"</td>
                        </tr>
                        <tr>
                            <td><span class="nf-badge nf-2nf">2NF</span></td>
                            <td>1NF'de + Kismi bagimlilik yok (anahtar olmayan, bilesik anahtarin bir parcasina bagimli)</td>
                            <td>OrderItems(OrderID, ProductID, ProductName) - ProductName sadece ProductID'ye bagimli</td>
                        </tr>
                        <tr>
                            <td><span class="nf-badge nf-3nf">3NF</span></td>
                            <td>2NF'de + Gecisli bagimlilik yok (anahtar olmayan baska anahtar olmayana bagimli)</td>
                            <td>Employee(EmpID, DeptID, DeptLocation) - DeptLocation, DeptID'ye bagimli</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Alistirma 1: Normalizasyon Sorunlarini Tespit Etme -->
            <section>
                <h2 id="exercise-1">Alistirma 1: Normalizasyon Sorunlarini Tespit Etme</h2>
                <p>Bir tablonun hangi normal formu ihlal ettigini ve nasil duzeltilecegini ogrenmek.</p>

                <div class="exercise-box">
                    <h4>Alistirma 1.1: Birinci Normal Form (1NF) Ihlalleri</h4>
                    <p>Bu tabloyu inceleyin ve 1NF ihlalini tespit edin:</p>

                    <div class="bad-design">
                        <strong>students Tablosu</strong>
                        <table class="dataset-table">
                            <thead>
                                <tr>
                                    <th>student_id</th>
                                    <th>name</th>
                                    <th>courses</th>
                                    <th>phone_numbers</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>John Smith</td>
                                    <td>Math, Physics, Chemistry</td>
                                    <td>555-1234, 555-5678</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>Jane Doe</td>
                                    <td>Biology, Chemistry</td>
                                    <td>555-9999</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>Bob Wilson</td>
                                    <td>Math</td>
                                    <td>555-1111, 555-2222, 555-3333</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <p><strong>Gorevler:</strong></p>
                    <ol>
                        <li>1NF ihlallerini tespit edin</li>
                        <li>1NF'yi karsilayan normallestirilmis bir sema tasarlayin</li>
                        <li>CREATE TABLE ifadelerini yazin</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_1')">Cozumu Goster</button>
                    <div id="solution1_1" class="solution-box">
                        <p><strong>1NF Ihlalleri:</strong></p>
                        <ul>
                            <li><code>courses</code> sutunu birden fazla deger icerir (virgul ayirmali liste)</li>
                            <li><code>phone_numbers</code> sutunu birden fazla deger icerir</li>
                        </ul>

                        <div class="good-design">
                            <strong>Normallestirilmis Sema:</strong>
                            <pre><code class="language-sql">-- Ana students tablosu
CREATE TABLE students (
    student_id INTEGER PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);

-- Dersler icin ayri tablo (coktan coka iliski)
CREATE TABLE courses (
    course_id INTEGER PRIMARY KEY,
    course_name VARCHAR(100) NOT NULL UNIQUE
);

-- Ogrenci-ders iliskisi icin baglanti tablosu
CREATE TABLE student_courses (
    student_id INTEGER,
    course_id INTEGER,
    PRIMARY KEY (student_id, course_id),
    FOREIGN KEY (student_id) REFERENCES students(student_id),
    FOREIGN KEY (course_id) REFERENCES courses(course_id)
);

-- Telefon numaralari icin ayri tablo (birden coka)
CREATE TABLE student_phones (
    phone_id INTEGER PRIMARY KEY,
    student_id INTEGER NOT NULL,
    phone_number VARCHAR(20) NOT NULL,
    phone_type VARCHAR(20) DEFAULT 'mobile',
    FOREIGN KEY (student_id) REFERENCES students(student_id)
);</code></pre>
                        </div>

                        <p><strong>Normallestirilmis Veriler:</strong></p>
                        <table class="dataset-table">
                            <tr>
                                <th colspan="2">students</th>
                            </tr>
                            <tr>
                                <th>student_id</th>
                                <th>name</th>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>John Smith</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>Jane Doe</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>Bob Wilson</td>
                            </tr>
                        </table>

                        <table class="dataset-table" style="margin-top: 10px;">
                            <tr>
                                <th colspan="3">student_phones</th>
                            </tr>
                            <tr>
                                <th>phone_id</th>
                                <th>student_id</th>
                                <th>phone_number</th>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>1</td>
                                <td>555-1234</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>1</td>
                                <td>555-5678</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>2</td>
                                <td>555-9999</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>3</td>
                                <td>555-1111</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>3</td>
                                <td>555-2222</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>3</td>
                                <td>555-3333</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 1.2: Ikinci Normal Form (2NF) Ihlalleri</h4>
                    <p>Bilesik birincil anahtari olan bu tabloyu inceleyin:</p>

                    <div class="bad-design">
                        <strong>order_items Tablosu (PK: order_id, product_id)</strong>
                        <table class="dataset-table">
                            <thead>
                                <tr>
                                    <th>order_id <span class="key-type key-pk">PK</span></th>
                                    <th>product_id <span class="key-type key-pk">PK</span></th>
                                    <th>quantity</th>
                                    <th>product_name</th>
                                    <th>product_price</th>
                                    <th>order_date</th>
                                    <th>customer_name</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>101</td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>Laptop</td>
                                    <td>999.99</td>
                                    <td>2024-03-15</td>
                                    <td>John Smith</td>
                                </tr>
                                <tr>
                                    <td>101</td>
                                    <td>2</td>
                                    <td>1</td>
                                    <td>Mouse</td>
                                    <td>29.99</td>
                                    <td>2024-03-15</td>
                                    <td>John Smith</td>
                                </tr>
                                <tr>
                                    <td>102</td>
                                    <td>1</td>
                                    <td>1</td>
                                    <td>Laptop</td>
                                    <td>999.99</td>
                                    <td>2024-03-16</td>
                                    <td>Jane Doe</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="anomaly-box">
                        <strong>Bu tasarimdaki sorunlar:</strong>
                        <ul>
                            <li><strong>Guncelleme Anomalisi:</strong> Laptop fiyati degisirse, birden fazla satiri guncellemeniz gerekir</li>
                            <li><strong>Fazlalik:</strong> Urun adi ve fiyati her siparis icin tekrarlanir</li>
                            <li><strong>Kismi Bagimlilik:</strong> product_name sadece product_id'ye bagimli, tam anahtara degil</li>
                        </ul>
                    </div>

                    <p><strong>Gorev:</strong> Bu tabloyu 2NF'ye normalestirin.</p>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_2')">Cozumu Goster</button>
                    <div id="solution1_2" class="solution-box">
                        <p><strong>Analiz:</strong></p>
                        <ul>
                            <li><code>product_name</code>, <code>product_price</code> sadece <code>product_id</code>'ye bagimli (kismi bagimlilik)</li>
                            <li><code>order_date</code>, <code>customer_name</code> sadece <code>order_id</code>'ye bagimli (kismi bagimlilik)</li>
                            <li><code>quantity</code> tam bilesik anahtara bagimli (order_id, product_id)</li>
                        </ul>

                        <div class="good-design">
                            <strong>2NF'ye Normallestirildi:</strong>
                            <pre><code class="language-sql">-- Urunler tablosu (urun ozellikleri)
CREATE TABLE products (
    product_id INTEGER PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    product_price DECIMAL(10, 2) NOT NULL
);

-- Siparisler tablosu (siparis ozellikleri)
CREATE TABLE orders (
    order_id INTEGER PRIMARY KEY,
    order_date DATE NOT NULL,
    customer_name VARCHAR(100) NOT NULL
);

-- Siparis kalemleri (sadece tam bilesik anahtara bagli ozellikler)
CREATE TABLE order_items (
    order_id INTEGER,
    product_id INTEGER,
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    PRIMARY KEY (order_id, product_id),
    FOREIGN KEY (order_id) REFERENCES orders(order_id),
    FOREIGN KEY (product_id) REFERENCES products(product_id)
);</code></pre>
                        </div>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 1.3: Ucuncu Normal Form (3NF) Ihlalleri</h4>
                    <p>Gecisli bagimliliklar icin bu tabloyu inceleyin:</p>

                    <div class="bad-design">
                        <strong>employees Tablosu</strong>
                        <table class="dataset-table">
                            <thead>
                                <tr>
                                    <th>emp_id <span class="key-type key-pk">PK</span></th>
                                    <th>emp_name</th>
                                    <th>dept_id</th>
                                    <th>dept_name</th>
                                    <th>dept_location</th>
                                    <th>dept_manager</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>Alice</td>
                                    <td>10</td>
                                    <td>Engineering</td>
                                    <td>Building A</td>
                                    <td>Bob</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>Charlie</td>
                                    <td>10</td>
                                    <td>Engineering</td>
                                    <td>Building A</td>
                                    <td>Bob</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>Diana</td>
                                    <td>20</td>
                                    <td>Marketing</td>
                                    <td>Building B</td>
                                    <td>Eve</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <p><strong>Gorev:</strong> Gecisli bagimliligi tespit edin ve 3NF'ye normalestirin.</p>

                    <div class="hint-box">
                        Birincil anahtara degil, diger anahtar olmayan sutunlara bagli olan anahtar olmayan sutunlari arayin.
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('solution1_3')">Cozumu Goster</button>
                    <div id="solution1_3" class="solution-box">
                        <p><strong>Bulunan Gecisli Bagimliliklar:</strong></p>
                        <ul>
                            <li><code>dept_name</code>, <code>dept_id</code>'ye bagimli (dogrudan <code>emp_id</code>'ye degil)</li>
                            <li><code>dept_location</code>, <code>dept_id</code>'ye bagimli</li>
                            <li><code>dept_manager</code>, <code>dept_id</code>'ye bagimli</li>
                        </ul>
                        <p>Zincir: emp_id → dept_id → dept_name/dept_location/dept_manager</p>

                        <div class="good-design">
                            <strong>3NF'ye Normallestirildi:</strong>
                            <pre><code class="language-sql">-- Departmanlar tablosu
CREATE TABLE departments (
    dept_id INTEGER PRIMARY KEY,
    dept_name VARCHAR(100) NOT NULL,
    dept_location VARCHAR(100),
    dept_manager VARCHAR(100)
);

-- Calisanlar tablosu (sadece dogrudan bagimliliklar)
CREATE TABLE employees (
    emp_id INTEGER PRIMARY KEY,
    emp_name VARCHAR(100) NOT NULL,
    dept_id INTEGER,
    FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
);</code></pre>
                        </div>

                        <p><strong>Faydalar:</strong></p>
                        <ul>
                            <li>Departman bilgisi bir kez saklanir, her calisan icin tekrarlanmaz</li>
                            <li>Departman konumu guncellemek sadece bir satir degistirir</li>
                            <li>Tutarsiz departman verisi riski yok</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Alistirma 2: Varlik-Iliski Modelleme -->
            <section>
                <h2 id="exercise-2">Alistirma 2: Varlik-Iliski Modelleme</h2>
                <p>Gercek dunya senaryolari icin varliklari, iliskileri ve kardinaliteyi tespit etme pratiği yapin.</p>

                <div class="concept-box">
                    Kardinalite, bir varligin kac orneginin bir baska varlikla iliskili oldugunu tanimlar:
                    <strong>1:1</strong> (bire-bir), <strong>1:N</strong> (birden-coka), <strong>M:N</strong> (coktan-coka).
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 2.1: Kutuphane Yonetim Sistemi</h4>
                    <p>Su gereksinimlere sahip bir kutuphane icin ER modeli tasarlayin:</p>
                    <ul>
                        <li>Kutuphanede baslik, ISBN, yayin yili ve tur bilgilerine sahip kitaplar vardir</li>
                        <li>Her kitabin bir veya daha fazla yazari olabilir</li>
                        <li>Yazarlarin adi, dogum tarihi ve uyruklari vardir</li>
                        <li>Uyeler kitap odunc alabilir</li>
                        <li>Kitaplarin ne zaman odunc alindigi ve iade edildigi takip edilir</li>
                        <li>Her kitap kopyasi ayni anda bir uye tarafindan odunc alinabilir</li>
                    </ul>

                    <p><strong>Gorevler:</strong></p>
                    <ol>
                        <li>Varliklari tespit edin</li>
                        <li>Her iliskinin kardinalitesini belirleyin</li>
                        <li>CREATE TABLE ifadelerini yazin</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_1')">Cozumu Goster</button>
                    <div id="solution2_1" class="solution-box">
                        <p><strong>Tespit Edilen Varliklar:</strong></p>
                        <ul>
                            <li><strong>Books</strong> - kitap basliklarini temsil eder</li>
                            <li><strong>Authors</strong> - kitap yazarlarini temsil eder</li>
                            <li><strong>Members</strong> - kitap odunc alan kutuphane uyeleri</li>
                            <li><strong>BookCopies</strong> - kitaplarin fiziksel kopyalari (bir kitabin birden fazla kopyasi olabilir)</li>
                            <li><strong>Loans</strong> - odunc alma islemleri</li>
                        </ul>

                        <div class="cardinality-box">
                            <strong>Iliskiler:</strong>
                            <ul>
                                <li>Book ↔ Author: <strong>M:N</strong> (bir kitabin birden fazla yazari olabilir, bir yazar birden fazla kitap yazabilir)</li>
                                <li>Book ↔ BookCopy: <strong>1:N</strong> (bir kitabin birden fazla kopyasi olabilir)</li>
                                <li>Member ↔ Loan: <strong>1:N</strong> (bir uyenin birden fazla odunc almasi olabilir)</li>
                                <li>BookCopy ↔ Loan: <strong>1:N</strong> (bir kopya birden fazla kez odunc alinabilir, ama ayni anda sadece bir odunc)</li>
                            </ul>
                        </div>

                        <div class="er-diagram">
+------------+       +---------------+       +-----------+
|   Authors  |       |  book_authors |       |   Books   |
+------------+       +---------------+       +-----------+
| author_id  |←----->| author_id     |       | book_id   |
| name       |       | book_id       |←----->| title     |
| birth_date |       +---------------+       | isbn      |
| nationality|           M:N                 | pub_year  |
+------------+                               | genre     |
                                             +-----------+
                                                   |
                                                   | 1:N
                                                   ↓
+-----------+       +-----------+       +-------------+
|  Members  |       |   Loans   |       | BookCopies  |
+-----------+       +-----------+       +-------------+
| member_id |←----->| loan_id   |←----->| copy_id     |
| name      |  1:N  | member_id |  1:N  | book_id     |
| email     |       | copy_id   |       | condition   |
| join_date |       | borrow_dt |       | location    |
+-----------+       | return_dt |       +-------------+
                    +-----------+
                        </div>

                        <pre><code class="language-sql">-- Yazarlar
CREATE TABLE authors (
    author_id INTEGER PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    birth_date DATE,
    nationality VARCHAR(100)
);

-- Kitaplar
CREATE TABLE books (
    book_id INTEGER PRIMARY KEY,
    title VARCHAR(300) NOT NULL,
    isbn CHAR(13) UNIQUE,
    publication_year INTEGER,
    genre VARCHAR(50)
);

-- Kitap-Yazar baglanti tablosu (M:N)
CREATE TABLE book_authors (
    book_id INTEGER,
    author_id INTEGER,
    PRIMARY KEY (book_id, author_id),
    FOREIGN KEY (book_id) REFERENCES books(book_id),
    FOREIGN KEY (author_id) REFERENCES authors(author_id)
);

-- Kitap kopyalari (fiziksel kopyalar)
CREATE TABLE book_copies (
    copy_id INTEGER PRIMARY KEY,
    book_id INTEGER NOT NULL,
    condition VARCHAR(20) DEFAULT 'good',
    shelf_location VARCHAR(20),
    FOREIGN KEY (book_id) REFERENCES books(book_id)
);

-- Uyeler
CREATE TABLE members (
    member_id INTEGER PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    join_date DATE DEFAULT CURRENT_DATE
);

-- Odunc Almalar
CREATE TABLE loans (
    loan_id INTEGER PRIMARY KEY,
    member_id INTEGER NOT NULL,
    copy_id INTEGER NOT NULL,
    borrow_date DATE NOT NULL DEFAULT CURRENT_DATE,
    due_date DATE NOT NULL,
    return_date DATE,
    FOREIGN KEY (member_id) REFERENCES members(member_id),
    FOREIGN KEY (copy_id) REFERENCES book_copies(copy_id)
);</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 2.2: Kardinaliteyi Belirleme</h4>
                    <p>Her varlik cifti icin kardinaliteyi belirleyin (1:1, 1:N veya M:N):</p>

                    <table class="dataset-table">
                        <thead>
                            <tr>
                                <th>Varlik A</th>
                                <th>Iliski</th>
                                <th>Varlik B</th>
                                <th>Cevabiniz</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Ulke</td>
                                <td>sahiptir</td>
                                <td>Baskent</td>
                                <td>?</td>
                            </tr>
                            <tr>
                                <td>Doktor</td>
                                <td>tedavi eder</td>
                                <td>Hasta</td>
                                <td>?</td>
                            </tr>
                            <tr>
                                <td>Departman</td>
                                <td>calistirir</td>
                                <td>Calisan</td>
                                <td>?</td>
                            </tr>
                            <tr>
                                <td>Ogrenci</td>
                                <td>kayit olur</td>
                                <td>Ders</td>
                                <td>?</td>
                            </tr>
                            <tr>
                                <td>Kisi</td>
                                <td>sahiptir</td>
                                <td>Pasaport</td>
                                <td>?</td>
                            </tr>
                            <tr>
                                <td>Siparis</td>
                                <td>icerir</td>
                                <td>Urun</td>
                                <td>?</td>
                            </tr>
                        </tbody>
                    </table>

                    <button class="toggle-btn" onclick="toggleSolution('solution2_2')">Cozumu Goster</button>
                    <div id="solution2_2" class="solution-box">
                        <table class="dataset-table">
                            <thead>
                                <tr>
                                    <th>Varlik A</th>
                                    <th>Iliski</th>
                                    <th>Varlik B</th>
                                    <th>Kardinalite</th>
                                    <th>Aciklama</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Ulke</td>
                                    <td>sahiptir</td>
                                    <td>Baskent</td>
                                    <td><strong>1:1</strong></td>
                                    <td>Her ulkenin tam olarak bir baskenti vardir; her baskent bir ulkeye aittir</td>
                                </tr>
                                <tr>
                                    <td>Doktor</td>
                                    <td>tedavi eder</td>
                                    <td>Hasta</td>
                                    <td><strong>M:N</strong></td>
                                    <td>Bir doktor bircok hastayi tedavi eder; bir hasta birden fazla doktora gidebilir</td>
                                </tr>
                                <tr>
                                    <td>Departman</td>
                                    <td>calistirir</td>
                                    <td>Calisan</td>
                                    <td><strong>1:N</strong></td>
                                    <td>Bir departmanin bircok calisani vardir; bir calisan bir departmana aittir</td>
                                </tr>
                                <tr>
                                    <td>Ogrenci</td>
                                    <td>kayit olur</td>
                                    <td>Ders</td>
                                    <td><strong>M:N</strong></td>
                                    <td>Bir ogrenci bircok ders alir; bir dersin bircok ogrencisi vardir</td>
                                </tr>
                                <tr>
                                    <td>Kisi</td>
                                    <td>sahiptir</td>
                                    <td>Pasaport</td>
                                    <td><strong>1:1</strong></td>
                                    <td>Bir kisinin bir pasaportu vardir; bir pasaport bir kisiye aittir</td>
                                </tr>
                                <tr>
                                    <td>Siparis</td>
                                    <td>icerir</td>
                                    <td>Urun</td>
                                    <td><strong>M:N</strong></td>
                                    <td>Bir siparis bircok urun icerebilir; bir urun bircok sipariste olabilir</td>
                                </tr>
                            </tbody>
                        </table>

                        <p><strong>Uygulama Notlari:</strong></p>
                        <ul>
                            <li><strong>1:1</strong>: Her iki tabloda FK veya tablolari birlestirme</li>
                            <li><strong>1:N</strong>: "Cok" tarafindaki tabloda FK</li>
                            <li><strong>M:N</strong>: Her iki tabloya FK'lari olan baglanti tablosu gerektirir</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Alistirma 3: Birincil ve Yabanci Anahtarlar -->
            <section>
                <h2 id="exercise-3">Alistirma 3: Anahtarlari Uygulama</h2>
                <p>Uygun anahtar turlerini secme ve referans butunlugunu uygulama pratiği yapin.</p>

                <div class="concept-box">
                    <strong>Vekil anahtarlar</strong> (otomatik olusturulan ID'ler) genellikle kararlilik ve basitlik icin
                    <strong>dogal anahtarlardan</strong> (is degerleri) tercih edilir.
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 3.1: Dogal vs Vekil Anahtarlar</h4>
                    <p>Her tablo icin dogal anahtar mi yoksa vekil anahtar mi kullanacaginiza karar verin ve nedenini aciklayin:</p>

                    <ol>
                        <li><strong>Countries tablosu</strong> - ulke kodu (US, UK, TR) ve ulke adi ile</li>
                        <li><strong>Users tablosu</strong> - e-posta, kullanici adi, sifre ile</li>
                        <li><strong>Products tablosu</strong> - SKU, ad, fiyat ile</li>
                        <li><strong>Log entries tablosu</strong> - zaman damgasi, olay_tipi, mesaj ile</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_1')">Cozumu Goster</button>
                    <div id="solution3_1" class="solution-box">
                        <pre><code class="language-sql">-- 1. Countries - Dogal Anahtar (ulke kodu kararli ve standart)
CREATE TABLE countries (
    country_code CHAR(2) PRIMARY KEY,  -- ISO standardi, asla degismez
    country_name VARCHAR(100) NOT NULL UNIQUE
);

-- 2. Users - Vekil Anahtar (e-posta degisebilir)
CREATE TABLE users (
    user_id INTEGER PRIMARY KEY,  -- Vekil anahtar
    email VARCHAR(255) NOT NULL UNIQUE,  -- Dogal anahtar adayi, ama degisebilir
    username VARCHAR(50) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL
);
-- Sebep: E-postalar degisebilir; vekil anahtar kullanmak FK'larin guncellenmesine gerek kalmamasini saglar

-- 3. Products - UNIQUE olarak Dogal Anahtar ile Vekil Anahtar
CREATE TABLE products (
    product_id INTEGER PRIMARY KEY,  -- FK'lar icin vekil anahtar
    sku VARCHAR(50) NOT NULL UNIQUE,  -- Dogal anahtar, ama yeniden formatlanabilir
    name VARCHAR(200) NOT NULL,
    price DECIMAL(10, 2) NOT NULL
);
-- Sebep: SKU'lar yeniden formatlanabilir veya satinalmalarda birlesebilir

-- 4. Log entries - Vekil Anahtar (dogal benzersiz tanimlayici yok)
CREATE TABLE log_entries (
    log_id BIGINT PRIMARY KEY,  -- Vekil anahtar (yuksek hacim icin BIGINT)
    timestamp TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    event_type VARCHAR(50) NOT NULL,
    message TEXT
);
-- Sebep: Ayni zaman damgasinda birden fazla log olabilir; dogal anahtar mevcut degil</code></pre>

                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>Tablo</th>
                                    <th>Anahtar Tipi</th>
                                    <th>Gerekce</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Countries</td>
                                    <td>Dogal (country_code)</td>
                                    <td>ISO kodlari kararli, evrensel olarak bilinen ve nadiren degisir</td>
                                </tr>
                                <tr>
                                    <td>Users</td>
                                    <td>Vekil (user_id)</td>
                                    <td>E-postalar degisebilir; vekil anahtar kararlilik saglar</td>
                                </tr>
                                <tr>
                                    <td>Products</td>
                                    <td>Vekil (product_id)</td>
                                    <td>SKU'lar yeniden formatlanabilir; is mantigi dahili ID'lere bagimli olmamali</td>
                                </tr>
                                <tr>
                                    <td>Log entries</td>
                                    <td>Vekil (log_id)</td>
                                    <td>Dogal benzersiz tanimlayici yok; zaman damgalari benzersiz degil</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 3.2: Referans Eylemleri</h4>
                    <p>Bu tablolar verildiginde, her yabanci anahtar icin uygun referans eylemini secin:</p>

                    <pre><code class="language-sql">-- Senaryo: E-ticaret sistemi

-- Musterilerin siparisleri olabilir
-- Siparislerin siparis kalemleri vardir
-- Urunler kategorilerde bulunur
-- Urunler siparis kalemlerinde gorunur</code></pre>

                    <p><strong>Her iliski icin karar verin:</strong></p>
                    <ol>
                        <li>Bir Musteri silindigi zaman, Siparislerine ne olmali?</li>
                        <li>Bir Siparis silindigi zaman, SiparisKalemlerine ne olmali?</li>
                        <li>Bir Kategori silindigi zaman, Urunlerine ne olmali?</li>
                        <li>Bir Urun silindigi zaman, ona referans veren SiparisKalemlerine ne olmali?</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution3_2')">Cozumu Goster</button>
                    <div id="solution3_2" class="solution-box">
                        <pre><code class="language-sql">-- Musteriler tablosu
CREATE TABLE customers (
    customer_id INTEGER PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL
);

-- Kategoriler tablosu
CREATE TABLE categories (
    category_id INTEGER PRIMARY KEY,
    category_name VARCHAR(100) NOT NULL
);

-- Urunler tablosu
CREATE TABLE products (
    product_id INTEGER PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    category_id INTEGER,
    -- Kategori silindigi zaman, urunun kategorisini NULL yap
    FOREIGN KEY (category_id) REFERENCES categories(category_id)
        ON DELETE SET NULL
        ON UPDATE CASCADE
);

-- Siparisler tablosu
CREATE TABLE orders (
    order_id INTEGER PRIMARY KEY,
    customer_id INTEGER,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    -- Musteri silindigi zaman, siparisi sakla ama customer_id'yi NULL yap
    -- VEYA siparisler musterisiz olmamali ise RESTRICT kullan
    FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
        ON DELETE SET NULL
        ON UPDATE CASCADE
);

-- Siparis kalemleri tablosu
CREATE TABLE order_items (
    order_item_id INTEGER PRIMARY KEY,
    order_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL,
    unit_price DECIMAL(10, 2) NOT NULL,  -- Siparis anindaki fiyati sakla!
    -- Siparis silindigi zaman, kalemlerini de sil
    FOREIGN KEY (order_id) REFERENCES orders(order_id)
        ON DELETE CASCADE,
    -- Urun silindigi zaman, RESTRICT (siparislerde varsa izin verme)
    FOREIGN KEY (product_id) REFERENCES products(product_id)
        ON DELETE RESTRICT
);</code></pre>

                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>Iliski</th>
                                    <th>Eylem</th>
                                    <th>Gerekce</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Customer → Orders</td>
                                    <td>SET NULL</td>
                                    <td>Muhasebe icin siparis gecmisini sakla; yetim siparisler kabul edilebilir</td>
                                </tr>
                                <tr>
                                    <td>Order → OrderItems</td>
                                    <td>CASCADE</td>
                                    <td>Siparis kalemleri siparisleri olmadan anlamsiz; birlikte sil</td>
                                </tr>
                                <tr>
                                    <td>Category → Products</td>
                                    <td>SET NULL</td>
                                    <td>Urunler kategori olmadan var olabilir; "kategorisiz" olmalarina izin ver</td>
                                </tr>
                                <tr>
                                    <td>Product → OrderItems</td>
                                    <td>RESTRICT</td>
                                    <td>Siparis edilmis urunlerin silinmesine izin verme; tarihsel butunluk</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="warning-box">
                            order_items'da <code>unit_price</code> sakladigimiza dikkat edin. Bu, urun fiyatlari degisebilecegi icin
                            siparis anindaki fiyati korumak icin kasitli bir denormalizasyondur.
                        </div>
                    </div>
                </div>
            </section>

            <!-- Alistirma 4: Kisitlamalar -->
            <section>
                <h2 id="exercise-4">Alistirma 4: Kisitlamalari Uygulama</h2>
                <p>Veritabani duzeyinde is kurallarini uygulamak icin kisitlamalar yazma pratiği yapin.</p>

                <div class="exercise-box">
                    <h4>Alistirma 4.1: Kisitlamalar Yazma</h4>
                    <p>Bu is kurallari icin uygun kisitlamalarla tablolar olusturun:</p>

                    <ol>
                        <li><strong>Employees tablosu:</strong>
                            <ul>
                                <li>Calisan ID gerekli ve benzersiz</li>
                                <li>E-posta benzersiz ve gecerli formatta olmali</li>
                                <li>Maas pozitif olmali</li>
                                <li>Ise alma tarihi gelecekte olamaz</li>
                                <li>Durum 'active', 'inactive' veya 'terminated' olmali</li>
                            </ul>
                        </li>
                        <li><strong>Products tablosu:</strong>
                            <ul>
                                <li>Fiyat negatif olmayan olmali</li>
                                <li>Indirim yuzdesi 0 ile 100 arasinda olmali</li>
                                <li>Stok miktari negatif olamaz</li>
                                <li>Urun adi en az 3 karakter olmali</li>
                            </ul>
                        </li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_1')">Cozumu Goster</button>
                    <div id="solution4_1" class="solution-box">
                        <pre><code class="language-sql">-- 1. Kisitlamalarla Employees tablosu
CREATE TABLE employees (
    employee_id INTEGER PRIMARY KEY,

    -- E-posta: benzersiz, bos olamaz, temel format kontrolu
    email VARCHAR(255) NOT NULL UNIQUE
        CONSTRAINT chk_email_format CHECK (email LIKE '%_@_%.__%'),

    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,

    -- Maas: pozitif olmali
    salary DECIMAL(12, 2) NOT NULL
        CONSTRAINT chk_salary_positive CHECK (salary > 0),

    -- Ise alma tarihi: gelecekte olamaz
    hire_date DATE NOT NULL
        CONSTRAINT chk_hire_date CHECK (hire_date <= CURRENT_DATE),

    -- Durum: belirli degerlerle sinirli
    status VARCHAR(20) NOT NULL DEFAULT 'active'
        CONSTRAINT chk_status CHECK (status IN ('active', 'inactive', 'terminated'))
);

-- 2. Kisitlamalarla Products tablosu
CREATE TABLE products (
    product_id INTEGER PRIMARY KEY,

    -- Urun adi: minimum uzunluk
    product_name VARCHAR(200) NOT NULL
        CONSTRAINT chk_name_length CHECK (LENGTH(product_name) >= 3),

    -- Fiyat: negatif olmayan
    price DECIMAL(10, 2) NOT NULL
        CONSTRAINT chk_price_non_negative CHECK (price >= 0),

    -- Indirim: 0 ile 100 arasinda
    discount_percent DECIMAL(5, 2) DEFAULT 0
        CONSTRAINT chk_discount_range CHECK (discount_percent >= 0 AND discount_percent <= 100),

    -- Stok: negatif olmayan
    stock_quantity INTEGER NOT NULL DEFAULT 0
        CONSTRAINT chk_stock_non_negative CHECK (stock_quantity >= 0),

    -- Hesaplanan efektif fiyat negatif olmayan olmali
    CONSTRAINT chk_effective_price CHECK (price * (1 - discount_percent/100) >= 0)
);</code></pre>

                        <p><strong>Kisitlamalari Test Etme:</strong></p>
                        <pre><code class="language-sql">-- Bunlar BASARISIZ olmali:
INSERT INTO employees (employee_id, email, first_name, last_name, salary, hire_date, status)
VALUES (1, 'invalid-email', 'John', 'Doe', 50000, '2024-01-01', 'active');
-- Hata: e-posta format kontrolu basarisiz

INSERT INTO employees (employee_id, email, first_name, last_name, salary, hire_date, status)
VALUES (1, 'john@example.com', 'John', 'Doe', -1000, '2024-01-01', 'active');
-- Hata: maas pozitif olmali

INSERT INTO products (product_id, product_name, price, discount_percent, stock_quantity)
VALUES (1, 'AB', 99.99, 0, 100);
-- Hata: urun adi cok kisa (< 3 karakter)

INSERT INTO products (product_id, product_name, price, discount_percent, stock_quantity)
VALUES (1, 'Widget', 99.99, 150, 100);
-- Hata: indirim > 100</code></pre>
                    </div>
                </div>

                <div class="exercise-box">
                    <h4>Alistirma 4.2: Cok Sutunlu Kisitlamalar</h4>
                    <p>Birden fazla sutun iceren kisitlamalar yazin:</p>

                    <ol>
                        <li><strong>Events tablosu:</strong> end_date, start_date'den sonra olmali</li>
                        <li><strong>Price history:</strong> Ayni urun icin cakisan tarih araliklari olmamali</li>
                        <li><strong>Appointments:</strong> Doktor, tarih ve zaman diliminin benzersiz kombinasyonu</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('solution4_2')">Cozumu Goster</button>
                    <div id="solution4_2" class="solution-box">
                        <pre><code class="language-sql">-- 1. Events: bitis baslangictan sonra olmali
CREATE TABLE events (
    event_id INTEGER PRIMARY KEY,
    event_name VARCHAR(200) NOT NULL,
    start_date TIMESTAMP NOT NULL,
    end_date TIMESTAMP NOT NULL,

    -- Cok sutunlu kisitlama
    CONSTRAINT chk_dates_valid CHECK (end_date > start_date)
);

-- 2. Cakismayan aralikli fiyat gecmisi
-- Not: Gercek cakisma onleme genellikle trigger veya disla kisitlamalari gerektirir
CREATE TABLE price_history (
    price_id INTEGER PRIMARY KEY,
    product_id INTEGER NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    effective_from DATE NOT NULL,
    effective_to DATE,  -- NULL suanki/devam eden anlamina gelir

    FOREIGN KEY (product_id) REFERENCES products(product_id),

    -- Temel kontrol: baslangic bitis tarihinden once olmali
    CONSTRAINT chk_date_range CHECK (
        effective_to IS NULL OR effective_from < effective_to
    )
);

-- PostgreSQL: Gercek cakisma onleme icin disla kisitlamasi kullanin
-- CREATE TABLE price_history (
--     ...
--     EXCLUDE USING gist (
--         product_id WITH =,
--         daterange(effective_from, effective_to, '[]') WITH &&
--     )
-- );

-- 3. Appointments: benzersiz doktor + tarih + zaman dilimi
CREATE TABLE appointments (
    appointment_id INTEGER PRIMARY KEY,
    doctor_id INTEGER NOT NULL,
    patient_id INTEGER NOT NULL,
    appointment_date DATE NOT NULL,
    time_slot VARCHAR(20) NOT NULL,  -- orn., '09:00-09:30'

    FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id),
    FOREIGN KEY (patient_id) REFERENCES patients(patient_id),

    -- Bilesik benzersiz kisitlama
    CONSTRAINT uk_doctor_schedule UNIQUE (doctor_id, appointment_date, time_slot)
);</code></pre>
                    </div>
                </div>
            </section>

            <!-- Meydan Okuma Alistirmalari -->
            <section>
                <h2 id="challenge-exercises">Meydan Okuma Alistirmalari</h2>
                <p>Tam veritabani semalari tasarlamak icin tum kavramlari uygulayin.</p>

                <div class="challenge-box">
                    <h4>Meydan Okuma 1: Otel Rezervasyon Sistemi</h4>
                    <p>Su gereksinimlere sahip bir otel rezervasyon sistemi icin veritabani semasi tasarlayin:</p>
                    <ul>
                        <li>Otellerin farkli tiplerde (single, double, suit) birden fazla odasi vardir</li>
                        <li>Her oda tipinin gecelik bir taban fiyati vardir</li>
                        <li>Misafirler belirli odalar icin rezervasyon yapabilir</li>
                        <li>Rezervasyonlarin giris ve cikis tarihleri vardir</li>
                        <li>Odeme durumunu takip edin (beklemede, odendi, iade edildi)</li>
                        <li>Bir oda cakisan tarihler icin cifte rezerve edilemez</li>
                    </ul>

                    <p><strong>Ciktilar:</strong></p>
                    <ol>
                        <li>Varliklari ve iliskileri tespit edin</li>
                        <li>Kardinaliteyi belirleyin</li>
                        <li>Tum kisitlamalarla normallestirilmis CREATE TABLE ifadeleri yazin</li>
                    </ol>

                    <button class="toggle-btn" onclick="toggleSolution('challenge1')">Cozumu Goster</button>
                    <div id="challenge1" class="solution-box">
                        <div class="er-diagram">
+----------+       +------------+       +---------+
|  Hotels  |------>| Room Types |       |  Rooms  |
+----------+  1:N  +------------+  1:N  +---------+
| hotel_id |       | type_id    |<------| room_id |
| name     |       | hotel_id   |       | type_id |
| address  |       | name       |       | number  |
| stars    |       | base_price |       | floor   |
+----------+       +------------+       +---------+
                                              |
                                              | 1:N
                                              ↓
+---------+       +--------------+
|  Guests |------>| Reservations |
+---------+  1:N  +--------------+
| guest_id|       | reservation_id|
| name    |       | guest_id     |
| email   |       | room_id      |
| phone   |       | check_in     |
+---------+       | check_out    |
                  | status       |
                  | total_price  |
                  +--------------+
                        </div>

                        <pre><code class="language-sql">-- Oteller
CREATE TABLE hotels (
    hotel_id INTEGER PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    address TEXT NOT NULL,
    city VARCHAR(100) NOT NULL,
    country VARCHAR(100) NOT NULL,
    stars INTEGER CHECK (stars BETWEEN 1 AND 5),
    phone VARCHAR(20),
    email VARCHAR(255)
);

-- Oda tipleri (otel basina, fiyatlar farkli olabilecegi icin)
CREATE TABLE room_types (
    type_id INTEGER PRIMARY KEY,
    hotel_id INTEGER NOT NULL,
    type_name VARCHAR(50) NOT NULL,  -- 'single', 'double', 'suite'
    description TEXT,
    base_price_per_night DECIMAL(10, 2) NOT NULL CHECK (base_price_per_night > 0),
    max_occupancy INTEGER NOT NULL CHECK (max_occupancy > 0),

    FOREIGN KEY (hotel_id) REFERENCES hotels(hotel_id) ON DELETE CASCADE,
    UNIQUE (hotel_id, type_name)
);

-- Bireysel odalar
CREATE TABLE rooms (
    room_id INTEGER PRIMARY KEY,
    type_id INTEGER NOT NULL,
    room_number VARCHAR(10) NOT NULL,
    floor INTEGER,
    is_available BOOLEAN DEFAULT TRUE,
    notes TEXT,

    FOREIGN KEY (type_id) REFERENCES room_types(type_id) ON DELETE RESTRICT,
    -- Oda numarasi kendi oteli icerisinde benzersiz (type_id iliskisi araciligiyla)
    UNIQUE (type_id, room_number)
);

-- Misafirler
CREATE TABLE guests (
    guest_id INTEGER PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    phone VARCHAR(20),
    id_document_type VARCHAR(20),
    id_document_number VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Rezervasyonlar
CREATE TABLE reservations (
    reservation_id INTEGER PRIMARY KEY,
    guest_id INTEGER NOT NULL,
    room_id INTEGER NOT NULL,
    check_in_date DATE NOT NULL,
    check_out_date DATE NOT NULL,
    num_guests INTEGER NOT NULL DEFAULT 1,
    total_price DECIMAL(12, 2) NOT NULL,
    payment_status VARCHAR(20) NOT NULL DEFAULT 'pending'
        CHECK (payment_status IN ('pending', 'paid', 'partially_paid', 'refunded', 'cancelled')),
    booking_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    special_requests TEXT,

    FOREIGN KEY (guest_id) REFERENCES guests(guest_id),
    FOREIGN KEY (room_id) REFERENCES rooms(room_id),

    -- Cikis giris tarihinden sonra olmali
    CONSTRAINT chk_dates CHECK (check_out_date > check_in_date),

    -- Giris tarihi gecmiste olamaz (yeni rezervasyonlar icin)
    CONSTRAINT chk_future_checkin CHECK (check_in_date >= CURRENT_DATE)
);

-- Cifte rezervasyonu onle (PostgreSQL disla kisitlamasi ile)
-- Diger veritabanlari icin, trigger kullanin
-- CREATE EXTENSION IF NOT EXISTS btree_gist;
-- ALTER TABLE reservations ADD CONSTRAINT no_overlap
--     EXCLUDE USING gist (
--         room_id WITH =,
--         daterange(check_in_date, check_out_date, '[)') WITH &&
--     )
--     WHERE (payment_status NOT IN ('cancelled', 'refunded'));

-- Musaitlik aramalari icin indeks
CREATE INDEX idx_reservations_room_dates
    ON reservations(room_id, check_in_date, check_out_date);</code></pre>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Meydan Okuma 2: Tasarim Sorunlarini Tespit Etme ve Duzeltme</h4>
                    <p>Bu tablonun birden fazla tasarim sorunu var. Tum sorunlari tespit edin ve normallestirilmis bir tasarim olusturun:</p>

                    <div class="bad-design">
                        <strong>invoices Tablosu</strong>
                        <table class="dataset-table">
                            <thead>
                                <tr>
                                    <th>invoice_num</th>
                                    <th>date</th>
                                    <th>customer_name</th>
                                    <th>customer_email</th>
                                    <th>customer_address</th>
                                    <th>items</th>
                                    <th>item_prices</th>
                                    <th>item_quantities</th>
                                    <th>total</th>
                                    <th>salesperson</th>
                                    <th>salesperson_phone</th>
                                    <th>commission_rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>INV-001</td>
                                    <td>2024-03-15</td>
                                    <td>John Smith</td>
                                    <td>john@email.com</td>
                                    <td>123 Main St</td>
                                    <td>Laptop, Mouse, Keyboard</td>
                                    <td>999.99, 29.99, 79.99</td>
                                    <td>1, 2, 1</td>
                                    <td>1139.96</td>
                                    <td>Alice Brown</td>
                                    <td>555-1234</td>
                                    <td>0.05</td>
                                </tr>
                                <tr>
                                    <td>INV-002</td>
                                    <td>2024-03-16</td>
                                    <td>John Smith</td>
                                    <td>john@email.com</td>
                                    <td>123 Main St</td>
                                    <td>Monitor</td>
                                    <td>399.99</td>
                                    <td>1</td>
                                    <td>399.99</td>
                                    <td>Alice Brown</td>
                                    <td>555-1234</td>
                                    <td>0.05</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <button class="toggle-btn" onclick="toggleSolution('challenge2')">Cozumu Goster</button>
                    <div id="challenge2" class="solution-box">
                        <p><strong>Tespit Edilen Sorunlar:</strong></p>
                        <ol>
                            <li><span class="nf-badge nf-1nf">1NF Ihlali</span>: items, item_prices, item_quantities virgul ayirmali degerler icerir</li>
                            <li><span class="nf-badge nf-2nf">2NF Ihlali</span>: Musteri verileri faturaya bagimli degil (kismi bagimlilik)</li>
                            <li><span class="nf-badge nf-3nf">3NF Ihlali</span>: salesperson_phone satici personele bagimli, faturaya degil</li>
                            <li><strong>Fazlalik</strong>: Musteri bilgisi tekrarlaniyor; satici personel bilgisi tekrarlaniyor</li>
                            <li><strong>Eksik kisitlamalar</strong>: Birincil anahtar tanimlanmamis; referans butunlugu yok</li>
                            <li><strong>Hesaplanan alan</strong>: total fazlalik olarak saklanmis (hesaplanabilir)</li>
                        </ol>

                        <div class="good-design">
                            <strong>Normallestirilmis Tasarim:</strong>
                            <pre><code class="language-sql">-- Musteriler (faturadan cikarildi)
CREATE TABLE customers (
    customer_id INTEGER PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    address TEXT
);

-- Urunler (kalemler icin)
CREATE TABLE products (
    product_id INTEGER PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    current_price DECIMAL(10, 2) NOT NULL CHECK (current_price >= 0)
);

-- Satis personeli
CREATE TABLE salespeople (
    salesperson_id INTEGER PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    phone VARCHAR(20),
    commission_rate DECIMAL(4, 3) NOT NULL CHECK (commission_rate BETWEEN 0 AND 1)
);

-- Faturalar (baslik)
CREATE TABLE invoices (
    invoice_id INTEGER PRIMARY KEY,
    invoice_number VARCHAR(20) UNIQUE NOT NULL,
    invoice_date DATE NOT NULL DEFAULT CURRENT_DATE,
    customer_id INTEGER NOT NULL,
    salesperson_id INTEGER NOT NULL,

    FOREIGN KEY (customer_id) REFERENCES customers(customer_id),
    FOREIGN KEY (salesperson_id) REFERENCES salespeople(salesperson_id)
);

-- Fatura kalemleri (satir ogeleri)
CREATE TABLE invoice_items (
    item_id INTEGER PRIMARY KEY,
    invoice_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_price DECIMAL(10, 2) NOT NULL,  -- Satis anindaki fiyat

    FOREIGN KEY (invoice_id) REFERENCES invoices(invoice_id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(product_id)
);

-- Fatura toplamlari icin gorunum (hesaplanan degeri saklamak yerine)
CREATE VIEW invoice_totals AS
SELECT
    i.invoice_id,
    i.invoice_number,
    i.invoice_date,
    c.name AS customer_name,
    s.name AS salesperson_name,
    SUM(ii.quantity * ii.unit_price) AS subtotal,
    SUM(ii.quantity * ii.unit_price) * s.commission_rate AS commission
FROM invoices i
JOIN customers c ON i.customer_id = c.customer_id
JOIN salespeople s ON i.salesperson_id = s.salesperson_id
JOIN invoice_items ii ON i.invoice_id = ii.invoice_id
GROUP BY i.invoice_id, i.invoice_number, i.invoice_date,
         c.name, s.name, s.commission_rate;</code></pre>
                        </div>
                    </div>
                </div>

                <div class="challenge-box">
                    <h4>Meydan Okuma 3: Ne Zaman Denormalize Edilir</h4>
                    <p>Tam normallestirilmis bir e-ticaret veritabaniniz var, ancak su sorgular yavas:</p>

                    <ol>
                        <li>Urun kategorisi basina toplam geliri gosteren kontrol paneli (her dakika calisir)</li>
                        <li>Her siparisla birlikte musteri adi ve adresini gosteren siparis gecmisi sayfasi</li>
                        <li>Ortalama derecelendirmeyi gosteren urun listesi (yorumlar tablosundan hesaplanan)</li>
                    </ol>

                    <p><strong>Gorev:</strong> Her senaryo icin denormalizasyon stratejileri onerin ve bunlari uygulamak icin DDL/DML yazin.</p>

                    <button class="toggle-btn" onclick="toggleSolution('challenge3')">Cozumu Goster</button>
                    <div id="challenge3" class="solution-box">
                        <pre><code class="language-sql">-- 1. Kategori geliri icin ozet tablo (gerceklestirilmis gorunum veya tablo)

-- Secenek A: Gerceklestirilmis Gorunum (PostgreSQL)
CREATE MATERIALIZED VIEW category_revenue_summary AS
SELECT
    c.category_id,
    c.category_name,
    DATE_TRUNC('day', o.order_date) AS date,
    SUM(oi.quantity * oi.unit_price) AS daily_revenue,
    COUNT(DISTINCT o.order_id) AS order_count
FROM categories c
JOIN products p ON c.category_id = p.category_id
JOIN order_items oi ON p.product_id = oi.product_id
JOIN orders o ON oi.order_id = o.order_id
GROUP BY c.category_id, c.category_name, DATE_TRUNC('day', o.order_date);

-- Periyodik olarak yenile
REFRESH MATERIALIZED VIEW category_revenue_summary;

-- Secenek B: Trigger guncellemeleri ile ozet tablo
CREATE TABLE category_daily_summary (
    category_id INTEGER,
    summary_date DATE,
    total_revenue DECIMAL(15, 2) DEFAULT 0,
    order_count INTEGER DEFAULT 0,
    PRIMARY KEY (category_id, summary_date),
    FOREIGN KEY (category_id) REFERENCES categories(category_id)
);


-- 2. Musteri bilgisini siparislere denormalize et

-- Siparisler tablosuna fazlalik sutunlari ekle
ALTER TABLE orders ADD COLUMN customer_name VARCHAR(200);
ALTER TABLE orders ADD COLUMN customer_email VARCHAR(255);
ALTER TABLE orders ADD COLUMN shipping_address TEXT;

-- Mevcut verilerden doldur
UPDATE orders o
SET
    customer_name = c.name,
    customer_email = c.email,
    shipping_address = c.address
FROM customers c
WHERE o.customer_id = c.customer_id;

-- Senkronize tutmak icin trigger olustur
CREATE OR REPLACE FUNCTION sync_order_customer()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        SELECT name, email, address
        INTO NEW.customer_name, NEW.customer_email, NEW.shipping_address
        FROM customers WHERE customer_id = NEW.customer_id;
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_sync_order_customer
    BEFORE INSERT ON orders
    FOR EACH ROW EXECUTE FUNCTION sync_order_customer();


-- 3. Urunlere onbelleklenmis ortalama derecelendirme ekle

ALTER TABLE products ADD COLUMN avg_rating DECIMAL(3, 2) DEFAULT 0;
ALTER TABLE products ADD COLUMN review_count INTEGER DEFAULT 0;

-- Mevcut yorumlardan guncelle
UPDATE products p
SET
    avg_rating = sub.avg_rating,
    review_count = sub.review_count
FROM (
    SELECT
        product_id,
        AVG(rating) AS avg_rating,
        COUNT(*) AS review_count
    FROM reviews
    GROUP BY product_id
) sub
WHERE p.product_id = sub.product_id;

-- Yeni yorumlarda guncellemek icin trigger
CREATE OR REPLACE FUNCTION update_product_rating()
RETURNS TRIGGER AS $$
BEGIN
    UPDATE products
    SET
        avg_rating = (SELECT AVG(rating) FROM reviews WHERE product_id = NEW.product_id),
        review_count = (SELECT COUNT(*) FROM reviews WHERE product_id = NEW.product_id)
    WHERE product_id = NEW.product_id;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_update_product_rating
    AFTER INSERT OR UPDATE OR DELETE ON reviews
    FOR EACH ROW EXECUTE FUNCTION update_product_rating();</code></pre>

                        <div class="warning-box">
                            Denormalizasyon Odulesmeleri:
                            <ul>
                                <li>Daha hizli okumalar ama daha karmasik yazmalar (tutarlilik saglanmali)</li>
                                <li>Triggerlar basarisiz olursa eski veri riski</li>
                                <li>Artan depolama gereksinimleri</li>
                                <li>Tum denormalizasyon kararlarini belgeleyin!</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Temel Cikarilar -->
            <section>
                <h2 id="key-takeaways">Temel Cikarilar</h2>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Kavram</th>
                            <th>En Iyi Uygulama</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Normalizasyon</td>
                            <td>3NF ile baslayin; sadece performans icin gerekli oldugu kanitlandiginda denormalize edin</td>
                        </tr>
                        <tr>
                            <td>1NF</td>
                            <td>Her hucre bir deger icerir; virgul ayirmali listeler yok</td>
                        </tr>
                        <tr>
                            <td>2NF</td>
                            <td>Bilesik anahtarlarda kismi bagimlilik yok</td>
                        </tr>
                        <tr>
                            <td>3NF</td>
                            <td>Gecisli bagimlilik yok (anahtar olmayan → anahtar olmayan)</td>
                        </tr>
                        <tr>
                            <td>Birincil Anahtarlar</td>
                            <td>Cogu tablo icin vekil anahtarlar tercih edin; kararli referans verileri icin dogal anahtarlar</td>
                        </tr>
                        <tr>
                            <td>Yabanci Anahtarlar</td>
                            <td>Her zaman FK kisitlamalarini tanimlayin; referans eylemlerini dikkatli secin</td>
                        </tr>
                        <tr>
                            <td>M:N Iliskileri</td>
                            <td>Bilesik PK'lar veya vekil PK ile baglanti tablolari kullanin</td>
                        </tr>
                        <tr>
                            <td>Kisitlamalar</td>
                            <td>Is kurallarini veritabani duzeyinde CHECK, UNIQUE, NOT NULL ile uygulayin</td>
                        </tr>
                        <tr>
                            <td>Denormalizasyon</td>
                            <td>Kararlari belgeleyin; tutarlilik saglamak icin trigger veya gerceklestirilmis gorunumler kullanin</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Navigasyon -->
            <section>
                <p><a href="01_database_design_principles_tr.html">&larr; Veritabani Tasarim Ilkeleri Dersine Don</a></p>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="../static/script.js"></script>

    <script>
        function toggleSolution(id) {
            var element = document.getElementById(id);
            if (element.classList.contains('show')) {
                element.classList.remove('show');
                event.target.textContent = 'Cozumu Goster';
            } else {
                element.classList.add('show');
                event.target.textContent = 'Cozumu Gizle';
            }
        }
    </script>
</body>

</html>
