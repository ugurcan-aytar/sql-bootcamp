<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 3 Cheatsheet - Database Design</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .cheatsheet-card {
            background: #ffffff; border: 1px solid #dee2e6; border-radius: 8px;
            margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .cheatsheet-card h5 {
            color: #0b132b; border-bottom: 2px solid #4dd0e1;
            padding-bottom: 0.5rem; margin-bottom: 1rem;
        }
        .section-title {
            color: #0b132b; font-size: 1.5rem; margin: 2rem 0 1rem;
            border-left: 4px solid #4dd0e1; padding-left: 1rem;
        }
        .keyword { color: #ff7b72; }
        .function { color: #d2a8ff; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; }
        .tip {
            background: #e8f5e9; border-left: 4px solid #4caf50; padding: 0.75rem 1rem;
            margin: 0.5rem 0; border-radius: 0 5px 5px 0;
        }
        .warning {
            background: #fff3e0; border-left: 4px solid #ff9800; padding: 0.75rem 1rem;
            margin: 0.5rem 0; border-radius: 0 5px 5px 0;
        }
        .quick-ref { background: #e3f2fd; border: 1px solid #1e88e5; border-radius: 8px; padding: 1rem; }
        .quick-ref h5 { color: #1e88e5; border-bottom: none; }
        .nf-badge {
            display: inline-block; padding: 0.3rem 0.6rem; border-radius: 20px;
            font-weight: bold; margin: 2px; color: white;
        }
        .nf-1 { background: #e91e63; }
        .nf-2 { background: #9c27b0; }
        .nf-3 { background: #673ab7; }
        .nf-bcnf { background: #3f51b5; }
    </style>
</head>
<body>
    <a href="../index_en.html" class="back-button">‚Üê Back to Index</a>
    <div class="language-switcher">
        <a href="cheatsheet.html" class="active">EN</a>
        <a href="cheatsheet_tr.html">TR</a>
    </div>
    <div id="europeanunion-turkey">
        <img src="../static/eu.png" alt="">
    </div>
    <div id="sanayiteknolojibakan">
        <img src="../static/sanayitek.png" alt="">
    </div>
    <div id="rekabet">
        <img src="../static/rekabet.png" alt="">
    </div>
    <div id="tisk">
        <img src="../static/tisk.png" alt="">
    </div>
    <div id="undp">
        <img src="../static/undp.png" alt="">
    </div>

    <div class="content-container">
        <div class="container">
            <section>
                <h1>Day 3: Database Design</h1>
                <p class="text-muted">Normalization, Schema Management & Extensions</p>

        <!-- Quick Reference -->
        <div class="quick-ref mb-4">
            <h5 class="text-center mb-3">Normal Forms Quick Reference</h5>
            <div class="row text-center">
                <div class="col-md-3"><span class="nf-badge nf-1">1NF</span> Atomic values, no repeating groups</div>
                <div class="col-md-3"><span class="nf-badge nf-2">2NF</span> 1NF + No partial dependencies</div>
                <div class="col-md-3"><span class="nf-badge nf-3">3NF</span> 2NF + No transitive dependencies</div>
                <div class="col-md-3"><span class="nf-badge nf-bcnf">BCNF</span> 3NF + Every determinant is a key</div>
            </div>
        </div>

        <!-- Normalization -->
        <h3 class="section-title">Database Normalization</h3>

        <div class="cheatsheet-card p-3">
            <h5>First Normal Form (1NF)</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Rules:</strong></p>
                    <ul>
                        <li>Each column contains atomic (indivisible) values</li>
                        <li>Each column contains values of a single type</li>
                        <li>Each row is unique (has primary key)</li>
                        <li>No repeating groups or arrays</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <pre><code><span class="comment">-- Violates 1NF (multiple phones)</span>
| id | name | phones              |
| 1  | John | 555-1234, 555-5678  |

<span class="comment">-- 1NF Compliant</span>
| id | name | phone    |
| 1  | John | 555-1234 |
| 1  | John | 555-5678 |

<span class="comment">-- Or separate table</span>
user_phones(user_id, phone)</code></pre>
                </div>
            </div>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Second Normal Form (2NF)</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Rules:</strong></p>
                    <ul>
                        <li>Must be in 1NF</li>
                        <li>No partial dependencies</li>
                        <li>Non-key columns depend on the ENTIRE primary key</li>
                        <li>Only applies to composite primary keys</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <pre><code><span class="comment">-- Violates 2NF (product_name depends only on product_id)</span>
order_items(order_id, product_id, product_name, qty)

<span class="comment">-- 2NF Compliant</span>
order_items(order_id, product_id, qty)
products(product_id, product_name)</code></pre>
                </div>
            </div>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Third Normal Form (3NF)</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Rules:</strong></p>
                    <ul>
                        <li>Must be in 2NF</li>
                        <li>No transitive dependencies</li>
                        <li>Non-key columns depend ONLY on the primary key</li>
                        <li>Not on other non-key columns</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <pre><code><span class="comment">-- Violates 3NF (city depends on zip, not id)</span>
employees(id, name, zip, city, state)

<span class="comment">-- 3NF Compliant</span>
employees(id, name, zip)
zip_codes(zip, city, state)</code></pre>
                </div>
            </div>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Denormalization (When to Break Rules)</h5>
            <table>
                <thead><tr><th>Situation</th><th>Reason</th></tr></thead>
                <tbody>
                    <tr><td>Read-heavy workloads</td><td>Reduce JOINs for faster queries</td></tr>
                    <tr><td>Reporting/Analytics</td><td>Pre-computed aggregates</td></tr>
                    <tr><td>Caching</td><td>Store computed values</td></tr>
                    <tr><td>Historical data</td><td>Snapshot point-in-time values</td></tr>
                </tbody>
            </table>
            <div class="warning">Denormalization trades storage and update complexity for read performance.</div>
        </div>

        <!-- Relationships -->
        <h3 class="section-title">Entity Relationships</h3>

        <div class="cheatsheet-card p-3">
            <h5>Relationship Types</h5>
            <table>
                <thead><tr><th>Type</th><th>Description</th><th>Implementation</th></tr></thead>
                <tbody>
                    <tr>
                        <td><strong>One-to-One (1:1)</strong></td>
                        <td>One record in A relates to one in B</td>
                        <td>FK with UNIQUE constraint, or same PK</td>
                    </tr>
                    <tr>
                        <td><strong>One-to-Many (1:N)</strong></td>
                        <td>One record in A relates to many in B</td>
                        <td>FK in the "many" table</td>
                    </tr>
                    <tr>
                        <td><strong>Many-to-Many (M:N)</strong></td>
                        <td>Many in A relate to many in B</td>
                        <td>Junction/bridge table with two FKs</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>One-to-Many Example</h5>
                    <pre><code><span class="keyword">CREATE TABLE</span> departments (
    id SERIAL <span class="keyword">PRIMARY KEY</span>,
    name VARCHAR(100) <span class="keyword">NOT NULL</span>
);

<span class="keyword">CREATE TABLE</span> employees (
    id SERIAL <span class="keyword">PRIMARY KEY</span>,
    name VARCHAR(100),
    department_id INT <span class="keyword">REFERENCES</span>
        departments(id)
);</code></pre>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Many-to-Many Example</h5>
                    <pre><code><span class="keyword">CREATE TABLE</span> students (
    id SERIAL <span class="keyword">PRIMARY KEY</span>,
    name VARCHAR(100)
);
<span class="keyword">CREATE TABLE</span> courses (
    id SERIAL <span class="keyword">PRIMARY KEY</span>,
    title VARCHAR(100)
);
<span class="comment">-- Junction table</span>
<span class="keyword">CREATE TABLE</span> enrollments (
    student_id INT <span class="keyword">REFERENCES</span> students(id),
    course_id INT <span class="keyword">REFERENCES</span> courses(id),
    <span class="keyword">PRIMARY KEY</span> (student_id, course_id)
);</code></pre>
                </div>
            </div>
        </div>

        <!-- Constraints -->
        <h3 class="section-title">Constraints</h3>

        <div class="cheatsheet-card p-3">
            <h5>Constraint Types</h5>
            <pre><code><span class="keyword">CREATE TABLE</span> products (
    <span class="comment">-- Primary Key</span>
    id SERIAL <span class="keyword">PRIMARY KEY</span>,

    <span class="comment">-- Not Null</span>
    name VARCHAR(100) <span class="keyword">NOT NULL</span>,

    <span class="comment">-- Unique</span>
    sku VARCHAR(50) <span class="keyword">UNIQUE</span>,

    <span class="comment">-- Check constraint</span>
    price DECIMAL(10,2) <span class="keyword">CHECK</span> (price >= 0),

    <span class="comment">-- Foreign Key</span>
    category_id INT <span class="keyword">REFERENCES</span> categories(id),

    <span class="comment">-- Default value</span>
    created_at TIMESTAMPTZ <span class="keyword">DEFAULT NOW</span>(),
    status VARCHAR(20) <span class="keyword">DEFAULT</span> <span class="string">'active'</span>,

    <span class="comment">-- Named constraints</span>
    <span class="keyword">CONSTRAINT</span> positive_stock <span class="keyword">CHECK</span> (stock >= 0),
    <span class="keyword">CONSTRAINT</span> valid_status <span class="keyword">CHECK</span> (status <span class="keyword">IN</span> (<span class="string">'active'</span>, <span class="string">'inactive'</span>, <span class="string">'discontinued'</span>))
);</code></pre>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Foreign Key Actions</h5>
            <pre><code><span class="keyword">CREATE TABLE</span> orders (
    id SERIAL <span class="keyword">PRIMARY KEY</span>,
    customer_id INT <span class="keyword">REFERENCES</span> customers(id)
        <span class="keyword">ON DELETE SET NULL</span>     <span class="comment">-- Set to NULL when parent deleted</span>
        <span class="keyword">ON UPDATE CASCADE</span>      <span class="comment">-- Update when parent ID changes</span>
);

<span class="comment">-- ON DELETE options:</span>
<span class="keyword">CASCADE</span>      <span class="comment">-- Delete child rows too</span>
<span class="keyword">SET NULL</span>     <span class="comment">-- Set FK to NULL</span>
<span class="keyword">SET DEFAULT</span>  <span class="comment">-- Set FK to default value</span>
<span class="keyword">RESTRICT</span>     <span class="comment">-- Prevent deletion (default)</span>
<span class="keyword">NO ACTION</span>    <span class="comment">-- Like RESTRICT but deferred</span></code></pre>
        </div>

        <!-- Schema Management -->
        <h3 class="section-title">Schema Management</h3>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Schema Commands</h5>
                    <pre><code><span class="comment">-- Create schema</span>
<span class="keyword">CREATE SCHEMA</span> sales;

<span class="comment">-- Create table in schema</span>
<span class="keyword">CREATE TABLE</span> sales.orders (...);

<span class="comment">-- Set search path</span>
<span class="keyword">SET</span> search_path <span class="keyword">TO</span> sales, public;

<span class="comment">-- Show current schema</span>
<span class="keyword">SELECT</span> current_schema();

<span class="comment">-- Drop schema</span>
<span class="keyword">DROP SCHEMA</span> sales;
<span class="keyword">DROP SCHEMA</span> sales <span class="keyword">CASCADE</span>;</code></pre>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Naming Conventions</h5>
                    <table>
                        <tbody>
                            <tr><td>Tables</td><td><code>snake_case</code>, plural</td><td><code>user_accounts</code></td></tr>
                            <tr><td>Columns</td><td><code>snake_case</code></td><td><code>first_name</code></td></tr>
                            <tr><td>Primary Key</td><td><code>id</code> or <code>table_id</code></td><td><code>id</code></td></tr>
                            <tr><td>Foreign Key</td><td><code>referenced_table_id</code></td><td><code>department_id</code></td></tr>
                            <tr><td>Indexes</td><td><code>idx_table_columns</code></td><td><code>idx_users_email</code></td></tr>
                            <tr><td>Constraints</td><td><code>type_table_column</code></td><td><code>pk_users</code></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ALTER TABLE -->
        <h3 class="section-title">Modifying Tables</h3>

        <div class="cheatsheet-card p-3">
            <h5>ALTER TABLE Commands</h5>
            <pre><code><span class="comment">-- Add column</span>
<span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD COLUMN</span> phone VARCHAR(20);

<span class="comment">-- Drop column</span>
<span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP COLUMN</span> phone;

<span class="comment">-- Rename column</span>
<span class="keyword">ALTER TABLE</span> users <span class="keyword">RENAME COLUMN</span> phone <span class="keyword">TO</span> phone_number;

<span class="comment">-- Change data type</span>
<span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER COLUMN</span> age <span class="keyword">TYPE</span> SMALLINT;

<span class="comment">-- Add constraint</span>
<span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD CONSTRAINT</span> email_unique <span class="keyword">UNIQUE</span> (email);

<span class="comment">-- Drop constraint</span>
<span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP CONSTRAINT</span> email_unique;

<span class="comment">-- Set/drop NOT NULL</span>
<span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER COLUMN</span> email <span class="keyword">SET NOT NULL</span>;
<span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER COLUMN</span> email <span class="keyword">DROP NOT NULL</span>;

<span class="comment">-- Set default</span>
<span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER COLUMN</span> status <span class="keyword">SET DEFAULT</span> <span class="string">'active'</span>;

<span class="comment">-- Rename table</span>
<span class="keyword">ALTER TABLE</span> users <span class="keyword">RENAME TO</span> user_accounts;</code></pre>
        </div>

        <!-- PostgreSQL Extensions -->
        <h3 class="section-title">PostgreSQL Extensions</h3>

        <div class="cheatsheet-card p-3">
            <h5>Managing Extensions</h5>
            <pre><code><span class="comment">-- List available extensions</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> pg_available_extensions;

<span class="comment">-- Install extension</span>
<span class="keyword">CREATE EXTENSION IF NOT EXISTS</span> <span class="string">"uuid-ossp"</span>;

<span class="comment">-- List installed extensions</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> pg_extension;

<span class="comment">-- Drop extension</span>
<span class="keyword">DROP EXTENSION</span> <span class="string">"uuid-ossp"</span>;</code></pre>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Popular PostgreSQL Extensions</h5>
            <table>
                <thead><tr><th>Extension</th><th>Purpose</th><th>Example</th></tr></thead>
                <tbody>
                    <tr><td><code>uuid-ossp</code></td><td>UUID generation</td><td><code>uuid_generate_v4()</code></td></tr>
                    <tr><td><code>pgcrypto</code></td><td>Encryption functions</td><td><code>gen_random_uuid()</code>, password hashing</td></tr>
                    <tr><td><code>pg_trgm</code></td><td>Fuzzy text matching</td><td>Similarity search, typo tolerance</td></tr>
                    <tr><td><code>PostGIS</code></td><td>Geographic data</td><td>Location queries, mapping</td></tr>
                    <tr><td><code>hstore</code></td><td>Key-value storage</td><td>Simple KV pairs in column</td></tr>
                    <tr><td><code>citext</code></td><td>Case-insensitive text</td><td>Email columns</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Views -->
        <h3 class="section-title">Views</h3>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Regular Views</h5>
                    <pre><code><span class="comment">-- Create view</span>
<span class="keyword">CREATE VIEW</span> active_employees <span class="keyword">AS</span>
<span class="keyword">SELECT</span> e.id, e.name, d.name <span class="keyword">AS</span> dept
<span class="keyword">FROM</span> employees e
<span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id = d.id
<span class="keyword">WHERE</span> e.status = <span class="string">'active'</span>;

<span class="comment">-- Replace view</span>
<span class="keyword">CREATE OR REPLACE VIEW</span> active_employees
<span class="keyword">AS</span> ...;

<span class="comment">-- Drop view</span>
<span class="keyword">DROP VIEW</span> active_employees;</code></pre>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Materialized Views</h5>
                    <pre><code><span class="comment">-- Stores data physically</span>
<span class="keyword">CREATE MATERIALIZED VIEW</span> mv_sales_summary
<span class="keyword">AS</span>
<span class="keyword">SELECT</span> product_id,
       <span class="function">SUM</span>(amount) <span class="keyword">AS</span> total
<span class="keyword">FROM</span> sales
<span class="keyword">GROUP BY</span> product_id;

<span class="comment">-- Must refresh to update</span>
<span class="keyword">REFRESH MATERIALIZED VIEW</span> mv_sales_summary;

<span class="comment">-- Concurrent refresh (no lock)</span>
<span class="keyword">REFRESH MATERIALIZED VIEW CONCURRENTLY</span>
mv_sales_summary;</code></pre>
                </div>
            </div>
        </div>

        <!-- Best Practices -->
        <h3 class="section-title">Design Best Practices</h3>

        <div class="row">
            <div class="col-md-6">
                <div class="tip">
                    <strong>Start with 3NF</strong> - Denormalize only when proven necessary
                </div>
                <div class="tip">
                    <strong>Use appropriate data types</strong> - Don't use TEXT for everything
                </div>
                <div class="tip">
                    <strong>Add constraints</strong> - Let the database enforce data integrity
                </div>
                <div class="tip">
                    <strong>Document with comments</strong> - <code>COMMENT ON TABLE/COLUMN</code>
                </div>
            </div>
            <div class="col-md-6">
                <div class="warning">
                    <strong>Avoid reserved words</strong> - Don't name columns 'user', 'order', 'table'
                </div>
                <div class="warning">
                    <strong>Plan for scale</strong> - Use BIGINT for IDs if expecting growth
                </div>
                <div class="warning">
                    <strong>Test migrations</strong> - Always backup before schema changes
                </div>
                <div class="warning">
                    <strong>Consider indexes early</strong> - But don't over-index
                </div>
            </div>
        </div>

            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>
