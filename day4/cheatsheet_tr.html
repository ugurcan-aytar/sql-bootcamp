<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gun 4 Kopya Kagidi - Performans & Analitik</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .cheatsheet-card {
            background: #ffffff; border: 1px solid #dee2e6; border-radius: 8px;
            margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .cheatsheet-card h5 {
            color: #0b132b; border-bottom: 2px solid #4dd0e1;
            padding-bottom: 0.5rem; margin-bottom: 1rem;
        }
        .section-title {
            color: #0b132b; font-size: 1.5rem; margin: 2rem 0 1rem;
            border-left: 4px solid #4dd0e1; padding-left: 1rem;
        }
        .keyword { color: #ff7b72; }
        .function { color: #d2a8ff; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; }
        .tip {
            background: #e8f5e9; border-left: 4px solid #4caf50; padding: 0.75rem 1rem;
            margin: 0.5rem 0; border-radius: 0 5px 5px 0;
        }
        .warning {
            background: #fff3e0; border-left: 4px solid #ff9800; padding: 0.75rem 1rem;
            margin: 0.5rem 0; border-radius: 0 5px 5px 0;
        }
        .quick-ref { background: #e3f2fd; border: 1px solid #1e88e5; border-radius: 8px; padding: 1rem; }
        .quick-ref h5 { color: #1e88e5; border-bottom: none; }
        .idx-badge {
            display: inline-block; padding: 0.2rem 0.5rem; border-radius: 4px;
            font-size: 0.75rem; margin: 2px; color: white;
        }
        .idx-btree { background: #2196f3; }
        .idx-hash { background: #4caf50; }
        .idx-gin { background: #ff9800; }
        .idx-gist { background: #9c27b0; }
        .idx-brin { background: #795548; }
    </style>
</head>
<body>
    <a href="../index_tr.html" class="back-button">← Anasayfaya Don</a>
    <div class="language-switcher">
        <a href="cheatsheet.html">EN</a>
        <a href="cheatsheet_tr.html" class="active">TR</a>
    </div>
    <div id="europeanunion-turkey">
        <img src="../static/eu.png" alt="">
    </div>
    <div id="sanayiteknolojibakan">
        <img src="../static/sanayitek.png" alt="">
    </div>
    <div id="rekabet">
        <img src="../static/rekabet.png" alt="">
    </div>
    <div id="tisk">
        <img src="../static/tisk.png" alt="">
    </div>
    <div id="undp">
        <img src="../static/undp.png" alt="">
    </div>

    <div class="content-container">
        <div class="container">
            <section>
                <h1>Gun 4: Performans & Analitik</h1>
                <p class="text-muted">Sorgu Optimizasyonu, Index'ler & Analitik Sorgular</p>

        <!-- Hizli Referans -->
        <div class="quick-ref mb-4">
            <h5 class="text-center mb-3">Index Turleri Hizli Referans</h5>
            <div class="row text-center">
                <div class="col"><span class="idx-badge idx-btree">B-tree</span> Varsayilan, karsilastirmalar</div>
                <div class="col"><span class="idx-badge idx-hash">Hash</span> Sadece esitlik</div>
                <div class="col"><span class="idx-badge idx-gin">GIN</span> Diziler, JSONB, tam metin</div>
                <div class="col"><span class="idx-badge idx-gist">GiST</span> Geometrik, aralik</div>
                <div class="col"><span class="idx-badge idx-brin">BRIN</span> Buyuk sirali tablolar</div>
            </div>
        </div>

        <!-- EXPLAIN -->
        <h3 class="section-title">EXPLAIN ile Sorgu Analizi</h3>

        <div class="cheatsheet-card p-3">
            <h5>EXPLAIN Komutlari</h5>
            <pre><code><span class="comment">-- Temel explain (sadece plani gosterir)</span>
<span class="keyword">EXPLAIN</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id = 5;

<span class="comment">-- Sorguyu gercekten calistir (gercek zamani gosterir)</span>
<span class="keyword">EXPLAIN ANALYZE</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id = 5;

<span class="comment">-- Buffer'larla ayrintili (I/O bilgisi)</span>
<span class="keyword">EXPLAIN</span> (ANALYZE, BUFFERS, FORMAT TEXT)
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary > 50000;

<span class="comment">-- JSON format (gorsellestirme araclari icin)</span>
<span class="keyword">EXPLAIN</span> (ANALYZE, FORMAT JSON)
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees;</code></pre>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>EXPLAIN Ciktisini Anlama</h5>
            <pre><code>Seq Scan on employees  (cost=0.00..15.00 rows=500 width=64) (actual time=0.015..0.892 rows=523 loops=1)
  Filter: (salary > 50000)
  Rows Removed by Filter: 477
Planning Time: 0.082 ms
Execution Time: 0.987 ms</code></pre>
            <table class="mt-3">
                <thead><tr><th>Metrik</th><th>Anlami</th></tr></thead>
                <tbody>
                    <tr><td><code>cost=0.00..15.00</code></td><td>Baslangiç maliyeti..toplam maliyet (keyfi birimler)</td></tr>
                    <tr><td><code>rows=500</code></td><td>Tahmini donen satir sayisi</td></tr>
                    <tr><td><code>width=64</code></td><td>Ortalama satir boyutu (byte)</td></tr>
                    <tr><td><code>actual time</code></td><td>Gercek calisma suresi (ms)</td></tr>
                    <tr><td><code>rows=523</code></td><td>Gercek donen satir sayisi</td></tr>
                    <tr><td><code>loops=1</code></td><td>Bu dugumun calistirilma sayisi</td></tr>
                </tbody>
            </table>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Yaygin Tarama Turleri</h5>
            <table>
                <thead><tr><th>Tarama Turu</th><th>Aciklama</th><th>Ne Zaman Kullanilir</th></tr></thead>
                <tbody>
                    <tr><td><code>Seq Scan</code></td><td>Tam tablo taramasi</td><td>Index yok, kucuk tablo, cogu satir gerekli</td></tr>
                    <tr><td><code>Index Scan</code></td><td>Index kullan, tablodan getir</td><td>Az satir, indexli sutun</td></tr>
                    <tr><td><code>Index Only Scan</code></td><td>Tum veri index'ten</td><td>Sorgu sutunlari tamamen index'te</td></tr>
                    <tr><td><code>Bitmap Index Scan</code></td><td>Bitmap olustur, sonra getir</td><td>Orta secicilik</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Index'ler -->
        <h3 class="section-title">Index Olusturma</h3>

        <div class="cheatsheet-card p-3">
            <h5>Index Sozdizimi</h5>
            <pre><code><span class="comment">-- Temel B-tree index (varsayilan)</span>
<span class="keyword">CREATE INDEX</span> idx_employees_dept <span class="keyword">ON</span> employees (department_id);

<span class="comment">-- Unique index</span>
<span class="keyword">CREATE UNIQUE INDEX</span> idx_users_email <span class="keyword">ON</span> users (email);

<span class="comment">-- Coklu sutun index</span>
<span class="keyword">CREATE INDEX</span> idx_orders_customer_date
<span class="keyword">ON</span> orders (customer_id, order_date <span class="keyword">DESC</span>);

<span class="comment">-- Partial index (kosullu)</span>
<span class="keyword">CREATE INDEX</span> idx_orders_pending
<span class="keyword">ON</span> orders (created_at)
<span class="keyword">WHERE</span> status = <span class="string">'pending'</span>;

<span class="comment">-- Ifade index'i</span>
<span class="keyword">CREATE INDEX</span> idx_users_email_lower
<span class="keyword">ON</span> users (<span class="function">LOWER</span>(email));

<span class="comment">-- Eszamanli index (kilit yok)</span>
<span class="keyword">CREATE INDEX CONCURRENTLY</span> idx_large_table
<span class="keyword">ON</span> large_table (column);</code></pre>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Index Turleri</h5>
                    <pre><code><span class="comment">-- B-tree (varsayilan) - karsilastirmalar</span>
<span class="keyword">CREATE INDEX</span> idx_btree
<span class="keyword">ON</span> table <span class="keyword">USING BTREE</span> (column);

<span class="comment">-- Hash - sadece esitlik</span>
<span class="keyword">CREATE INDEX</span> idx_hash
<span class="keyword">ON</span> table <span class="keyword">USING HASH</span> (column);

<span class="comment">-- GIN - diziler, JSONB, tam metin</span>
<span class="keyword">CREATE INDEX</span> idx_gin
<span class="keyword">ON</span> table <span class="keyword">USING GIN</span> (jsonb_column);

<span class="comment">-- GiST - geometrik, aralik tipleri</span>
<span class="keyword">CREATE INDEX</span> idx_gist
<span class="keyword">ON</span> table <span class="keyword">USING GIST</span> (location);

<span class="comment">-- BRIN - buyuk sirali tablolar</span>
<span class="keyword">CREATE INDEX</span> idx_brin
<span class="keyword">ON</span> table <span class="keyword">USING BRIN</span> (created_at);</code></pre>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Her Index Ne Zaman Kullanilir</h5>
                    <table>
                        <tbody>
                            <tr><td><span class="idx-badge idx-btree">B-tree</span></td><td>=, <, >, <=, >=, BETWEEN, IN, LIKE 'onek%'</td></tr>
                            <tr><td><span class="idx-badge idx-hash">Hash</span></td><td>Sadece = (esitlik)</td></tr>
                            <tr><td><span class="idx-badge idx-gin">GIN</span></td><td>@>, ?, ?|, ?&, tam metin arama</td></tr>
                            <tr><td><span class="idx-badge idx-gist">GiST</span></td><td><<, >>, &<, &>, @@, aralik icerir</td></tr>
                            <tr><td><span class="idx-badge idx-brin">BRIN</span></td><td>Zaman serisi, dogal olarak sirali veri</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Index'leri Yonetme</h5>
            <pre><code><span class="comment">-- Tablodaki index'leri listele</span>
<span class="keyword">SELECT</span> indexname, indexdef
<span class="keyword">FROM</span> pg_indexes
<span class="keyword">WHERE</span> tablename = <span class="string">'employees'</span>;

<span class="comment">-- Index sil</span>
<span class="keyword">DROP INDEX</span> idx_employees_dept;
<span class="keyword">DROP INDEX CONCURRENTLY</span> idx_employees_dept;  <span class="comment">-- Kilit yok</span>

<span class="comment">-- Index'i yeniden olustur</span>
<span class="keyword">REINDEX INDEX</span> idx_employees_dept;
<span class="keyword">REINDEX TABLE</span> employees;

<span class="comment">-- Index boyutu</span>
<span class="keyword">SELECT</span> pg_size_pretty(pg_relation_size(<span class="string">'idx_employees_dept'</span>));</code></pre>
        </div>

        <!-- Sorgu Optimizasyonu -->
        <h3 class="section-title">Sorgu Optimizasyonu Ipuclari</h3>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Bunu Yapin</h5>
                    <pre><code><span class="comment">-- WHERE'de indexli sutunlari kullanin</span>
<span class="keyword">WHERE</span> indexed_column = value

<span class="comment">-- Buyuk sonuclar icin LIMIT kullanin</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> logs
<span class="keyword">ORDER BY</span> created_at <span class="keyword">DESC</span>
<span class="keyword">LIMIT</span> 100;

<span class="comment">-- Alt sorgular icin IN yerine EXISTS kullanin</span>
<span class="keyword">WHERE EXISTS</span> (<span class="keyword">SELECT</span> 1 <span class="keyword">FROM</span> ... <span class="keyword">WHERE</span> ...)

<span class="comment">-- Sadece gerekli sutunlari secin</span>
<span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> users;

<span class="comment">-- Kapsayici index'ler kullanin</span>
<span class="keyword">CREATE INDEX</span> idx_covering
<span class="keyword">ON</span> orders (customer_id) <span class="keyword">INCLUDE</span> (total);</code></pre>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>Bundan Kacinin</h5>
                    <pre><code><span class="comment">-- Indexli sutunlarda fonksiyonlar</span>
<span class="keyword">WHERE</span> <span class="function">LOWER</span>(email) = <span class="string">'test@email.com'</span>
<span class="comment">-- Bunun yerine ifade index'i kullanin</span>

<span class="comment">-- Bastaki joker karakter</span>
<span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">'%john%'</span>
<span class="comment">-- B-tree index kullanilamaz</span>

<span class="comment">-- Farkli sutunlarda OR</span>
<span class="keyword">WHERE</span> col1 = x <span class="keyword">OR</span> col2 = y
<span class="comment">-- Bunun yerine UNION dusunun</span>

<span class="comment">-- JOIN'lerle SELECT *</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> a <span class="keyword">JOIN</span> b <span class="keyword">JOIN</span> c ...

<span class="comment">-- != veya NOT IN (genellikle index kullanilamaz)</span>
<span class="keyword">WHERE</span> status != <span class="string">'deleted'</span>
<span class="comment">-- Bunun yerine partial index kullanin</span></code></pre>
                </div>
            </div>
        </div>

        <!-- Istatistikler -->
        <h3 class="section-title">Istatistikler & Bakim</h3>

        <div class="cheatsheet-card p-3">
            <h5>Istatistikleri Guncelleme</h5>
            <pre><code><span class="comment">-- Sorgu planlayici icin istatistikleri guncelle</span>
<span class="keyword">ANALYZE</span> employees;

<span class="comment">-- Tum tablolar icin istatistikleri guncelle</span>
<span class="keyword">ANALYZE</span>;

<span class="comment">-- VACUUM - olu tuple'lari geri kazan</span>
<span class="keyword">VACUUM</span> employees;

<span class="comment">-- VACUUM ANALYZE - her iki islem</span>
<span class="keyword">VACUUM ANALYZE</span> employees;

<span class="comment">-- Tablo istatistiklerini goruntule</span>
<span class="keyword">SELECT</span> relname, n_live_tup, n_dead_tup, last_vacuum, last_analyze
<span class="keyword">FROM</span> pg_stat_user_tables;</code></pre>
        </div>

        <!-- Analitik Sorgular -->
        <h3 class="section-title">Analitik Sorgular</h3>

        <div class="cheatsheet-card p-3">
            <h5>Pencere Fonksiyonlari Ozeti</h5>
            <pre><code><span class="keyword">SELECT</span>
    employee_name,
    department,
    salary,
    <span class="comment">-- Siralama</span>
    <span class="function">ROW_NUMBER</span>() <span class="keyword">OVER</span> (w) <span class="keyword">AS</span> satir_no,
    <span class="function">RANK</span>() <span class="keyword">OVER</span> (w) <span class="keyword">AS</span> siralama,
    <span class="function">DENSE_RANK</span>() <span class="keyword">OVER</span> (w) <span class="keyword">AS</span> yogun_siralama,
    <span class="function">NTILE</span>(4) <span class="keyword">OVER</span> (w) <span class="keyword">AS</span> ceyrek,

    <span class="comment">-- Toplamalar</span>
    <span class="function">SUM</span>(salary) <span class="keyword">OVER</span> (<span class="keyword">PARTITION BY</span> department) <span class="keyword">AS</span> dept_toplam,
    <span class="function">AVG</span>(salary) <span class="keyword">OVER</span> () <span class="keyword">AS</span> sirket_ort,

    <span class="comment">-- Kumulatif toplamlar</span>
    <span class="function">SUM</span>(salary) <span class="keyword">OVER</span> (<span class="keyword">ORDER BY</span> hire_date) <span class="keyword">AS</span> kumulatif_toplam

<span class="keyword">FROM</span> employees
<span class="keyword">WINDOW</span> w <span class="keyword">AS</span> (<span class="keyword">PARTITION BY</span> department <span class="keyword">ORDER BY</span> salary <span class="keyword">DESC</span>);</code></pre>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>LAG / LEAD</h5>
                    <pre><code><span class="comment">-- Onceki/sonraki satirlarla karsilastir</span>
<span class="keyword">SELECT</span>
    order_date,
    amount,
    <span class="function">LAG</span>(amount, 1) <span class="keyword">OVER</span> (<span class="keyword">ORDER BY</span> order_date)
        <span class="keyword">AS</span> onceki_tutar,
    <span class="function">LEAD</span>(amount, 1) <span class="keyword">OVER</span> (<span class="keyword">ORDER BY</span> order_date)
        <span class="keyword">AS</span> sonraki_tutar,
    amount - <span class="function">LAG</span>(amount) <span class="keyword">OVER</span> (<span class="keyword">ORDER BY</span> order_date)
        <span class="keyword">AS</span> degisim
<span class="keyword">FROM</span> daily_sales;</code></pre>
                </div>
            </div>
            <div class="col-md-6">
                <div class="cheatsheet-card p-3">
                    <h5>FIRST_VALUE / LAST_VALUE</h5>
                    <pre><code><span class="keyword">SELECT</span>
    name,
    salary,
    <span class="function">FIRST_VALUE</span>(name) <span class="keyword">OVER</span> (
        <span class="keyword">PARTITION BY</span> department
        <span class="keyword">ORDER BY</span> salary <span class="keyword">DESC</span>
    ) <span class="keyword">AS</span> en_yuksek_maasli,
    <span class="function">LAST_VALUE</span>(name) <span class="keyword">OVER</span> (
        <span class="keyword">PARTITION BY</span> department
        <span class="keyword">ORDER BY</span> salary <span class="keyword">DESC</span>
        <span class="keyword">ROWS BETWEEN UNBOUNDED PRECEDING
        AND UNBOUNDED FOLLOWING</span>
    ) <span class="keyword">AS</span> en_dusuk_maasli
<span class="keyword">FROM</span> employees;</code></pre>
                </div>
            </div>
        </div>

        <div class="cheatsheet-card p-3">
            <h5>Cerceve Cumleleri</h5>
            <pre><code><span class="comment">-- Hareketli ortalama (son 3 satir)</span>
<span class="function">AVG</span>(amount) <span class="keyword">OVER</span> (
    <span class="keyword">ORDER BY</span> date
    <span class="keyword">ROWS BETWEEN</span> 2 <span class="keyword">PRECEDING AND CURRENT ROW</span>
)

<span class="comment">-- Partisyondaki tum satirlar</span>
<span class="function">SUM</span>(amount) <span class="keyword">OVER</span> (
    <span class="keyword">PARTITION BY</span> category
    <span class="keyword">ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING</span>
)

<span class="comment">-- Aralik tabanli (pozisyona degil degere gore)</span>
<span class="function">SUM</span>(amount) <span class="keyword">OVER</span> (
    <span class="keyword">ORDER BY</span> date
    <span class="keyword">RANGE BETWEEN INTERVAL</span> <span class="string">'7 days'</span> <span class="keyword">PRECEDING AND CURRENT ROW</span>
)</code></pre>
        </div>

        <!-- GROUPING SETS -->
        <h3 class="section-title">Gelismis Gruplama</h3>

        <div class="cheatsheet-card p-3">
            <h5>GROUPING SETS, ROLLUP, CUBE</h5>
            <pre><code><span class="comment">-- GROUPING SETS: belirli gruplama kombinasyonlari</span>
<span class="keyword">SELECT</span> region, product, <span class="function">SUM</span>(sales)
<span class="keyword">FROM</span> sales
<span class="keyword">GROUP BY GROUPING SETS</span> (
    (region, product),  <span class="comment">-- Bolge ve urune gore</span>
    (region),           <span class="comment">-- Sadece bolgeye gore</span>
    (product),          <span class="comment">-- Sadece urune gore</span>
    ()                  <span class="comment">-- Genel toplam</span>
);

<span class="comment">-- ROLLUP: hiyerarsik ara toplamlar</span>
<span class="keyword">SELECT</span> year, quarter, month, <span class="function">SUM</span>(sales)
<span class="keyword">FROM</span> sales
<span class="keyword">GROUP BY ROLLUP</span> (year, quarter, month);
<span class="comment">-- Uretir: (year,quarter,month), (year,quarter), (year), ()</span>

<span class="comment">-- CUBE: tum olasi kombinasyonlar</span>
<span class="keyword">SELECT</span> region, product, <span class="function">SUM</span>(sales)
<span class="keyword">FROM</span> sales
<span class="keyword">GROUP BY CUBE</span> (region, product);
<span class="comment">-- Uretir: (region,product), (region), (product), ()</span></code></pre>
        </div>

        <!-- Performans En Iyi Uygulamalari -->
        <h3 class="section-title">Performans En Iyi Uygulamalari</h3>

        <div class="row">
            <div class="col-md-6">
                <div class="tip">
                    <strong>Foreign key'leri indexleyin</strong> - JOIN'ler icin FK sutunlarini her zaman indexleyin
                </div>
                <div class="tip">
                    <strong>EXPLAIN ANALYZE kullanin</strong> - Tahmin etmeyin, olcun
                </div>
                <div class="tip">
                    <strong>Yavas sorgulari izleyin</strong> - pg_stat_statements'i etkinlestirin
                </div>
                <div class="tip">
                    <strong>Buyuk islemleri parcalayin</strong> - Parcalar halinde isleyin
                </div>
            </div>
            <div class="col-md-6">
                <div class="warning">
                    <strong>Asiri indexleme yapmayin</strong> - Her index yazmalari yavaslatir
                </div>
                <div class="warning">
                    <strong>Seq Scan'lere dikkat edin</strong> - Buyuk tablolarda = problem
                </div>
                <div class="warning">
                    <strong>Sisme kontrolu yapin</strong> - VACUUM'u duzenly calistirin
                </div>
                <div class="warning">
                    <strong>Tahmin vs gercek</strong> - Buyuk fark = guncel olmayan istatistikler
                </div>
            </div>
        </div>

            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>
