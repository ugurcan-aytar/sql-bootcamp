<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">


<!-- Mirrored from code-mext.github.io/sql-training/day4/02_analytics_data_visualization.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 10 Jan 2026 07:44:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="../style_bootstrap.html">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/code.css">
  <link href="https://cdn.prod.website-files.com/5efdb54f07a6812bcd95cc65/6773d0fc3013e060f08d7145_favicon.jpg"
    rel="shortcut icon" type="image/x-icon">
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Day 4: Analytics and Data Visualization</title>
  <style>
    code {
      white-space: pre-wrap;
    }

    span.smallcaps {
      font-variant: small-caps;
    }

    span.underline {
      text-decoration: underline;
    }

    div.column {
      display: inline-block;
      vertical-align: top;
      width: 50%;
    }

    div.hanging-indent {
      margin-left: 1.5em;
      text-indent: -1.5em;
    }

    ul.task-list {
      list-style: none;
    }

    pre>code.sourceCode {
      white-space: pre;
      position: relative;
    }

    pre>code.sourceCode>span {
      display: inline-block;
      line-height: 1.25;
    }

    pre>code.sourceCode>span:empty {
      height: 1.2em;
    }

    code.sourceCode>span {
      color: inherit;
      text-decoration: inherit;
    }

    div.sourceCode {
      margin: 1em 0;
    }

    pre.sourceCode {
      margin: 0;
    }

    @media screen {
      div.sourceCode {
        overflow: auto;
      }
    }

    @media print {
      pre>code.sourceCode {
        white-space: pre-wrap;
      }

      pre>code.sourceCode>span {
        text-indent: -5em;
        padding-left: 5em;
      }
    }

    pre.numberSource code {
      counter-reset: source-line 0;
    }

    pre.numberSource code>span {
      position: relative;
      left: -4em;
      counter-increment: source-line;
    }

    pre.numberSource code>span>a:first-child::before {
      content: counter(source-line);
      position: relative;
      left: -1em;
      text-align: right;
      vertical-align: baseline;
      border: none;
      display: inline-block;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      padding: 0 4px;
      width: 4em;
      color: #aaaaaa;
    }

    pre.numberSource {
      margin-left: 3em;
      border-left: 1px solid #aaaaaa;
      padding-left: 4px;
    }

    div.sourceCode {}

    @media screen {
      pre>code.sourceCode>span>a:first-child::before {
        text-decoration: underline;
      }
    }

    code span.al {
      color: #ff0000;
      font-weight: bold;
    }

    /* Alert */
    code span.an {
      color: #60a0b0;
      font-weight: bold;
      font-style: italic;
    }

    /* Annotation */
    code span.at {
      color: #7d9029;
    }

    /* Attribute */
    code span.bn {
      color: #40a070;
    }

    /* BaseN */
    code span.bu {}

    /* BuiltIn */
    code span.cf {
      color: #007020;
      font-weight: bold;
    }

    /* ControlFlow */
    code span.ch {
      color: #4070a0;
    }

    /* Char */
    code span.cn {
      color: #880000;
    }

    /* Constant */
    code span.co {
      color: #60a0b0;
      font-style: italic;
    }

    /* Comment */
    code span.cv {
      color: #60a0b0;
      font-weight: bold;
      font-style: italic;
    }

    /* CommentVar */
    code span.do {
      color: #ba2121;
      font-style: italic;
    }

    /* Documentation */
    code span.dt {
      color: #902000;
    }

    /* DataType */
    code span.dv {
      color: #40a070;
    }

    /* DecVal */
    code span.er {
      color: #ff0000;
      font-weight: bold;
    }

    /* Error */
    code span.ex {}

    /* Extension */
    code span.fl {
      color: #40a070;
    }

    /* Float */
    code span.fu {
      color: #06287e;
    }

    /* Function */
    code span.im {}

    /* Import */
    code span.in {
      color: #60a0b0;
      font-weight: bold;
      font-style: italic;
    }

    /* Information */
    code span.kw {
      color: #007020;
      font-weight: bold;
    }

    /* Keyword */
    code span.op {
      color: #666666;
    }

    /* Operator */
    code span.ot {
      color: #007020;
    }

    /* Other */
    code span.pp {
      color: #bc7a00;
    }

    /* Preprocessor */
    code span.sc {
      color: #4070a0;
    }

    /* SpecialChar */
    code span.ss {
      color: #bb6688;
    }

    /* SpecialString */
    code span.st {
      color: #4070a0;
    }

    /* String */
    code span.va {
      color: #19177c;
    }

    /* Variable */
    code span.vs {
      color: #4070a0;
    }

    /* VerbatimString */
    code span.wa {
      color: #60a0b0;
      font-weight: bold;
      font-style: italic;
    }

    /* Warning */

    .language-switcher {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 1000;
        background: #fff;
        padding: 5px 10px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .language-switcher a {
        text-decoration: none;
        padding: 5px 10px;
        margin: 0 2px;
        border-radius: 3px;
        color: #333;
    }
    .language-switcher a.active {
        background: #0d6efd;
        color: #fff;
    }
    .language-switcher a:hover:not(.active) {
        background: #e9ecef;
    }
  </style>
</head>

<body>
    <a href="../index.html" class="back-button">← Back to Index</a>
<div class="language-switcher">
    <a href="02_analytics_data_visualization.html" class="active">EN</a>
    <a href="02_analytics_data_visualization_tr.html">TR</a>
</div>
  <div class="copy-notification" id="copyNotification">Copied!</div>

  <div id="europeanunion-turkey">
    <img src="../static/eu.png" alt="">
  </div>
  <div id="sanayiteknolojibakan">
    <img src="../static/sanayitek.png" alt="">
  </div>
  <div id="rekabet">
    <img src="../static/rekabet.png" alt="">
  </div>
  <div id="tisk">
    <img src="../static/tisk.png" alt="">
  </div>
  <div id="undp">
    <img src="../static/undp.png" alt="">
  </div>
  <div class="content-container">
    <div class="container">
      <section>
        <h1 id="day-4-analytics-and-data-visualization">Day 4: Analytics and Data Visualization</h1>
        <h2 id="session-2-analytics-and-data-visualization-2.5-hours">Analytics and Data Visualization</h2>
        <h3 id="introduction-to-analytics-with-postgresql">Introduction to Analytics with PostgreSQL</h3>
        <p>PostgreSQL offers powerful capabilities for data analytics directly within the database. This approach, often
          called “in-database analytics,” can provide significant performance benefits by reducing data movement and
          leveraging PostgreSQL’s optimization capabilities.</p>
      </section>
      <section>
        <p><strong>Benefits of In-Database Analytics</strong>:</p>
        <ol type="1">
          <li><strong>Reduced data movement</strong>: Analyze data where it lives</li>
          <li><strong>Improved performance</strong>: Leverage database optimizations</li>
          <li><strong>Data security</strong>: Data doesn’t leave the secure database environment</li>
          <li><strong>Simplified architecture</strong>: Fewer components in the analytics stack</li>
          <li><strong>Real-time analysis</strong>: Work with current data without ETL delays</li>
        </ol>
      </section>
      <section>
        <p><strong>Key PostgreSQL Features for Analytics</strong>:</p>
        <ol type="1">
          <li><strong>Window functions</strong>: Perform calculations across rows related to the current row</li>
          <li><strong>Common Table Expressions (CTEs)</strong>: Write readable, modular queries</li>
          <li><strong>Materialized views</strong>: Cache complex query results for faster access</li>
          <li><strong>Statistical functions</strong>: Built-in functions for statistical analysis</li>
          <li><strong>Advanced aggregations</strong>: Beyond simple SUM and COUNT</li>
          <li><strong>JSON/JSONB support</strong>: Analyze semi-structured data</li>
          <li><strong>Foreign data wrappers</strong>: Access external data sources</li>
        </ol>
      </section>
      <section>
        <p><strong>Setting Up an Analytics Environment</strong>:</p>
        <div class="sourceCode" id="cb1">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co">-- Create a schema for analytics</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">SCHEMA</span> analytics;</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="co">-- Create a role for analysts</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">ROLE</span> analyst;</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="kw">GRANT</span> <span class="kw">USAGE</span> <span class="kw">ON</span> <span class="kw">SCHEMA</span> analytics <span class="kw">TO</span> analyst;</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="co">-- Grant read access to application data</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a><span class="kw">GRANT</span> <span class="kw">SELECT</span> <span class="kw">ON</span> <span class="kw">ALL</span> <span class="kw">TABLES</span> <span class="kw">IN</span> <span class="kw">SCHEMA</span> <span class="kw">public</span> <span class="kw">TO</span> analyst;</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="co">-- Grant write access to analytics schema</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a><span class="kw">GRANT</span> <span class="kw">ALL</span> <span class="kw">PRIVILEGES</span> <span class="kw">ON</span> <span class="kw">SCHEMA</span> analytics <span class="kw">TO</span> analyst;</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a><span class="kw">GRANT</span> <span class="kw">ALL</span> <span class="kw">PRIVILEGES</span> <span class="kw">ON</span> <span class="kw">ALL</span> <span class="kw">TABLES</span> <span class="kw">IN</span> <span class="kw">SCHEMA</span> analytics <span class="kw">TO</span> analyst;</span></code></pre>
        </div>
      </section>
      <section>
        <h3 id="window-functions-for-analytics">Window Functions for Analytics</h3>
        <p>Window functions perform calculations across a set of table rows related to the current row, similar to
          aggregate functions but without grouping rows into a single output row.</p>
        <p><strong>Basic Window Function Syntax</strong>:</p>
        <div class="sourceCode" id="cb2">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>    column1,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>    column2,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>    window_function() <span class="kw">OVER</span> (</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>        [<span class="kw">PARTITION</span> <span class="kw">BY</span> partition_expression]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>        [<span class="kw">ORDER</span> <span class="kw">BY</span> sort_expression [<span class="kw">ASC</span> | <span class="kw">DESC</span>]]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>        [frame_clause]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>    )</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>    table_name;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Common Window Functions</strong>:</p>
        <ol type="1">
          <li><strong>Ranking Functions</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb3">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="co">-- ROW_NUMBER(): Unique sequential number</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>    product_id,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>    category_id,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>    price,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>    <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id <span class="kw">ORDER</span> <span class="kw">BY</span> price <span class="kw">DESC</span>) <span class="kw">AS</span> price_rank</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>    product;</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="co">-- RANK(): Rank with gaps for ties</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>    product_id,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>    category_id,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>    price,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>    <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id <span class="kw">ORDER</span> <span class="kw">BY</span> price <span class="kw">DESC</span>) <span class="kw">AS</span> price_rank</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a>    product;</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a><span class="co">-- DENSE_RANK(): Rank without gaps</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a>    product_id,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a>    category_id,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a>    price,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a>    <span class="fu">DENSE_RANK</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id <span class="kw">ORDER</span> <span class="kw">BY</span> price <span class="kw">DESC</span>) <span class="kw">AS</span> price_rank</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a>    product;</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true"></a><span class="co">-- PERCENT_RANK(): Relative rank (0 to 1)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true"></a>    product_id,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true"></a>    category_id,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true"></a>    price,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true"></a>    <span class="fu">PERCENT_RANK</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id <span class="kw">ORDER</span> <span class="kw">BY</span> price) <span class="kw">AS</span> price_percentile</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true"></a>    product;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Common Window Functions</strong>:</p>
        <ol start="2" type="1">
          <li><strong>Aggregate Window Functions</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb4">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="co">-- SUM() as a window function</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>    order_id,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    product_id,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>    amount,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>    <span class="fu">SUM</span>(amount) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> order_id) <span class="kw">AS</span> order_total</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>    order_item;</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a><span class="co">-- AVG() as a window function</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>    product_id,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>    category_id,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>    price,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>    <span class="fu">AVG</span>(price) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id) <span class="kw">AS</span> category_avg_price,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>    price <span class="op">-</span> <span class="fu">AVG</span>(price) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id) <span class="kw">AS</span> price_diff_from_avg</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>    product;</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a><span class="co">-- COUNT() as a window function</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true"></a>    customer_id,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true"></a>    order_date,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true"></a>    amount,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id) <span class="kw">AS</span> customer_order_count</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true"></a>    orders;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Common Window Functions</strong>:</p>
        <ol start="3" type="1">
          <li><strong>Value Window Functions</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb5">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co">-- FIRST_VALUE(): First value in the window</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    customer_id,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    order_date,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>    amount,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>    <span class="fu">FIRST_VALUE</span>(amount) <span class="kw">OVER</span> (</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>        <span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> order_date</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>    ) <span class="kw">AS</span> first_order_amount</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>    orders;</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a><span class="co">-- LAST_VALUE(): Last value in the window</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>    customer_id,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>    order_date,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>    amount,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>    <span class="fu">LAST_VALUE</span>(amount) <span class="kw">OVER</span> (</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a>        <span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> order_date</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>        <span class="kw">RANGE</span> <span class="kw">BETWEEN</span> <span class="kw">UNBOUNDED</span> <span class="kw">PRECEDING</span> <span class="kw">AND</span> <span class="kw">UNBOUNDED</span> <span class="kw">FOLLOWING</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>    ) <span class="kw">AS</span> last_order_amount</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a>    orders;</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true"></a><span class="co">-- LAG(): Access previous row values</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true"></a>    customer_id,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true"></a>    order_date,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true"></a>    amount,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true"></a>    <span class="fu">LAG</span>(amount) <span class="kw">OVER</span> (</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true"></a>        <span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> order_date</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true"></a>    ) <span class="kw">AS</span> previous_order_amount,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true"></a>    amount <span class="op">-</span> <span class="fu">LAG</span>(amount) <span class="kw">OVER</span> (</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true"></a>        <span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> order_date</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true"></a>    ) <span class="kw">AS</span> amount_change</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true"></a>    orders;</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true"></a><span class="co">-- LEAD(): Access next row values</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true"></a>    customer_id,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true"></a>    order_date,</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true"></a>    amount,</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true"></a>    <span class="fu">LEAD</span>(amount) <span class="kw">OVER</span> (</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true"></a>        <span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> order_date</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true"></a>    ) <span class="kw">AS</span> next_order_amount</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true"></a>    orders;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Window Frame Clauses</strong>:</p>
        <p>The frame clause defines which rows are included in the window function calculation relative to the current
          row.</p>
        <div class="sourceCode" id="cb6">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="co">-- Default frame (depends on presence of ORDER BY)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>    order_date,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>    amount,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>    <span class="fu">AVG</span>(amount) <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> order_date) <span class="kw">AS</span> running_avg</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>    orders;</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a><span class="co">-- Explicit frame: rows between unbounded preceding and current row</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>    order_date,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>    amount,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>    <span class="fu">AVG</span>(amount) <span class="kw">OVER</span> (</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> order_date</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a>        <span class="kw">ROWS</span> <span class="kw">BETWEEN</span> <span class="kw">UNBOUNDED</span> <span class="kw">PRECEDING</span> <span class="kw">AND</span> <span class="kw">CURRENT</span> <span class="kw">ROW</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a>    ) <span class="kw">AS</span> running_avg</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a>    orders;</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a><span class="co">-- Explicit frame: rows between 2 preceding and 2 following</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a>    order_date,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a>    amount,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a>    <span class="fu">AVG</span>(amount) <span class="kw">OVER</span> (</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> order_date</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a>        <span class="kw">ROWS</span> <span class="kw">BETWEEN</span> <span class="dv">2</span> <span class="kw">PRECEDING</span> <span class="kw">AND</span> <span class="dv">2</span> <span class="kw">FOLLOWING</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true"></a>    ) <span class="kw">AS</span> moving_avg</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true"></a>    orders;</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true"></a><span class="co">-- Range-based frame: range between unbounded preceding and current row</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true"></a>    order_date,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true"></a>    amount,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true"></a>    <span class="fu">SUM</span>(amount) <span class="kw">OVER</span> (</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> order_date</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true"></a>        <span class="kw">RANGE</span> <span class="kw">BETWEEN</span> <span class="kw">UNBOUNDED</span> <span class="kw">PRECEDING</span> <span class="kw">AND</span> <span class="kw">CURRENT</span> <span class="kw">ROW</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true"></a>    ) <span class="kw">AS</span> running_total</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true"></a>    orders;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Practical Analytics Examples with Window Functions</strong>:</p>
        <ol type="1">
          <li><strong>Month-over-Month Growth</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb7">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>    date_trunc(<span class="st">&#39;month&#39;</span>, order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>    <span class="fu">SUM</span>(amount) <span class="kw">AS</span> monthly_sales,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>    <span class="fu">LAG</span>(<span class="fu">SUM</span>(amount)) <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> date_trunc(<span class="st">&#39;month&#39;</span>, order_date)) <span class="kw">AS</span> prev_month_sales,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>    (<span class="fu">SUM</span>(amount) <span class="op">-</span> <span class="fu">LAG</span>(<span class="fu">SUM</span>(amount)) <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> date_trunc(<span class="st">&#39;month&#39;</span>, order_date))) <span class="op">/</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>        <span class="fu">NULLIF</span>(<span class="fu">LAG</span>(<span class="fu">SUM</span>(amount)) <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> date_trunc(<span class="st">&#39;month&#39;</span>, order_date)), <span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span> <span class="kw">AS</span> mom_growth</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>    orders</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>    date_trunc(<span class="st">&#39;month&#39;</span>, order_date)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a>    <span class="dt">month</span>;</span></code></pre>
        </div>
      </section>
      <section>
        <ol start="2" type="1">
          <li><strong>Running Totals and Moving Averages</strong>:</li>
          <div class="sourceCode" id="cb8">
            <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    order_date,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>    amount,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>    <span class="fu">SUM</span>(amount) <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> order_date) <span class="kw">AS</span> running_total,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>    <span class="fu">AVG</span>(amount) <span class="kw">OVER</span> (</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> order_date</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>        <span class="kw">ROWS</span> <span class="kw">BETWEEN</span> <span class="dv">6</span> <span class="kw">PRECEDING</span> <span class="kw">AND</span> <span class="kw">CURRENT</span> <span class="kw">ROW</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>    ) <span class="kw">AS</span> seven_day_moving_avg</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>    daily_sales;</span></code></pre>
          </div>
        </ol>
      </section>
      <section>
        <ol start="3" type="1">
          <li><strong>Percentiles and Distribution Analysis</strong>:</li>
          <div class="sourceCode" id="cb9">
            <pre
              class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>    category_name,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>    price,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>    <span class="fu">PERCENT_RANK</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id <span class="kw">ORDER</span> <span class="kw">BY</span> price) <span class="kw">AS</span> percentile,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>        <span class="cf">WHEN</span> <span class="fu">PERCENT_RANK</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id <span class="kw">ORDER</span> <span class="kw">BY</span> price) <span class="op">&lt;</span> <span class="fl">0.25</span> <span class="cf">THEN</span> <span class="st">&#39;Budget&#39;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>        <span class="cf">WHEN</span> <span class="fu">PERCENT_RANK</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id <span class="kw">ORDER</span> <span class="kw">BY</span> price) <span class="op">&lt;</span> <span class="fl">0.75</span> <span class="cf">THEN</span> <span class="st">&#39;Mid-range&#39;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="st">&#39;Premium&#39;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>    <span class="cf">END</span> <span class="kw">AS</span> price_segment</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>    product p</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a>    <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id;</span></code></pre>
          </div>
        </ol>
      </section>
      <section>
        <ol start="4" type="1">
          <li><strong>Customer Purchase Patterns</strong>:</li>
          <div class="sourceCode" id="cb10">
            <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>    customer_id,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>    order_date,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>    amount,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>    <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> order_date) <span class="kw">AS</span> purchase_number,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>    order_date <span class="op">-</span> <span class="fu">LAG</span>(order_date) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> order_date) <span class="kw">AS</span> days_since_last_purchase,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>        <span class="cf">WHEN</span> order_date <span class="op">-</span> <span class="fu">LAG</span>(order_date) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> order_date) <span class="op">&gt;</span> <span class="dv">90</span> <span class="cf">THEN</span> <span class="st">&#39;Reactivated&#39;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>        <span class="cf">WHEN</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> order_date) <span class="op">=</span> <span class="dv">1</span> <span class="cf">THEN</span> <span class="st">&#39;New&#39;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="st">&#39;Returning&#39;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>    <span class="cf">END</span> <span class="kw">AS</span> customer_type</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>    orders;</span></code></pre>
          </div>
        </ol>
      </section>
      <section>
        <ol start="5" type="1">
          <li><strong>Identifying Outliers</strong>:</li>

          <div class="sourceCode" id="cb11">
            <pre
              class="sourceCode sql"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">WITH</span> product_stats <span class="kw">AS</span> (</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>        category_id,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>        product_id,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>        price,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>        <span class="fu">AVG</span>(price) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id) <span class="kw">AS</span> avg_price,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>        <span class="fu">STDDEV</span>(price) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> category_id) <span class="kw">AS</span> stddev_price</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>        product</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>    p.category_id,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>    c.category_name,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a>    p.product_id,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a>    p.price,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a>    p.avg_price,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a>    p.stddev_price,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a>    (p.price <span class="op">-</span> p.avg_price) <span class="op">/</span> <span class="fu">NULLIF</span>(p.stddev_price, <span class="dv">0</span>) <span class="kw">AS</span> z_score</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true"></a>    product_stats p</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true"></a>    <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true"></a><span class="kw">WHERE</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true"></a>    <span class="fu">ABS</span>((p.price <span class="op">-</span> p.avg_price) <span class="op">/</span> <span class="fu">NULLIF</span>(p.stddev_price, <span class="dv">0</span>)) <span class="op">&gt;</span> <span class="dv">2</span>;</span></code></pre>
          </div>
        </ol>
      </section>
      <section>
        <h3 id="advanced-aggregation-techniques">Advanced Aggregation Techniques</h3>
        <p>PostgreSQL offers advanced aggregation capabilities beyond basic functions like SUM, COUNT, and AVG.</p>
        <p><strong>Statistical Aggregations</strong>:</p>
        <div class="sourceCode" id="cb12">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="co">-- Basic statistics</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>    category_id,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> product_count,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a>    <span class="fu">AVG</span>(price) <span class="kw">AS</span> avg_price,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>    <span class="fu">STDDEV</span>(price) <span class="kw">AS</span> stddev_price,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a>    <span class="fu">VAR_SAMP</span>(price) <span class="kw">AS</span> variance_price,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>    <span class="fu">MIN</span>(price) <span class="kw">AS</span> min_price,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a>    <span class="fu">MAX</span>(price) <span class="kw">AS</span> max_price,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a>    <span class="fu">MAX</span>(price) <span class="op">-</span> <span class="fu">MIN</span>(price) <span class="kw">AS</span> price_range</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a>    product</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a>    category_id;</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true"></a><span class="co">-- Correlation coefficient</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true"></a>    <span class="fu">CORR</span>(price, weight) <span class="kw">AS</span> price_weight_correlation</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true"></a>    product;</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true"></a><span class="co">-- Regression slope and intercept</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true"></a>    <span class="fu">REGR_SLOPE</span>(price, weight) <span class="kw">AS</span> slope,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true"></a>    <span class="fu">REGR_INTERCEPT</span>(price, weight) <span class="kw">AS</span> intercept</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true"></a>    product;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Conditional Aggregations</strong>:</p>
        <div class="sourceCode" id="cb13">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="co">-- FILTER clause</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>    category_id,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> total_products,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FILTER</span> (<span class="kw">WHERE</span> price <span class="op">&lt;</span> <span class="dv">50</span>) <span class="kw">AS</span> budget_products,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FILTER</span> (<span class="kw">WHERE</span> price <span class="op">&gt;=</span> <span class="dv">50</span> <span class="kw">AND</span> price <span class="op">&lt;</span> <span class="dv">200</span>) <span class="kw">AS</span> midrange_products,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FILTER</span> (<span class="kw">WHERE</span> price <span class="op">&gt;=</span> <span class="dv">200</span>) <span class="kw">AS</span> premium_products</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a>    product</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a>    category_id;</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a><span class="co">-- Percentage calculations</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a>    category_id,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> total_products,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a>    <span class="fu">ROUND</span>(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FILTER</span> (<span class="kw">WHERE</span> price <span class="op">&lt;</span> <span class="dv">50</span>) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">COUNT</span>(<span class="op">*</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true"></a>        <span class="dv">2</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true"></a>    ) <span class="kw">AS</span> budget_percentage,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true"></a>    <span class="fu">ROUND</span>(</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FILTER</span> (<span class="kw">WHERE</span> price <span class="op">&gt;=</span> <span class="dv">50</span> <span class="kw">AND</span> price <span class="op">&lt;</span> <span class="dv">200</span>) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">COUNT</span>(<span class="op">*</span>),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true"></a>        <span class="dv">2</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true"></a>    ) <span class="kw">AS</span> midrange_percentage,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true"></a>    <span class="fu">ROUND</span>(</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FILTER</span> (<span class="kw">WHERE</span> price <span class="op">&gt;=</span> <span class="dv">200</span>) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">COUNT</span>(<span class="op">*</span>),</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true"></a>        <span class="dv">2</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true"></a>    ) <span class="kw">AS</span> premium_percentage</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true"></a>    product</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true"></a>    category_id;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Array Aggregations</strong>:</p>
        <div class="sourceCode" id="cb14">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="co">-- ARRAY_AGG: Collect values into an array</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>    category_id,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>    ARRAY_AGG(product_id) <span class="kw">AS</span> product_ids,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>    ARRAY_AGG(name <span class="kw">ORDER</span> <span class="kw">BY</span> price <span class="kw">DESC</span>) <span class="kw">AS</span> products_by_price</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>    product</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a>    category_id;</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true"></a><span class="co">-- STRING_AGG: Concatenate values with a delimiter</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true"></a>    order_id,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true"></a>    STRING_AGG(p.name, <span class="st">&#39;, &#39;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> oi.price <span class="kw">DESC</span>) <span class="kw">AS</span> ordered_products</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true"></a>    order_item oi</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true"></a>    product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true"></a>    order_id;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>JSON Aggregations</strong>:</p>
        <div class="sourceCode" id="cb15">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="co">-- JSON_AGG: Aggregate rows as JSON arrays</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>    category_id,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a>    JSON_AGG(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>        JSON_BUILD_OBJECT(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>            <span class="st">&#39;id&#39;</span>, product_id,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>            <span class="st">&#39;name&#39;</span>, name,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a>            <span class="st">&#39;price&#39;</span>, price</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a>        )</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a>    ) <span class="kw">AS</span> products</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a>    product</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a>    category_id;</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a><span class="co">-- JSONB_OBJECT_AGG: Create JSON objects from key-value pairs</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true"></a>    order_id,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true"></a>    JSONB_OBJECT_AGG(</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true"></a>        p.product_id,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true"></a>        JSON_BUILD_OBJECT(</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true"></a>            <span class="st">&#39;name&#39;</span>, p.name,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true"></a>            <span class="st">&#39;quantity&#39;</span>, oi.quantity,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true"></a>            <span class="st">&#39;price&#39;</span>, oi.price</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true"></a>        )</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true"></a>    ) <span class="kw">AS</span> order_items</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true"></a>    order_item oi</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true"></a>    product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true"></a>    order_id;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Custom Aggregations with GROUPING SETS, ROLLUP, and CUBE</strong>:</p>
        <div class="sourceCode" id="cb16">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="co">-- GROUPING SETS: Multiple grouping sets in one query</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>    <span class="fu">COALESCE</span>(category_name, <span class="st">&#39;All Categories&#39;</span>) <span class="kw">AS</span> <span class="kw">category</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>    <span class="fu">COALESCE</span>(supplier_name, <span class="st">&#39;All Suppliers&#39;</span>) <span class="kw">AS</span> supplier,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> product_count,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a>    <span class="fu">AVG</span>(price) <span class="kw">AS</span> avg_price</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true"></a>    product p</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true"></a>    <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true"></a>    supplier s <span class="kw">ON</span> p.supplier_id <span class="op">=</span> s.supplier_id</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true"></a>    <span class="fu">GROUPING</span> SETS (</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true"></a>        (category_name, supplier_name),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true"></a>        (category_name),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true"></a>        (supplier_name),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true"></a>        ()</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true"></a>    )</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true"></a>    <span class="kw">category</span>, supplier;</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true"></a><span class="co">-- ROLLUP: Hierarchical subtotals</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true"></a>    <span class="fu">EXTRACT</span>(<span class="dt">YEAR</span> <span class="kw">FROM</span> order_date) <span class="kw">AS</span> <span class="dt">year</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true"></a>    <span class="fu">EXTRACT</span>(<span class="dt">MONTH</span> <span class="kw">FROM</span> order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true"></a>    <span class="fu">EXTRACT</span>(<span class="dt">DAY</span> <span class="kw">FROM</span> order_date) <span class="kw">AS</span> <span class="dt">day</span>,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true"></a>    <span class="fu">SUM</span>(amount) <span class="kw">AS</span> total_sales</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true"></a>    orders</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true"></a>    <span class="kw">ROLLUP</span> (</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true"></a>        <span class="fu">EXTRACT</span>(<span class="dt">YEAR</span> <span class="kw">FROM</span> order_date),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true"></a>        <span class="fu">EXTRACT</span>(<span class="dt">MONTH</span> <span class="kw">FROM</span> order_date),</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true"></a>        <span class="fu">EXTRACT</span>(<span class="dt">DAY</span> <span class="kw">FROM</span> order_date)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true"></a>    )</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true"></a>    <span class="dt">year</span>, <span class="dt">month</span>, <span class="dt">day</span>;</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true"></a><span class="co">-- CUBE: All possible combinations of grouping sets</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true"></a>    <span class="fu">COALESCE</span>(category_name, <span class="st">&#39;All Categories&#39;</span>) <span class="kw">AS</span> <span class="kw">category</span>,</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true"></a>    <span class="fu">COALESCE</span>(<span class="fu">TO_CHAR</span>(order_date, <span class="st">&#39;YYYY&#39;</span>), <span class="st">&#39;All Years&#39;</span>) <span class="kw">AS</span> <span class="dt">year</span>,</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true"></a>    <span class="fu">COALESCE</span>(<span class="fu">TO_CHAR</span>(order_date, <span class="st">&#39;MM&#39;</span>), <span class="st">&#39;All Months&#39;</span>) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true"></a>    <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="kw">AS</span> sales</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true"></a>    order_item oi</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true"></a>    orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true"></a>    product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true"></a>    <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true"></a>    <span class="kw">CUBE</span> (category_name, <span class="fu">TO_CHAR</span>(order_date, <span class="st">&#39;YYYY&#39;</span>), <span class="fu">TO_CHAR</span>(order_date, <span class="st">&#39;MM&#39;</span>))</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true"></a>    <span class="kw">category</span>, <span class="dt">year</span>, <span class="dt">month</span>;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Practical Analytics Examples with Advanced Aggregations</strong>:</p>
        <ol type="1">
          <li><strong>Sales Analysis by Multiple Dimensions</strong>:</li>
          <div class="sourceCode" id="cb17">
            <pre
              class="sourceCode sql"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>    <span class="fu">COALESCE</span>(c.category_name, <span class="st">&#39;All Categories&#39;</span>) <span class="kw">AS</span> <span class="kw">category</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>    <span class="fu">COALESCE</span>(<span class="fu">TO_CHAR</span>(o.order_date, <span class="st">&#39;YYYY-MM&#39;</span>), <span class="st">&#39;All Time&#39;</span>) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>    <span class="fu">COALESCE</span>(r.region_name, <span class="st">&#39;All Regions&#39;</span>) <span class="kw">AS</span> region,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>    <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="kw">AS</span> sales,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> o.customer_id) <span class="kw">AS</span> customers,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>    <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="op">/</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> o.customer_id) <span class="kw">AS</span> avg_per_customer</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>    order_item oi</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>    orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a>    product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true"></a>    <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true"></a>    customer cu <span class="kw">ON</span> o.customer_id <span class="op">=</span> cu.customer_id</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true"></a>    region r <span class="kw">ON</span> cu.region_id <span class="op">=</span> r.region_id</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true"></a>    <span class="fu">GROUPING</span> SETS (</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true"></a>        (c.category_name, <span class="fu">TO_CHAR</span>(o.order_date, <span class="st">&#39;YYYY-MM&#39;</span>), r.region_name),</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true"></a>        (c.category_name, <span class="fu">TO_CHAR</span>(o.order_date, <span class="st">&#39;YYYY-MM&#39;</span>)),</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true"></a>        (c.category_name, r.region_name),</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true"></a>        (<span class="fu">TO_CHAR</span>(o.order_date, <span class="st">&#39;YYYY-MM&#39;</span>), r.region_name),</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true"></a>        (c.category_name),</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true"></a>        (<span class="fu">TO_CHAR</span>(o.order_date, <span class="st">&#39;YYYY-MM&#39;</span>)),</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true"></a>        (r.region_name),</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true"></a>        ()</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true"></a>    )</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true"></a>    <span class="kw">category</span>, <span class="dt">month</span>, region;</span></code></pre>
          </div>
        </ol>
      </section>
      <section>
        <ol start="2" type="1">
          <li><strong>Customer Segmentation Analysis</strong>:</li>
          <div class="sourceCode" id="cb18">
            <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="kw">WITH</span> customer_stats <span class="kw">AS</span> (</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>        customer_id,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> order_count,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>        <span class="fu">SUM</span>(amount) <span class="kw">AS</span> total_spent,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>        <span class="fu">AVG</span>(amount) <span class="kw">AS</span> avg_order_value,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>        <span class="fu">MIN</span>(order_date) <span class="kw">AS</span> first_order_date,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>        <span class="fu">MAX</span>(order_date) <span class="kw">AS</span> last_order_date,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>        <span class="fu">MAX</span>(order_date) <span class="op">-</span> <span class="fu">MIN</span>(order_date) <span class="kw">AS</span> customer_lifespan</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true"></a>        orders</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true"></a>        customer_id</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true"></a>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true"></a>        <span class="cf">WHEN</span> order_count <span class="op">&gt;=</span> <span class="dv">10</span> <span class="kw">AND</span> total_spent <span class="op">&gt;=</span> <span class="dv">1000</span> <span class="cf">THEN</span> <span class="st">&#39;VIP&#39;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true"></a>        <span class="cf">WHEN</span> order_count <span class="op">&gt;=</span> <span class="dv">5</span> <span class="kw">OR</span> total_spent <span class="op">&gt;=</span> <span class="dv">500</span> <span class="cf">THEN</span> <span class="st">&#39;Regular&#39;</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="st">&#39;Occasional&#39;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true"></a>    <span class="cf">END</span> <span class="kw">AS</span> customer_segment,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> customer_count,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(order_count), <span class="dv">2</span>) <span class="kw">AS</span> avg_orders,</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(total_spent), <span class="dv">2</span>) <span class="kw">AS</span> avg_total_spent,</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(avg_order_value), <span class="dv">2</span>) <span class="kw">AS</span> avg_order_value,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(<span class="fu">EXTRACT</span>(<span class="dt">DAY</span> <span class="kw">FROM</span> customer_lifespan)), <span class="dv">2</span>) <span class="kw">AS</span> avg_lifespan_days</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true"></a>    customer_stats</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true"></a>        <span class="cf">WHEN</span> order_count <span class="op">&gt;=</span> <span class="dv">10</span> <span class="kw">AND</span> total_spent <span class="op">&gt;=</span> <span class="dv">1000</span> <span class="cf">THEN</span> <span class="st">&#39;VIP&#39;</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true"></a>        <span class="cf">WHEN</span> order_count <span class="op">&gt;=</span> <span class="dv">5</span> <span class="kw">OR</span> total_spent <span class="op">&gt;=</span> <span class="dv">500</span> <span class="cf">THEN</span> <span class="st">&#39;Regular&#39;</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="st">&#39;Occasional&#39;</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true"></a>    <span class="cf">END</span>;</span></code></pre>
          </div>
        </ol>
      </section>
      <section>
        <ol start="3" type="1">
          <li><strong>Product Affinity Analysis (Market Basket Analysis)</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb19">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="kw">WITH</span> product_pairs <span class="kw">AS</span> (</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>        oi1.product_id <span class="kw">AS</span> product1,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a>        oi2.product_id <span class="kw">AS</span> product2,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> oi1.order_id) <span class="kw">AS</span> order_count</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a>        order_item oi1</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true"></a>        order_item oi2 <span class="kw">ON</span> oi1.order_id <span class="op">=</span> oi2.order_id <span class="kw">AND</span> oi1.product_id <span class="op">&lt;</span> oi2.product_id</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true"></a>        oi1.product_id, oi2.product_id</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true"></a>    <span class="kw">HAVING</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> oi1.order_id) <span class="op">&gt;=</span> <span class="dv">5</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true"></a>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true"></a>    p1.name <span class="kw">AS</span> product1,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true"></a>    p2.name <span class="kw">AS</span> product2,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true"></a>    pp.order_count,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true"></a>    <span class="fu">ROUND</span>(</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true"></a>        pp.order_count <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> (</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true"></a>            <span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> order_id) <span class="kw">FROM</span> orders</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true"></a>        ),</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true"></a>        <span class="dv">2</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true"></a>    ) <span class="kw">AS</span> percentage_of_orders</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true"></a>    product_pairs pp</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true"></a>    product p1 <span class="kw">ON</span> pp.product1 <span class="op">=</span> p1.product_id</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true"></a>    product p2 <span class="kw">ON</span> pp.product2 <span class="op">=</span> p2.product_id</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true"></a>    pp.order_count <span class="kw">DESC</span>;</span></code></pre>
        </div>
      </section>
      <section>
        <h3 id="common-table-expressions-ctes-for-complex-analytics">Common Table Expressions (CTEs) for Complex
          Analytics
        </h3>
        <p>Common Table Expressions (CTEs) provide a way to write auxiliary statements for use in a larger query, making
          complex analytics queries more readable and maintainable.</p>
        <p><strong>Basic CTE Syntax</strong>:</p>
        <div class="sourceCode" id="cb20">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="kw">WITH</span> cte_name <span class="kw">AS</span> (</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a>    <span class="kw">SELECT</span> column1, column2, <span class="op">..</span>.</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a>    <span class="kw">FROM</span> table_name</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a>    <span class="kw">WHERE</span> condition</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true"></a><span class="kw">FROM</span> cte_name;</span></code></pre>
        </div>
        <p><strong>Using Multiple CTEs</strong>:</p>
        <div class="sourceCode" id="cb21">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="kw">WITH</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>customer_orders <span class="kw">AS</span> (</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>        customer_id,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> order_count,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a>        <span class="fu">SUM</span>(amount) <span class="kw">AS</span> total_spent</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true"></a>        orders</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true"></a>        customer_id</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true"></a>),</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true"></a>customer_segments <span class="kw">AS</span> (</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true"></a>        customer_id,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true"></a>        <span class="cf">CASE</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true"></a>            <span class="cf">WHEN</span> order_count <span class="op">&gt;=</span> <span class="dv">10</span> <span class="kw">AND</span> total_spent <span class="op">&gt;=</span> <span class="dv">1000</span> <span class="cf">THEN</span> <span class="st">&#39;VIP&#39;</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true"></a>            <span class="cf">WHEN</span> order_count <span class="op">&gt;=</span> <span class="dv">5</span> <span class="kw">OR</span> total_spent <span class="op">&gt;=</span> <span class="dv">500</span> <span class="cf">THEN</span> <span class="st">&#39;Regular&#39;</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true"></a>            <span class="cf">ELSE</span> <span class="st">&#39;Occasional&#39;</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true"></a>        <span class="cf">END</span> <span class="kw">AS</span> <span class="kw">segment</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true"></a>        customer_orders</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true"></a>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true"></a>    <span class="kw">segment</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> customer_count</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true"></a>    customer_segments</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true"></a>    <span class="kw">segment</span>;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Recursive CTEs</strong>:</p>
        <p>Recursive CTEs are particularly useful for hierarchical or graph-structured data.</p>
        <div class="sourceCode" id="cb22">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="co">-- Employee hierarchy example</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="kw">WITH</span> RECURSIVE employee_hierarchy <span class="kw">AS</span> (</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a>    <span class="co">-- Base case: top-level employees (no manager)</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true"></a>        <span class="kw">id</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true"></a>        name,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true"></a>        manager_id,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true"></a>        <span class="dv">1</span> <span class="kw">AS</span> <span class="kw">level</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true"></a>        name <span class="kw">AS</span> path</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true"></a>        employee</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true"></a>    <span class="kw">WHERE</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true"></a>        manager_id <span class="kw">IS</span> <span class="kw">NULL</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true"></a>    </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true"></a>    <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true"></a>    </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true"></a>    <span class="co">-- Recursive case: employees with managers</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true"></a>        e.<span class="kw">id</span>,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true"></a>        e.name,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true"></a>        e.manager_id,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true"></a>        eh.<span class="kw">level</span> <span class="op">+</span> <span class="dv">1</span>,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true"></a>        eh.path <span class="op">||</span> <span class="st">&#39; &gt; &#39;</span> <span class="op">||</span> e.name</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true"></a>        employee e</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true"></a>        employee_hierarchy eh <span class="kw">ON</span> e.manager_id <span class="op">=</span> eh.<span class="kw">id</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true"></a>)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true"></a>    <span class="kw">id</span>,</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true"></a>    name,</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true"></a>    manager_id,</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true"></a>    <span class="kw">level</span>,</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true"></a>    path</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true"></a>    employee_hierarchy</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true"></a>    path;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Practical Analytics Examples with CTEs</strong>:</p>
        <ol type="1">
          <li><strong>Customer Lifetime Value Analysis</strong>:</li>
          <div class="sourceCode" id="cb23">
            <pre
              class="sourceCode sql"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="kw">WITH</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a>customer_orders <span class="kw">AS</span> (</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a>        customer_id,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a>        DATE_TRUNC(<span class="st">&#39;month&#39;</span>, order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true"></a>        <span class="fu">SUM</span>(amount) <span class="kw">AS</span> monthly_spent</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true"></a>        orders</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true"></a>        customer_id, DATE_TRUNC(<span class="st">&#39;month&#39;</span>, order_date)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true"></a>),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true"></a>customer_monthly_stats <span class="kw">AS</span> (</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true"></a>        customer_id,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> <span class="dt">month</span>) <span class="kw">AS</span> active_months,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true"></a>        <span class="fu">SUM</span>(monthly_spent) <span class="kw">AS</span> total_spent,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true"></a>        <span class="fu">AVG</span>(monthly_spent) <span class="kw">AS</span> avg_monthly_spent</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true"></a>        customer_orders</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true"></a>        customer_id</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true"></a>),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true"></a>customer_segments <span class="kw">AS</span> (</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true"></a>        cms.<span class="op">*</span>,</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true"></a>        <span class="fu">NTILE</span>(<span class="dv">4</span>) <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> total_spent <span class="kw">DESC</span>) <span class="kw">AS</span> spending_quartile,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true"></a>        <span class="fu">NTILE</span>(<span class="dv">4</span>) <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> active_months <span class="kw">DESC</span>) <span class="kw">AS</span> loyalty_quartile</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true"></a>        customer_monthly_stats cms</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true"></a>),</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true"></a>customer_ltv <span class="kw">AS</span> (</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true"></a>        customer_id,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true"></a>        total_spent,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true"></a>        active_months,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true"></a>        avg_monthly_spent,</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true"></a>        spending_quartile,</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true"></a>        loyalty_quartile,</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true"></a>        avg_monthly_spent <span class="op">*</span> <span class="dv">12</span> <span class="op">*</span> <span class="dv">3</span> <span class="kw">AS</span> projected_3year_value <span class="co">-- Simple projection</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true"></a>        customer_segments</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true"></a>)</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true"></a>    spending_quartile,</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true"></a>    loyalty_quartile,</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> customer_count,</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(total_spent), <span class="dv">2</span>) <span class="kw">AS</span> avg_total_spent,</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(active_months), <span class="dv">2</span>) <span class="kw">AS</span> avg_active_months,</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(projected_3year_value), <span class="dv">2</span>) <span class="kw">AS</span> avg_projected_3year_value</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true"></a>    customer_ltv</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true"></a>    spending_quartile, loyalty_quartile</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true"></a>    spending_quartile, loyalty_quartile;</span></code></pre>
          </div>
        </ol>
      </section>
      <section>
        <ol start="2" type="1">
          <li><strong>Cohort Analysis</strong>:</li>

          <div class="sourceCode" id="cb24">
            <pre
              class="sourceCode sql"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="kw">WITH</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a>first_purchases <span class="kw">AS</span> (</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a>        customer_id,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a>        DATE_TRUNC(<span class="st">&#39;month&#39;</span>, <span class="fu">MIN</span>(order_date)) <span class="kw">AS</span> cohort_month</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a>        orders</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true"></a>        customer_id</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true"></a>),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true"></a>customer_activity <span class="kw">AS</span> (</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true"></a>        fp.customer_id,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true"></a>        fp.cohort_month,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true"></a>        DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date) <span class="kw">AS</span> activity_month,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true"></a>        DATE_PART(<span class="st">&#39;month&#39;</span>, DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date) <span class="op">-</span> fp.cohort_month) <span class="kw">AS</span> months_since_first_purchase,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true"></a>        <span class="fu">SUM</span>(o.amount) <span class="kw">AS</span> amount</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true"></a>        orders o</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true"></a>        first_purchases fp <span class="kw">ON</span> o.customer_id <span class="op">=</span> fp.customer_id</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true"></a>        fp.customer_id, fp.cohort_month, DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true"></a>),</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true"></a>cohort_size <span class="kw">AS</span> (</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true"></a>        cohort_month,</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> customer_id) <span class="kw">AS</span> num_customers</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true"></a>        first_purchases</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true"></a>        cohort_month</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true"></a>),</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true"></a>cohort_retention <span class="kw">AS</span> (</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true"></a>        ca.cohort_month,</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true"></a>        ca.months_since_first_purchase,</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> ca.customer_id) <span class="kw">AS</span> num_customers,</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true"></a>        <span class="fu">SUM</span>(ca.amount) <span class="kw">AS</span> total_amount</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true"></a>        customer_activity ca</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true"></a>        ca.cohort_month, ca.months_since_first_purchase</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true"></a>)</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true"></a>    cr.cohort_month,</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true"></a>    cs.num_customers <span class="kw">AS</span> cohort_size,</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true"></a>    cr.months_since_first_purchase,</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true"></a>    cr.num_customers <span class="kw">AS</span> active_customers,</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true"></a>    <span class="fu">ROUND</span>(cr.num_customers <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> cs.num_customers, <span class="dv">2</span>) <span class="kw">AS</span> retention_rate,</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true"></a>    <span class="fu">ROUND</span>(cr.total_amount, <span class="dv">2</span>) <span class="kw">AS</span> total_amount,</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true"></a>    <span class="fu">ROUND</span>(cr.total_amount <span class="op">/</span> cr.num_customers, <span class="dv">2</span>) <span class="kw">AS</span> avg_amount_per_customer</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true"></a>    cohort_retention cr</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true"></a>    cohort_size cs <span class="kw">ON</span> cr.cohort_month <span class="op">=</span> cs.cohort_month</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true"></a>    cr.cohort_month, cr.months_since_first_purchase;</span></code></pre>
          </div>
        </ol>
      </section>
      <section>
        <ol start="3" type="1">
          <li><strong>Customer Journey Analysis</strong>:</li>
          <div class="sourceCode" id="cb25">
            <pre
              class="sourceCode sql"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="kw">WITH</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a>customer_touchpoints <span class="kw">AS</span> (</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a>    <span class="co">-- Orders</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a>        customer_id,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a>        order_date <span class="kw">AS</span> event_date,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a>        <span class="st">&#39;purchase&#39;</span> <span class="kw">AS</span> event_type,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a>        amount <span class="kw">AS</span> event_value,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a>        order_id <span class="kw">AS</span> event_id</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true"></a>        orders</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true"></a>    </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true"></a>    <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true"></a>    </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true"></a>    <span class="co">-- Website visits</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true"></a>        customer_id,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true"></a>        visit_date <span class="kw">AS</span> event_date,</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true"></a>        <span class="st">&#39;website_visit&#39;</span> <span class="kw">AS</span> event_type,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true"></a>        <span class="kw">NULL</span> <span class="kw">AS</span> event_value,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true"></a>        visit_id <span class="kw">AS</span> event_id</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true"></a>        website_visits</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true"></a>    </span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true"></a>    <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true"></a>    </span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true"></a>    <span class="co">-- Support tickets</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true"></a>        customer_id,</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true"></a>        created_at <span class="kw">AS</span> event_date,</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true"></a>        <span class="st">&#39;support_ticket&#39;</span> <span class="kw">AS</span> event_type,</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true"></a>        <span class="kw">NULL</span> <span class="kw">AS</span> event_value,</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true"></a>        ticket_id <span class="kw">AS</span> event_id</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true"></a>        support_tickets</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true"></a>),</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true"></a>customer_journey <span class="kw">AS</span> (</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true"></a>        customer_id,</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true"></a>        event_date,</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true"></a>        event_type,</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true"></a>        event_value,</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true"></a>        event_id,</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true"></a>        <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> event_date) <span class="kw">AS</span> event_sequence,</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true"></a>        <span class="fu">LEAD</span>(event_type) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> event_date) <span class="kw">AS</span> next_event_type,</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true"></a>        <span class="fu">LEAD</span>(event_date) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> event_date) <span class="op">-</span> event_date <span class="kw">AS</span> time_to_next_event</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true"></a>        customer_touchpoints</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true"></a>)</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true"></a>    event_type,</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true"></a>    next_event_type,</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> transition_count,</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(<span class="fu">EXTRACT</span>(EPOCH <span class="kw">FROM</span> time_to_next_event) <span class="op">/</span> <span class="dv">86400</span>), <span class="dv">2</span>) <span class="kw">AS</span> avg_days_to_next_event</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true"></a>    customer_journey</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true"></a><span class="kw">WHERE</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true"></a>    next_event_type <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true"></a>    event_type, next_event_type</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true"></a>    event_type, transition_count <span class="kw">DESC</span>;</span></code></pre>
          </div>
        </ol>
      </section>
      <section>
        <h3 id="data-visualization-with-postgresql">Data Visualization with PostgreSQL</h3>
        <p>While PostgreSQL itself doesn’t provide visualization capabilities, you can prepare data for visualization
          tools or generate basic visualizations using SQL results. Here, we’ll focus on preparing data for
          visualization
          and explore some options for connecting visualization tools to PostgreSQL.</p>
        <p><strong>Preparing Data for Visualization</strong>:</p>
        <ol type="1">
          <li><strong>Aggregating Data at the Right Level</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb26">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="co">-- Daily sales for time series chart</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a>    order_date,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a>    <span class="fu">SUM</span>(amount) <span class="kw">AS</span> daily_sales</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true"></a>    orders</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true"></a>    order_date</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true"></a>    order_date;</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true"></a><span class="co">-- Monthly sales by category for bar chart</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true"></a>    DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true"></a>    c.category_name,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true"></a>    <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="kw">AS</span> sales</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true"></a>    order_item oi</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true"></a>    orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true"></a>    product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true"></a>    <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true"></a>    DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date), c.category_name</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true"></a>    <span class="dt">month</span>, c.category_name;</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true"></a></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true"></a><span class="co">-- Regional sales for map visualization</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true"></a>    r.region_name,</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true"></a>    r.latitude,</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true"></a>    r.longitude,</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> o.order_id) <span class="kw">AS</span> order_count,</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true"></a>    <span class="fu">SUM</span>(o.amount) <span class="kw">AS</span> total_sales</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true"></a>    orders o</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true"></a>    customer c <span class="kw">ON</span> o.customer_id <span class="op">=</span> c.customer_id</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true"></a>    region r <span class="kw">ON</span> c.region_id <span class="op">=</span> r.region_id</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true"></a>    r.region_name, r.latitude, r.longitude;</span></code></pre>
        </div>
      </section>
      <section>
        <ol start="2" type="1">
          <li><strong>Calculating Percentages for Pie Charts</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb27">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="kw">WITH</span> category_sales <span class="kw">AS</span> (</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a>        c.category_name,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="kw">AS</span> sales</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true"></a>        order_item oi</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true"></a>        orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true"></a>        product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true"></a>        <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true"></a>        c.category_name</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true"></a>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true"></a>    category_name,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true"></a>    sales,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true"></a>    <span class="fu">ROUND</span>(sales <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">SUM</span>(sales) <span class="kw">OVER</span> (), <span class="dv">2</span>) <span class="kw">AS</span> percentage</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true"></a>    category_sales</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true"></a>    sales <span class="kw">DESC</span>;</span></code></pre>
        </div>
      </section>
      <section>
        <ol start="3" type="1">
          <li><strong>Preparing Data for Heatmaps</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb28">
          <pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a><span class="co">-- Sales heatmap by day of week and hour</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a>    <span class="fu">EXTRACT</span>(DOW <span class="kw">FROM</span> order_date) <span class="kw">AS</span> day_of_week,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a>    <span class="fu">EXTRACT</span>(<span class="kw">HOUR</span> <span class="kw">FROM</span> order_time) <span class="kw">AS</span> hour_of_day,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> order_count,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a>    <span class="fu">SUM</span>(amount) <span class="kw">AS</span> total_sales</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true"></a>    orders</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true"></a>    <span class="fu">EXTRACT</span>(DOW <span class="kw">FROM</span> order_date), <span class="fu">EXTRACT</span>(<span class="kw">HOUR</span> <span class="kw">FROM</span> order_time)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true"></a>    day_of_week, hour_of_day;</span></code></pre>
        </div>
      </section>
      <section>
        <ol start="4" type="1">
          <li><strong>Preparing Data for Network Graphs</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb29">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a><span class="co">-- Product co-purchase network</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a>    p1.product_id <span class="kw">AS</span> source_id,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true"></a>    p1.name <span class="kw">AS</span> source_name,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true"></a>    p2.product_id <span class="kw">AS</span> target_id,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true"></a>    p2.name <span class="kw">AS</span> target_name,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> oi1.order_id) <span class="kw">AS</span> weight</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true"></a>    order_item oi1</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true"></a>    order_item oi2 <span class="kw">ON</span> oi1.order_id <span class="op">=</span> oi2.order_id <span class="kw">AND</span> oi1.product_id <span class="op">&lt;</span> oi2.product_id</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true"></a>    product p1 <span class="kw">ON</span> oi1.product_id <span class="op">=</span> p1.product_id</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true"></a>    product p2 <span class="kw">ON</span> oi2.product_id <span class="op">=</span> p2.product_id</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true"></a>    p1.product_id, p1.name, p2.product_id, p2.name</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true"></a><span class="kw">HAVING</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> oi1.order_id) <span class="op">&gt;=</span> <span class="dv">5</span>;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Exporting Data for Visualization</strong>:</p>
        <ol type="1">
          <li><strong>CSV Export</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb30">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a><span class="co">-- From psql command line</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a>\<span class="kw">copy</span> (<span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> monthly_sales) <span class="kw">TO</span> <span class="st">&#39;/path/to/monthly_sales.csv&#39;</span> <span class="kw">WITH</span> CSV <span class="kw">HEADER</span>;</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a><span class="co">-- Using SQL</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true"></a><span class="kw">COPY</span> (</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true"></a>        DATE_TRUNC(<span class="st">&#39;month&#39;</span>, order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true"></a>        <span class="fu">SUM</span>(amount) <span class="kw">AS</span> monthly_sales</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true"></a>        orders</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true"></a>        DATE_TRUNC(<span class="st">&#39;month&#39;</span>, order_date)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true"></a>    <span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true"></a>        <span class="dt">month</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true"></a>) <span class="kw">TO</span> <span class="st">&#39;/tmp/monthly_sales.csv&#39;</span> <span class="kw">WITH</span> CSV <span class="kw">HEADER</span>;</span></code></pre>
        </div>
      </section>
      <section>
        <ol start="2" type="1">
          <li><strong>JSON Export</strong>:</li>
        </ol>
        <div class="sourceCode" id="cb31">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a><span class="co">-- Export as JSON array</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a>    JSON_AGG(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a>        JSON_BUILD_OBJECT(</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true"></a>            <span class="st">&#39;date&#39;</span>, order_date,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true"></a>            <span class="st">&#39;sales&#39;</span>, daily_sales</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true"></a>        )</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true"></a>    )</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true"></a><span class="kw">FROM</span> (</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true"></a>        order_date,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true"></a>        <span class="fu">SUM</span>(amount) <span class="kw">AS</span> daily_sales</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true"></a>        orders</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true"></a>        order_date</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true"></a>    <span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true"></a>        order_date</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true"></a>) <span class="kw">AS</span> daily_sales_data;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Visualization Tools for PostgreSQL</strong>:</p>
        <ol type="1">
          <li><strong>Direct Connection Tools</strong>:
            <ul>
              <li>Tableau</li>
              <li>Power BI</li>
              <li>Looker</li>
              <li>Metabase</li>
              <li>Grafana</li>
              <li>Redash</li>
              <li>Apache Superset</li>
            </ul>
          </li>
          <li><strong>Programming Libraries</strong>:
            <ul>
              <li>Python: Matplotlib, Seaborn, Plotly</li>
              <li>R: ggplot2, Shiny</li>
              <li>JavaScript: D3.js, Chart.js</li>
            </ul>
          </li>
          <li><strong>PostgreSQL-Specific Extensions</strong>:
            <ul>
              <li>PL/R: R language procedural language for PostgreSQL</li>
              <li>MADlib: Machine learning in SQL</li>
            </ul>
          </li>
        </ol>
      </section>
      <section>
        <p><strong>Example: Setting Up a Basic Dashboard with Metabase</strong>:</p>
        <ol type="1">
          <li>Install Metabase</li>
          <li>Connect to PostgreSQL database</li>
          <li>Create saved questions for key metrics:</li>
        </ol>
        <div class="sourceCode" id="cb32">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a><span class="co">-- Monthly revenue trend</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a>    DATE_TRUNC(<span class="st">&#39;month&#39;</span>, order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true"></a>    <span class="fu">SUM</span>(amount) <span class="kw">AS</span> monthly_revenue</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true"></a>    orders</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true"></a>    DATE_TRUNC(<span class="st">&#39;month&#39;</span>, order_date)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true"></a>    <span class="dt">month</span>;</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true"></a><span class="co">-- Top customers</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true"></a>    c.name <span class="kw">AS</span> customer_name,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true"></a>    <span class="fu">COUNT</span>(o.order_id) <span class="kw">AS</span> order_count,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true"></a>    <span class="fu">SUM</span>(o.amount) <span class="kw">AS</span> total_spent</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true"></a>    orders o</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true"></a>    customer c <span class="kw">ON</span> o.customer_id <span class="op">=</span> c.customer_id</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true"></a>    c.name</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true"></a>    total_spent <span class="kw">DESC</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true"></a><span class="co">-- Sales by category</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true"></a>    cat.category_name,</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true"></a>    <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="kw">AS</span> sales</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true"></a>    order_item oi</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true"></a>    orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true"></a>    product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true"></a>    <span class="kw">category</span> cat <span class="kw">ON</span> p.category_id <span class="op">=</span> cat.category_id</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true"></a>    cat.category_name</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true"></a>    sales <span class="kw">DESC</span>;</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true"></a></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true"></a><span class="co">-- Regional sales map</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true"></a>    r.region_name,</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true"></a>    r.latitude,</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true"></a>    r.longitude,</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> o.order_id) <span class="kw">AS</span> order_count,</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true"></a>    <span class="fu">SUM</span>(o.amount) <span class="kw">AS</span> total_sales</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true"></a>    orders o</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true"></a>    customer c <span class="kw">ON</span> o.customer_id <span class="op">=</span> c.customer_id</span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true"></a>    region r <span class="kw">ON</span> c.region_id <span class="op">=</span> r.region_id</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true"></a>    r.region_name, r.latitude, r.longitude;</span></code></pre>
        </div>
      </section>
      <section>
        <ol start="4" type="1">
          <li>Arrange questions into a dashboard</li>
          <li>Set up automatic refresh</li>
        </ol>
        <p><strong>Example: Python Visualization with psycopg2 and Matplotlib</strong>:</p>
        <div class="sourceCode" id="cb33">
          <pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a><span class="im">import</span> psycopg2</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true"></a><span class="co"># Connect to PostgreSQL</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true"></a>conn <span class="op">=</span> psycopg2.<span class="ex">connect</span>(</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true"></a>    host<span class="op">=</span><span class="st">&quot;localhost&quot;</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true"></a>    database<span class="op">=</span><span class="st">&quot;erp_database&quot;</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true"></a>    user<span class="op">=</span><span class="st">&quot;analyst&quot;</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true"></a>    password<span class="op">=</span><span class="st">&quot;password&quot;</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true"></a>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true"></a><span class="co"># Query monthly sales data</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true"></a>query <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true"></a><span class="st">SELECT</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true"></a><span class="st">    DATE_TRUNC(&#39;month&#39;, order_date) AS month,</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true"></a><span class="st">    SUM(amount) AS monthly_sales</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true"></a><span class="st">FROM</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true"></a><span class="st">    orders</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true"></a><span class="st">GROUP BY</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true"></a><span class="st">    DATE_TRUNC(&#39;month&#39;, order_date)</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true"></a><span class="st">ORDER BY</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true"></a><span class="st">    month</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true"></a><span class="co"># Load data into pandas DataFrame</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true"></a>df <span class="op">=</span> pd.read_sql_query(query, conn)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true"></a>df[<span class="st">&#39;month&#39;</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">&#39;month&#39;</span>])</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true"></a><span class="co"># Create visualization</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true"></a>sns.lineplot(x<span class="op">=</span><span class="st">&#39;month&#39;</span>, y<span class="op">=</span><span class="st">&#39;monthly_sales&#39;</span>, data<span class="op">=</span>df, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true"></a>plt.title(<span class="st">&#39;Monthly Sales Trend&#39;</span>)</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true"></a>plt.xlabel(<span class="st">&#39;Month&#39;</span>)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true"></a>plt.ylabel(<span class="st">&#39;Sales Amount&#39;</span>)</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true"></a>plt.tight_layout()</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true"></a>plt.savefig(<span class="st">&#39;monthly_sales_trend.png&#39;</span>)</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true"></a>plt.close()</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true"></a></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true"></a><span class="co"># Query category sales data</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true"></a>query <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true"></a><span class="st">SELECT</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true"></a><span class="st">    c.category_name,</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true"></a><span class="st">    SUM(oi.quantity * oi.price) AS sales</span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true"></a><span class="st">FROM</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true"></a><span class="st">    order_item oi</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true"></a><span class="st">JOIN</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true"></a><span class="st">    orders o ON oi.order_id = o.order_id</span></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true"></a><span class="st">JOIN</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true"></a><span class="st">    product p ON oi.product_id = p.product_id</span></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true"></a><span class="st">JOIN</span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true"></a><span class="st">    category c ON p.category_id = c.category_id</span></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true"></a><span class="st">GROUP BY</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true"></a><span class="st">    c.category_name</span></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true"></a><span class="st">ORDER BY</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true"></a><span class="st">    sales DESC</span></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true"></a></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true"></a><span class="co"># Load data into pandas DataFrame</span></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true"></a>df <span class="op">=</span> pd.read_sql_query(query, conn)</span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true"></a></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true"></a><span class="co"># Create visualization</span></span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true"></a>sns.barplot(x<span class="op">=</span><span class="st">&#39;sales&#39;</span>, y<span class="op">=</span><span class="st">&#39;category_name&#39;</span>, data<span class="op">=</span>df)</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true"></a>plt.title(<span class="st">&#39;Sales by Category&#39;</span>)</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true"></a>plt.xlabel(<span class="st">&#39;Sales Amount&#39;</span>)</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true"></a>plt.ylabel(<span class="st">&#39;Category&#39;</span>)</span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true"></a>plt.grid(<span class="va">True</span>, axis<span class="op">=</span><span class="st">&#39;x&#39;</span>)</span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true"></a>plt.tight_layout()</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true"></a>plt.savefig(<span class="st">&#39;sales_by_category.png&#39;</span>)</span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true"></a></span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true"></a><span class="co"># Close connection</span></span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true"></a>conn.close()</span></code></pre>
        </div>
      </section>
      <section>
        <h3 id="hands-on-workshop-analytics-with-postgresql">Hands-on Workshop: Analytics with PostgreSQL</h3>
        <p>Let’s apply what we’ve learned in a hands-on workshop using an ERP database. We’ll explore sales data,
          customer
          behavior, and product performance.</p>
        <p><strong>Exercise 1: Sales Performance Dashboard</strong></p>
        <p>In this exercise, we’ll create queries for a sales performance dashboard.</p>
        <div class="sourceCode" id="cb34">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a><span class="co">-- 1. Monthly sales trend with year-over-year comparison</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a><span class="kw">WITH</span> monthly_sales <span class="kw">AS</span> (</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true"></a>        DATE_TRUNC(<span class="st">&#39;month&#39;</span>, order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true"></a>        <span class="fu">EXTRACT</span>(<span class="dt">YEAR</span> <span class="kw">FROM</span> order_date) <span class="kw">AS</span> <span class="dt">year</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true"></a>        <span class="fu">SUM</span>(amount) <span class="kw">AS</span> monthly_revenue</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true"></a>        orders</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true"></a>        DATE_TRUNC(<span class="st">&#39;month&#39;</span>, order_date), <span class="fu">EXTRACT</span>(<span class="dt">YEAR</span> <span class="kw">FROM</span> order_date)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true"></a>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true"></a>    <span class="fu">TO_CHAR</span>(<span class="dt">month</span>, <span class="st">&#39;Month&#39;</span>) <span class="kw">AS</span> month_name,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true"></a>    <span class="dt">year</span>,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true"></a>    monthly_revenue,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true"></a>    <span class="fu">LAG</span>(monthly_revenue) <span class="kw">OVER</span> (</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true"></a>        <span class="kw">PARTITION</span> <span class="kw">BY</span> <span class="fu">TO_CHAR</span>(<span class="dt">month</span>, <span class="st">&#39;Month&#39;</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true"></a>        <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">year</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true"></a>    ) <span class="kw">AS</span> prev_year_revenue,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true"></a>        <span class="cf">WHEN</span> <span class="fu">LAG</span>(monthly_revenue) <span class="kw">OVER</span> (</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true"></a>            <span class="kw">PARTITION</span> <span class="kw">BY</span> <span class="fu">TO_CHAR</span>(<span class="dt">month</span>, <span class="st">&#39;Month&#39;</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true"></a>            <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">year</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true"></a>        ) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true"></a>        <span class="cf">THEN</span> <span class="fu">ROUND</span>(</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true"></a>            (monthly_revenue <span class="op">-</span> <span class="fu">LAG</span>(monthly_revenue) <span class="kw">OVER</span> (</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true"></a>                <span class="kw">PARTITION</span> <span class="kw">BY</span> <span class="fu">TO_CHAR</span>(<span class="dt">month</span>, <span class="st">&#39;Month&#39;</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true"></a>                <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">year</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true"></a>            )) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">NULLIF</span>(<span class="fu">LAG</span>(monthly_revenue) <span class="kw">OVER</span> (</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true"></a>                <span class="kw">PARTITION</span> <span class="kw">BY</span> <span class="fu">TO_CHAR</span>(<span class="dt">month</span>, <span class="st">&#39;Month&#39;</span>)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true"></a>                <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">year</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true"></a>            ), <span class="dv">0</span>),</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true"></a>            <span class="dv">2</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true"></a>        )</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="kw">NULL</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true"></a>    <span class="cf">END</span> <span class="kw">AS</span> yoy_growth_percent</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true"></a>    monthly_sales</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true"></a>    <span class="dt">year</span>, <span class="dt">month</span>;</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true"></a><span class="co">-- 2. Sales by region with comparison to targets</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true"></a><span class="kw">WITH</span> regional_sales <span class="kw">AS</span> (</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true"></a>        r.region_id,</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true"></a>        r.region_name,</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true"></a>        <span class="fu">SUM</span>(o.amount) <span class="kw">AS</span> actual_sales</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true"></a>        orders o</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true"></a>        customer c <span class="kw">ON</span> o.customer_id <span class="op">=</span> c.customer_id</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true"></a>        region r <span class="kw">ON</span> c.region_id <span class="op">=</span> r.region_id</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true"></a>    <span class="kw">WHERE</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true"></a>        o.order_date <span class="kw">BETWEEN</span> <span class="st">&#39;2023-01-01&#39;</span> <span class="kw">AND</span> <span class="st">&#39;2023-12-31&#39;</span></span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true"></a>        r.region_id, r.region_name</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true"></a>)</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true"></a>    rs.region_name,</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true"></a>    rs.actual_sales,</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true"></a>    rt.target_sales,</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true"></a>    rs.actual_sales <span class="op">-</span> rt.target_sales <span class="kw">AS</span> sales_gap,</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true"></a>    <span class="fu">ROUND</span>((rs.actual_sales <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">NULLIF</span>(rt.target_sales, <span class="dv">0</span>)), <span class="dv">2</span>) <span class="kw">AS</span> percent_of_target,</span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true"></a>        <span class="cf">WHEN</span> rs.actual_sales <span class="op">&gt;=</span> rt.target_sales <span class="cf">THEN</span> <span class="st">&#39;Met or Exceeded&#39;</span></span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true"></a>        <span class="cf">WHEN</span> rs.actual_sales <span class="op">&gt;=</span> rt.target_sales <span class="op">*</span> <span class="fl">0.9</span> <span class="cf">THEN</span> <span class="st">&#39;Nearly Met&#39;</span></span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="st">&#39;Below Target&#39;</span></span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true"></a>    <span class="cf">END</span> <span class="kw">AS</span> performance_category</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true"></a>    regional_sales rs</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true"></a>    region_targets rt <span class="kw">ON</span> rs.region_id <span class="op">=</span> rt.region_id <span class="kw">AND</span> rt.<span class="dt">year</span> <span class="op">=</span> <span class="dv">2023</span></span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true"></a>    percent_of_target <span class="kw">DESC</span>;</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true"></a></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true"></a><span class="co">-- 3. Top-selling products with trend indicators</span></span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true"></a><span class="kw">WITH</span> product_sales <span class="kw">AS</span> (</span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true"></a>        p.product_id,</span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true"></a>        p.name <span class="kw">AS</span> product_name,</span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true"></a>        DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity) <span class="kw">AS</span> units_sold,</span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="kw">AS</span> revenue</span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true"></a>        order_item oi</span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true"></a>        orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true"></a>        product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true"></a>    <span class="kw">WHERE</span></span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true"></a>        o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;6 months&#39;</span></span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true"></a>        p.product_id, p.name, DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date)</span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true"></a>),</span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true"></a>product_totals <span class="kw">AS</span> (</span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true"></a>        product_id,</span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true"></a>        product_name,</span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true"></a>        <span class="fu">SUM</span>(units_sold) <span class="kw">AS</span> total_units,</span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true"></a>        <span class="fu">SUM</span>(revenue) <span class="kw">AS</span> total_revenue,</span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> <span class="dt">month</span>) <span class="kw">AS</span> months_with_sales,</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true"></a>        <span class="fu">FIRST_VALUE</span>(units_sold) <span class="kw">OVER</span> (</span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true"></a>            <span class="kw">PARTITION</span> <span class="kw">BY</span> product_id</span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true"></a>            <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">month</span></span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true"></a>        ) <span class="kw">AS</span> first_month_units,</span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true"></a>        <span class="fu">LAST_VALUE</span>(units_sold) <span class="kw">OVER</span> (</span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true"></a>            <span class="kw">PARTITION</span> <span class="kw">BY</span> product_id</span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true"></a>            <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">month</span></span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true"></a>            <span class="kw">RANGE</span> <span class="kw">BETWEEN</span> <span class="kw">UNBOUNDED</span> <span class="kw">PRECEDING</span> <span class="kw">AND</span> <span class="kw">UNBOUNDED</span> <span class="kw">FOLLOWING</span></span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true"></a>        ) <span class="kw">AS</span> last_month_units</span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true"></a>        product_sales</span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true"></a>        product_id, product_name, <span class="dt">month</span>, units_sold</span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true"></a>)</span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true"></a>    product_name,</span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true"></a>    <span class="fu">SUM</span>(total_units) <span class="kw">AS</span> total_units_sold,</span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true"></a>    <span class="fu">SUM</span>(total_revenue) <span class="kw">AS</span> total_revenue,</span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(total_revenue) <span class="op">/</span> <span class="fu">SUM</span>(total_units), <span class="dv">2</span>) <span class="kw">AS</span> avg_unit_price,</span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true"></a>        <span class="cf">WHEN</span> <span class="fu">MAX</span>(last_month_units) <span class="op">&gt;</span> <span class="fu">MAX</span>(first_month_units) <span class="cf">THEN</span> <span class="st">&#39;Trending Up&#39;</span></span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true"></a>        <span class="cf">WHEN</span> <span class="fu">MAX</span>(last_month_units) <span class="op">&lt;</span> <span class="fu">MAX</span>(first_month_units) <span class="cf">THEN</span> <span class="st">&#39;Trending Down&#39;</span></span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="st">&#39;Stable&#39;</span></span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true"></a>    <span class="cf">END</span> <span class="kw">AS</span> trend</span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true"></a>    product_totals</span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true"></a>    product_id, product_name</span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true"></a>    total_revenue <span class="kw">DESC</span></span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true"></a></span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true"></a><span class="co">-- 4. Sales team performance scorecard</span></span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true"></a><span class="kw">WITH</span> salesperson_performance <span class="kw">AS</span> (</span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true"></a>        e.employee_id,</span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true"></a>        e.first_name <span class="op">||</span> <span class="st">&#39; &#39;</span> <span class="op">||</span> e.last_name <span class="kw">AS</span> salesperson_name,</span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> o.order_id) <span class="kw">AS</span> orders_closed,</span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> o.customer_id) <span class="kw">AS</span> customers_served,</span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true"></a>        <span class="fu">SUM</span>(o.amount) <span class="kw">AS</span> total_sales,</span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true"></a>        <span class="fu">AVG</span>(o.amount) <span class="kw">AS</span> avg_order_value,</span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true"></a>        <span class="fu">SUM</span>(o.amount) <span class="op">/</span> <span class="fu">NULLIF</span>(<span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> o.customer_id), <span class="dv">0</span>) <span class="kw">AS</span> avg_revenue_per_customer</span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true"></a>        orders o</span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb34-148"><a href="#cb34-148" aria-hidden="true"></a>        employee e <span class="kw">ON</span> o.salesperson_id <span class="op">=</span> e.employee_id</span>
<span id="cb34-149"><a href="#cb34-149" aria-hidden="true"></a>    <span class="kw">WHERE</span></span>
<span id="cb34-150"><a href="#cb34-150" aria-hidden="true"></a>        o.order_date <span class="kw">BETWEEN</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;3 months&#39;</span> <span class="kw">AND</span> <span class="fu">CURRENT_DATE</span></span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true"></a>        e.employee_id, e.first_name, e.last_name</span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true"></a>),</span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true"></a>team_averages <span class="kw">AS</span> (</span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true"></a>        <span class="fu">AVG</span>(orders_closed) <span class="kw">AS</span> avg_orders_closed,</span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true"></a>        <span class="fu">AVG</span>(customers_served) <span class="kw">AS</span> avg_customers_served,</span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true"></a>        <span class="fu">AVG</span>(total_sales) <span class="kw">AS</span> avg_total_sales,</span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true"></a>        <span class="fu">AVG</span>(avg_order_value) <span class="kw">AS</span> avg_order_value_all,</span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true"></a>        <span class="fu">AVG</span>(avg_revenue_per_customer) <span class="kw">AS</span> avg_revenue_per_customer_all</span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true"></a>        salesperson_performance</span>
<span id="cb34-163"><a href="#cb34-163" aria-hidden="true"></a>)</span>
<span id="cb34-164"><a href="#cb34-164" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true"></a>    sp.salesperson_name,</span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true"></a>    sp.orders_closed,</span>
<span id="cb34-167"><a href="#cb34-167" aria-hidden="true"></a>    <span class="fu">ROUND</span>((sp.orders_closed <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> ta.avg_orders_closed) <span class="op">-</span> <span class="dv">100</span>, <span class="dv">2</span>) <span class="kw">AS</span> orders_vs_avg,</span>
<span id="cb34-168"><a href="#cb34-168" aria-hidden="true"></a>    sp.total_sales,</span>
<span id="cb34-169"><a href="#cb34-169" aria-hidden="true"></a>    <span class="fu">ROUND</span>((sp.total_sales <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> ta.avg_total_sales) <span class="op">-</span> <span class="dv">100</span>, <span class="dv">2</span>) <span class="kw">AS</span> sales_vs_avg,</span>
<span id="cb34-170"><a href="#cb34-170" aria-hidden="true"></a>    sp.avg_order_value,</span>
<span id="cb34-171"><a href="#cb34-171" aria-hidden="true"></a>    sp.customers_served,</span>
<span id="cb34-172"><a href="#cb34-172" aria-hidden="true"></a>    sp.avg_revenue_per_customer,</span>
<span id="cb34-173"><a href="#cb34-173" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb34-174"><a href="#cb34-174" aria-hidden="true"></a>        <span class="cf">WHEN</span> sp.total_sales <span class="op">&gt;</span> ta.avg_total_sales <span class="op">*</span> <span class="fl">1.2</span> <span class="cf">THEN</span> <span class="st">&#39;Top Performer&#39;</span></span>
<span id="cb34-175"><a href="#cb34-175" aria-hidden="true"></a>        <span class="cf">WHEN</span> sp.total_sales <span class="op">&gt;</span> ta.avg_total_sales <span class="cf">THEN</span> <span class="st">&#39;Above Average&#39;</span></span>
<span id="cb34-176"><a href="#cb34-176" aria-hidden="true"></a>        <span class="cf">WHEN</span> sp.total_sales <span class="op">&gt;</span> ta.avg_total_sales <span class="op">*</span> <span class="fl">0.8</span> <span class="cf">THEN</span> <span class="st">&#39;Average&#39;</span></span>
<span id="cb34-177"><a href="#cb34-177" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="st">&#39;Needs Improvement&#39;</span></span>
<span id="cb34-178"><a href="#cb34-178" aria-hidden="true"></a>    <span class="cf">END</span> <span class="kw">AS</span> performance_category</span>
<span id="cb34-179"><a href="#cb34-179" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb34-180"><a href="#cb34-180" aria-hidden="true"></a>    salesperson_performance sp</span>
<span id="cb34-181"><a href="#cb34-181" aria-hidden="true"></a><span class="kw">CROSS</span> <span class="kw">JOIN</span></span>
<span id="cb34-182"><a href="#cb34-182" aria-hidden="true"></a>    team_averages ta</span>
<span id="cb34-183"><a href="#cb34-183" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb34-184"><a href="#cb34-184" aria-hidden="true"></a>    sp.total_sales <span class="kw">DESC</span>;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Exercise 2: Customer Analytics</strong></p>
        <p>In this exercise, we’ll analyze customer behavior and segmentation.</p>
        <div class="sourceCode" id="cb35">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a><span class="co">-- 1. RFM (Recency, Frequency, Monetary) Analysis</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a><span class="kw">WITH</span> customer_rfm <span class="kw">AS</span> (</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a>        c.customer_id,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a>        c.name <span class="kw">AS</span> customer_name,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true"></a>        <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="fu">MAX</span>(o.order_date) <span class="kw">AS</span> recency,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true"></a>        <span class="fu">COUNT</span>(o.order_id) <span class="kw">AS</span> frequency,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true"></a>        <span class="fu">SUM</span>(o.amount) <span class="kw">AS</span> monetary</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true"></a>        customer c</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true"></a>        orders o <span class="kw">ON</span> c.customer_id <span class="op">=</span> o.customer_id</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true"></a>        c.customer_id, c.name</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true"></a>),</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true"></a>rfm_scores <span class="kw">AS</span> (</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true"></a>        customer_id,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true"></a>        customer_name,</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true"></a>        recency,</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true"></a>        frequency,</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true"></a>        monetary,</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true"></a>        <span class="fu">NTILE</span>(<span class="dv">5</span>) <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> recency <span class="kw">DESC</span>) <span class="kw">AS</span> r_score,</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true"></a>        <span class="fu">NTILE</span>(<span class="dv">5</span>) <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> frequency) <span class="kw">AS</span> f_score,</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true"></a>        <span class="fu">NTILE</span>(<span class="dv">5</span>) <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> monetary) <span class="kw">AS</span> m_score</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true"></a>        customer_rfm</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true"></a>)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true"></a>    customer_id,</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true"></a>    customer_name,</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true"></a>    recency,</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true"></a>    frequency,</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true"></a>    monetary,</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true"></a>    r_score,</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true"></a>    f_score,</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true"></a>    m_score,</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true"></a>    r_score <span class="op">||</span> f_score <span class="op">||</span> m_score <span class="kw">AS</span> rfm_score,</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true"></a>        <span class="cf">WHEN</span> r_score <span class="op">&gt;=</span> <span class="dv">4</span> <span class="kw">AND</span> f_score <span class="op">&gt;=</span> <span class="dv">4</span> <span class="kw">AND</span> m_score <span class="op">&gt;=</span> <span class="dv">4</span> <span class="cf">THEN</span> <span class="st">&#39;Champions&#39;</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true"></a><span class="cf">    WHEN</span> r_score <span class="op">&gt;=</span> <span class="dv">3</span> <span class="kw">AND</span> f_score <span class="op">&gt;=</span> <span class="dv">3</span> <span class="kw">AND</span> m_score <span class="op">&gt;=</span> <span class="dv">3</span> <span class="cf">THEN</span> <span class="st">&#39;Loyal Customers&#39;</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true"></a><span class="cf">    WHEN</span> r_score <span class="op">&gt;=</span> <span class="dv">3</span> <span class="kw">AND</span> f_score <span class="op">&gt;=</span> <span class="dv">1</span> <span class="kw">AND</span> m_score <span class="op">&gt;=</span> <span class="dv">2</span> <span class="cf">THEN</span> <span class="st">&#39;Potential Loyalists&#39;</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true"></a><span class="cf">    WHEN</span> r_score <span class="op">&gt;=</span> <span class="dv">4</span> <span class="kw">AND</span> f_score <span class="op">&lt;=</span> <span class="dv">2</span> <span class="kw">AND</span> m_score <span class="op">&lt;=</span> <span class="dv">2</span> <span class="cf">THEN</span> <span class="st">&#39;New Customers&#39;</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true"></a><span class="cf">    WHEN</span> r_score <span class="op">&lt;=</span> <span class="dv">2</span> <span class="kw">AND</span> f_score <span class="op">&gt;=</span> <span class="dv">3</span> <span class="kw">AND</span> m_score <span class="op">&gt;=</span> <span class="dv">3</span> <span class="cf">THEN</span> <span class="st">&#39;At Risk&#39;</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true"></a><span class="cf">    WHEN</span> r_score <span class="op">&lt;=</span> <span class="dv">2</span> <span class="kw">AND</span> f_score <span class="op">&gt;=</span> <span class="dv">2</span> <span class="kw">AND</span> m_score <span class="op">&gt;=</span> <span class="dv">2</span> <span class="cf">THEN</span> <span class="st">&#39;Need Attention&#39;</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true"></a><span class="cf">    WHEN</span> r_score <span class="op">&lt;=</span> <span class="dv">1</span> <span class="kw">AND</span> f_score <span class="op">&gt;=</span> <span class="dv">4</span> <span class="kw">AND</span> m_score <span class="op">&gt;=</span> <span class="dv">4</span> <span class="cf">THEN</span> <span class="st">&#39;Cant Lose Them&#39;</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true"></a><span class="cf">    WHEN</span> r_score <span class="op">&lt;=</span> <span class="dv">2</span> <span class="kw">AND</span> f_score <span class="op">&lt;=</span> <span class="dv">2</span> <span class="kw">AND</span> m_score <span class="op">&lt;=</span> <span class="dv">2</span> <span class="cf">THEN</span> <span class="st">&#39;Hibernating&#39;</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true"></a><span class="cf">    WHEN</span> r_score <span class="op">&lt;=</span> <span class="dv">1</span> <span class="kw">AND</span> f_score <span class="op">&lt;=</span> <span class="dv">1</span> <span class="kw">AND</span> m_score <span class="op">&lt;=</span> <span class="dv">1</span> <span class="cf">THEN</span> <span class="st">&#39;Lost&#39;</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true"></a><span class="cf">        ELSE &#39;</span>Others<span class="st">&#39;</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true"></a><span class="cf">    END AS customer_segment</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true"></a><span class="cf">FROM</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true"></a>    rfm_scores</span></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true"></a><span class="cf">ORDER BY</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true"></a><span class="cf">    CASE</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true"></a><span class="cf">        WHEN</span> r_score &gt;= 4 <span class="cf">AND</span> f_score &gt;= 4 <span class="cf">AND</span> m_score &gt;= 4 <span class="cf">THEN</span> 1</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true"></a><span class="cf">        WHEN</span> r_score &gt;= 3 <span class="cf">AND</span> f_score &gt;= 3 <span class="cf">AND</span> m_score &gt;= 3 <span class="cf">THEN</span> 2</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true"></a><span class="cf">        ELSE 3</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true"></a><span class="cf">    END,</span></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true"></a>    monetary <span class="cf">DESC;</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true"></a></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true"></a><span class="st">-- 2. Customer Purchase Journey Analysis</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true"></a><span class="cf">WITH</span> customer_purchases <span class="cf">AS </span>(</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true"></a><span class="cf">    SELECT</span></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true"></a>        c.customer_id,</span></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true"></a>        c.name AS customer_name,</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true"></a>        o.order_id,</span></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true"></a>        o.order_date,</span></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true"></a>        o.amount,</span></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true"></a>        <span class="fu">ROW_NUMBER()</span> <span class="cf">OVER (PARTITION BY</span> c.customer_id ORDER BY o.order_date) <span class="cf">AS</span> purchase_number,</span></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true"></a>        <span class="fu">LEAD(o.order_date)</span> <span class="cf">OVER (PARTITION BY</span> c.customer_id ORDER BY o.order_date) <span class="cf">AS</span> next_purchase_date,</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true"></a>        <span class="fu">LEAD(o.order_date)</span> <span class="cf">OVER (PARTITION BY</span> c.customer_id ORDER BY o.order_date) - o.order_date <span class="cf">AS</span> days_to_next_purchase</span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true"></a><span class="cf">    FROM</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true"></a>        customer c</span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true"></a><span class="cf">    JOIN</span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true"></a>        orders o ON c.customer_id = o.customer_id</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true"></a>),</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true"></a>purchase_summary <span class="cf">AS</span> (</span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true"></a><span class="cf">    SELECT</span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true"></a>        customer_id,</span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true"></a>        customer_name,</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true"></a>        <span class="fu">COUNT</span>(*) <span class="cf">AS</span> total_purchases,</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true"></a>        <span class="fu">MIN</span>(order_date) <span class="cf">AS</span> first_purchase_date,</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true"></a>        <span class="fu">MAX</span>(order_date) <span class="cf">AS</span> last_purchase_date,</span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true"></a>        <span class="fu">MAX</span>(order_date) - MIN(order_date) <span class="cf">AS</span> customer_lifespan,</span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true"></a>        <span class="fu">SUM</span>(amount) <span class="cf">AS</span> total_spent,</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true"></a>        <span class="fu">AVG</span>(amount) <span class="cf">AS</span> avg_order_value,</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true"></a>        <span class="fu">AVG</span>(EXTRACT(DAY FROM days_to_next_purchase)) <span class="cf">AS</span> avg_days_between_purchases</span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true"></a><span class="cf"></span>    FROM</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true"></a>        customer_purchases</span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true"></a><span class="cf"></span>    GROUP BY</span></span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true"></a>        customer_id, customer_name</span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true"></a>)</span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true"></a><span class="cf">SELECT</span></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true"></a>    ps.*,</span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true"></a><span class="cf">    CASE</span></span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true"></a><span class="cf">        WHEN</span> ps.last_purchase_date &lt; CURRENT_DATE - INTERVAL &#39;</span><span class="dv">90</span> days<span class="st">&#39; THEN &#39;</span>Churned<span class="st">&#39;</span></span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true"></a><span class="cf">        WHEN</span> ps.last_purchase_date &lt; CURRENT_DATE - INTERVAL &#39;</span><span class="dv">60</span> days<span class="st">&#39; THEN &#39;</span>At Risk<span class="st">&#39;</span></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true"></a><span class="cf">        WHEN</span> ps.last_purchase_date &lt; CURRENT_DATE - INTERVAL &#39;</span><span class="dv">30</span> days<span class="st">&#39; THEN &#39;</span>Active<span class="st">&#39;</span></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true"></a><span class="cf">        ELSE</span> &#39;</span>Recently Active<span class="st">&#39;</span></span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true"></a>    END AS current_status,</span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true"></a>    CASE</span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true"></a>        WHEN ps.total_purchases = 1 THEN &#39;</span>One<span class="op">-</span>time<span class="st">&#39;</span></span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true"></a>        WHEN ps.total_purchases = 2 THEN &#39;</span>Second Purchase<span class="st">&#39;</span></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true"></a>        WHEN ps.total_purchases &lt;= 5 THEN &#39;</span>Regular<span class="st">&#39;</span></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true"></a>        ELSE &#39;</span>Loyal<span class="st">&#39;</span></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true"></a>    END AS purchase_frequency_segment,</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true"></a>    ROUND(ps.total_spent / NULLIF(EXTRACT(DAY FROM ps.customer_lifespan), 0) * 30, 2) AS monthly_revenue</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true"></a>FROM</span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true"></a>    purchase_summary ps</span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true"></a>ORDER BY</span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true"></a>    total_spent DESC;</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true"></a></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true"></a>-- 3. Customer Cohort Retention Analysis</span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true"></a>WITH first_purchases AS (</span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true"></a>    SELECT</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true"></a>        customer_id,</span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true"></a>        DATE_TRUNC(&#39;month&#39;, MIN(order_date)) AS cohort_month</span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true"></a>    FROM</span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true"></a>        orders</span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true"></a>    GROUP BY</span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true"></a>        customer_id</span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true"></a>),</span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true"></a>cohort_data AS (</span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true"></a>    SELECT</span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true"></a>        fp.customer_id,</span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true"></a>        fp.cohort_month,</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true"></a>        DATE_TRUNC(&#39;month&#39;, o.order_date) AS order_month,</span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true"></a>        EXTRACT(YEAR FROM DATE_TRUNC(&#39;month&#39;, o.order_date)) - </span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true"></a>        EXTRACT(YEAR FROM fp.cohort_month) AS year_diff,</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true"></a>        EXTRACT(MONTH FROM DATE_TRUNC(&#39;month&#39;, o.order_date)) - </span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true"></a>        EXTRACT(MONTH FROM fp.cohort_month) + </span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true"></a>        (EXTRACT(YEAR FROM DATE_TRUNC(&#39;</span>month<span class="st">&#39;, o.order_date)) - </span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true"></a>         EXTRACT(YEAR FROM fp.cohort_month)) * 12 AS month_diff</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true"></a>    FROM</span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true"></a>        first_purchases fp</span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true"></a>    JOIN</span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true"></a>        orders o ON fp.customer_id = o.customer_id</span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true"></a>),</span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true"></a>cohort_size AS (</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true"></a>    SELECT</span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true"></a>        cohort_month,</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true"></a>        COUNT(DISTINCT customer_id) AS num_customers</span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true"></a>    FROM</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true"></a>        first_purchases</span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true"></a>    GROUP BY</span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true"></a>        cohort_month</span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true"></a>),</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true"></a>retention AS (</span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true"></a>    SELECT</span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true"></a>        cohort_month,</span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true"></a>        month_diff,</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true"></a>        COUNT(DISTINCT customer_id) AS num_customers</span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true"></a>    FROM</span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true"></a>        cohort_data</span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true"></a>    GROUP BY</span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true"></a>        cohort_month, month_diff</span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true"></a>)</span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true"></a>SELECT</span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true"></a>    TO_CHAR(r.cohort_month, &#39;</span>YYYY<span class="op">-</span>MM<span class="st">&#39;) AS cohort,</span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true"></a>    cs.num_customers AS cohort_size,</span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true"></a>    r.month_diff,</span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true"></a>    r.num_customers AS retained_customers,</span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true"></a>    ROUND(r.num_customers * 100.0 / cs.num_customers, 2) AS retention_rate</span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true"></a>FROM</span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true"></a>    retention r</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true"></a>JOIN</span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true"></a>    cohort_size cs ON r.cohort_month = cs.cohort_month</span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true"></a>WHERE</span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true"></a>    r.month_diff &lt;= 12</span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true"></a>ORDER BY</span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true"></a>    r.cohort_month, r.month_diff;</span></span></code>
        </div>
      </section>
      <section>
        <p><strong>Exercise 3: Product Performance Analytics</strong></p>
        <p>In this exercise, we’ll analyze product performance and identify opportunities.</p>
        <div class="sourceCode" id="cb36">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a><span class="co">-- 1. Product Performance Matrix</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a><span class="kw">WITH</span> product_metrics <span class="kw">AS</span> (</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true"></a>        p.product_id,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true"></a>        p.name <span class="kw">AS</span> product_name,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true"></a>        p.category_id,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true"></a>        c.category_name,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> oi.order_id) <span class="kw">AS</span> order_count,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity) <span class="kw">AS</span> units_sold,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="kw">AS</span> revenue,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> (oi.price <span class="op">-</span> p.<span class="kw">cost</span>)) <span class="kw">AS</span> profit,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> (oi.price <span class="op">-</span> p.<span class="kw">cost</span>)) <span class="op">/</span> <span class="fu">NULLIF</span>(<span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price), <span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span> <span class="kw">AS</span> profit_margin</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true"></a>        product p</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true"></a>        <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true"></a>        order_item oi <span class="kw">ON</span> p.product_id <span class="op">=</span> oi.product_id</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true"></a>        orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true"></a>    <span class="kw">WHERE</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true"></a>        o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true"></a>        p.product_id, p.name, p.category_id, c.category_name</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true"></a>),</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true"></a>product_rankings <span class="kw">AS</span> (</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true"></a>        product_id,</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true"></a>        product_name,</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true"></a>        category_id,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true"></a>        category_name,</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true"></a>        order_count,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true"></a>        units_sold,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true"></a>        revenue,</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true"></a>        profit,</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true"></a>        profit_margin,</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true"></a>        <span class="fu">PERCENT_RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> revenue) <span class="kw">AS</span> revenue_percentile,</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true"></a>        <span class="fu">PERCENT_RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> profit_margin) <span class="kw">AS</span> margin_percentile</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true"></a>        product_metrics</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true"></a>)</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true"></a>    product_id,</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true"></a>    product_name,</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true"></a>    category_name,</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true"></a>    order_count,</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true"></a>    units_sold,</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true"></a>    <span class="fu">ROUND</span>(revenue, <span class="dv">2</span>) <span class="kw">AS</span> revenue,</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true"></a>    <span class="fu">ROUND</span>(profit, <span class="dv">2</span>) <span class="kw">AS</span> profit,</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true"></a>    <span class="fu">ROUND</span>(profit_margin, <span class="dv">2</span>) <span class="kw">AS</span> profit_margin,</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true"></a>        <span class="cf">WHEN</span> revenue_percentile <span class="op">&gt;=</span> <span class="fl">0.8</span> <span class="kw">AND</span> margin_percentile <span class="op">&gt;=</span> <span class="fl">0.8</span> <span class="cf">THEN</span> <span class="st">&#39;Star&#39;</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true"></a>        <span class="cf">WHEN</span> revenue_percentile <span class="op">&gt;=</span> <span class="fl">0.8</span> <span class="kw">AND</span> margin_percentile <span class="op">&lt;</span> <span class="fl">0.8</span> <span class="cf">THEN</span> <span class="st">&#39;High Volume&#39;</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true"></a>        <span class="cf">WHEN</span> revenue_percentile <span class="op">&lt;</span> <span class="fl">0.8</span> <span class="kw">AND</span> margin_percentile <span class="op">&gt;=</span> <span class="fl">0.8</span> <span class="cf">THEN</span> <span class="st">&#39;High Margin&#39;</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="st">&#39;Underperformer&#39;</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true"></a>    <span class="cf">END</span> <span class="kw">AS</span> product_category</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true"></a>    product_rankings</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true"></a>        <span class="cf">WHEN</span> revenue_percentile <span class="op">&gt;=</span> <span class="fl">0.8</span> <span class="kw">AND</span> margin_percentile <span class="op">&gt;=</span> <span class="fl">0.8</span> <span class="cf">THEN</span> <span class="dv">1</span></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true"></a>        <span class="cf">WHEN</span> revenue_percentile <span class="op">&gt;=</span> <span class="fl">0.8</span> <span class="kw">AND</span> margin_percentile <span class="op">&lt;</span> <span class="fl">0.8</span> <span class="cf">THEN</span> <span class="dv">2</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true"></a>        <span class="cf">WHEN</span> revenue_percentile <span class="op">&lt;</span> <span class="fl">0.8</span> <span class="kw">AND</span> margin_percentile <span class="op">&gt;=</span> <span class="fl">0.8</span> <span class="cf">THEN</span> <span class="dv">3</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="dv">4</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true"></a>    <span class="cf">END</span>,</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true"></a>    revenue <span class="kw">DESC</span>;</span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true"></a></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true"></a><span class="co">-- 2. Product Affinity Analysis (Market Basket)</span></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true"></a><span class="kw">WITH</span> product_pairs <span class="kw">AS</span> (</span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true"></a>        oi1.product_id <span class="kw">AS</span> product1_id,</span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true"></a>        p1.name <span class="kw">AS</span> product1_name,</span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true"></a>        oi2.product_id <span class="kw">AS</span> product2_id,</span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true"></a>        p2.name <span class="kw">AS</span> product2_name,</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> oi1.order_id) <span class="kw">AS</span> co_occurrence_count</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true"></a>        order_item oi1</span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true"></a>        order_item oi2 <span class="kw">ON</span> oi1.order_id <span class="op">=</span> oi2.order_id <span class="kw">AND</span> oi1.product_id <span class="op">&lt;</span> oi2.product_id</span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true"></a>        product p1 <span class="kw">ON</span> oi1.product_id <span class="op">=</span> p1.product_id</span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true"></a>        product p2 <span class="kw">ON</span> oi2.product_id <span class="op">=</span> p2.product_id</span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true"></a>        oi1.product_id, p1.name, oi2.product_id, p2.name</span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true"></a>    <span class="kw">HAVING</span></span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> oi1.order_id) <span class="op">&gt;=</span> <span class="dv">3</span></span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true"></a>),</span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true"></a>product_counts <span class="kw">AS</span> (</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true"></a>        product_id,</span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> order_id) <span class="kw">AS</span> order_count</span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true"></a>        order_item</span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true"></a>        product_id</span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true"></a>),</span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true"></a>total_orders <span class="kw">AS</span> (</span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true"></a>    <span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> order_id) <span class="kw">AS</span> total <span class="kw">FROM</span> orders</span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true"></a>)</span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true"></a>    pp.product1_name,</span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true"></a>    pp.product2_name,</span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true"></a>    pp.co_occurrence_count,</span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true"></a>    pc1.order_count <span class="kw">AS</span> product1_count,</span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true"></a>    pc2.order_count <span class="kw">AS</span> product2_count,</span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true"></a>    <span class="fu">ROUND</span>(pp.co_occurrence_count <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="kw">to</span>.total, <span class="dv">2</span>) <span class="kw">AS</span> percentage_of_all_orders,</span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true"></a>    <span class="fu">ROUND</span>(pp.co_occurrence_count <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> pc1.order_count, <span class="dv">2</span>) <span class="kw">AS</span> product1_to_product2_confidence,</span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true"></a>    <span class="fu">ROUND</span>(pp.co_occurrence_count <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> pc2.order_count, <span class="dv">2</span>) <span class="kw">AS</span> product2_to_product1_confidence,</span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true"></a>    <span class="fu">ROUND</span>(</span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true"></a>        (pp.co_occurrence_count <span class="op">*</span> <span class="kw">to</span>.total) <span class="op">*</span> <span class="fl">1.0</span> <span class="op">/</span> (pc1.order_count <span class="op">*</span> pc2.order_count),</span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true"></a>        <span class="dv">4</span></span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true"></a>    ) <span class="kw">AS</span> lift</span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true"></a>    product_pairs pp</span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true"></a>    product_counts pc1 <span class="kw">ON</span> pp.product1_id <span class="op">=</span> pc1.product_id</span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb36-119"><a href="#cb36-119" aria-hidden="true"></a>    product_counts pc2 <span class="kw">ON</span> pp.product2_id <span class="op">=</span> pc2.product_id</span>
<span id="cb36-120"><a href="#cb36-120" aria-hidden="true"></a><span class="kw">CROSS</span> <span class="kw">JOIN</span></span>
<span id="cb36-121"><a href="#cb36-121" aria-hidden="true"></a>    total_orders <span class="kw">to</span></span>
<span id="cb36-122"><a href="#cb36-122" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb36-123"><a href="#cb36-123" aria-hidden="true"></a>    lift <span class="kw">DESC</span>;</span>
<span id="cb36-124"><a href="#cb36-124" aria-hidden="true"></a></span>
<span id="cb36-125"><a href="#cb36-125" aria-hidden="true"></a><span class="co">-- 3. Product Category Trend Analysis</span></span>
<span id="cb36-126"><a href="#cb36-126" aria-hidden="true"></a><span class="kw">WITH</span> monthly_category_sales <span class="kw">AS</span> (</span>
<span id="cb36-127"><a href="#cb36-127" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb36-128"><a href="#cb36-128" aria-hidden="true"></a>        DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb36-129"><a href="#cb36-129" aria-hidden="true"></a>        c.category_id,</span>
<span id="cb36-130"><a href="#cb36-130" aria-hidden="true"></a>        c.category_name,</span>
<span id="cb36-131"><a href="#cb36-131" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity) <span class="kw">AS</span> units_sold,</span>
<span id="cb36-132"><a href="#cb36-132" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="kw">AS</span> revenue</span>
<span id="cb36-133"><a href="#cb36-133" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb36-134"><a href="#cb36-134" aria-hidden="true"></a>        order_item oi</span>
<span id="cb36-135"><a href="#cb36-135" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb36-136"><a href="#cb36-136" aria-hidden="true"></a>        orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb36-137"><a href="#cb36-137" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb36-138"><a href="#cb36-138" aria-hidden="true"></a>        product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb36-139"><a href="#cb36-139" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb36-140"><a href="#cb36-140" aria-hidden="true"></a>        <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb36-141"><a href="#cb36-141" aria-hidden="true"></a>    <span class="kw">WHERE</span></span>
<span id="cb36-142"><a href="#cb36-142" aria-hidden="true"></a>        o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span></span>
<span id="cb36-143"><a href="#cb36-143" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb36-144"><a href="#cb36-144" aria-hidden="true"></a>        DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date), c.category_id, c.category_name</span>
<span id="cb36-145"><a href="#cb36-145" aria-hidden="true"></a>),</span>
<span id="cb36-146"><a href="#cb36-146" aria-hidden="true"></a>category_growth <span class="kw">AS</span> (</span>
<span id="cb36-147"><a href="#cb36-147" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb36-148"><a href="#cb36-148" aria-hidden="true"></a>        category_id,</span>
<span id="cb36-149"><a href="#cb36-149" aria-hidden="true"></a>        category_name,</span>
<span id="cb36-150"><a href="#cb36-150" aria-hidden="true"></a>        <span class="fu">FIRST_VALUE</span>(revenue) <span class="kw">OVER</span> (</span>
<span id="cb36-151"><a href="#cb36-151" aria-hidden="true"></a>            <span class="kw">PARTITION</span> <span class="kw">BY</span> category_id</span>
<span id="cb36-152"><a href="#cb36-152" aria-hidden="true"></a>            <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">month</span></span>
<span id="cb36-153"><a href="#cb36-153" aria-hidden="true"></a>        ) <span class="kw">AS</span> first_month_revenue,</span>
<span id="cb36-154"><a href="#cb36-154" aria-hidden="true"></a>        <span class="fu">LAST_VALUE</span>(revenue) <span class="kw">OVER</span> (</span>
<span id="cb36-155"><a href="#cb36-155" aria-hidden="true"></a>            <span class="kw">PARTITION</span> <span class="kw">BY</span> category_id</span>
<span id="cb36-156"><a href="#cb36-156" aria-hidden="true"></a>            <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">month</span></span>
<span id="cb36-157"><a href="#cb36-157" aria-hidden="true"></a>            <span class="kw">RANGE</span> <span class="kw">BETWEEN</span> <span class="kw">UNBOUNDED</span> <span class="kw">PRECEDING</span> <span class="kw">AND</span> <span class="kw">UNBOUNDED</span> <span class="kw">FOLLOWING</span></span>
<span id="cb36-158"><a href="#cb36-158" aria-hidden="true"></a>        ) <span class="kw">AS</span> last_month_revenue,</span>
<span id="cb36-159"><a href="#cb36-159" aria-hidden="true"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> <span class="dt">month</span>) <span class="kw">AS</span> months_with_sales,</span>
<span id="cb36-160"><a href="#cb36-160" aria-hidden="true"></a>        <span class="fu">SUM</span>(revenue) <span class="kw">AS</span> total_revenue,</span>
<span id="cb36-161"><a href="#cb36-161" aria-hidden="true"></a>        <span class="fu">SUM</span>(units_sold) <span class="kw">AS</span> total_units</span>
<span id="cb36-162"><a href="#cb36-162" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb36-163"><a href="#cb36-163" aria-hidden="true"></a>        monthly_category_sales</span>
<span id="cb36-164"><a href="#cb36-164" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb36-165"><a href="#cb36-165" aria-hidden="true"></a>        category_id, category_name, <span class="dt">month</span>, revenue, units_sold</span>
<span id="cb36-166"><a href="#cb36-166" aria-hidden="true"></a>)</span>
<span id="cb36-167"><a href="#cb36-167" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb36-168"><a href="#cb36-168" aria-hidden="true"></a>    category_name,</span>
<span id="cb36-169"><a href="#cb36-169" aria-hidden="true"></a>    <span class="fu">SUM</span>(total_revenue) <span class="kw">AS</span> annual_revenue,</span>
<span id="cb36-170"><a href="#cb36-170" aria-hidden="true"></a>    <span class="fu">SUM</span>(total_units) <span class="kw">AS</span> annual_units,</span>
<span id="cb36-171"><a href="#cb36-171" aria-hidden="true"></a>    <span class="fu">ROUND</span>(</span>
<span id="cb36-172"><a href="#cb36-172" aria-hidden="true"></a>        (<span class="fu">MAX</span>(last_month_revenue) <span class="op">-</span> <span class="fu">MAX</span>(first_month_revenue)) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">NULLIF</span>(<span class="fu">MAX</span>(first_month_revenue), <span class="dv">0</span>),</span>
<span id="cb36-173"><a href="#cb36-173" aria-hidden="true"></a>        <span class="dv">2</span></span>
<span id="cb36-174"><a href="#cb36-174" aria-hidden="true"></a>    ) <span class="kw">AS</span> revenue_growth_percent,</span>
<span id="cb36-175"><a href="#cb36-175" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb36-176"><a href="#cb36-176" aria-hidden="true"></a>        <span class="cf">WHEN</span> <span class="fu">MAX</span>(last_month_revenue) <span class="op">&gt;</span> <span class="fu">MAX</span>(first_month_revenue) <span class="op">*</span> <span class="fl">1.1</span> <span class="cf">THEN</span> <span class="st">&#39;Growing&#39;</span></span>
<span id="cb36-177"><a href="#cb36-177" aria-hidden="true"></a>        <span class="cf">WHEN</span> <span class="fu">MAX</span>(last_month_revenue) <span class="op">&lt;</span> <span class="fu">MAX</span>(first_month_revenue) <span class="op">*</span> <span class="fl">0.9</span> <span class="cf">THEN</span> <span class="st">&#39;Declining&#39;</span></span>
<span id="cb36-178"><a href="#cb36-178" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="st">&#39;Stable&#39;</span></span>
<span id="cb36-179"><a href="#cb36-179" aria-hidden="true"></a>    <span class="cf">END</span> <span class="kw">AS</span> trend</span>
<span id="cb36-180"><a href="#cb36-180" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb36-181"><a href="#cb36-181" aria-hidden="true"></a>    category_growth</span>
<span id="cb36-182"><a href="#cb36-182" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb36-183"><a href="#cb36-183" aria-hidden="true"></a>    category_id, category_name</span>
<span id="cb36-184"><a href="#cb36-184" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb36-185"><a href="#cb36-185" aria-hidden="true"></a>    annual_revenue <span class="kw">DESC</span>;</span></code></pre>
        </div>
      </section>
      <section>
        <p><strong>Exercise 4: Creating a Simple Dashboard</strong></p>
        <p>In this exercise, we’ll prepare data for a simple dashboard that could be visualized with a tool like
          Metabase,
          Tableau, or Power BI.</p>
        <div class="sourceCode" id="cb37">
          <pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a><span class="co">-- 1. Sales Overview Dashboard</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true"></a><span class="co">-- Key metrics for the dashboard header</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> order_id) <span class="kw">AS</span> total_orders,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> customer_id) <span class="kw">AS</span> total_customers,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(amount), <span class="dv">2</span>) <span class="kw">AS</span> total_revenue,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(amount), <span class="dv">2</span>) <span class="kw">AS</span> avg_order_value</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true"></a>    orders</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true"></a><span class="kw">WHERE</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true"></a>    order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span>;</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true"></a><span class="co">-- Monthly revenue trend for line chart</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true"></a>    DATE_TRUNC(<span class="st">&#39;month&#39;</span>, order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> order_id) <span class="kw">AS</span> order_count,</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> customer_id) <span class="kw">AS</span> customer_count,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(amount), <span class="dv">2</span>) <span class="kw">AS</span> monthly_revenue,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(amount), <span class="dv">2</span>) <span class="kw">AS</span> avg_order_value</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true"></a>    orders</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true"></a><span class="kw">WHERE</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true"></a>    order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;24 months&#39;</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true"></a>    DATE_TRUNC(<span class="st">&#39;month&#39;</span>, order_date)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true"></a>    <span class="dt">month</span>;</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true"></a></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true"></a><span class="co">-- Revenue by category for pie chart</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true"></a>    c.category_name,</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price), <span class="dv">2</span>) <span class="kw">AS</span> revenue,</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> (</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true"></a>        <span class="kw">SELECT</span> <span class="fu">SUM</span>(quantity <span class="op">*</span> price) <span class="kw">FROM</span> order_item</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true"></a>        <span class="kw">JOIN</span> orders o <span class="kw">ON</span> order_item.order_id <span class="op">=</span> o.order_id</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true"></a>        <span class="kw">WHERE</span> o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true"></a>    ), <span class="dv">2</span>) <span class="kw">AS</span> percentage</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true"></a>    order_item oi</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true"></a>    orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true"></a>    product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true"></a>    <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true"></a><span class="kw">WHERE</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true"></a>    o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true"></a>    c.category_name</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true"></a>    revenue <span class="kw">DESC</span>;</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true"></a></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true"></a><span class="co">-- Revenue by region for map visualization</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true"></a>    r.region_name,</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true"></a>    r.latitude,</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true"></a>    r.longitude,</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> o.order_id) <span class="kw">AS</span> order_count,</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(o.amount), <span class="dv">2</span>) <span class="kw">AS</span> revenue</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true"></a>    orders o</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true"></a>    customer c <span class="kw">ON</span> o.customer_id <span class="op">=</span> c.customer_id</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true"></a>    region r <span class="kw">ON</span> c.region_id <span class="op">=</span> r.region_id</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true"></a><span class="kw">WHERE</span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true"></a>    o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true"></a>    r.region_name, r.latitude, r.longitude</span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true"></a>    revenue <span class="kw">DESC</span>;</span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true"></a></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true"></a><span class="co">-- Top 10 customers for bar chart</span></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true"></a>    c.name <span class="kw">AS</span> customer_name,</span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> o.order_id) <span class="kw">AS</span> order_count,</span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(o.amount), <span class="dv">2</span>) <span class="kw">AS</span> total_spent,</span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">AVG</span>(o.amount), <span class="dv">2</span>) <span class="kw">AS</span> avg_order_value</span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true"></a>    orders o</span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true"></a>    customer c <span class="kw">ON</span> o.customer_id <span class="op">=</span> c.customer_id</span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true"></a><span class="kw">WHERE</span></span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true"></a>    o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span></span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true"></a>    c.customer_id, c.name</span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true"></a>    total_spent <span class="kw">DESC</span></span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true"></a></span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true"></a><span class="co">-- 2. Product Performance Dashboard</span></span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true"></a><span class="co">-- Top 10 products by revenue</span></span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true"></a>    p.name <span class="kw">AS</span> product_name,</span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true"></a>    c.category_name,</span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> oi.order_id) <span class="kw">AS</span> order_count,</span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true"></a>    <span class="fu">SUM</span>(oi.quantity) <span class="kw">AS</span> units_sold,</span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price), <span class="dv">2</span>) <span class="kw">AS</span> revenue,</span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(oi.quantity <span class="op">*</span> (oi.price <span class="op">-</span> p.<span class="kw">cost</span>)), <span class="dv">2</span>) <span class="kw">AS</span> profit,</span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(oi.quantity <span class="op">*</span> (oi.price <span class="op">-</span> p.<span class="kw">cost</span>)) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price), <span class="dv">2</span>) <span class="kw">AS</span> profit_margin</span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true"></a>    order_item oi</span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true"></a>    orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true"></a>    product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true"></a>    <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true"></a><span class="kw">WHERE</span></span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true"></a>    o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span></span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb37-112"><a href="#cb37-112" aria-hidden="true"></a>    p.product_id, p.name, c.category_name</span>
<span id="cb37-113"><a href="#cb37-113" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb37-114"><a href="#cb37-114" aria-hidden="true"></a>    revenue <span class="kw">DESC</span></span>
<span id="cb37-115"><a href="#cb37-115" aria-hidden="true"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span>
<span id="cb37-116"><a href="#cb37-116" aria-hidden="true"></a></span>
<span id="cb37-117"><a href="#cb37-117" aria-hidden="true"></a><span class="co">-- Monthly trend for top 5 products</span></span>
<span id="cb37-118"><a href="#cb37-118" aria-hidden="true"></a><span class="kw">WITH</span> top_products <span class="kw">AS</span> (</span>
<span id="cb37-119"><a href="#cb37-119" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb37-120"><a href="#cb37-120" aria-hidden="true"></a>        p.product_id,</span>
<span id="cb37-121"><a href="#cb37-121" aria-hidden="true"></a>        p.name <span class="kw">AS</span> product_name</span>
<span id="cb37-122"><a href="#cb37-122" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb37-123"><a href="#cb37-123" aria-hidden="true"></a>        order_item oi</span>
<span id="cb37-124"><a href="#cb37-124" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb37-125"><a href="#cb37-125" aria-hidden="true"></a>        orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb37-126"><a href="#cb37-126" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb37-127"><a href="#cb37-127" aria-hidden="true"></a>        product p <span class="kw">ON</span> oi.product_id <span class="op">=</span> p.product_id</span>
<span id="cb37-128"><a href="#cb37-128" aria-hidden="true"></a>    <span class="kw">WHERE</span></span>
<span id="cb37-129"><a href="#cb37-129" aria-hidden="true"></a>        o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span></span>
<span id="cb37-130"><a href="#cb37-130" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb37-131"><a href="#cb37-131" aria-hidden="true"></a>        p.product_id, p.name</span>
<span id="cb37-132"><a href="#cb37-132" aria-hidden="true"></a>    <span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb37-133"><a href="#cb37-133" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="kw">DESC</span></span>
<span id="cb37-134"><a href="#cb37-134" aria-hidden="true"></a>    <span class="kw">LIMIT</span> <span class="dv">5</span></span>
<span id="cb37-135"><a href="#cb37-135" aria-hidden="true"></a>)</span>
<span id="cb37-136"><a href="#cb37-136" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb37-137"><a href="#cb37-137" aria-hidden="true"></a>    DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb37-138"><a href="#cb37-138" aria-hidden="true"></a>    tp.product_name,</span>
<span id="cb37-139"><a href="#cb37-139" aria-hidden="true"></a>    <span class="fu">SUM</span>(oi.quantity) <span class="kw">AS</span> units_sold,</span>
<span id="cb37-140"><a href="#cb37-140" aria-hidden="true"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price), <span class="dv">2</span>) <span class="kw">AS</span> revenue</span>
<span id="cb37-141"><a href="#cb37-141" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb37-142"><a href="#cb37-142" aria-hidden="true"></a>    order_item oi</span>
<span id="cb37-143"><a href="#cb37-143" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-144"><a href="#cb37-144" aria-hidden="true"></a>    orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb37-145"><a href="#cb37-145" aria-hidden="true"></a><span class="kw">JOIN</span></span>
<span id="cb37-146"><a href="#cb37-146" aria-hidden="true"></a>    top_products tp <span class="kw">ON</span> oi.product_id <span class="op">=</span> tp.product_id</span>
<span id="cb37-147"><a href="#cb37-147" aria-hidden="true"></a><span class="kw">WHERE</span></span>
<span id="cb37-148"><a href="#cb37-148" aria-hidden="true"></a>    o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span></span>
<span id="cb37-149"><a href="#cb37-149" aria-hidden="true"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb37-150"><a href="#cb37-150" aria-hidden="true"></a>    DATE_TRUNC(<span class="st">&#39;month&#39;</span>, o.order_date), tp.product_name</span>
<span id="cb37-151"><a href="#cb37-151" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb37-152"><a href="#cb37-152" aria-hidden="true"></a>    <span class="dt">month</span>, tp.product_name;</span>
<span id="cb37-153"><a href="#cb37-153" aria-hidden="true"></a></span>
<span id="cb37-154"><a href="#cb37-154" aria-hidden="true"></a><span class="co">-- Product performance matrix</span></span>
<span id="cb37-155"><a href="#cb37-155" aria-hidden="true"></a><span class="kw">WITH</span> product_metrics <span class="kw">AS</span> (</span>
<span id="cb37-156"><a href="#cb37-156" aria-hidden="true"></a>    <span class="kw">SELECT</span></span>
<span id="cb37-157"><a href="#cb37-157" aria-hidden="true"></a>        p.product_id,</span>
<span id="cb37-158"><a href="#cb37-158" aria-hidden="true"></a>        p.name <span class="kw">AS</span> product_name,</span>
<span id="cb37-159"><a href="#cb37-159" aria-hidden="true"></a>        c.category_name,</span>
<span id="cb37-160"><a href="#cb37-160" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price) <span class="kw">AS</span> revenue,</span>
<span id="cb37-161"><a href="#cb37-161" aria-hidden="true"></a>        <span class="fu">SUM</span>(oi.quantity <span class="op">*</span> (oi.price <span class="op">-</span> p.<span class="kw">cost</span>)) <span class="op">/</span> <span class="fu">NULLIF</span>(<span class="fu">SUM</span>(oi.quantity <span class="op">*</span> oi.price), <span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span> <span class="kw">AS</span> profit_margin</span>
<span id="cb37-162"><a href="#cb37-162" aria-hidden="true"></a>    <span class="kw">FROM</span></span>
<span id="cb37-163"><a href="#cb37-163" aria-hidden="true"></a>        product p</span>
<span id="cb37-164"><a href="#cb37-164" aria-hidden="true"></a>    <span class="kw">JOIN</span></span>
<span id="cb37-165"><a href="#cb37-165" aria-hidden="true"></a>        <span class="kw">category</span> c <span class="kw">ON</span> p.category_id <span class="op">=</span> c.category_id</span>
<span id="cb37-166"><a href="#cb37-166" aria-hidden="true"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span></span>
<span id="cb37-167"><a href="#cb37-167" aria-hidden="true"></a>        order_item oi <span class="kw">ON</span> p.product_id <span class="op">=</span> oi.product_id</span>
<span id="cb37-168"><a href="#cb37-168" aria-hidden="true"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span></span>
<span id="cb37-169"><a href="#cb37-169" aria-hidden="true"></a>        orders o <span class="kw">ON</span> oi.order_id <span class="op">=</span> o.order_id</span>
<span id="cb37-170"><a href="#cb37-170" aria-hidden="true"></a>    <span class="kw">WHERE</span></span>
<span id="cb37-171"><a href="#cb37-171" aria-hidden="true"></a>        o.order_date <span class="op">&gt;=</span> <span class="fu">CURRENT_DATE</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;12 months&#39;</span></span>
<span id="cb37-172"><a href="#cb37-172" aria-hidden="true"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb37-173"><a href="#cb37-173" aria-hidden="true"></a>        p.product_id, p.name, c.category_name</span>
<span id="cb37-174"><a href="#cb37-174" aria-hidden="true"></a>)</span>
<span id="cb37-175"><a href="#cb37-175" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb37-176"><a href="#cb37-176" aria-hidden="true"></a>    product_name,</span>
<span id="cb37-177"><a href="#cb37-177" aria-hidden="true"></a>    category_name,</span>
<span id="cb37-178"><a href="#cb37-178" aria-hidden="true"></a>    <span class="fu">ROUND</span>(revenue, <span class="dv">2</span>) <span class="kw">AS</span> revenue,</span>
<span id="cb37-179"><a href="#cb37-179" aria-hidden="true"></a>    <span class="fu">ROUND</span>(profit_margin, <span class="dv">2</span>) <span class="kw">AS</span> profit_margin,</span>
<span id="cb37-180"><a href="#cb37-180" aria-hidden="true"></a>    <span class="cf">CASE</span></span>
<span id="cb37-181"><a href="#cb37-181" aria-hidden="true"></a>        <span class="cf">WHEN</span> revenue <span class="op">&gt;</span> (<span class="kw">SELECT</span> <span class="fu">PERCENTILE_CONT</span>(<span class="fl">0.75</span>) WITHIN <span class="kw">GROUP</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> revenue) <span class="kw">FROM</span> product_metrics)</span>
<span id="cb37-182"><a href="#cb37-182" aria-hidden="true"></a>             <span class="kw">AND</span> profit_margin <span class="op">&gt;</span> (<span class="kw">SELECT</span> <span class="fu">PERCENTILE_CONT</span>(<span class="fl">0.75</span>) WITHIN <span class="kw">GROUP</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> profit_margin) <span class="kw">FROM</span> product_metrics)</span>
<span id="cb37-183"><a href="#cb37-183" aria-hidden="true"></a>        <span class="cf">THEN</span> <span class="st">&#39;Star&#39;</span></span>
<span id="cb37-184"><a href="#cb37-184" aria-hidden="true"></a>        <span class="cf">WHEN</span> revenue <span class="op">&gt;</span> (<span class="kw">SELECT</span> <span class="fu">PERCENTILE_CONT</span>(<span class="fl">0.75</span>) WITHIN <span class="kw">GROUP</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> revenue) <span class="kw">FROM</span> product_metrics)</span>
<span id="cb37-185"><a href="#cb37-185" aria-hidden="true"></a>             <span class="kw">AND</span> profit_margin <span class="op">&lt;=</span> (<span class="kw">SELECT</span> <span class="fu">PERCENTILE_CONT</span>(<span class="fl">0.75</span>) WITHIN <span class="kw">GROUP</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> profit_margin) <span class="kw">FROM</span> product_metrics)</span>
<span id="cb37-186"><a href="#cb37-186" aria-hidden="true"></a>        <span class="cf">THEN</span> <span class="st">&#39;High Volume&#39;</span></span>
<span id="cb37-187"><a href="#cb37-187" aria-hidden="true"></a>        <span class="cf">WHEN</span> revenue <span class="op">&lt;=</span> (<span class="kw">SELECT</span> <span class="fu">PERCENTILE_CONT</span>(<span class="fl">0.75</span>) WITHIN <span class="kw">GROUP</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> revenue) <span class="kw">FROM</span> product_metrics)</span>
<span id="cb37-188"><a href="#cb37-188" aria-hidden="true"></a>             <span class="kw">AND</span> profit_margin <span class="op">&gt;</span> (<span class="kw">SELECT</span> <span class="fu">PERCENTILE_CONT</span>(<span class="fl">0.75</span>) WITHIN <span class="kw">GROUP</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> profit_margin) <span class="kw">FROM</span> product_metrics)</span>
<span id="cb37-189"><a href="#cb37-189" aria-hidden="true"></a>        <span class="cf">THEN</span> <span class="st">&#39;High Margin&#39;</span></span>
<span id="cb37-190"><a href="#cb37-190" aria-hidden="true"></a>        <span class="cf">ELSE</span> <span class="st">&#39;Underperformer&#39;</span></span>
<span id="cb37-191"><a href="#cb37-191" aria-hidden="true"></a>    <span class="cf">END</span> <span class="kw">AS</span> quadrant</span>
<span id="cb37-192"><a href="#cb37-192" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb37-193"><a href="#cb37-193" aria-hidden="true"></a>    product_metrics</span>
<span id="cb37-194"><a href="#cb37-194" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb37-195"><a href="#cb37-195" aria-hidden="true"></a>    revenue <span class="kw">DESC</span>, profit_margin <span class="kw">DESC</span>;</span></code></pre>
        </div>
        <p>These exercises demonstrate how to use PostgreSQL's analytics capabilities to extract valuable business
          insights from an ERP database. The queries can be used directly with visualization tools to create dashboards
          or
          exported to CSV/JSON for further analysis in specialized tools.</p>
      </section>
      <section>
        <h3 id="practice-exercises">Practice What You Learned</h3>
        <p>Ready to master analytics and data visualization? Practice window functions, advanced aggregations, CTEs, and data preparation with hands-on exercises.</p>
        <p><a href="02_analytics_data_visualization_examples.html" class="btn btn-primary">Go to Practical Examples &rarr;</a></p>
      </section>
    </div>
  </div> <!-- /container -->
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>


<!-- Mirrored from code-mext.github.io/sql-training/day4/02_analytics_data_visualization.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 10 Jan 2026 07:44:40 GMT -->
</html>